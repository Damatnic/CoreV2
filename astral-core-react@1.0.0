
> astral-core-react@1.0.0 test
> jest test --no-coverage

FAIL src/hooks/useSafeLocation.test.ts (7.395 s)
  useSafeLocation Hook
    √ should return location from router context when available (24 ms)
    √ should return fallback location when no router context exists (4 ms)
    × should return fallback location when context has no location
    × should handle various location states (1 ms)
    × should handle missing search parameter (1 ms)
    × should handle missing hash parameter (1 ms)
    × should handle missing state parameter (1 ms)
    × should handle missing key parameter (1 ms)
    √ should work consistently across multiple renders (8 ms)
    × should handle context changes
    √ should maintain type safety (3 ms)
    × should handle edge case of undefined context
    × should handle complex state objects
    × should handle empty string values correctly (1 ms)
    × should be usable outside Router context without errors

  ● useSafeLocation Hook › should return fallback location when context has no location

    ReferenceError: React is not defined

    [0m [90m 54 |[39m   it([32m'should return fallback location when context has no location'[39m[33m,[39m () [33m=>[39m {
     [90m 55 |[39m     [90m// Mock useContext to return context without location[39m
    [31m[1m>[22m[39m[90m 56 |[39m     jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockReturnValue({})[33m;[39m
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 57 |[39m
     [90m 58 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useSafeLocation())[33m;[39m
     [90m 59 |[39m[0m

      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:56:16)

  ● useSafeLocation Hook › should handle various location states

    ReferenceError: React is not defined

    [0m [90m 100 |[39m
     [90m 101 |[39m     locationStates[33m.[39mforEach((locationState) [33m=>[39m {
    [31m[1m>[22m[39m[90m 102 |[39m       jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockReturnValue({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 103 |[39m         location[33m:[39m locationState
     [90m 104 |[39m       })[33m;[39m
     [90m 105 |[39m[0m

      at src/hooks/useSafeLocation.test.ts:102:18
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:101:20)

  ● useSafeLocation Hook › should handle missing search parameter

    ReferenceError: React is not defined

    [0m [90m 111 |[39m
     [90m 112 |[39m   it([32m'should handle missing search parameter'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 113 |[39m     jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockReturnValue({
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 114 |[39m       location[33m:[39m {
     [90m 115 |[39m         pathname[33m:[39m [32m'/test'[39m[33m,[39m
     [90m 116 |[39m         hash[33m:[39m [32m'#section'[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:113:16)

  ● useSafeLocation Hook › should handle missing hash parameter

    ReferenceError: React is not defined

    [0m [90m 131 |[39m
     [90m 132 |[39m   it([32m'should handle missing hash parameter'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 133 |[39m     jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockReturnValue({
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 134 |[39m       location[33m:[39m {
     [90m 135 |[39m         pathname[33m:[39m [32m'/test'[39m[33m,[39m
     [90m 136 |[39m         search[33m:[39m [32m'?test=true'[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:133:16)

  ● useSafeLocation Hook › should handle missing state parameter

    ReferenceError: React is not defined

    [0m [90m 151 |[39m
     [90m 152 |[39m   it([32m'should handle missing state parameter'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 153 |[39m     jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockReturnValue({
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 154 |[39m       location[33m:[39m {
     [90m 155 |[39m         pathname[33m:[39m [32m'/test'[39m[33m,[39m
     [90m 156 |[39m         search[33m:[39m [32m'?test=true'[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:153:16)

  ● useSafeLocation Hook › should handle missing key parameter

    ReferenceError: React is not defined

    [0m [90m 171 |[39m
     [90m 172 |[39m   it([32m'should handle missing key parameter'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 173 |[39m     jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockReturnValue({
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 174 |[39m       location[33m:[39m {
     [90m 175 |[39m         pathname[33m:[39m [32m'/test'[39m[33m,[39m
     [90m 176 |[39m         search[33m:[39m [32m'?test=true'[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:173:16)

  ● useSafeLocation Hook › should handle context changes

    ReferenceError: React is not defined

    [0m [90m 214 |[39m     }[33m;[39m
     [90m 215 |[39m
    [31m[1m>[22m[39m[90m 216 |[39m     jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockImplementation(() [33m=>[39m contextValue)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 217 |[39m
     [90m 218 |[39m     [36mconst[39m { result[33m,[39m rerender } [33m=[39m renderHook(() [33m=>[39m useSafeLocation())[33m;[39m
     [90m 219 |[39m[0m

      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:216:16)

  ● useSafeLocation Hook › should handle edge case of undefined context

    ReferenceError: React is not defined

    [0m [90m 252 |[39m
     [90m 253 |[39m   it([32m'should handle edge case of undefined context'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 254 |[39m     jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockReturnValue(undefined)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 255 |[39m
     [90m 256 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useSafeLocation())[33m;[39m
     [90m 257 |[39m[0m

      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:254:16)

  ● useSafeLocation Hook › should handle complex state objects

    ReferenceError: React is not defined

    [0m [90m 273 |[39m     }[33m;[39m
     [90m 274 |[39m
    [31m[1m>[22m[39m[90m 275 |[39m     jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockReturnValue({
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 276 |[39m       location[33m:[39m {
     [90m 277 |[39m         pathname[33m:[39m [32m'/complex'[39m[33m,[39m
     [90m 278 |[39m         search[33m:[39m [32m'?complex=true&nested=value'[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:275:16)

  ● useSafeLocation Hook › should handle empty string values correctly

    ReferenceError: React is not defined

    [0m [90m 293 |[39m
     [90m 294 |[39m   it([32m'should handle empty string values correctly'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 295 |[39m     jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockReturnValue({
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 296 |[39m       location[33m:[39m {
     [90m 297 |[39m         pathname[33m:[39m [32m''[39m[33m,[39m
     [90m 298 |[39m         search[33m:[39m [32m''[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:295:16)

  ● useSafeLocation Hook › should be usable outside Router context without errors

    ReferenceError: React is not defined

    [0m [90m 314 |[39m   it([32m'should be usable outside Router context without errors'[39m[33m,[39m () [33m=>[39m {
     [90m 315 |[39m     [90m// This simulates usage outside of Router context entirely[39m
    [31m[1m>[22m[39m[90m 316 |[39m     jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockReturnValue([36mnull[39m)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 317 |[39m
     [90m 318 |[39m     expect(() [33m=>[39m {
     [90m 319 |[39m       [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useSafeLocation())[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:316:16)

  console.error
    Error: Uncaught [TypeError: performance.now is not a function]
        at reportException (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\helpers\runtime-script-errors.js:66:24)
        at innerInvokeEventListeners (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:353:9)
        at invokeEventListeners (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:286:3)
        at HTMLUnknownElementImpl._dispatch (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:233:9)
        at HTMLUnknownElementImpl.dispatchEvent (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:104:17)
        at HTMLUnknownElement.dispatchEvent (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\generated\EventTarget.js:241:34)
        at Object.invokeGuardedCallbackDev (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:4213:16)
        at invokeGuardedCallback (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:4277:31)
        at reportUncaughtErrorInDEV (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:22877:5)
        at captureCommitPhaseError (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27165:5)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24932:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at renderRoot (C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\pure.js:190:26)
        at render (C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\pure.js:292:10)
        at C:\Users\damat\_REPOS\CoreV2\src\utils\enhancedRouting.test.ts:601:15
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\node_modules\expect\build\toThrowMatchers.js:74:11)
        at Object.throwingMatcher [as toThrow] (C:\Users\damat\_REPOS\CoreV2\node_modules\expect\build\index.js:320:21)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\utils\enhancedRouting.test.ts:602:14)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12) {
      detail: TypeError: performance.now is not a function
          at C:\Users\damat\_REPOS\CoreV2\src\utils\enhancedRouting.ts:455:37
          at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
          at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
          at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
          at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
          at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
          at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
          at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
          at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
          at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
          at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
          at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
          at renderRoot (C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\pure.js:190:26)
          at render (C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\pure.js:292:10)
          at C:\Users\damat\_REPOS\CoreV2\src\utils\enhancedRouting.test.ts:601:15
          at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\node_modules\expect\build\toThrowMatchers.js:74:11)
          at Object.throwingMatcher [as toThrow] (C:\Users\damat\_REPOS\CoreV2\node_modules\expect\build\index.js:320:21)
          at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\utils\enhancedRouting.test.ts:602:14)
          at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
          at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
          at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
          at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
          at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
          at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
          at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
          at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
          at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
          at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
          at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12),
      type: 'unhandled exception'
    }

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at reportException (node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:70:28)
      at innerInvokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
      at invokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
      at HTMLUnknownElementImpl._dispatch (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
      at HTMLUnknownElementImpl.dispatchEvent (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
      at HTMLUnknownElement.dispatchEvent (node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
      at Object.invokeGuardedCallbackDev (node_modules/react-dom/cjs/react-dom.development.js:4213:16)
      at invokeGuardedCallback (node_modules/react-dom/cjs/react-dom.development.js:4277:31)
      at reportUncaughtErrorInDEV (node_modules/react-dom/cjs/react-dom.development.js:22877:5)
      at captureCommitPhaseError (node_modules/react-dom/cjs/react-dom.development.js:27165:5)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24932:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at src/utils/enhancedRouting.test.ts:601:15
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/utils/enhancedRouting.test.ts:602:14)

  console.error
    The above error occurred in the <withRouteTracking(TestComponent)> component:
    
        at TrackedComponent (C:\Users\damat\_REPOS\CoreV2\src\utils\enhancedRouting.ts:454:14)
    
    Consider adding an error boundary to your tree to customize error handling behavior.
    Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at logCapturedError (node_modules/react-dom/cjs/react-dom.development.js:18704:23)
      at update.callback (node_modules/react-dom/cjs/react-dom.development.js:18737:5)
      at callCallback (node_modules/react-dom/cjs/react-dom.development.js:15036:12)
      at commitUpdateQueue (node_modules/react-dom/cjs/react-dom.development.js:15057:9)
      at commitLayoutEffectOnFiber (node_modules/react-dom/cjs/react-dom.development.js:23430:13)
      at commitLayoutMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24727:9)
      at commitLayoutEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24713:7)
      at commitLayoutEffects (node_modules/react-dom/cjs/react-dom.development.js:24651:3)
      at commitRootImpl (node_modules/react-dom/cjs/react-dom.development.js:26862:5)
      at commitRoot (node_modules/react-dom/cjs/react-dom.development.js:26721:5)
      at performSyncWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:26156:3)
      at flushSyncCallbacks (node_modules/react-dom/cjs/react-dom.development.js:12042:22)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27099:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at src/utils/enhancedRouting.test.ts:601:15
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/utils/enhancedRouting.test.ts:602:14)

  console.log
    [Crisis Detection] Severity reduced from high to medium due to protective factors: [ 'ambivalence', 'professional_support', 'past_recovery' ]

      at AstralCoreCrisisDetectionService.analyzeCrisisContent (src/services/crisisDetectionService.ts:209:19)

FAIL src/services/__tests__/crisisDetection.integration.test.ts
  Crisis Detection Service - Integration Tests
    Critical Crisis Detection
      √ should detect immediate suicide risk (3 ms)
      √ should detect self-harm indicators (2 ms)
      √ should detect substance abuse crisis (1 ms)
    Protective Factors Detection
      × should recognize protective factors that reduce risk (3 ms)
      × should detect help-seeking behavior (2 ms)
    False Positive Prevention
      √ should not flag casual mentions (1 ms)
      × should not flag past tense recovery stories (59 ms)
    Multilingual Crisis Detection
      × should have support for multiple languages
    Escalation Workflow
      × should trigger emergency escalation for critical threats (1 ms)
      × should recommend professional support for high-risk cases (1 ms)
    Performance
      √ should analyze text quickly (under 100ms) (1 ms)
      √ should handle very long texts (2 ms)
  Crisis Detection Service - Edge Cases
    √ should handle empty input (1 ms)
    √ should handle null/undefined gracefully
    √ should handle special characters and emojis (1 ms)

  ● Crisis Detection Service - Integration Tests › Protective Factors Detection › should recognize protective factors that reduce risk

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 50 |[39m       )[33m;[39m
     [90m 51 |[39m       
    [31m[1m>[22m[39m[90m 52 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 53 |[39m       expect(result[33m.[39mprotectiveFactors[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m 54 |[39m       expect(result[33m.[39mprotectiveFactors)[33m.[39mtoContain([32m'life_responsibilities'[39m)[33m;[39m
     [90m 55 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetection.integration.test.ts:52:42)

  ● Crisis Detection Service - Integration Tests › Protective Factors Detection › should detect help-seeking behavior

    expect(received).toContain(expected) // indexOf

    Expected value: "professional_support"
    Received array: ["Provide suicide prevention resources", "Share safety planning tools", "Connect with crisis hotline", "Schedule follow-up check-in", "Provide comprehensive resource list", "Connect with peer support", "Facilitate connection to requested support resources"]

    [0m [90m 62 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 63 |[39m       expect(result[33m.[39mprotectiveFactors)[33m.[39mtoContain([32m'help_seeking'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 64 |[39m       expect(result[33m.[39mrecommendedActions)[33m.[39mtoContain([32m'professional_support'[39m)[33m;[39m
     [90m    |[39m                                         [31m[1m^[22m[39m
     [90m 65 |[39m     })[33m;[39m
     [90m 66 |[39m   })[33m;[39m
     [90m 67 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetection.integration.test.ts:64:41)

  ● Crisis Detection Service - Integration Tests › False Positive Prevention › should not flag past tense recovery stories

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 81 |[39m       )[33m;[39m
     [90m 82 |[39m       
    [31m[1m>[22m[39m[90m 83 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 84 |[39m       expect(result[33m.[39mseverityLevel)[33m.[39mtoBe([32m'none'[39m)[33m;[39m
     [90m 85 |[39m     })[33m;[39m
     [90m 86 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetection.integration.test.ts:83:42)

  ● Crisis Detection Service - Integration Tests › Multilingual Crisis Detection › should have support for multiple languages

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 90 |[39m       [90m// Test that the service has multilingual capabilities[39m
     [90m 91 |[39m       [36mconst[39m service [33m=[39m astralCoreCrisisDetection [36mas[39m any[33m;[39m
    [31m[1m>[22m[39m[90m 92 |[39m       expect(service[33m.[39msupportedLanguages)[33m.[39mtoBeDefined()[33m;[39m
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 93 |[39m       expect(service[33m.[39msupportedLanguages[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m1[39m)[33m;[39m
     [90m 94 |[39m     })[33m;[39m
     [90m 95 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetection.integration.test.ts:92:42)

  ● Crisis Detection Service - Integration Tests › Escalation Workflow › should trigger emergency escalation for critical threats

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 101 |[39m       )[33m;[39m
     [90m 102 |[39m       
    [31m[1m>[22m[39m[90m 103 |[39m       expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                         [31m[1m^[22m[39m
     [90m 104 |[39m       expect(result[33m.[39memergencyServices)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 105 |[39m       expect(result[33m.[39mrecommendedActions)[33m.[39mtoContain([32m'call_emergency'[39m)[33m;[39m
     [90m 106 |[39m       expect(result[33m.[39mrecommendedActions)[33m.[39mtoContain([32m'immediate_intervention'[39m)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetection.integration.test.ts:103:41)

  ● Crisis Detection Service - Integration Tests › Escalation Workflow › should recommend professional support for high-risk cases

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 112 |[39m       )[33m;[39m
     [90m 113 |[39m       
    [31m[1m>[22m[39m[90m 114 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 115 |[39m       expect(result[33m.[39mrecommendedActions)[33m.[39mtoContain([32m'professional_support'[39m)[33m;[39m
     [90m 116 |[39m       expect(result[33m.[39mrecommendedActions)[33m.[39mtoContain([32m'crisis_hotline'[39m)[33m;[39m
     [90m 117 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetection.integration.test.ts:114:42)

FAIL src/utils/enhancedRouting.test.ts (7.856 s)
  enhancedRouting
    EnhancedRouteManager
      initialize
        √ should initialize route manager only once (12 ms)
        √ should setup navigation monitoring (2 ms)
        × should setup intersection observers for viewport preloading (1 ms)
        √ should log initialization in development (2 ms)
      registerRoute
        √ should register a route with default configuration (1 ms)
        √ should register route with custom configuration (1 ms)
        √ should schedule preload when preload is true (4 ms)
      createLazyRoute
        √ should create lazy route with default options (1 ms)
        √ should create lazy route with custom options (1 ms)
      navigation tracking
        √ should record navigation patterns (1 ms)
        √ should handle popstate events (1 ms)
      preloading
        × should preload critical routes on initialization (1 ms)
        √ should not duplicate preload requests
      performance tracking
        √ should provide navigation statistics (2 ms)
        √ should provide route metrics (1 ms)
        √ should return metrics for non-existent route
      viewport-based preloading
        × should setup intersection observer for viewport preloading (2 ms)
        √ should observe links when they are added to DOM (1 ms)
      hover-based preloading
        × should setup hover preloading for specified routes (1 ms)
      interaction-based preloading
        × should setup interaction preloading for specified routes (1 ms)
      cleanup and memory management
        √ should cleanup unused resources in development
    useEnhancedRouting hook
      √ should initialize route manager on mount (15 ms)
      √ should return route utilities (4 ms)
      × should provide access to route manager methods (3 ms)
    withRouteTracking HOC
      √ should wrap component with performance tracking (1 ms)
      √ should track render performance in development (7 ms)
      √ should handle component without display name (1 ms)
      √ should handle anonymous components (1 ms)
      √ should pass props correctly to wrapped component (4 ms)
    navigation patterns and prediction
      √ should track and predict navigation patterns (4 ms)
      √ should limit navigation history to prevent memory leaks (272 ms)
    error handling
      √ should handle intersection observer unavailability (1 ms)
      √ should handle mutation observer unavailability
      × should handle performance API unavailability (187 ms)
    mobile optimization
      √ should respect mobile optimization settings (1 ms)
      √ should handle data saver mode
    bundle integration
      √ should integrate with bundle optimization
      √ should work with enhanced lazy components (1 ms)

  ● enhancedRouting › EnhancedRouteManager › initialize › should setup intersection observers for viewport preloading

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 116 |[39m         [33mEnhancedRouteManager[39m[33m.[39minitialize()[33m;[39m
     [90m 117 |[39m         
    [31m[1m>[22m[39m[90m 118 |[39m         expect(mockIntersectionObserver)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 119 |[39m       })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m       it([32m'should log initialization in development'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/enhancedRouting.test.ts:118:42)

  ● enhancedRouting › EnhancedRouteManager › preloading › should preload critical routes on initialization

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/", Any<Function>, "high"

    Number of calls: 0

    [0m [90m 251 |[39m         ([33mEnhancedRouteManager[39m [36mas[39m any)[33m.[39mpreloadCriticalRoutes()[33m;[39m
     [90m 252 |[39m
    [31m[1m>[22m[39m[90m 253 |[39m         expect([33mComponentPreloader[39m[33m.[39maddToQueue)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                               [31m[1m^[22m[39m
     [90m 254 |[39m           [32m'/'[39m[33m,[39m
     [90m 255 |[39m           expect[33m.[39many([33mFunction[39m)[33m,[39m
     [90m 256 |[39m           [32m'high'[39m[0m

      at Object.<anonymous> (src/utils/enhancedRouting.test.ts:253:47)

  ● enhancedRouting › EnhancedRouteManager › viewport-based preloading › should setup intersection observer for viewport preloading

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: Any<Function>, {"rootMargin": "100px"}

    Number of calls: 0

    [0m [90m 332 |[39m
     [90m 333 |[39m       it([32m'should setup intersection observer for viewport preloading'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 334 |[39m         expect(mockIntersectionObserver)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 335 |[39m           expect[33m.[39many([33mFunction[39m)[33m,[39m
     [90m 336 |[39m           { rootMargin[33m:[39m [32m'100px'[39m }
     [90m 337 |[39m         )[33m;[39m[0m

      at Object.<anonymous> (src/utils/enhancedRouting.test.ts:334:42)

  ● enhancedRouting › EnhancedRouteManager › hover-based preloading › should setup hover preloading for specified routes

    expect(received).toHaveBeenCalledWith(...expected)

    Matcher error: received value must be a mock or spy function

    Received has type:  function
    Received has value: [Function addEventListener]

    [0m [90m 377 |[39m
     [90m 378 |[39m         [36mconst[39m hoverListener [33m=[39m document[33m.[39maddEventListener [36mas[39m jest[33m.[39m[33mMock[39m[33m;[39m
    [31m[1m>[22m[39m[90m 379 |[39m         expect(hoverListener)[33m.[39mtoHaveBeenCalledWith([32m'mouseover'[39m[33m,[39m expect[33m.[39many([33mFunction[39m))[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 380 |[39m       })[33m;[39m
     [90m 381 |[39m     })[33m;[39m
     [90m 382 |[39m[0m

      at Object.<anonymous> (src/utils/enhancedRouting.test.ts:379:31)

  ● enhancedRouting › EnhancedRouteManager › interaction-based preloading › should setup interaction preloading for specified routes

    expect(received).toHaveBeenCalledWith(...expected)

    Matcher error: received value must be a mock or spy function

    Received has type:  function
    Received has value: [Function addEventListener]

    [0m [90m 396 |[39m
     [90m 397 |[39m         [90m// Should setup touch and mouse event listeners[39m
    [31m[1m>[22m[39m[90m 398 |[39m         expect(document[33m.[39maddEventListener)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 399 |[39m           [32m'touchstart'[39m[33m,[39m
     [90m 400 |[39m           expect[33m.[39many([33mFunction[39m)[33m,[39m
     [90m 401 |[39m           { passive[33m:[39m [36mtrue[39m }[0m

      at Object.<anonymous> (src/utils/enhancedRouting.test.ts:398:43)

  ● enhancedRouting › useEnhancedRouting hook › should provide access to route manager methods

    TypeError: Cannot read properties of undefined (reading 'length')

    [0m [90m 414 |[39m   [36mstatic[39m getNavigationStats() {
     [90m 415 |[39m     [36mreturn[39m {
    [31m[1m>[22m[39m[90m 416 |[39m       totalNavigations[33m:[39m [36mthis[39m[33m.[39mnavigationHistory[33m.[39mlength[33m,[39m
     [90m     |[39m                                                [31m[1m^[22m[39m
     [90m 417 |[39m       currentRoute[33m:[39m [36mthis[39m[33m.[39mcurrentRoute[33m,[39m
     [90m 418 |[39m       preloadedRoutes[33m:[39m [33mArray[39m[33m.[39m[36mfrom[39m([36mthis[39m[33m.[39mpreloadCache)[33m,[39m
     [90m 419 |[39m       registeredRoutes[33m:[39m [33mArray[39m[33m.[39m[36mfrom[39m([36mthis[39m[33m.[39mroutes[33m.[39mkeys())[33m,[39m[0m

      at Object.getNavigationStats (src/utils/enhancedRouting.ts:416:48)
      at Object.<anonymous> (src/utils/enhancedRouting.test.ts:456:36)

  ● enhancedRouting › error handling › should handle performance API unavailability

    expect(received).not.toThrow()

    Error name:    "TypeError"
    Error message: "performance.now is not a function"

        [0m [90m 453 |[39m   [36mconst[39m [33mTrackedComponent[39m[33m:[39m [33mReact[39m[33m.[39m[33mFC[39m[33m<[39m[33mP[39m[33m>[39m [33m=[39m (props) [33m=>[39m {
         [90m 454 |[39m     useEffect(() [33m=>[39m {
        [31m[1m>[22m[39m[90m 455 |[39m       [36mconst[39m startTime [33m=[39m performance[33m.[39mnow()[33m;[39m
         [90m     |[39m                                     [31m[1m^[22m[39m
         [90m 456 |[39m       
         [90m 457 |[39m       [36mreturn[39m () [33m=>[39m {
         [90m 458 |[39m         [36mconst[39m endTime [33m=[39m performance[33m.[39mnow()[33m;[39m[0m

      at src/utils/enhancedRouting.ts:455:37
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at src/utils/enhancedRouting.test.ts:601:15
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/utils/enhancedRouting.test.ts:602:14)
      at Object.<anonymous> (src/utils/enhancedRouting.test.ts:602:14)

PASS src/services/__tests__/crisisDetectionService.test.ts
  EnhancedCrisisDetectionService
    analyzeCrisisContent
      √ should detect critical crisis level from severe keywords (2 ms)
      √ should detect high crisis level from moderate suicidal ideation (5 ms)
      √ should detect self-harm indicators (2 ms)
      √ should detect emergency situations (1 ms)
      √ should return low severity for normal text
      √ should handle empty or null input gracefully (1 ms)
      √ should consider urgency modifiers in analysis (1 ms)
      √ should identify risk and protective factors (1 ms)
      √ should provide appropriate recommended actions (1 ms)
    getEscalationActions
      √ should provide immediate escalation for emergency services cases
      √ should provide appropriate escalation for high-risk situations
    generateCrisisResponse
      √ should generate appropriate response for emergency situations (1 ms)
      √ should generate different responses for seekers vs helpers (1 ms)
      √ should provide supportive response for medium-level situations (6 ms)
    edge cases and error handling
      √ should handle malformed input gracefully (3 ms)
      √ should maintain consistent response structure (7 ms)
      Protective Factors Integration
        √ should identify protective factors in text (1 ms)
        √ should reduce severity when strong protective factors are present (1 ms)
        √ should identify all types of protective factors (1 ms)
        √ should not reduce severity for emergency situations despite protective factors
        √ should provide protective factor-based recommendations (1 ms)
        √ should handle ambivalence as a protective factor
      Comprehensive Crisis Scenarios
        √ should handle complex multi-factor crisis situations (1 ms)
        √ should detect crisis in different languages expressions (1 ms)
        √ should handle temporal urgency indicators (1 ms)
        √ should differentiate between past and present crisis
        √ should handle violence threats appropriately
        √ should detect panic and anxiety crises (6 ms)
        √ should provide appropriate escalation actions (1 ms)
        √ should generate appropriate crisis responses for seekers
      Edge Cases and Boundary Testing
        √ should handle very long text inputs (4 ms)
        √ should handle text with special characters (1 ms)
        √ should handle mixed case text (1 ms)
        √ should not trigger false positives for non-crisis content (1 ms)
        √ should handle context modifiers correctly (1 ms)
      Performance and Consistency
        √ should analyze text within reasonable time (1 ms)
        √ should provide consistent results for identical inputs
        √ should handle concurrent analysis requests (1 ms)

FAIL src/utils/truncateText.test.ts (7.795 s)
  truncateText
    basic functionality
      √ should return original text when shorter than max length (15 ms)
      × should truncate text when longer than max length (3 ms)
      √ should use custom suffix when provided (1 ms)
      √ should return original text when exactly at max length (1 ms)
    edge cases
      √ should handle empty string
      √ should handle null input (1 ms)
      √ should handle undefined input
      √ should handle zero max length (1 ms)
      √ should handle negative max length (1 ms)
      √ should handle very long suffix
      × should handle empty suffix (2 ms)
    unicode and special characters
      × should handle unicode characters correctly (1 ms)
      √ should handle accented characters
      √ should handle newline characters
      √ should handle tab characters (1 ms)
      √ should handle mixed whitespace
    boundary conditions
      √ should handle text length equal to max length
      √ should handle text length one more than max length (1 ms)
      √ should handle very small max length with default suffix
      √ should handle max length smaller than suffix (1 ms)
    default parameter behavior
      × should use default suffix when not provided
      × should handle default suffix with various lengths
    performance and memory
      √ should handle very long strings efficiently
      √ should not create unnecessary string copies when no truncation needed
      √ should handle multiple calls efficiently
    real-world scenarios
      √ should handle typical social media post truncation (1 ms)
      × should handle news headline truncation (1 ms)
      × should handle email subject line truncation (1 ms)
      × should handle product description truncation (1 ms)
      √ should handle user bio truncation (1 ms)
    consistent behavior
      √ should produce consistent results for same inputs
      × should handle different data types gracefully (14 ms)
    integration with default export
      √ should be available as default export (1 ms)

  ● truncateText › basic functionality › should truncate text when longer than max length

    expect(received).toBe(expected) // Object.is equality

    Expected: 23
    Received: 22

    [0m [90m 18 |[39m       [36mconst[39m result [33m=[39m truncateText(text[33m,[39m [35m20[39m)[33m;[39m
     [90m 19 |[39m       expect(result)[33m.[39mtoBe([32m'This is a very long...'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 20 |[39m       expect(result[33m.[39mlength)[33m.[39mtoBe([35m23[39m)[33m;[39m [90m// 20 + 3 for '...'[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 21 |[39m     })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m     it([32m'should use custom suffix when provided'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/truncateText.test.ts:20:29)

  ● truncateText › edge cases › should handle empty suffix

    expect(received).toBe(expected) // Object.is equality

    Expected: "This is a "
    Received: "This is a"

    [0m [90m 71 |[39m       [36mconst[39m text [33m=[39m [32m'This is a long text that will be truncated'[39m[33m;[39m
     [90m 72 |[39m       [36mconst[39m result [33m=[39m truncateText(text[33m,[39m [35m10[39m[33m,[39m [32m''[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 73 |[39m       expect(result)[33m.[39mtoBe([32m'This is a '[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 74 |[39m       expect(result[33m.[39mlength)[33m.[39mtoBe([35m10[39m)[33m;[39m
     [90m 75 |[39m     })[33m;[39m
     [90m 76 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/utils/truncateText.test.ts:73:22)

  ● truncateText › unicode and special characters › should handle unicode characters correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: "Hello 👋 World ..."
    Received: "Hello 👋 World..."

    [0m [90m 80 |[39m       [36mconst[39m text [33m=[39m [32m'Hello 👋 World 🌍 How are you? 😊'[39m[33m;[39m
     [90m 81 |[39m       [36mconst[39m result [33m=[39m truncateText(text[33m,[39m [35m15[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 82 |[39m       expect(result)[33m.[39mtoBe([32m'Hello 👋 World ...'[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 83 |[39m     })[33m;[39m
     [90m 84 |[39m
     [90m 85 |[39m     it([32m'should handle accented characters'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/truncateText.test.ts:82:22)

  ● truncateText › default parameter behavior › should use default suffix when not provided

    expect(received).toBe(expected) // Object.is equality

    Expected: "This is a ..."
    Received: "This is a..."

    [0m [90m 140 |[39m       [36mconst[39m text [33m=[39m [32m'This is a long text'[39m[33m;[39m
     [90m 141 |[39m       [36mconst[39m result [33m=[39m truncateText(text[33m,[39m [35m10[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 142 |[39m       expect(result)[33m.[39mtoBe([32m'This is a ...'[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 143 |[39m       expect(result[33m.[39mendsWith([32m'...'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 144 |[39m     })[33m;[39m
     [90m 145 |[39m[0m

      at Object.<anonymous> (src/utils/truncateText.test.ts:142:22)

  ● truncateText › default parameter behavior › should handle default suffix with various lengths

    expect(received).toBe(expected) // Object.is equality

    Expected: "This ..."
    Received: "This..."

    [0m [90m 151 |[39m       [36mconst[39m result3 [33m=[39m truncateText(longText[33m,[39m [35m25[39m)[33m;[39m
     [90m 152 |[39m       
    [31m[1m>[22m[39m[90m 153 |[39m       expect(result1)[33m.[39mtoBe([32m'This ...'[39m)[33m;[39m
     [90m     |[39m                       [31m[1m^[22m[39m
     [90m 154 |[39m       expect(result2)[33m.[39mtoBe([32m'This is a very ...'[39m)[33m;[39m
     [90m 155 |[39m       expect(result3)[33m.[39mtoBe([32m'This is a very long text...'[39m)[33m;[39m
     [90m 156 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/utils/truncateText.test.ts:153:23)

  ● truncateText › real-world scenarios › should handle news headline truncation

    expect(received).toBe(expected) // Object.is equality

    Expected: "Breaking News: Major Technology Company Announces Revolut..."
    Received: "Breaking News: Major Technology Company Announces Revolution..."

    [0m [90m 207 |[39m       
     [90m 208 |[39m       expect(result[33m.[39mlength)[33m.[39mtoBe([35m63[39m)[33m;[39m [90m// 60 + 3[39m
    [31m[1m>[22m[39m[90m 209 |[39m       expect(result)[33m.[39mtoBe([32m'Breaking News: Major Technology Company Announces Revolut...'[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 210 |[39m     })[33m;[39m
     [90m 211 |[39m
     [90m 212 |[39m     it([32m'should handle email subject line truncation'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/truncateText.test.ts:209:22)

  ● truncateText › real-world scenarios › should handle email subject line truncation

    expect(received).toBe(expected) // Object.is equality

    Expected: "Urgent: Please review the quarterly budget propos..."
    Received: "Urgent: Please review the quarterly budget proposa..."

    [0m [90m 215 |[39m       
     [90m 216 |[39m       expect(result[33m.[39mlength)[33m.[39mtoBe([35m53[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 217 |[39m       expect(result)[33m.[39mtoBe([32m'Urgent: Please review the quarterly budget propos...'[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 218 |[39m     })[33m;[39m
     [90m 219 |[39m
     [90m 220 |[39m     it([32m'should handle product description truncation'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/truncateText.test.ts:217:22)

  ● truncateText › real-world scenarios › should handle product description truncation

    expect(received).toBe(expected) // Object.is equality

    Expected: "This premium organic cotton t-shirt features a comfortable relaxed fit, sustai... read more"
    Received: "This premium organic cotton t-shirt features a comfortable relaxed fit, sustaina... read more"

    [0m [90m 222 |[39m       [36mconst[39m result [33m=[39m truncateText(description[33m,[39m [35m80[39m[33m,[39m [32m'... read more'[39m)[33m;[39m
     [90m 223 |[39m       
    [31m[1m>[22m[39m[90m 224 |[39m       expect(result)[33m.[39mtoBe([32m'This premium organic cotton t-shirt features a comfortable relaxed fit, sustai... read more'[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 225 |[39m     })[33m;[39m
     [90m 226 |[39m
     [90m 227 |[39m     it([32m'should handle user bio truncation'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/truncateText.test.ts:224:22)

  ● truncateText › consistent behavior › should handle different data types gracefully

    expect(received).not.toThrow()

    Error name:    "TypeError"
    Error message: "text.slice is not a function"

        [0m [90m 19 |[39m   
         [90m 20 |[39m   [90m// Trim the text before adding suffix to avoid trailing spaces[39m
        [31m[1m>[22m[39m[90m 21 |[39m   [36mreturn[39m text[33m.[39mslice([35m0[39m[33m,[39m maxLength)[33m.[39mtrimEnd() [33m+[39m suffix[33m;[39m
         [90m    |[39m               [31m[1m^[22m[39m
         [90m 22 |[39m }[33m;[39m
         [90m 23 |[39m
         [90m 24 |[39m [36mexport[39m [36mdefault[39m truncateText[33m;[39m[0m

      at truncateText (src/utils/truncateText.ts:21:15)
      at src/utils/truncateText.test.ts:262:23
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at src/utils/truncateText.test.ts:263:16
                at Array.forEach (<anonymous>)
      at Object.<anonymous> (src/utils/truncateText.test.ts:260:14)
      at src/utils/truncateText.test.ts:263:16
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (src/utils/truncateText.test.ts:260:14)

FAIL src/utils/bundleOptimization.test.ts (7.922 s)
  bundleOptimization
    BundleAnalyzer
      analyzeBundlePerformance
        √ should return metrics without analysis in production (13 ms)
        × should perform full analysis in development (3 ms)
        × should handle analysis errors gracefully (6 ms)
        √ should detect and log duplicate modules (2 ms)
      getLoadedChunks
        √ should get chunks from webpack cache when available (1 ms)
        √ should fallback to script analysis when webpack not available (1 ms)
        √ should handle missing webpack gracefully (1 ms)
      getChunkSize
        √ should fetch chunk size from headers (1 ms)
        √ should fallback to estimation when fetch fails (3 ms)
        √ should return 0 for missing chunks (2 ms)
      chunk registry management
        √ should register chunk loading (1 ms)
        √ should mark chunk as loaded (1 ms)
        √ should mark chunk as failed (1 ms)
        √ should handle operations on non-existent chunks
      getMetrics
        √ should return current metrics (8 ms)
        √ should return a copy of metrics (1 ms)
    ChunkLoadingOptimizer
      setStrategy
        √ should set loading strategy
      optimizeChunkLoading
        √ should trigger optimization processes (1 ms)
        √ should preload critical chunks (1 ms)
        √ should prefetch likely chunks based on route (1 ms)
      loadChunk
        √ should load chunk successfully (2 ms)
        √ should prevent concurrent loading of same chunk (1 ms)
        √ should queue chunks when max concurrent limit reached (1 ms)
        √ should handle load failures (1 ms)
      getLoadingStats
        √ should return current loading statistics (1 ms)
      processQueue
        √ should process queued chunks by priority (1 ms)
    MobileMemoryOptimizer
      startMonitoring
        √ should start memory monitoring (1 ms)
        √ should not start multiple intervals (1 ms)
      stopMonitoring
        √ should stop memory monitoring (1 ms)
        √ should handle stopping when not monitoring
      memory cleanup
        × should perform cleanup when memory threshold exceeded
        × should not cleanup when memory usage is normal (1 ms)
        √ should clear unused images from DOM (2 ms)
        √ should keep visible images (1 ms)
        √ should handle missing performance.memory (1 ms)
      garbage collection
        √ should trigger garbage collection when available (1 ms)
        √ should handle missing garbage collection gracefully (1 ms)
      getMemoryStats
        √ should return memory statistics (1 ms)
      isElementInViewport
        √ should detect element in viewport
        √ should detect element outside viewport
        √ should handle documentElement dimensions fallback (1 ms)
    initializeBundleOptimization
      √ should start memory monitoring on mobile devices (1 ms)
      √ should not start memory monitoring on desktop devices (1 ms)
      √ should analyze bundle performance in development (1 ms)
      √ should not analyze bundle performance in production (1 ms)
    Error Handling and Edge Cases
      √ should handle missing webpack require gracefully (1 ms)
      √ should handle fetch errors in chunk size detection (1 ms)
      √ should handle missing script elements (1 ms)
      √ should handle missing performance API
      √ should handle missing DOM elements in memory cleanup
    Performance Considerations
      √ should not impact performance with frequent memory checks (1 ms)
      √ should efficiently manage chunk registry (1 ms)
      √ should not create memory leaks with intervals (19 ms)
    Integration Tests
      √ should work together in a realistic mobile scenario (2 ms)
      √ should coordinate between different optimization systems (2 ms)
    Default Export
      √ should export all optimization classes (5 ms)

  ● bundleOptimization › BundleAnalyzer › analyzeBundlePerformance › should perform full analysis in development

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 139 |[39m         [36mconst[39m result [33m=[39m [36mawait[39m [33mBundleAnalyzer[39m[33m.[39manalyzeBundlePerformance()[33m;[39m
     [90m 140 |[39m
    [31m[1m>[22m[39m[90m 141 |[39m         expect(result[33m.[39mloadTime)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 142 |[39m         expect(result[33m.[39mmemoryImpact)[33m.[39mtoBe([35m0[39m)[33m;[39m [90m// No memory change in mock[39m
     [90m 143 |[39m         expect(result[33m.[39mchunkCount)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m 144 |[39m         expect(console[33m.[39mgroup)[33m.[39mtoHaveBeenCalledWith([32m'📊 Bundle Analysis Results'[39m)[33m;[39m[0m

      at Object.<anonymous> (src/utils/bundleOptimization.test.ts:141:33)

  ● bundleOptimization › BundleAnalyzer › analyzeBundlePerformance › should handle analysis errors gracefully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "Bundle analysis failed:", Any<Error>

    Number of calls: 0

    [0m [90m 157 |[39m         [36mconst[39m result [33m=[39m [36mawait[39m [33mBundleAnalyzer[39m[33m.[39manalyzeBundlePerformance()[33m;[39m
     [90m 158 |[39m
    [31m[1m>[22m[39m[90m 159 |[39m         expect(console[33m.[39merror)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 160 |[39m           [32m'Bundle analysis failed:'[39m[33m,[39m
     [90m 161 |[39m           expect[33m.[39many([33mError[39m)
     [90m 162 |[39m         )[33m;[39m[0m

      at Object.<anonymous> (src/utils/bundleOptimization.test.ts:159:31)

  ● bundleOptimization › MobileMemoryOptimizer › memory cleanup › should perform cleanup when memory threshold exceeded

    TypeError: Cannot read properties of undefined (reading 'getCurrentMemoryUsage')

    [0m [90m 437 |[39m   [90m// Check memory usage and cleanup if necessary[39m
     [90m 438 |[39m   [36mprivate[39m [36mstatic[39m checkMemoryUsage()[33m:[39m [36mvoid[39m {
    [31m[1m>[22m[39m[90m 439 |[39m     [36mconst[39m memoryUsage [33m=[39m [36mthis[39m[33m.[39mgetCurrentMemoryUsage()[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 440 |[39m     
     [90m 441 |[39m     [36mif[39m (memoryUsage [33m>[39m [36mthis[39m[33m.[39mmemoryThreshold) {
     [90m 442 |[39m       [36mthis[39m[33m.[39mperformCleanup()[33m;[39m[0m

      at checkMemoryUsage (src/utils/bundleOptimization.ts:439:30)
      at Object.<anonymous> (src/utils/bundleOptimization.test.ts:580:9)

  ● bundleOptimization › MobileMemoryOptimizer › memory cleanup › should not cleanup when memory usage is normal

    TypeError: Cannot read properties of undefined (reading 'getCurrentMemoryUsage')

    [0m [90m 437 |[39m   [90m// Check memory usage and cleanup if necessary[39m
     [90m 438 |[39m   [36mprivate[39m [36mstatic[39m checkMemoryUsage()[33m:[39m [36mvoid[39m {
    [31m[1m>[22m[39m[90m 439 |[39m     [36mconst[39m memoryUsage [33m=[39m [36mthis[39m[33m.[39mgetCurrentMemoryUsage()[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 440 |[39m     
     [90m 441 |[39m     [36mif[39m (memoryUsage [33m>[39m [36mthis[39m[33m.[39mmemoryThreshold) {
     [90m 442 |[39m       [36mthis[39m[33m.[39mperformCleanup()[33m;[39m[0m

      at checkMemoryUsage (src/utils/bundleOptimization.ts:439:30)
      at Object.<anonymous> (src/utils/bundleOptimization.test.ts:601:9)

  console.info
    ✓ Running in demo mode on port 80

      at checkNetlifyFunctions (src/utils/ApiClient.ts:38:17)

  console.log
    [Family Support] Loading family support data...

      at CulturalFamilySupportService.loadFamilySupportData (src/services/culturalFamilySupportService.ts:871:15)

FAIL src/utils/crisisDetection.test.ts (7.995 s)
  crisisDetection
    detectCrisis
      keyword detection
        √ should detect suicide-related keywords (13 ms)
        √ should detect self-harm keywords (2 ms)
        √ should detect immediate danger keywords (11 ms)
        √ should detect severe distress keywords (1 ms)
      past tense detection
        √ should detect past tense modifiers (2 ms)
        √ should reduce severity for past tense (1 ms)
      severity calculation
        √ should assign high severity for multiple high-risk keywords (1 ms)
        √ should assign high severity for specific high-risk keywords (1 ms)
        √ should assign medium severity for moderate keyword count (1 ms)
        √ should assign low severity for single keyword
      edge cases
        √ should handle empty text (2 ms)
        √ should handle non-crisis text (3 ms)
        √ should handle case insensitive matching (1 ms)
        √ should handle text with punctuation
        √ should handle very long text (1 ms)
        √ should handle text with numbers and special characters
      keyword combinations
        √ should detect multiple different crisis keywords (2 ms)
        √ should not double-count overlapping keywords
      result structure
        √ should return correct result structure (2 ms)
        √ should satisfy CrisisDetectionResult interface (1 ms)
    getCrisisResources
      country-specific resources
        √ should return US resources (1 ms)
        √ should return UK resources (8 ms)
        √ should return Canadian resources (1 ms)
        √ should return Australian resources
      fallback behavior
        √ should return default resources for unknown country (1 ms)
        √ should return default resources when country is undefined
        √ should return default resources for empty string
        √ should return default resources for null (1 ms)
      resource structure
        √ should return complete resource structure
        √ should have valid URLs for all countries
      case sensitivity
        × should handle lowercase country codes (4 ms)
        × should handle mixed case country codes (1 ms)
    integration scenarios
      √ should provide appropriate resources for detected crisis (1 ms)
      √ should handle workflow for different severity levels (1 ms)
      √ should work with real-world crisis scenarios (1 ms)
    performance and reliability
      √ should handle large text efficiently (1 ms)
      √ should be consistent across multiple calls
      √ should handle concurrent detection calls (1 ms)
    false positives and negatives
      √ should avoid false positives in medical contexts
      √ should minimize false negatives for coded language

  ● crisisDetection › getCrisisResources › case sensitivity › should handle lowercase country codes

    expect(received).toBe(expected) // Object.is equality

    Expected: "International Crisis Lines"
    Received: "988 Suicide & Crisis Lifeline"

    [0m [90m 344 |[39m       it([32m'should handle lowercase country codes'[39m[33m,[39m () [33m=>[39m {
     [90m 345 |[39m         [36mconst[39m resources [33m=[39m getCrisisResources([32m'us'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 346 |[39m         expect(resources[33m.[39mname)[33m.[39mtoBe([32m'International Crisis Lines'[39m)[33m;[39m [90m// Should fallback for lowercase[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 347 |[39m       })[33m;[39m
     [90m 348 |[39m
     [90m 349 |[39m       it([32m'should handle mixed case country codes'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/crisisDetection.test.ts:346:32)

  ● crisisDetection › getCrisisResources › case sensitivity › should handle mixed case country codes

    expect(received).toBe(expected) // Object.is equality

    Expected: "International Crisis Lines"
    Received: "988 Suicide & Crisis Lifeline"

    [0m [90m 349 |[39m       it([32m'should handle mixed case country codes'[39m[33m,[39m () [33m=>[39m {
     [90m 350 |[39m         [36mconst[39m resources [33m=[39m getCrisisResources([32m'Us'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 351 |[39m         expect(resources[33m.[39mname)[33m.[39mtoBe([32m'International Crisis Lines'[39m)[33m;[39m [90m// Should fallback for mixed case[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 352 |[39m       })[33m;[39m
     [90m 353 |[39m     })[33m;[39m
     [90m 354 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/utils/crisisDetection.test.ts:351:32)

  console.log
    Simulating creating a payment intent for $25.00

      at src/utils/ApiClient.ts:264:25

FAIL src/utils/sanitizeHtml.test.ts (8.085 s)
  sanitizeHtml
    sanitizeHtml
      √ should sanitize basic HTML by escaping dangerous elements (9 ms)
      √ should handle empty input (1 ms)
      √ should handle plain text without HTML
      √ should escape special characters
    safeMarkdownToHtml
      √ should return empty string for empty input (1 ms)
      √ should return empty string for null input
      √ should convert bold markdown to HTML (1 ms)
      √ should convert italic markdown to HTML
      √ should convert line breaks to <br> tags (1 ms)
      √ should convert valid links to HTML
      √ should handle mailto links (1 ms)
      √ should handle relative links
      √ should reject dangerous javascript: links (1 ms)
      √ should reject data: URLs
      √ should handle multiple markdown formats in one string (1 ms)
      √ should escape HTML in markdown before processing (1 ms)
      × should handle nested markdown correctly (1 ms)
      × should handle edge cases with empty markdown patterns (1 ms)
    createSafeHtml
      √ should return object with __html property (1 ms)
      √ should process markdown through safeMarkdownToHtml (1 ms)
      √ should handle empty content
      √ should be compatible with React dangerouslySetInnerHTML (1 ms)
    integration and real-world scenarios
      √ should handle user-generated content safely (1 ms)
      √ should handle comment-like content (1 ms)
      √ should handle forum post content
    performance and edge cases
      √ should handle very long content efficiently (7 ms)
      √ should handle special regex characters in content (1 ms)
      √ should handle malformed markdown gracefully (1 ms)
      √ should maintain performance with many links (1 ms)
    security considerations
      × should prevent XSS through various vectors (1 ms)
      √ should sanitize link URLs properly (1 ms)

  ● sanitizeHtml › safeMarkdownToHtml › should handle nested markdown correctly

    expect(received).toContain(expected) // indexOf

    Expected substring: "<strong><em>bold and italic</em></strong>"
    Received string:    "This is <strong><em>bold and italic</strong></em> text"

    [0m [90m 213 |[39m       [36mconst[39m result [33m=[39m safeMarkdownToHtml(markdown)[33m;[39m
     [90m 214 |[39m       [90m// Should handle the outer ** first, then inner *[39m
    [31m[1m>[22m[39m[90m 215 |[39m       expect(result)[33m.[39mtoContain([32m'<strong><em>bold and italic</em></strong>'[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 216 |[39m     })[33m;[39m
     [90m 217 |[39m
     [90m 218 |[39m     it([32m'should handle edge cases with empty markdown patterns'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/sanitizeHtml.test.ts:215:22)

  ● sanitizeHtml › safeMarkdownToHtml › should handle edge cases with empty markdown patterns

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "<em></em>"
    Received string:        "Empty <em></em> and * patterns []() too"

    [0m [90m 223 |[39m       [90m// Should not create empty tags[39m
     [90m 224 |[39m       expect(result)[33m.[39mnot[33m.[39mtoContain([32m'<strong></strong>'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 225 |[39m       expect(result)[33m.[39mnot[33m.[39mtoContain([32m'<em></em>'[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 226 |[39m       expect(result)[33m.[39mnot[33m.[39mtoContain([32m'<a href="">'[39m)[33m;[39m
     [90m 227 |[39m     })[33m;[39m
     [90m 228 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/utils/sanitizeHtml.test.ts:225:26)

  ● sanitizeHtml › security considerations › should prevent XSS through various vectors

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "onerror="
    Received string:        "&lt;img src=x onerror=alert(1)&gt;"

    [0m [90m 379 |[39m         expect(result)[33m.[39mnot[33m.[39mtoContain([32m'<script>'[39m)[33m;[39m
     [90m 380 |[39m         expect(result)[33m.[39mnot[33m.[39mtoContain([32m'javascript:'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 381 |[39m         expect(result)[33m.[39mnot[33m.[39mtoContain([32m'onerror='[39m)[33m;[39m
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 382 |[39m         expect(result)[33m.[39mnot[33m.[39mtoContain([32m'onload='[39m)[33m;[39m
     [90m 383 |[39m       })[33m;[39m
     [90m 384 |[39m     })[33m;[39m[0m

      at src/utils/sanitizeHtml.test.ts:381:28
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (src/utils/sanitizeHtml.test.ts:375:19)

FAIL src/hooks/useSwipeGesture.test.ts (8.48 s)
  useSwipeGesture Hook
    √ should initialize with correct default state (53 ms)
    √ should attach and detach listeners to an element (8 ms)
    √ should use non-passive listeners when preventDefaultTouchMove is enabled (6 ms)
    √ should detect left swipe gesture (7 ms)
    √ should detect right swipe gesture (4 ms)
    √ should detect up swipe gesture (3 ms)
    √ should detect down swipe gesture (3 ms)
    √ should not trigger swipe if distance is below threshold (22 ms)
    √ should not trigger swipe if velocity is below threshold (5 ms)
    √ should ignore multi-touch events (3 ms)
    √ should handle touchend without touchmove (3 ms)
    √ should update tracking state correctly (3 ms)
  useSwipeRef Hook
    √ should return ref and tracking state (2 ms)
    √ should automatically attach listeners when ref is set (5 ms)
  usePullToRefresh Hook
    √ should initialize with correct default state (2 ms)
    × should start pulling when swiping down from top (3 ms)
    √ should not start pulling when not at top (3 ms)
    × should trigger refresh when threshold is exceeded (8 ms)
    √ should not trigger refresh when below threshold (2 ms)
    × should handle refresh errors gracefully (7 ms)
    √ should not pull when disabled (3 ms)
    × should apply resistance to pull distance (2 ms)

  ● usePullToRefresh Hook › should start pulling when swiping down from top

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 470 |[39m     })[33m;[39m
     [90m 471 |[39m
    [31m[1m>[22m[39m[90m 472 |[39m     expect(result[33m.[39mcurrent[33m.[39misPulling)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 473 |[39m     expect(result[33m.[39mcurrent[33m.[39mpullDistance)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m 474 |[39m     expect(result[33m.[39mcurrent[33m.[39mpullProgress)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m 475 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useSwipeGesture.test.ts:472:38)

  ● usePullToRefresh Hook › should trigger refresh when threshold is exceeded

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 529 |[39m     })[33m;[39m
     [90m 530 |[39m
    [31m[1m>[22m[39m[90m 531 |[39m     expect(mockOnRefresh)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 532 |[39m   })[33m;[39m
     [90m 533 |[39m
     [90m 534 |[39m   it([32m'should not trigger refresh when below threshold'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/hooks/useSwipeGesture.test.ts:531:27)

  ● usePullToRefresh Hook › should handle refresh errors gracefully

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 598 |[39m     })[33m;[39m
     [90m 599 |[39m
    [31m[1m>[22m[39m[90m 600 |[39m     expect(mockOnRefresh)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 601 |[39m     expect(result[33m.[39mcurrent[33m.[39misRefreshing)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 602 |[39m     expect(result[33m.[39mcurrent[33m.[39misPulling)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 603 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useSwipeGesture.test.ts:600:27)

  ● usePullToRefresh Hook › should apply resistance to pull distance

    expect(received).toBe(expected) // Object.is equality

    Expected: 50
    Received: 0

    [0m [90m 652 |[39m
     [90m 653 |[39m     [90m// With 0.5 resistance, 100px pull should result in 50px distance[39m
    [31m[1m>[22m[39m[90m 654 |[39m     expect(result[33m.[39mcurrent[33m.[39mpullDistance)[33m.[39mtoBe([35m50[39m)[33m;[39m
     [90m     |[39m                                         [31m[1m^[22m[39m
     [90m 655 |[39m   })[33m;[39m
     [90m 656 |[39m })[33m;[39m
     [90m 657 |[39m[0m

      at Object.<anonymous> (src/hooks/useSwipeGesture.test.ts:654:41)

FAIL src/services/__tests__/culturalFamilySupportService.test.ts
  CulturalFamilySupportService
    Initialization
      √ should initialize with cultural guidance (2 ms)
      × should load family support data on initialization (1 ms)
    Cultural Guidance Configuration
      √ should have comprehensive Western cultural guidance (8 ms)
      √ should have comprehensive Hispanic/Latino cultural guidance (5 ms)
      √ should have comprehensive Arabic cultural guidance (1 ms)
      √ should have comprehensive Chinese cultural guidance (1 ms)
    Family Support Creation
      √ should create family support configuration (2 ms)
      √ should set appropriate privacy settings based on support level (1 ms)
      √ should record analytics for family support setup (1 ms)
      √ should handle analytics recording errors gracefully (1 ms)
    Family Member Management
      √ should add family member successfully (1 ms)
      √ should throw error when adding member to non-existent family support (7 ms)
      √ should update lastUpdated timestamp when adding family member (22 ms)
      √ should log family member addition (1 ms)
    Crisis Notification Strategy
      √ should determine individual crisis strategy (1 ms)
      √ should determine family-centered crisis strategy
      √ should determine community-based crisis strategy (1 ms)
    Crisis Notification Sending
      √ should send crisis notification successfully (2 ms)
      √ should not send notification if emergency protocol is disabled
      √ should not send notification if no family support exists
      √ should respect member consent and notification preferences
      √ should store notification in offline sync queue (1 ms)
    Cultural Message Generation
      √ should generate culturally appropriate Western messages (1 ms)
      √ should generate culturally appropriate Arabic messages
      √ should generate culturally appropriate Chinese messages (1 ms)
      √ should generate culturally appropriate Hispanic/Latino messages (1 ms)
    Family Support Analytics
      × should calculate family support analytics (1 ms)
      √ should handle non-existent user gracefully
    Default Configuration Generation
      √ should generate appropriate default escalation levels (4 ms)
      √ should customize escalation for authority-based cultures (1 ms)
      √ should customize escalation for gradual cultures
      √ should generate appropriate communication guidelines (1 ms)
      √ should customize guidelines for family-centered cultures (1 ms)
      √ should customize guidelines for community-based cultures
    Data Persistence
      × should log data loading on initialization (1 ms)
      √ should log data saving when creating family support (1 ms)
      √ should log data saving when adding family members
    Singleton Instance
      √ should export singleton instance
      √ should maintain same instance

  ● CulturalFamilySupportService › Initialization › should load family support data on initialization

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[Family Support] Loading family support data..."

    Number of calls: 0

    [0m [90m 61 |[39m
     [90m 62 |[39m     test([32m'should load family support data on initialization'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 63 |[39m       expect(console[33m.[39mlog)[33m.[39mtoHaveBeenCalledWith([32m'[Family Support] Loading family support data...'[39m)[33m;[39m
     [90m    |[39m                           [31m[1m^[22m[39m
     [90m 64 |[39m     })[33m;[39m
     [90m 65 |[39m   })[33m;[39m
     [90m 66 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/culturalFamilySupportService.test.ts:63:27)

  ● CulturalFamilySupportService › Family Support Analytics › should calculate family support analytics

    expect(received).toBe(expected) // Object.is equality

    Expected: 24
    Received: 0

    [0m [90m 1009 |[39m       expect(analytics[33m.[39msupportEngagement)[33m.[39mtoBe([35m0.5[39m)[33m;[39m [90m// 1 consenting out of 2 total[39m
     [90m 1010 |[39m       expect(analytics[33m.[39mfamilyResponseRate)[33m.[39mtoBe([35m0[39m)[33m;[39m [90m// No responses yet[39m
    [31m[1m>[22m[39m[90m 1011 |[39m       expect(analytics[33m.[39mcrisisResolutionTime)[33m.[39mtoBe([35m24[39m)[33m;[39m [90m// Default placeholder[39m
     [90m      |[39m                                              [31m[1m^[22m[39m
     [90m 1012 |[39m       expect(analytics[33m.[39mculturalProtocolsUsed)[33m.[39mtoEqual([])[33m;[39m [90m// No notifications sent yet[39m
     [90m 1013 |[39m     })[33m;[39m
     [90m 1014 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/culturalFamilySupportService.test.ts:1011:46)

  ● CulturalFamilySupportService › Data Persistence › should log data loading on initialization

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[Family Support] Loading family support data..."

    Number of calls: 0

    [0m [90m 1124 |[39m   describe([32m'Data Persistence'[39m[33m,[39m () [33m=>[39m {
     [90m 1125 |[39m     test([32m'should log data loading on initialization'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 1126 |[39m       expect(console[33m.[39mlog)[33m.[39mtoHaveBeenCalledWith([32m'[Family Support] Loading family support data...'[39m)[33m;[39m
     [90m      |[39m                           [31m[1m^[22m[39m
     [90m 1127 |[39m     })[33m;[39m
     [90m 1128 |[39m
     [90m 1129 |[39m     test([32m'should log data saving when creating family support'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/culturalFamilySupportService.test.ts:1126:27)

  console.error
    Failed to initiate tether: Error: Network error
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\stores\tetherStore.test.ts:253:41)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at Object.initiateTether (src/stores/tetherStore.ts:172:15)
      at Object.<anonymous> (src/stores/tetherStore.test.ts:255:7)

  console.error
    Failed to accept tether: Error: API Error
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\stores\tetherStore.test.ts:380:41)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at Object.acceptTether (src/stores/tetherStore.ts:211:15)
      at src/stores/tetherStore.test.ts:383:9

  console.error
    Failed to decline tether: Error: Decline Error
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\stores\tetherStore.test.ts:436:41)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at Object.declineTether (src/stores/tetherStore.ts:230:15)
      at src/stores/tetherStore.test.ts:439:9

  console.error
    Failed to load session history: Error: History load failed
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\stores\tetherStore.test.ts:913:41)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at Object.loadSessionHistory (src/stores/tetherStore.ts:398:15)
      at src/stores/tetherStore.test.ts:916:9

FAIL src/utils/formatTimeAgo.test.ts (8.123 s)
  formatTimeAgo
    formatTimeAgo
      √ should format seconds correctly (12 ms)
      √ should format minutes correctly (1 ms)
      √ should format hours correctly (1 ms)
      √ should format days correctly (1 ms)
      √ should format months correctly (1 ms)
      √ should format years correctly (1 ms)
      √ should handle zero seconds (1 ms)
      √ should handle fractional seconds
      √ should handle boundary between seconds and minutes (1 ms)
      √ should handle boundary between minutes and hours
      √ should handle boundary between hours and days
      √ should handle boundary between days and months (1 ms)
      √ should handle boundary between months and years
      √ should handle invalid date strings (1 ms)
      √ should handle future timestamps
      √ should handle very old timestamps (1 ms)
    formatChatTimestamp
      √ should format today's timestamp with time only (1 ms)
      √ should format yesterday's timestamp with "Yesterday at" prefix (1 ms)
      √ should format older timestamps with full date (1 ms)
      √ should handle timestamps from different years (1 ms)
      √ should correctly identify today vs yesterday across month boundaries
      √ should correctly identify today vs yesterday across year boundaries
      √ should handle same timestamp as current time (1 ms)
      √ should handle invalid timestamp gracefully (1 ms)
      × should respect browser locale settings
      × should handle timezone differences correctly (3 ms)
      √ should handle leap year dates correctly (20 ms)
    edge cases and performance
      √ should handle very large timestamp differences efficiently (1 ms)
      √ should be consistent across multiple calls (1 ms)
      √ should handle empty string gracefully (1 ms)
      √ should handle null and undefined inputs (15 ms)
      √ should maintain performance with frequent calls (9 ms)
    localization compatibility
      × should work with different locale settings (1 ms)

  ● formatTimeAgo › formatChatTimestamp › should respect browser locale settings

    TypeError: Cannot redefine property: language
        at Function.defineProperty (<anonymous>)

    [0m [90m 216 |[39m     it([32m'should respect browser locale settings'[39m[33m,[39m () [33m=>[39m {
     [90m 217 |[39m       [90m// Change navigator.language[39m
    [31m[1m>[22m[39m[90m 218 |[39m       [33mObject[39m[33m.[39mdefineProperty(navigator[33m,[39m [32m'language'[39m[33m,[39m {
     [90m     |[39m              [31m[1m^[22m[39m
     [90m 219 |[39m         value[33m:[39m [32m'fr-FR'[39m[33m,[39m
     [90m 220 |[39m         configurable[33m:[39m [36mtrue[39m
     [90m 221 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (src/utils/formatTimeAgo.test.ts:218:14)

  ● formatTimeAgo › formatChatTimestamp › should handle timezone differences correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: "12:00 PM"
    Received: "Yesterday at 12:00 PM"

    [0m [90m 243 |[39m       
     [90m 244 |[39m       [90m// Both should be treated as "today" since they're the same date[39m
    [31m[1m>[22m[39m[90m 245 |[39m       expect(resultUTC)[33m.[39mtoBe([32m'12:00 PM'[39m)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 246 |[39m       expect(resultLocal)[33m.[39mtoBe([32m'12:00 PM'[39m)[33m;[39m
     [90m 247 |[39m     })[33m;[39m
     [90m 248 |[39m[0m

      at Object.<anonymous> (src/utils/formatTimeAgo.test.ts:245:25)

  ● formatTimeAgo › localization compatibility › should work with different locale settings

    TypeError: Cannot redefine property: language
        at Function.defineProperty (<anonymous>)

    [0m [90m 322 |[39m       
     [90m 323 |[39m       locales[33m.[39mforEach(locale [33m=>[39m {
    [31m[1m>[22m[39m[90m 324 |[39m         [33mObject[39m[33m.[39mdefineProperty(navigator[33m,[39m [32m'language'[39m[33m,[39m {
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 325 |[39m           value[33m:[39m locale[33m,[39m
     [90m 326 |[39m           configurable[33m:[39m [36mtrue[39m
     [90m 327 |[39m         })[33m;[39m[0m

      at src/utils/formatTimeAgo.test.ts:324:16
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (src/utils/formatTimeAgo.test.ts:323:15)

FAIL src/utils/logger.test.ts (8.3 s)
  ● Logger › development environment › should log debug messages in development

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[TestComponent] Debug message", {"key": "value"}

    Number of calls: 0

    [0m [90m 63 |[39m       logger[33m.[39mdebug([32m'Debug message'[39m[33m,[39m { key[33m:[39m [32m'value'[39m }[33m,[39m [32m'TestComponent'[39m)[33m;[39m
     [90m 64 |[39m
    [31m[1m>[22m[39m[90m 65 |[39m       expect(console[33m.[39mlog)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                           [31m[1m^[22m[39m
     [90m 66 |[39m         [32m'[TestComponent] Debug message'[39m[33m,[39m
     [90m 67 |[39m         { key[33m:[39m [32m'value'[39m }
     [90m 68 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:65:27)

  ● Logger › development environment › should log info messages in development

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: " Info message", {"data": 123}

    Number of calls: 0

    [0m [90m 72 |[39m       logger[33m.[39minfo([32m'Info message'[39m[33m,[39m { data[33m:[39m [35m123[39m })[33m;[39m
     [90m 73 |[39m
    [31m[1m>[22m[39m[90m 74 |[39m       expect(console[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                            [31m[1m^[22m[39m
     [90m 75 |[39m         [32m' Info message'[39m[33m,[39m
     [90m 76 |[39m         { data[33m:[39m [35m123[39m }
     [90m 77 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:74:28)

  ● Logger › development environment › should log warn messages in development

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[Component] Warning message", ""

    Number of calls: 0

    [0m [90m 81 |[39m       logger[33m.[39mwarn([32m'Warning message'[39m[33m,[39m [36mnull[39m[33m,[39m [32m'Component'[39m)[33m;[39m
     [90m 82 |[39m
    [31m[1m>[22m[39m[90m 83 |[39m       expect(console[33m.[39mwarn)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                            [31m[1m^[22m[39m
     [90m 84 |[39m         [32m'[Component] Warning message'[39m[33m,[39m
     [90m 85 |[39m         [32m''[39m
     [90m 86 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:83:28)

  ● Logger › development environment › should log error messages in development

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[ErrorComponent] Error occurred", [Error: Test error]

    Number of calls: 0

    [0m [90m 91 |[39m       logger[33m.[39merror([32m'Error occurred'[39m[33m,[39m error[33m,[39m [32m'ErrorComponent'[39m)[33m;[39m
     [90m 92 |[39m
    [31m[1m>[22m[39m[90m 93 |[39m       expect(console[33m.[39merror)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 94 |[39m         [32m'[ErrorComponent] Error occurred'[39m[33m,[39m
     [90m 95 |[39m         error
     [90m 96 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:93:29)

  ● Logger › development environment › should format messages correctly without source

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: " Message without source", ""

    Number of calls: 0

    [0m [90m 100 |[39m       logger[33m.[39mdebug([32m'Message without source'[39m)[33m;[39m
     [90m 101 |[39m
    [31m[1m>[22m[39m[90m 102 |[39m       expect(console[33m.[39mlog)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 103 |[39m         [32m' Message without source'[39m[33m,[39m
     [90m 104 |[39m         [32m''[39m
     [90m 105 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:102:27)

  ● Logger › development environment › should handle empty data parameter

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[Test] Message with no data", ""

    Number of calls: 0

    [0m [90m 109 |[39m       logger[33m.[39minfo([32m'Message with no data'[39m[33m,[39m undefined[33m,[39m [32m'Test'[39m)[33m;[39m
     [90m 110 |[39m
    [31m[1m>[22m[39m[90m 111 |[39m       expect(console[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 112 |[39m         [32m'[Test] Message with no data'[39m[33m,[39m
     [90m 113 |[39m         [32m''[39m
     [90m 114 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:111:28)

  ● Logger › production environment › should log warning messages in production

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 136 |[39m       logger[33m.[39mwarn([32m'Warning message'[39m)[33m;[39m
     [90m 137 |[39m
    [31m[1m>[22m[39m[90m 138 |[39m       expect(console[33m.[39mwarn)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 139 |[39m     })[33m;[39m
     [90m 140 |[39m
     [90m 141 |[39m     it([32m'should log error messages in production'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/logger.test.ts:138:28)

  ● Logger › production environment › should log error messages in production

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 142 |[39m       logger[33m.[39merror([32m'Error message'[39m)[33m;[39m
     [90m 143 |[39m
    [31m[1m>[22m[39m[90m 144 |[39m       expect(console[33m.[39merror)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 145 |[39m     })[33m;[39m
     [90m 146 |[39m
     [90m 147 |[39m     it([32m'should send errors to Sentry in production'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/logger.test.ts:144:29)

  ● Logger › production environment › should send errors to Sentry in production

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: [Error: Production error], {"level": "error", "tags": {"source": "Component"}}

    Number of calls: 0

    [0m [90m 149 |[39m       logger[33m.[39merror([32m'Error occurred'[39m[33m,[39m error[33m,[39m [32m'Component'[39m)[33m;[39m
     [90m 150 |[39m
    [31m[1m>[22m[39m[90m 151 |[39m       expect(mockSentry[33m.[39mcaptureException)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 152 |[39m         error[33m,[39m
     [90m 153 |[39m         {
     [90m 154 |[39m           tags[33m:[39m { source[33m:[39m [32m'Component'[39m }[33m,[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:151:43)

  ● Logger › production environment › should send error message to Sentry when no error object provided

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: Any<Error>, {"level": "error", "tags": {"source": "Component"}}

    Number of calls: 0

    [0m [90m 161 |[39m       logger[33m.[39merror([32m'Error message'[39m[33m,[39m [36mnull[39m[33m,[39m [32m'Component'[39m)[33m;[39m
     [90m 162 |[39m
    [31m[1m>[22m[39m[90m 163 |[39m       expect(mockSentry[33m.[39mcaptureException)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 164 |[39m         expect[33m.[39many([33mError[39m)[33m,[39m
     [90m 165 |[39m         {
     [90m 166 |[39m           tags[33m:[39m { source[33m:[39m [32m'Component'[39m }[33m,[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:163:43)

  ● Logger › log buffer management › should add entries to log buffer

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 0
    Received array:  []

    [0m [90m 190 |[39m       [36mconst[39m logs [33m=[39m logger[33m.[39mgetRecentLogs()[33m;[39m
     [90m 191 |[39m       
    [31m[1m>[22m[39m[90m 192 |[39m       expect(logs)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 193 |[39m       expect(logs[[35m0[39m])[33m.[39mtoMatchObject({
     [90m 194 |[39m         level[33m:[39m [32m'debug'[39m[33m,[39m
     [90m 195 |[39m         message[33m:[39m [32m'Debug message'[39m[33m,[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:192:20)

  ● Logger › log buffer management › should limit buffer size to maxBufferSize

    expect(received).toHaveLength(expected)

    Expected length: 100
    Received length: 0
    Received array:  []

    [0m [90m 208 |[39m       [36mconst[39m logs [33m=[39m logger[33m.[39mgetRecentLogs()[33m;[39m
     [90m 209 |[39m       
    [31m[1m>[22m[39m[90m 210 |[39m       expect(logs)[33m.[39mtoHaveLength([35m100[39m)[33m;[39m
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 211 |[39m       [90m// Should keep most recent entries[39m
     [90m 212 |[39m       expect(logs[[35m99[39m][33m.[39mmessage)[33m.[39mtoBe([32m'Message 149'[39m)[33m;[39m
     [90m 213 |[39m       expect(logs[[35m0[39m][33m.[39mmessage)[33m.[39mtoBe([32m'Message 50'[39m)[33m;[39m [90m// Oldest kept entry[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:210:20)

  ● Logger › log buffer management › should clear log buffer

    expect(received).toHaveLength(expected)

    Expected length: 3
    Received length: 0
    Received array:  []

    [0m [90m 219 |[39m       logger[33m.[39mwarn([32m'Message 3'[39m)[33m;[39m
     [90m 220 |[39m       
    [31m[1m>[22m[39m[90m 221 |[39m       expect(logger[33m.[39mgetRecentLogs())[33m.[39mtoHaveLength([35m3[39m)[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 222 |[39m       
     [90m 223 |[39m       logger[33m.[39mclearLogs()[33m;[39m
     [90m 224 |[39m       [0m

      at Object.<anonymous> (src/utils/logger.test.ts:221:38)

  ● Logger › log buffer management › should store all log levels in buffer

    expect(received).toHaveLength(expected)

    Expected length: 4
    Received length: 0
    Received array:  []

    [0m [90m 244 |[39m       [36mconst[39m logs [33m=[39m logger[33m.[39mgetRecentLogs()[33m;[39m
     [90m 245 |[39m       
    [31m[1m>[22m[39m[90m 246 |[39m       expect(logs)[33m.[39mtoHaveLength([35m4[39m)[33m;[39m
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 247 |[39m       expect(logs[33m.[39mmap(log [33m=>[39m log[33m.[39mlevel))[33m.[39mtoEqual([[32m'debug'[39m[33m,[39m [32m'info'[39m[33m,[39m [32m'warn'[39m[33m,[39m [32m'error'[39m])[33m;[39m
     [90m 248 |[39m     })[33m;[39m
     [90m 249 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:246:20)

  ● Logger › helper functions › should provide log helper function

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[Helper] Test message", {"data": "test"}

    Number of calls: 0

    [0m [90m 257 |[39m       log([32m'Test message'[39m[33m,[39m { data[33m:[39m [32m'test'[39m }[33m,[39m [32m'Helper'[39m)[33m;[39m
     [90m 258 |[39m
    [31m[1m>[22m[39m[90m 259 |[39m       expect(console[33m.[39mlog)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 260 |[39m         [32m'[Helper] Test message'[39m[33m,[39m
     [90m 261 |[39m         { data[33m:[39m [32m'test'[39m }
     [90m 262 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:259:27)

  ● Logger › helper functions › should provide logInfo helper function

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: " Info message", {"info": true}

    Number of calls: 0

    [0m [90m 266 |[39m       logInfo([32m'Info message'[39m[33m,[39m { info[33m:[39m [36mtrue[39m })[33m;[39m
     [90m 267 |[39m
    [31m[1m>[22m[39m[90m 268 |[39m       expect(console[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 269 |[39m         [32m' Info message'[39m[33m,[39m
     [90m 270 |[39m         { info[33m:[39m [36mtrue[39m }
     [90m 271 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:268:28)

  ● Logger › helper functions › should provide logWarn helper function

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[WarnComponent] Warning message", {"warn": true}

    Number of calls: 0

    [0m [90m 275 |[39m       logWarn([32m'Warning message'[39m[33m,[39m { warn[33m:[39m [36mtrue[39m }[33m,[39m [32m'WarnComponent'[39m)[33m;[39m
     [90m 276 |[39m
    [31m[1m>[22m[39m[90m 277 |[39m       expect(console[33m.[39mwarn)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 278 |[39m         [32m'[WarnComponent] Warning message'[39m[33m,[39m
     [90m 279 |[39m         { warn[33m:[39m [36mtrue[39m }
     [90m 280 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:277:28)

  ● Logger › helper functions › should provide logError helper function

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[ErrorHelper] Error message", [Error: Helper error]

    Number of calls: 0

    [0m [90m 285 |[39m       logError([32m'Error message'[39m[33m,[39m error[33m,[39m [32m'ErrorHelper'[39m)[33m;[39m
     [90m 286 |[39m
    [31m[1m>[22m[39m[90m 287 |[39m       expect(console[33m.[39merror)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 288 |[39m         [32m'[ErrorHelper] Error message'[39m[33m,[39m
     [90m 289 |[39m         error
     [90m 290 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:287:29)

  ● Logger › timestamp handling › should add ISO timestamp to log entries

    TypeError: Cannot read properties of undefined (reading 'timestamp')

    [0m [90m 300 |[39m       [36mconst[39m logs [33m=[39m logger[33m.[39mgetRecentLogs()[33m;[39m
     [90m 301 |[39m       
    [31m[1m>[22m[39m[90m 302 |[39m       expect(logs[[35m0[39m][33m.[39mtimestamp)[33m.[39mtoBeDefined()[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 303 |[39m       expect(logs[[35m0[39m][33m.[39mtimestamp)[33m.[39mtoMatch([35m/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z$/[39m)[33m;[39m
     [90m 304 |[39m       expect(logs[[35m0[39m][33m.[39mtimestamp [33m>=[39m beforeTime)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 305 |[39m       expect(logs[[35m0[39m][33m.[39mtimestamp [33m<=[39m afterTime)[33m.[39mtoBe([36mtrue[39m)[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:302:22)

  ● Logger › data serialization › should handle various data types

    expect(received).toHaveLength(expected)

    Expected length: 7
    Received length: 0
    Received array:  []

    [0m [90m 329 |[39m       [36mconst[39m logs [33m=[39m logger[33m.[39mgetRecentLogs()[33m;[39m
     [90m 330 |[39m       
    [31m[1m>[22m[39m[90m 331 |[39m       expect(logs)[33m.[39mtoHaveLength(testData[33m.[39mlength)[33m;[39m
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 332 |[39m       logs[33m.[39mforEach((log[33m,[39m index) [33m=>[39m {
     [90m 333 |[39m         expect(log[33m.[39mdata)[33m.[39mtoEqual(testData[index])[33m;[39m
     [90m 334 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:331:20)

  ● Logger › error handling edge cases › should handle special characters in messages

    TypeError: Cannot read properties of undefined (reading 'message')

    [0m [90m 406 |[39m       
     [90m 407 |[39m       [36mconst[39m logs [33m=[39m logger[33m.[39mgetRecentLogs()[33m;[39m
    [31m[1m>[22m[39m[90m 408 |[39m       expect(logs[[35m0[39m][33m.[39mmessage)[33m.[39mtoBe(specialMessage)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 409 |[39m     })[33m;[39m
     [90m 410 |[39m
     [90m 411 |[39m     it([32m'should handle console method unavailability'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/logger.test.ts:408:22)

  ● Logger › integration scenarios › should work in typical component logging scenario

    expect(received).toHaveLength(expected)

    Expected length: 4
    Received length: 0
    Received array:  []

    [0m [90m 436 |[39m       [36mconst[39m logs [33m=[39m logger[33m.[39mgetRecentLogs()[33m;[39m
     [90m 437 |[39m       
    [31m[1m>[22m[39m[90m 438 |[39m       expect(logs)[33m.[39mtoHaveLength([35m4[39m)[33m;[39m
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 439 |[39m       expect(logs[33m.[39mevery(log [33m=>[39m log[33m.[39msource [33m===[39m componentName))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 440 |[39m       expect(console[33m.[39minfo)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m 441 |[39m       expect(console[33m.[39mlog)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:438:20)

  ● Logger › integration scenarios › should work in production error tracking scenario

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: [Error: Payment processing failed], {"level": "error", "tags": {"source": "PaymentForm"}}

    Number of calls: 0

    [0m [90m 454 |[39m       logger[33m.[39mwarn([32m'Retrying payment'[39m[33m,[39m context[33m,[39m component)[33m;[39m
     [90m 455 |[39m       
    [31m[1m>[22m[39m[90m 456 |[39m       expect(mockSentry[33m.[39mcaptureException)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 457 |[39m         error[33m,[39m
     [90m 458 |[39m         {
     [90m 459 |[39m           tags[33m:[39m { source[33m:[39m component }[33m,[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:456:43)

  ● Logger › configuration and environment detection › should detect development environment correctly

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 473 |[39m       
     [90m 474 |[39m       logger[33m.[39mdebug([32m'Dev test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 475 |[39m       expect(console[33m.[39mlog)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 476 |[39m     })[33m;[39m
     [90m 477 |[39m
     [90m 478 |[39m     it([32m'should detect production environment correctly'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/logger.test.ts:475:27)


  ● Test suite failed to run

    The error below may be caused by using the wrong test environment, see https://jestjs.io/docs/configuration#testenvironment-string.
    Consider using the "jsdom" test environment.

    ReferenceError: window is not defined

    [0m [90m 253 |[39m [36mexport[39m [36mconst[39m cleanupPerformanceMocks [33m=[39m () [33m=>[39m {
     [90m 254 |[39m   [90m// Restore original values if needed[39m
    [31m[1m>[22m[39m[90m 255 |[39m   [36mif[39m ([32m'performance'[39m [36min[39m window) {
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 256 |[39m     [36mdelete[39m (window [36mas[39m any)[33m.[39mperformance[33m;[39m
     [90m 257 |[39m   }
     [90m 258 |[39m   [0m

      at cleanupPerformanceMocks (src/test-utils/performanceMocks.ts:255:24)
      at Object.<anonymous> (src/setupTests.ts:1207:26)

  console.error
    Failed to trigger wellness check: Error: Wellness check failed
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\stores\tetherStore.test.ts:960:41)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at Object.triggerWellnessCheck (src/stores/tetherStore.ts:413:15)
      at src/stores/tetherStore.test.ts:963:9

  console.error
    Failed to escalate to crisis: Error: Escalation failed
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\stores\tetherStore.test.ts:1007:41)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at Object.escalateToCrisis (src/stores/tetherStore.ts:431:15)
      at src/stores/tetherStore.test.ts:1010:9

  console.error
    Failed to initiate tether: Error [TimeoutError]: Network timeout
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\stores\tetherStore.test.ts:1158:28)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at Object.initiateTether (src/stores/tetherStore.ts:172:15)
      at Object.<anonymous> (src/stores/tetherStore.test.ts:1163:7)

  console.error
    Failed to initiate tether: Error: API Error
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\stores\tetherStore.test.ts:1171:41)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at Object.initiateTether (src/stores/tetherStore.ts:172:15)
      at src/stores/tetherStore.test.ts:1175:11

FAIL src/utils/imageOptimization.test.ts (8.324 s)
  imageOptimization
    Default Configuration
      √ should have correct default breakpoints (12 ms)
      √ should have appropriate quality settings (2 ms)
      √ should have reasonable lazy loading offset (1 ms)
      √ should have 24-hour cache expiry
      √ should have proper connection thresholds (1 ms)
    ImageOptimizer Class
      Constructor and Initialization
        √ should initialize with default config (1 ms)
        √ should accept custom config (1 ms)
        √ should initialize IntersectionObserver when available (1 ms)
        √ should handle missing IntersectionObserver (1 ms)
        √ should initialize connection detection
        √ should handle missing navigator.connection (29 ms)
      Connection Detection
        √ should detect slow connection (2 ms)
        √ should detect medium connection
        √ should detect fast connection
        × should update connection type on change (4 ms)
      generateOptimizedImages
        √ should generate optimized image configuration (7 ms)
        √ should generate formats for all breakpoints (10 ms)
        √ should generate correct URLs with query parameters (11 ms)
        √ should use cache for repeated requests (3 ms)
        √ should handle custom priority and loading (3 ms)
        × should generate unique IDs for different images (4 ms)
      getOptimalFormat
        √ should prefer WebP when supported (3 ms)
        √ should fallback to JPEG when WebP not supported (3 ms)
        √ should choose size based on connection speed (8 ms)
      preloadCriticalImages
        × should preload high priority images (3 ms)
        √ should limit preloads to first 3 critical images (4 ms)
      setupLazyLoading
        √ should observe element with IntersectionObserver (1 ms)
        × should fallback without IntersectionObserver (1 ms)
      generateSrcSet
        √ should generate proper srcset for WebP (4 ms)
        √ should generate proper srcset for JPEG (3 ms)
      generateSizes
        √ should generate responsive sizes attribute (1 ms)
      clearCache
        √ should clear internal cache (3 ms)
      Private Methods
        √ should generate proper image ID (1 ms)
        √ should generate blur placeholder (1 ms)
        √ should handle canvas context creation failure
        √ should load optimized image with error handling (3 ms)
        √ should handle image load error with fallback (3 ms)
    Singleton Instance
      √ should export a singleton instance (1 ms)
      √ should be the same instance when imported multiple times (1 ms)
    TypeScript Interfaces
      √ should have proper ImageFormat interface (1 ms)
      √ should have proper OptimizedImage interface (16 ms)
    Error Handling
      √ should handle invalid URLs gracefully (2 ms)
      √ should handle empty alt text (3 ms)
      √ should handle missing image data in cache (1 ms)
      √ should handle missing dataset (2 ms)
    Performance Considerations
      √ should cache expensive operations (2 ms)
      √ should generate IDs efficiently (11 ms)
      √ should not leak memory with cache (2 ms)
    Browser Compatibility
      √ should handle missing canvas support (1 ms)
      √ should detect WebP support correctly
    Real-world Integration
      √ should work with typical image component pattern (3 ms)
      √ should handle video thumbnail optimization (2 ms)

  ● imageOptimization › ImageOptimizer Class › Connection Detection › should update connection type on change

    expect(received).toBe(expected) // Object.is equality

    Expected: "fast"
    Received: "slow"

    [0m [90m 224 |[39m         
     [90m 225 |[39m         [90m// Verify connection type was updated[39m
    [31m[1m>[22m[39m[90m 226 |[39m         expect((optimizer [36mas[39m any)[33m.[39mconnectionType)[33m.[39mtoBe([32m'fast'[39m)[33m;[39m
     [90m     |[39m                                                   [31m[1m^[22m[39m
     [90m 227 |[39m       })[33m;[39m
     [90m 228 |[39m     })[33m;[39m
     [90m 229 |[39m[0m

      at Object.<anonymous> (src/utils/imageOptimization.test.ts:226:51)

  ● imageOptimization › ImageOptimizer Class › generateOptimizedImages › should generate unique IDs for different images

    expect(received).not.toBe(expected) // Object.is equality

    Expected: not "aHR0cHM6Ly9leGFt"

    [0m [90m 309 |[39m         })[33m;[39m
     [90m 310 |[39m
    [31m[1m>[22m[39m[90m 311 |[39m         expect(result1[33m.[39mid)[33m.[39mnot[33m.[39mtoBe(result2[33m.[39mid)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 312 |[39m       })[33m;[39m
     [90m 313 |[39m     })[33m;[39m
     [90m 314 |[39m[0m

      at Object.<anonymous> (src/utils/imageOptimization.test.ts:311:32)

  ● imageOptimization › ImageOptimizer Class › preloadCriticalImages › should preload high priority images

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 2
    Received number of calls: 3

    [0m [90m 405 |[39m         optimizer[33m.[39mpreloadCriticalImages(images)[33m;[39m
     [90m 406 |[39m
    [31m[1m>[22m[39m[90m 407 |[39m         expect(mockAppendChild)[33m.[39mtoHaveBeenCalledTimes([35m2[39m)[33m;[39m [90m// Only high priority (>=8) and eager loading[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 408 |[39m       })[33m;[39m
     [90m 409 |[39m
     [90m 410 |[39m       test([32m'should limit preloads to first 3 critical images'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/imageOptimization.test.ts:407:33)

  ● imageOptimization › ImageOptimizer Class › setupLazyLoading › should fallback without IntersectionObserver

    TypeError: Cannot set properties of undefined (setting 'imageId')

    [0m [90m 447 |[39m         
     [90m 448 |[39m         [36mconst[39m mockImg [33m=[39m document[33m.[39mcreateElement([32m'img'[39m) [36mas[39m [33mHTMLImageElement[39m[33m;[39m
    [31m[1m>[22m[39m[90m 449 |[39m         mockImg[33m.[39mdataset[33m.[39mimageId [33m=[39m [32m'test-id'[39m[33m;[39m [90m// Add imageId to prevent error[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 450 |[39m         [36mconst[39m loadOptimizedImageSpy [33m=[39m jest[33m.[39mspyOn(
     [90m 451 |[39m           optimizer[33m,[39m
     [90m 452 |[39m           [32m'loadOptimizedImage'[39m [36mas[39m any[0m

      at Object.<anonymous> (src/utils/imageOptimization.test.ts:449:32)

FAIL src/stores/tetherStore.test.ts
  tetherStore
    initial state
      √ should have correct initial state (3 ms)
      √ should have all required action functions (2 ms)
    initiateTether action
      √ should successfully initiate a tether session (2 ms)
      √ should set up WebSocket message handling (1 ms)
      √ should handle haptic WebSocket messages (1 ms)
      √ should handle API errors gracefully (59 ms)
      √ should set up auto-escalation for crisis mode (2 ms)
      √ should disable audio when silent mode is enabled (1 ms)
    acceptTether action
      √ should accept a tether request successfully (1 ms)
      √ should handle non-existent request gracefully (1 ms)
      √ should handle API errors gracefully (36 ms)
    declineTether action
      √ should decline a tether request successfully (22 ms)
      × should handle API errors gracefully (10 ms)
    endTether action
      √ should end an active tether session (2 ms)
      √ should handle ending session without notes or rating (1 ms)
      √ should not do anything when no active tether (1 ms)
      √ should trigger haptic feedback on end (1 ms)
      √ should not trigger haptic in silent mode
    updateConnectionStrength action
      √ should update connection strength for active tether
      √ should clamp connection strength to 0-100 range
      √ should not update when no active tether (1 ms)
    sendHapticPulse action
      √ should send haptic pulse when tether is active and enabled (4 ms)
      √ should not send haptic when disabled (1 ms)
      √ should not send haptic when no active tether
      √ should not vibrate in silent mode (1 ms)
    toggleDrawing action
      √ should toggle drawing mode for active tether
      √ should not toggle when no active tether (1 ms)
    updateTetherProfile action
      √ should update tether profile partially (1 ms)
      √ should handle null profile gracefully
      √ should update comfort messages (1 ms)
    addToCircle action
      √ should add member to tether circle
      √ should add multiple members to circle (1 ms)
    removeFromCircle action
      √ should remove member from tether circle (1 ms)
      √ should handle removing non-existent member gracefully
    updateAvailability action
      √ should update availability status
      √ should handle all availability states (2 ms)
    loadSessionHistory action
      √ should load session history successfully (1 ms)
      √ should handle API errors gracefully (8 ms)
      √ should handle empty history response (1 ms)
    triggerWellnessCheck action
      √ should trigger wellness check successfully (1 ms)
      √ should handle wellness check API errors (36 ms)
    escalateToCrisis action
      √ should escalate to crisis with contacts (1 ms)
      √ should not escalate when no contacts are configured
      √ should handle escalation API errors (8 ms)
    complex state interactions
      √ should handle full tether lifecycle (1 ms)
      √ should handle concurrent operations
    edge cases and error handling
      × should handle malformed WebSocket messages (1 ms)
      × should handle extreme connection strength values (1 ms)
      √ should handle missing session token gracefully (2 ms)
      √ should handle network timeouts (11 ms)
      √ should preserve state consistency during errors (8 ms)
    settings and configuration
      √ should handle all escalation timeout values
      √ should handle auto-escalation toggle
      √ should handle multiple escalation contacts
      √ should handle bandwidth and accessibility modes (1 ms)

  ● tetherStore › declineTether action › should handle API errors gracefully

    expect(received).toHaveLength(expected)

    Expected length: 0
    Received length: 1
    Received array:  [{"from": "requester-1", "fromName": "Requester", "id": "error-decline", "message": "Please help", "timestamp": 2025-08-17T19:58:42.103Z}]

    [0m [90m 442 |[39m       [90m// Should still remove from pending requests on error[39m
     [90m 443 |[39m       [36mconst[39m state [33m=[39m useTetherStore[33m.[39mgetState()[33m;[39m
    [31m[1m>[22m[39m[90m 444 |[39m       expect(state[33m.[39mpendingRequests)[33m.[39mtoHaveLength([35m0[39m)[33m;[39m
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 445 |[39m     })[33m;[39m
     [90m 446 |[39m   })[33m;[39m
     [90m 447 |[39m[0m

      at Object.<anonymous> (src/stores/tetherStore.test.ts:444:37)

  ● tetherStore › edge cases and error handling › should handle malformed WebSocket messages

    SyntaxError: Unexpected token 'i', "invalid-json" is not valid JSON
        at JSON.parse (<anonymous>)

    [0m [90m 133 |[39m         
     [90m 134 |[39m         ws[33m.[39monmessage [33m=[39m (event) [33m=>[39m {
    [31m[1m>[22m[39m[90m 135 |[39m           [36mconst[39m message [33m=[39m [33mJSON[39m[33m.[39mparse(event[33m.[39mdata)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 136 |[39m           [36mif[39m (message[33m.[39mtype [33m===[39m [32m'strength_update'[39m) {
     [90m 137 |[39m             [36mget[39m()[33m.[39mupdateConnectionStrength(message[33m.[39mstrength)[33m;[39m
     [90m 138 |[39m           } [36melse[39m [36mif[39m (message[33m.[39mtype [33m===[39m [32m'haptic'[39m) {[0m

      at Object.ws.onmessage (src/stores/tetherStore.ts:135:32)
      at src/stores/tetherStore.test.ts:1113:34
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at Object.<anonymous> (src/stores/tetherStore.test.ts:1112:10)

  ● tetherStore › edge cases and error handling › should handle extreme connection strength values

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 5e-324

    [0m [90m 1135 |[39m
     [90m 1136 |[39m       state [33m=[39m useTetherStore[33m.[39mgetState()[33m;[39m
    [31m[1m>[22m[39m[90m 1137 |[39m       expect(state[33m.[39mactiveTether[33m?[39m[33m.[39mconnectionStrength)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m      |[39m                                                      [31m[1m^[22m[39m
     [90m 1138 |[39m     })[33m;[39m
     [90m 1139 |[39m
     [90m 1140 |[39m     test([32m'should handle missing session token gracefully'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/stores/tetherStore.test.ts:1137:54)

FAIL src/services/__tests__/astralTetherService.test.ts
  ● Test suite failed to run

    ReferenceError: Cannot access 'mockNotificationService' before initialization

    [0m [90m 33 |[39m
     [90m 34 |[39m jest[33m.[39mmock([32m'../notificationService'[39m[33m,[39m () [33m=>[39m ({
    [31m[1m>[22m[39m[90m 35 |[39m   notificationService[33m:[39m mockNotificationService[33m,[39m
     [90m    |[39m                        [31m[1m^[22m[39m
     [90m 36 |[39m }))[33m;[39m
     [90m 37 |[39m
     [90m 38 |[39m jest[33m.[39mmock([32m'../secureStorageService'[39m[33m,[39m () [33m=>[39m ({[0m

      at src/services/__tests__/astralTetherService.test.ts:35:24
      at Object.<anonymous> (src/services/astralTetherService.ts:10:1)
      at Object.<anonymous> (src/services/__tests__/astralTetherService.test.ts:5:1)

FAIL src/utils/chartUtils.test.ts (8.195 s)
  chartUtils
    groupCheckInsByDay
      √ should return empty chart data when no check-ins provided (35 ms)
      √ should generate chart data for specified number of days (2 ms)
      √ should correctly calculate average mood scores for days with multiple check-ins (1 ms)
      × should filter out check-ins older than the specified days (3 ms)
      × should return 0 for days with no check-ins (2 ms)
      √ should generate correct date labels (2 ms)
      √ should generate chart points in chronological order (oldest to newest) (2 ms)
      √ should handle edge case of single day request (1 ms)
      √ should handle fractional mood score averages correctly (1 ms)
      √ should handle timezone differences correctly (2 ms)
      √ should handle large datasets efficiently (26 ms)
      √ should handle invalid timestamp gracefully (4 ms)
      √ should handle zero and negative mood scores (2 ms)
      √ should maintain data point structure integrity (3 ms)
      × should handle daylight saving time transitions (2 ms)
      √ should handle empty mood scores array
      √ should handle negative days parameter gracefully (1 ms)
    ChartDataPoint interface
      √ should accept valid ChartDataPoint objects

  ● chartUtils › groupCheckInsByDay › should filter out check-ins older than the specified days

    expect(received).toBe(expected) // Object.is equality

    Expected: 7
    Received: 0

    [0m [90m 117 |[39m       })[33m;[39m
     [90m 118 |[39m       
    [31m[1m>[22m[39m[90m 119 |[39m       expect(yesterdayData[33m?[39m[33m.[39mvalue)[33m.[39mtoBe([35m7[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 120 |[39m       
     [90m 121 |[39m       [90m// Old check-in should not be included[39m
     [90m 122 |[39m       [36mconst[39m oldData [33m=[39m result[33m.[39mfind(point [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/chartUtils.test.ts:119:36)

  ● chartUtils › groupCheckInsByDay › should return 0 for days with no check-ins

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 9

    [0m [90m 146 |[39m       [36mconst[39m yesterday [33m=[39m [36mnew[39m [33mDate[39m([32m'2024-01-14'[39m)[33m;[39m
     [90m 147 |[39m       [36mconst[39m yesterdayData [33m=[39m result[33m.[39mfind(point [33m=>[39m point[33m.[39mdate[33m.[39mtoDateString() [33m===[39m yesterday[33m.[39mtoDateString())[33m;[39m
    [31m[1m>[22m[39m[90m 148 |[39m       expect(yesterdayData[33m?[39m[33m.[39mvalue)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 149 |[39m     })[33m;[39m
     [90m 150 |[39m
     [90m 151 |[39m     it([32m'should generate correct date labels'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/chartUtils.test.ts:148:36)

  ● chartUtils › groupCheckInsByDay › should handle daylight saving time transitions

    expect(received).toBe(expected) // Object.is equality

    Expected: 6
    Received: undefined

    [0m [90m 332 |[39m       [90m// Should handle DST without errors[39m
     [90m 333 |[39m       [36mconst[39m todayData [33m=[39m result[33m.[39mfind(point [33m=>[39m point[33m.[39mdate[33m.[39mtoDateString() [33m===[39m dstDate[33m.[39mtoDateString())[33m;[39m
    [31m[1m>[22m[39m[90m 334 |[39m       expect(todayData[33m?[39m[33m.[39mvalue)[33m.[39mtoBe([35m6[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 335 |[39m     })[33m;[39m
     [90m 336 |[39m
     [90m 337 |[39m     it([32m'should handle empty mood scores array'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/chartUtils.test.ts:334:32)

FAIL src/components/__tests__/LoadingSpinner.test.tsx (8.823 s)
  LoadingSpinner
    Rendering
      √ should render spinner with default props (76 ms)
      √ should render spinner with custom className (6 ms)
      √ should render message when provided (8 ms)
      √ should not render message when not provided (4 ms)
      √ should render with correct HTML structure (11 ms)
    Sizes
      √ should apply correct classes for small size (6 ms)
      √ should apply correct classes for medium size (4 ms)
      √ should apply correct classes for large size (3 ms)
      √ should use medium size by default (5 ms)
      √ should handle invalid size gracefully (2 ms)
    Accessibility
      √ should use output element with role status (3 ms)
      √ should have aria-live="polite" (3 ms)
      √ should have aria-hidden="true" on spinner element (2 ms)
      √ should have aria-hidden="true" on loading dots (2 ms)
      √ should include "Loading:" prefix for screen readers (13 ms)
      √ should provide complete message context for screen readers (4 ms)
    Message Display
      √ should render simple text messages (2 ms)
      √ should render complex messages (2 ms)
      × should handle empty string message (2 ms)
      √ should handle messages with special characters (3 ms)
      √ should handle very long messages (3 ms)
      √ should render loading dots alongside message (3 ms)
    CSS Classes
      √ should apply base classes (4 ms)
      √ should combine custom className with base classes (2 ms)
      √ should handle multiple custom classes (3 ms)
      √ should apply size-specific classes correctly (6 ms)
    Component Structure
      √ should have correct element hierarchy (2 ms)
      √ should maintain structure without message (3 ms)
    Edge Cases
      √ should handle undefined className (37 ms)
      √ should handle null message (2 ms)
      √ should handle undefined message (3 ms)
      √ should handle undefined size (3 ms)
      √ should handle numeric message (2 ms)
      √ should handle boolean message (3 ms)
    Named and Default Exports
      √ should export LoadingSpinner as named export (8 ms)
      √ should export LoadingSpinner as default export (3 ms)
    Integration with Different Content
      √ should work with different size and message combinations (40 ms)
      √ should maintain accessibility with all prop combinations (10 ms)

  ● LoadingSpinner › Message Display › should handle empty string message

    expect(received).toBeInTheDocument()

    received value must be an HTMLElement or an SVGElement.
    Received has value: null

    [0m [90m 144 |[39m       
     [90m 145 |[39m       [36mconst[39m messageElement [33m=[39m container[33m.[39mquerySelector([32m'.loading-message'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 146 |[39m       expect(messageElement)[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 147 |[39m       expect(messageElement[33m.[39mtextContent)[33m.[39mtoContain([32m'Loading:'[39m)[33m;[39m
     [90m 148 |[39m     })[33m;[39m
     [90m 149 |[39m[0m

      at __EXTERNAL_MATCHER_TRAP__ (node_modules/expect/build/index.js:325:30)
      at Object.throwingMatcher [as toBeInTheDocument] (node_modules/expect/build/index.js:326:15)
      at Object.<anonymous> (src/components/__tests__/LoadingSpinner.test.tsx:146:30)

FAIL src/utils/accessibilityUtils.test.ts (8.557 s)
  AccessibilityUtils
    getElementAttributes
      √ should return all attributes as a record (13 ms)
      √ should return empty object for element with no attributes (1 ms)
      √ should handle attributes with empty values (1 ms)
      √ should handle special characters in attribute names and values (1 ms)
    getElementSelector
      √ should return ID selector when element has ID (1 ms)
      √ should return class selector when element has class but no ID
      √ should return tag name when element has no ID or class (1 ms)
      √ should handle mixed case tag names
      √ should handle whitespace in class names (1 ms)
    generateElementId
      √ should generate unique ID with tag name, timestamp, and random string (2 ms)
      √ should handle different tag names
      √ should generate different IDs for multiple calls (4 ms)
    isVisible
      √ should return true for visible element (1 ms)
      √ should return false for element with display: none
      √ should return false for element with visibility: hidden
      √ should return false for element with opacity: 0 (1 ms)
      √ should handle partial opacity
      √ should handle different display values (1 ms)
    getFocusableElements
      √ should return focusable elements that are visible (1 ms)
      √ should filter out invisible elements (1 ms)
      √ should handle empty result
      √ should include elements with positive tabindex (1 ms)
      √ should include contenteditable elements
    hasTextContent
      √ should return true for element with text content (1 ms)
      √ should return false for element with no text content
      √ should return false for element with empty text content
      √ should return false for element with only whitespace (1 ms)
      √ should return true for element with text after trimming
      √ should handle undefined textContent
    isCrisisElement
      √ should return true for element with crisis class (1 ms)
      √ should return true for element with data-crisis attribute
      √ should return true for element inside crisis container (1 ms)
      √ should return false for non-crisis element
      √ should handle data-crisis attribute with different values (1 ms)
    getComplianceThresholds
      √ should return AAA thresholds for AAA level
      √ should return AA thresholds for AA level (1 ms)
      √ should return A thresholds for A level
      √ should return A thresholds for unknown level (1 ms)
      √ should handle empty string
      √ should handle case-insensitive input
    findComplexText
      √ should identify complex sentences with more than 20 words (1 ms)
      √ should handle empty text elements (1 ms)
      × should handle multiple sentences in one element (1 ms)
      × should handle different sentence terminators (1 ms)
      √ should query the correct text elements
      √ should handle elements with only punctuation (1 ms)
      √ should trim whitespace from sentences
    getTextContent
      √ should return trimmed text content within length limit
      √ should truncate text content to max length
      √ should use default max length of 50 (1 ms)
      √ should return undefined for null text content (1 ms)
      √ should return empty string for empty text content
      √ should handle whitespace-only content
      √ should handle zero max length (1 ms)
      √ should handle negative max length
      √ should preserve text when shorter than max length
    edge cases and error handling
      √ should handle null elements gracefully (7 ms)
      √ should handle elements without classList (1 ms)
      √ should handle getComputedStyle failures (2 ms)
      √ should handle querySelectorAll failures
    integration scenarios
      √ should work with real-like DOM structures
      √ should handle accessibility audit workflow (1 ms)

  ● AccessibilityUtils › findComplexText › should handle multiple sentences in one element

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 0
    Received array:  []

    [0m [90m 616 |[39m       [36mconst[39m result [33m=[39m [33mAccessibilityUtils[39m[33m.[39mfindComplexText()[33m;[39m
     [90m 617 |[39m
    [31m[1m>[22m[39m[90m 618 |[39m       expect(result)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 619 |[39m       expect(result[[35m0[39m])[33m.[39mtoContain([32m'This is another very long sentence'[39m)[33m;[39m
     [90m 620 |[39m     })[33m;[39m
     [90m 621 |[39m[0m

      at Object.<anonymous> (src/utils/accessibilityUtils.test.ts:618:22)

  ● AccessibilityUtils › findComplexText › should handle different sentence terminators

    expect(received).toHaveLength(expected)

    Expected length: 2
    Received length: 0
    Received array:  []

    [0m [90m 629 |[39m       [36mconst[39m result [33m=[39m [33mAccessibilityUtils[39m[33m.[39mfindComplexText()[33m;[39m
     [90m 630 |[39m
    [31m[1m>[22m[39m[90m 631 |[39m       expect(result)[33m.[39mtoHaveLength([35m2[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 632 |[39m     })[33m;[39m
     [90m 633 |[39m
     [90m 634 |[39m     it([32m'should query the correct text elements'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/accessibilityUtils.test.ts:631:22)

PASS src/services/__tests__/safetyPlanRemindersService.test.ts
  SafetyPlanRemindersService
    Safety Plan Creation
      √ should create a comprehensive safety plan (2 ms)
      √ should validate required safety plan components (2 ms)
      √ should create templates for common situations (8 ms)
    Reminder Scheduling
      √ should schedule daily check-in reminders (1 ms)
      √ should schedule strategy practice reminders (1 ms)
      √ should adapt reminder timing based on user patterns (1 ms)
    Crisis Detection Integration
      √ should trigger safety plan when crisis detected (1 ms)
      √ should escalate reminders during high-risk periods (1 ms)
    Interactive Reminders
      √ should create interactive coping strategy reminders
      √ should track reminder engagement
      √ should provide quick access buttons in reminders (1 ms)
    Progress Tracking
      √ should track safety plan usage over time (1 ms)
    Personalization and Learning
      √ should personalize reminders based on user preferences
      √ should learn from user feedback (1 ms)
    Multi-channel Delivery
      √ should deliver reminders through multiple channels (1 ms)
      √ should fallback to alternative channels on failure
    Emergency Activation
      √ should activate emergency contacts in crisis (1 ms)
      √ should provide immediate coping strategies during activation (1 ms)
    Collaboration Features
      √ should allow sharing safety plan with trusted contacts
      √ should sync updates with care team
    Maintenance and Review
      √ should prompt for periodic plan reviews (1 ms)
      √ should track plan version history

FAIL src/hooks/useAutoSave.test.ts (9.166 s)
  useAutoSave Hook
    √ should initialize with default state (71 ms)
    √ should initialize with provided content and title (13 ms)
    √ should update content and mark as dirty (10 ms)
    √ should update title and mark as dirty (4 ms)
    √ should save to localStorage by default (6 ms)
    √ should save to sessionStorage when configured (6 ms)
    √ should use custom save function (5 ms)
    √ should handle save errors gracefully (4 ms)
    × should load draft from storage
    × should delete draft from storage (1 ms)
    × should get all drafts from storage
    × should clear all drafts
    × should enable/disable auto-save
    × should create new draft
    × should debounce content updates before auto-saving
    × should auto-save at regular intervals
    × should not save when content is not dirty (1 ms)
    × should handle storage quota exceeded error
    × should call callbacks on save events (1 ms)
    × should respect maxDrafts limit
    × should update save countdown timer (1 ms)

  ● useAutoSave Hook › should load draft from storage

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should delete draft from storage

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should get all drafts from storage

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should clear all drafts

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should enable/disable auto-save

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should create new draft

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should debounce content updates before auto-saving

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should auto-save at regular intervals

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should not save when content is not dirty

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should handle storage quota exceeded error

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should call callbacks on save events

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should respect maxDrafts limit

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should update save countdown timer

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

PASS src/services/__tests__/accessibilityAuditSystem.test.ts
  AccessibilityAuditSystem
    WCAG Enums and Types
      √ should have correct WCAG levels (3 ms)
      √ should have correct WCAG principles (1 ms)
    ContrastAnalyzer
      √ should calculate contrast ratio correctly (1 ms)
      √ should check WCAG contrast compliance (1 ms)
      √ should handle large text contrast differently (1 ms)
    KeyboardNavigationTester
      √ should detect missing skip links (26 ms)
      √ should not detect missing skip links when they exist (8 ms)
      √ should detect custom tab order issues (5 ms)
      √ should detect missing focus indicators (3 ms)
    ScreenReaderTester
      √ should detect missing ARIA labels (8 ms)
      √ should detect improper heading structure (4 ms)
      √ should detect missing alt text (13 ms)
      √ should detect missing form labels (6 ms)
      √ should detect missing landmarks (4 ms)
      √ should detect missing live regions for dynamic content (3 ms)
    MentalHealthAccessibilityChecker
      √ should detect crisis elements with accessibility issues (8 ms)
      √ should detect flashing content (3 ms)
      √ should detect autoplay media (5 ms)
      √ should check chat accessibility (4 ms)
      √ should check emoji accessibility (5 ms)
    Comprehensive Audit
      √ should run complete accessibility audit (11 ms)
      √ should calculate accessibility scores correctly (3 ms)
      √ should generate appropriate recommendations (4 ms)
      √ should check WCAG compliance correctly (4 ms)
      √ should handle different WCAG levels (4 ms)
    Mental Health Compliance
      √ should evaluate mental health compliance factors (6 ms)
      √ should evaluate assistive technology support (2 ms)
    Singleton Instance
      √ should export singleton instance (1 ms)
      √ should maintain same instance
    Error Handling
      √ should handle DOM exceptions gracefully (2 ms)
      √ should handle missing elements gracefully (1 ms)

  console.warn
    ⚠️ Performance Alert: {
      id: 'budget_firstContentfulPaint_1755460722685',
      type: 'budget_violation',
      severity: 'critical',
      metric: 'firstContentfulPaint',
      currentValue: 5000,
      expectedValue: 1500,
      description: 'firstContentfulPaint (5000) exceeds critical threshold (3500)',
      recommendations: [
        'Optimize critical CSS delivery',
        'Minimize main thread work',
        'Use resource hints (preload, preconnect)',
        'Optimize font loading'
      ],
      timestamp: 1755460722685,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at src/services/comprehensivePerformanceMonitor.ts:642:14
          at Array.forEach (<anonymous>)
      at ComprehensivePerformanceMonitor.checkPerformanceBudgets (src/services/comprehensivePerformanceMonitor.ts:623:29)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:382:24)

  console.warn
    ⚠️ Performance Alert: {
      id: 'budget_memoryUsage_1755460722829',
      type: 'budget_violation',
      severity: 'medium',
      metric: 'memoryUsage',
      currentValue: 100,
      expectedValue: 50,
      description: 'memoryUsage (100) exceeds target (50)',
      recommendations: [
        'Implement virtual scrolling',
        'Clean up subscriptions and listeners',
        'Use React.memo for expensive components',
        'Optimize image memory usage'
      ],
      timestamp: 1755460722829,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at src/services/comprehensivePerformanceMonitor.ts:642:14
          at Array.forEach (<anonymous>)
      at ComprehensivePerformanceMonitor.checkPerformanceBudgets (src/services/comprehensivePerformanceMonitor.ts:623:29)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:382:24)

  console.warn
    ⚠️ Performance Alert: {
      id: 'budget_totalResourceSize_1755460722839',
      type: 'budget_violation',
      severity: 'medium',
      metric: 'totalResourceSize',
      currentValue: 2000000,
      expectedValue: 1500000,
      description: 'totalResourceSize (2000000) exceeds target (1500000)',
      recommendations: [ 'Monitor and optimize based on specific bottlenecks' ],
      timestamp: 1755460722839,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at src/services/comprehensivePerformanceMonitor.ts:642:14
          at Array.forEach (<anonymous>)
      at ComprehensivePerformanceMonitor.checkPerformanceBudgets (src/services/comprehensivePerformanceMonitor.ts:623:29)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:382:24)

  console.warn
    ⚠️ Performance Alert: {
      id: 'test-alert',
      type: 'budget_violation',
      severity: 'high',
      metric: 'firstContentfulPaint',
      currentValue: 3000,
      expectedValue: 1500,
      description: 'FCP exceeds target',
      recommendations: [ 'Optimize critical CSS' ],
      timestamp: 1755460722857,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:716:24)

  console.warn
    ⚠️ Performance Alert: {
      id: 'alert-1',
      type: 'budget_violation',
      severity: 'high',
      metric: 'firstContentfulPaint',
      currentValue: 3000,
      expectedValue: 1500,
      description: 'FCP exceeds target',
      recommendations: [ 'Optimize critical CSS' ],
      timestamp: 1755460722866,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:749:24)

  console.error
    🚨 CRITICAL PERFORMANCE ALERT (Crisis-Related): {
      id: 'callback-test',
      type: 'bottleneck_detected',
      severity: 'critical',
      metric: 'crisisDetectionResponseTime',
      currentValue: 600,
      expectedValue: 100,
      description: 'Crisis detection too slow',
      recommendations: [ 'Optimize AI model' ],
      timestamp: 1755460722877,
      isCrisisRelated: true
    }

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:789:15)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:774:24)

  console.warn
    ⚠️ Performance Alert: {
      id: 'resolved-alert',
      type: 'budget_violation',
      severity: 'high',
      metric: 'firstContentfulPaint',
      currentValue: 3000,
      expectedValue: 1500,
      description: 'FCP was too slow',
      recommendations: [ 'Optimize CSS' ],
      timestamp: 1755460722886,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:822:24)

FAIL src/services/__tests__/culturalAssessmentService.test.ts
  CulturalAssessmentService
    Cultural Expression Patterns
      √ should have comprehensive expression patterns for different cultures (2 ms)
    Assessment Questions Adaptation
      × should get culturally adapted PHQ-9 questions (3 ms)
      √ should get culturally adapted GAD-7 questions (2 ms)
      √ should use default context when none provided (1 ms)
      √ should determine appropriate sensitivity levels (1 ms)
      √ should identify stigma considerations
      √ should identify suicide stigma considerations (1 ms)
    Cultural Assessment Calculation
      × should calculate culturally-adjusted PHQ-9 results (1 ms)
      √ should calculate culturally-adjusted GAD-7 results (1 ms)
      √ should apply somatic bias adjustment for relevant cultures
      √ should apply expressiveness adjustment for indirect cultures (1 ms)
      √ should apply stigma adjustment based on stigma level (1 ms)
      √ should calculate adjusted PHQ-9 severity thresholds
      √ should calculate adjusted GAD-7 severity thresholds (1 ms)
    Cultural Recommendations
      √ should generate Hispanic/Latino cultural recommendations
      √ should generate Arabic cultural recommendations (1 ms)
      √ should generate Chinese cultural recommendations (59 ms)
      √ should provide language-specific crisis resources (1 ms)
      √ should provide culturally appropriate family guidance (1 ms)
      √ should generate base recommendations by severity (1 ms)
    Assessment Submission
      √ should submit cultural assessment with privacy preservation (2 ms)
      √ should handle assessment submission errors (11 ms)
    Cultural Analytics
      √ should get cultural assessment analytics (1 ms)
      √ should filter analytics by cultural context
      √ should handle analytics errors gracefully (1 ms)
      √ should record analytics with error handling (1 ms)
    Helper Methods
      √ should generate unique assessment IDs
      √ should anonymize user tokens (1 ms)
      √ should get cultural adaptations used
      √ should analyze cultural expression patterns
      √ should get relevant expression patterns for questions
      √ should generate alternative phrasings
    Base Assessment Questions
      √ should provide complete PHQ-9 questions (2 ms)
      √ should provide complete GAD-7 questions (2 ms)
    Singleton Instance
      √ should export singleton instance
      √ should maintain same instance
    Error Handling
      √ should handle cultural question adaptation errors (1 ms)
      √ should handle calculation errors gracefully
      √ should handle missing cultural patterns gracefully (1 ms)

  ● CulturalAssessmentService › Assessment Questions Adaptation › should get culturally adapted PHQ-9 questions

    expect(received).toHaveProperty(path)

    Expected path: "Hispanic/Latino"
    Received path: []

    Received value: {}

    [0m [90m 89 |[39m       
     [90m 90 |[39m       expect(questions)[33m.[39mtoHaveLength([35m9[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 91 |[39m       expect(questions[[35m0[39m][33m.[39mculturalAdaptations)[33m.[39mtoHaveProperty([32m'Hispanic/Latino'[39m)[33m;[39m
     [90m    |[39m                                                [31m[1m^[22m[39m
     [90m 92 |[39m       expect(questions[[35m0[39m][33m.[39msensitivityLevel)[33m.[39mtoBeDefined()[33m;[39m
     [90m 93 |[39m       expect(questions[[35m0[39m][33m.[39mstigmaConsiderations)[33m.[39mtoBeInstanceOf([33mArray[39m)[33m;[39m
     [90m 94 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/culturalAssessmentService.test.ts:91:48)

  ● CulturalAssessmentService › Cultural Assessment Calculation › should calculate culturally-adjusted PHQ-9 results

    expect(received).toBeGreaterThan(expected)

    Matcher error: received value must be a number or bigint

    Received has type:  string
    Received has value: "high"

    [0m [90m 175 |[39m       expect(result[33m.[39mculturalFactors)[33m.[39mtoBeDefined()[33m;[39m
     [90m 176 |[39m       expect(result[33m.[39mculturalFactors[33m.[39mexpressionStyle)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 177 |[39m       expect(result[33m.[39mculturalFactors[33m.[39mstigmaLevel)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                                  [31m[1m^[22m[39m
     [90m 178 |[39m       expect(result[33m.[39mculturalFactors[33m.[39mfamilyInvolvement)[33m.[39mtoBe([32m'family-centered'[39m)[33m;[39m
     [90m 179 |[39m       expect(result[33m.[39mrecommendations)[33m.[39mtoBeDefined()[33m;[39m
     [90m 180 |[39m       expect(result[33m.[39mrecommendations[33m.[39mprimary)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/culturalAssessmentService.test.ts:177:50)

FAIL src/services/__tests__/securityService.test.ts
  SecurityService
    constructor
      × should initialize with default config (1 ms)
      × should initialize with custom config (1 ms)
      × should setup CSP when enabled (1 ms)
    validateInput
      × should validate required fields
      × should validate minimum length (1 ms)
      × should validate maximum length
      × should validate pattern (1 ms)
      × should validate custom rules
      × should skip validation when disabled
    sanitizeInput
      × should sanitize HTML entities
      × should skip sanitization when disabled (1 ms)
    containsXSS
      × should detect script tags
      × should detect javascript: protocol
      × should detect event handlers (1 ms)
      × should detect eval
      × should detect vbscript
      × should detect data URLs
      × should not detect safe content
    sanitizeHTML
      × should remove script tags
      × should remove event handlers (10 ms)
      × should remove javascript: protocol
    checkRateLimit
      × should allow requests within limit
      × should block requests exceeding limit (1 ms)
      × should use different limits for different keys (1 ms)
      × should track different identifiers separately
      × should skip rate limiting when disabled (1 ms)
    IP blocking
      × should block and unblock IPs
      × should auto-unblock after duration
    validatePassword
      × should validate password length (1 ms)
      × should check for lowercase letters (1 ms)
      × should check for uppercase letters (1 ms)
      × should check for numbers (1 ms)
      × should check for special characters
      × should detect common passwords (8 ms)
      × should validate strong passwords
    hashPassword
      × should hash passwords
      × should produce consistent hashes
      × should produce different hashes for different passwords (1 ms)
    generateSecureToken
      × should generate tokens of specified length
      × should generate different tokens (1 ms)
      × should use default length
    validateSession
      × should validate hex tokens (1 ms)
      × should reject short tokens
      × should reject non-hex tokens (1 ms)
      × should reject empty tokens
    CSRF protection
      × should generate and validate CSRF tokens (1 ms)
      × should reject invalid CSRF tokens
      × should store token in sessionStorage
    content filtering
      × should detect profanity
      × should filter content
    logSecurityEvent
      × should log security events
      × should limit logs to 100 entries
    addFormProtection
      × should add CSRF token to form
      × should add input validation listeners
    clearRateLimitStore
      × should clear expired rate limits
    security logs management
      × should get security logs
      × should clear security logs
  useSecurity hook
    × should return security methods
    × should clear rate limits periodically
  ValidationRules
    × should provide email validation rules
    × should provide password validation rules
    × should provide username validation rules
  getSecurityService
    × should return singleton instance
  edge cases and error handling
    × should handle null values in validation
    × should handle undefined values in validation (7 ms)
    × should handle empty profanity list (1 ms)
    × should handle form without inputs
    × should handle crypto API errors gracefully

  ● SecurityService › constructor › should initialize with default config

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › constructor › should initialize with custom config

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › constructor › should setup CSP when enabled

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validateInput › should validate required fields

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validateInput › should validate minimum length

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validateInput › should validate maximum length

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validateInput › should validate pattern

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validateInput › should validate custom rules

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validateInput › should skip validation when disabled

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › sanitizeInput › should sanitize HTML entities

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › sanitizeInput › should skip sanitization when disabled

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › containsXSS › should detect script tags

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › containsXSS › should detect javascript: protocol

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › containsXSS › should detect event handlers

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › containsXSS › should detect eval

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › containsXSS › should detect vbscript

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › containsXSS › should detect data URLs

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › containsXSS › should not detect safe content

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › sanitizeHTML › should remove script tags

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › sanitizeHTML › should remove event handlers

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › sanitizeHTML › should remove javascript: protocol

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › checkRateLimit › should allow requests within limit

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › checkRateLimit › should block requests exceeding limit

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › checkRateLimit › should use different limits for different keys

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › checkRateLimit › should track different identifiers separately

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › checkRateLimit › should skip rate limiting when disabled

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › IP blocking › should block and unblock IPs

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › IP blocking › should auto-unblock after duration

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validatePassword › should validate password length

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validatePassword › should check for lowercase letters

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validatePassword › should check for uppercase letters

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validatePassword › should check for numbers

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validatePassword › should check for special characters

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validatePassword › should detect common passwords

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validatePassword › should validate strong passwords

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › hashPassword › should hash passwords

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › hashPassword › should produce consistent hashes

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › hashPassword › should produce different hashes for different passwords

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › generateSecureToken › should generate tokens of specified length

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › generateSecureToken › should generate different tokens

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › generateSecureToken › should use default length

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validateSession › should validate hex tokens

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validateSession › should reject short tokens

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validateSession › should reject non-hex tokens

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validateSession › should reject empty tokens

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › CSRF protection › should generate and validate CSRF tokens

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › CSRF protection › should reject invalid CSRF tokens

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › CSRF protection › should store token in sessionStorage

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › content filtering › should detect profanity

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › content filtering › should filter content

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › logSecurityEvent › should log security events

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › logSecurityEvent › should limit logs to 100 entries

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › addFormProtection › should add CSRF token to form

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › addFormProtection › should add input validation listeners

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › clearRateLimitStore › should clear expired rate limits

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › security logs management › should get security logs

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › security logs management › should clear security logs

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● useSecurity hook › should return security methods

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● useSecurity hook › should clear rate limits periodically

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● ValidationRules › should provide email validation rules

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● ValidationRules › should provide password validation rules

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● ValidationRules › should provide username validation rules

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● getSecurityService › should return singleton instance

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● edge cases and error handling › should handle null values in validation

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● edge cases and error handling › should handle undefined values in validation

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● edge cases and error handling › should handle empty profanity list

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● edge cases and error handling › should handle form without inputs

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● edge cases and error handling › should handle crypto API errors gracefully

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

PASS src/services/__tests__/crisisStressTestingSystem.test.ts
  CrisisStressTestingSystem
    Load Testing
      √ should handle multiple simultaneous crisis detections (2 ms)
      √ should prioritize emergency cases under load (1 ms)
      √ should maintain accuracy under stress (1 ms)
    Failover and Recovery
      √ should handle primary detector failure (1 ms)
      √ should handle database connection loss
      √ should handle API rate limiting (1 ms)
      √ should recover from cascading failures
    Performance Monitoring
      √ should track response time distribution (1 ms)
      √ should detect performance degradation
      √ should track resource utilization (1 ms)
    Chaos Engineering
      √ should handle random failures gracefully
      √ should handle network partitions
      √ should handle clock skew
    Scalability Testing
      √ should scale horizontally (1 ms)
      √ should handle auto-scaling triggers
    Data Consistency Under Load
      √ should maintain data consistency during concurrent writes (1 ms)
      √ should handle distributed transactions (1 ms)
    Edge Cases and Boundaries
      √ should handle extremely long texts
      √ should handle rapid user switching (1 ms)
      √ should handle malformed inputs gracefully
    Monitoring and Alerting
      √ should generate comprehensive stress test report
      √ should trigger alerts on threshold breaches (1 ms)

FAIL src/utils/accessibilityAuditor.test.ts (9.047 s)
  accessibilityAuditor
    Constructor and Configuration
      √ should initialize with default configuration (18 ms)
      √ should accept custom configuration (2 ms)
      √ should merge custom config with defaults (2 ms)
    auditPage
      √ should return audit result with all required properties (53 ms)
      √ should calculate score between 0 and 100 (3 ms)
      × should run all audit checks (11 ms)
    Image Alternatives (WCAG 1.1.1)
      × should detect missing alt attributes (4 ms)
      √ should not flag images with proper alt text (3 ms)
      √ should not flag decorative images (5 ms)
      √ should detect redundant alt text (4 ms)
      √ should detect background images without alternatives (31 ms)
    Form Labels (WCAG 1.3.1, 3.3.2)
      √ should detect form controls without labels (27 ms)
      × should accept various labeling methods (8 ms)
      √ should detect placeholder-as-label antipattern (4 ms)
    Heading Structure (WCAG 1.3.1)
      × should detect missing headings (2 ms)
      × should detect missing H1 (3 ms)
      × should detect multiple H1s (3 ms)
      × should detect heading level jumps (4 ms)
      √ should detect empty headings (3 ms)
      × should accept proper heading hierarchy (3 ms)
    Color Contrast (WCAG 1.4.3, 1.4.6)
      × should detect insufficient color contrast (2 ms)
      √ should handle transparent backgrounds (3 ms)
    Focus Indicators (WCAG 2.4.7)
      × should detect missing global focus styles (2 ms)
      √ should handle cross-origin stylesheet errors (1 ms)
    Keyboard Navigation (WCAG 2.1.1)
      × should detect positive tabindex values (2 ms)
      × should detect click handlers without keyboard support (2 ms)
      × should accept proper interactive elements (3 ms)
    Touch Targets (WCAG 2.5.5) - Mobile Specific
      √ should detect small touch targets on mobile (7 ms)
      × should not check touch targets when mobile optimization disabled (64 ms)
      √ should accept adequately sized touch targets (3 ms)
    Landmarks (WCAG 1.3.1)
      × should detect missing main landmark (1 ms)
      √ should detect multiple main landmarks (3 ms)
      √ should accept proper landmark structure (4 ms)
      √ should warn about missing navigation landmark (3 ms)
    ARIA Usage (WCAG 4.1.2)
      × should detect empty aria-label (1 ms)
      × should detect invalid aria-labelledby references (2 ms)
      × should detect invalid aria-describedby references (2 ms)
      × should accept valid ARIA references (2 ms)
    Text Alternatives (WCAG 1.1.1)
      √ should detect SVG without accessible name (4 ms)
      √ should accept SVG with proper alternatives (4 ms)
      √ should detect canvas without alternative content (3 ms)
    Language Specification (WCAG 3.1.1)
      √ should detect missing lang attribute (2 ms)
      √ should accept proper language declaration (2 ms)
    Mobile-Specific Checks
      √ should detect missing viewport meta tag (1 ms)
      × should detect viewport that prevents zooming (9 ms)
      × should accept proper viewport configuration (8 ms)
      √ should detect horizontal scrolling (26 ms)
    Custom Rules
      × should execute custom rules (9 ms)
    Configuration Options
      √ should exclude warnings when configured (7 ms)
      × should skip elements with aria-hidden when configured (3 ms)
      √ should use AAA level when configured (2 ms)
    Score Calculation
      × should calculate lower score with more issues (11 ms)
      √ should provide appropriate suggestions based on issues (3 ms)
      × should identify compliant areas (3 ms)
    Static Methods
      × should provide quickAudit method (2 ms)
      × should provide comprehensiveAudit method (1 ms)
    Error Handling
      × should handle malformed DOM gracefully (29 ms)
      × should handle missing elements gracefully (1 ms)
      × should handle getBoundingClientRect errors (1 ms)
      × should handle color parsing errors (12 ms)
    Performance
      × should complete audit in reasonable time (89 ms)
      × should not cause memory leaks with repeated audits (3 ms)
    Default Export
      √ should export MobileAccessibilityAuditor as default (1 ms)

  ● accessibilityAuditor › auditPage › should run all audit checks

    SyntaxError: 'h1 with text ,,Test Heading,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:161:30)

  ● accessibilityAuditor › Image Alternatives (WCAG 1.1.1) › should detect missing alt attributes

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 173 |[39m       )[33m;[39m
     [90m 174 |[39m
    [31m[1m>[22m[39m[90m 175 |[39m       expect(imageIssues[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 176 |[39m       expect(imageIssues[[35m0[39m][33m.[39mwcagCriterion)[33m.[39mtoBe([32m'1.1.1'[39m)[33m;[39m
     [90m 177 |[39m       expect(imageIssues[[35m0[39m][33m.[39mseverity)[33m.[39mtoBe([32m'high'[39m)[33m;[39m
     [90m 178 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:175:34)

  ● accessibilityAuditor › Form Labels (WCAG 1.3.1, 3.3.2) › should accept various labeling methods

    SyntaxError: 'label with text ,,Email,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:263:30)

  ● accessibilityAuditor › Heading Structure (WCAG 1.3.1) › should detect missing headings

    SyntaxError: 'p with text ,,Content without any headings,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:288:30)

  ● accessibilityAuditor › Heading Structure (WCAG 1.3.1) › should detect missing H1

    SyntaxError: 'h2 with text ,,Section Title,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:302:30)

  ● accessibilityAuditor › Heading Structure (WCAG 1.3.1) › should detect multiple H1s

    SyntaxError: 'h1 with text ,,First Title,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:316:30)

  ● accessibilityAuditor › Heading Structure (WCAG 1.3.1) › should detect heading level jumps

    SyntaxError: 'h1 with text ,,Main Title,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:330:30)

  ● accessibilityAuditor › Heading Structure (WCAG 1.3.1) › should accept proper heading hierarchy

    SyntaxError: 'h1 with text ,,Main Title,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:358:30)

  ● accessibilityAuditor › Color Contrast (WCAG 1.4.3, 1.4.6) › should detect insufficient color contrast

    SyntaxError: 'p with text ,,Low contrast text,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:399:30)

  ● accessibilityAuditor › Focus Indicators (WCAG 2.4.7) › should detect missing global focus styles

    SyntaxError: 'button with text ,,Test Button,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:438:30)

  ● accessibilityAuditor › Keyboard Navigation (WCAG 2.1.1) › should detect positive tabindex values

    SyntaxError: 'div with text ,,Positive tabindex,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:468:30)

  ● accessibilityAuditor › Keyboard Navigation (WCAG 2.1.1) › should detect click handlers without keyboard support

    SyntaxError: 'div with text ,,Clickable div,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:480:30)

  ● accessibilityAuditor › Keyboard Navigation (WCAG 2.1.1) › should accept proper interactive elements

    SyntaxError: 'button with text ,,Button,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:496:30)

  ● accessibilityAuditor › Touch Targets (WCAG 2.5.5) - Mobile Specific › should not check touch targets when mobile optimization disabled

    SyntaxError: 'button with text ,,Small Button,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:542:37)

  ● accessibilityAuditor › Landmarks (WCAG 1.3.1) › should detect missing main landmark

    SyntaxError: 'div with text ,,Content without main landmark,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:585:30)

  ● accessibilityAuditor › ARIA Usage (WCAG 4.1.2) › should detect empty aria-label

    SyntaxError: 'button with text ,,Button,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:642:30)

  ● accessibilityAuditor › ARIA Usage (WCAG 4.1.2) › should detect invalid aria-labelledby references

    SyntaxError: 'button with text ,,Button,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:653:30)

  ● accessibilityAuditor › ARIA Usage (WCAG 4.1.2) › should detect invalid aria-describedby references

    SyntaxError: 'button with text ,,Button,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:665:30)

  ● accessibilityAuditor › ARIA Usage (WCAG 4.1.2) › should accept valid ARIA references

    SyntaxError: 'span with text ,,Button Label,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:680:30)

  ● accessibilityAuditor › Mobile-Specific Checks › should detect viewport that prevents zooming

    RangeError: Maximum call stack size exceeded
        at WeakMap.get (<anonymous>)

    [0m [90m 86 |[39m         [36mreturn[39m mockCanvas[33m;[39m
     [90m 87 |[39m       }
    [31m[1m>[22m[39m[90m 88 |[39m       [36mreturn[39m originalCreateElement(tagName)[33m;[39m
     [90m    |[39m              [31m[1m^[22m[39m
     [90m 89 |[39m     })[33m;[39m
     [90m 90 |[39m
     [90m 91 |[39m     [90m// Default auditor configuration[39m[0m

      at ModuleMocker._ensureMockState (node_modules/jest-mock/build/index.js:287:33)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:396:39)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)

  ● accessibilityAuditor › Mobile-Specific Checks › should accept proper viewport configuration

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

    [0m [90m 86 |[39m         [36mreturn[39m mockCanvas[33m;[39m
     [90m 87 |[39m       }
    [31m[1m>[22m[39m[90m 88 |[39m       [36mreturn[39m originalCreateElement(tagName)[33m;[39m
     [90m    |[39m              [31m[1m^[22m[39m
     [90m 89 |[39m     })[33m;[39m
     [90m 90 |[39m
     [90m 91 |[39m     [90m// Default auditor configuration[39m[0m

      at node_modules/jest-mock/build/index.js:367:22
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:396:39)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)

  ● accessibilityAuditor › Custom Rules › should execute custom rules

    SyntaxError: 'div with text ,,Test content,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:836:36)

  ● accessibilityAuditor › Configuration Options › should skip elements with aria-hidden when configured

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 8

    [0m [90m 867 |[39m       [36mconst[39m result [33m=[39m skipHiddenAuditor[33m.[39mauditPage()[33m;[39m
     [90m 868 |[39m       [90m// Should not have issues for hidden elements[39m
    [31m[1m>[22m[39m[90m 869 |[39m       expect(result[33m.[39missues[33m.[39mlength)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 870 |[39m     })[33m;[39m
     [90m 871 |[39m
     [90m 872 |[39m     test([32m'should use AAA level when configured'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:869:36)

  ● accessibilityAuditor › Score Calculation › should calculate lower score with more issues

    SyntaxError: 'div with text ,,Clickable div,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:893:30)

  ● accessibilityAuditor › Score Calculation › should identify compliant areas

    SyntaxError: 'h1 with text ,,Page Title,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:917:30)

  ● accessibilityAuditor › Static Methods › should provide quickAudit method

    SyntaxError: 'h1 with text ,,Test Page,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Function.quickAudit (src/utils/accessibilityAuditor.ts:865:20)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:929:49)

  ● accessibilityAuditor › Static Methods › should provide comprehensiveAudit method

    SyntaxError: 'h1 with text ,,Test Page,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Function.comprehensiveAudit (src/utils/accessibilityAuditor.ts:871:20)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:940:49)

  ● accessibilityAuditor › Error Handling › should handle malformed DOM gracefully

    expect(received).not.toThrow()

    Error name:    "Error"
    Error message: "DOM error"

        [0m [90m 953 |[39m       [36mconst[39m originalQuerySelector [33m=[39m document[33m.[39mquerySelector[33m;[39m
         [90m 954 |[39m       document[33m.[39mquerySelector [33m=[39m jest[33m.[39mfn(() [33m=>[39m {
        [31m[1m>[22m[39m[90m 955 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'DOM error'[39m)[33m;[39m
         [90m     |[39m               [31m[1m^[22m[39m
         [90m 956 |[39m       })[33m;[39m
         [90m 957 |[39m
         [90m 958 |[39m       expect(() [33m=>[39m {[0m

      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:955:15)
      at MobileAccessibilityAuditor.checkMobileSpecificChecks (src/utils/accessibilityAuditor.ts:736:35)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:92:10)
      at src/utils/accessibilityAuditor.test.ts:959:17
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:960:14)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:960:14)

  ● accessibilityAuditor › Error Handling › should handle missing elements gracefully

    DOM error

    [0m [90m 953 |[39m       [36mconst[39m originalQuerySelector [33m=[39m document[33m.[39mquerySelector[33m;[39m
     [90m 954 |[39m       document[33m.[39mquerySelector [33m=[39m jest[33m.[39mfn(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 955 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'DOM error'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 956 |[39m       })[33m;[39m
     [90m 957 |[39m
     [90m 958 |[39m       expect(() [33m=>[39m {[0m

      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:955:15)
      at MobileAccessibilityAuditor.checkMobileSpecificChecks (src/utils/accessibilityAuditor.ts:736:35)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:92:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:969:30)

  ● accessibilityAuditor › Error Handling › should handle getBoundingClientRect errors

    DOM error

    [0m [90m 953 |[39m       [36mconst[39m originalQuerySelector [33m=[39m document[33m.[39mquerySelector[33m;[39m
     [90m 954 |[39m       document[33m.[39mquerySelector [33m=[39m jest[33m.[39mfn(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 955 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'DOM error'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 956 |[39m       })[33m;[39m
     [90m 957 |[39m
     [90m 958 |[39m       expect(() [33m=>[39m {[0m

      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:955:15)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:976:35)

  ● accessibilityAuditor › Error Handling › should handle color parsing errors

    expect(received).not.toThrow()

    Error name:    "Error"
    Error message: "DOM error"

        [0m [90m 953 |[39m       [36mconst[39m originalQuerySelector [33m=[39m document[33m.[39mquerySelector[33m;[39m
         [90m 954 |[39m       document[33m.[39mquerySelector [33m=[39m jest[33m.[39mfn(() [33m=>[39m {
        [31m[1m>[22m[39m[90m 955 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'DOM error'[39m)[33m;[39m
         [90m     |[39m               [31m[1m^[22m[39m
         [90m 956 |[39m       })[33m;[39m
         [90m 957 |[39m
         [90m 958 |[39m       expect(() [33m=>[39m {[0m

      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:955:15)
      at MobileAccessibilityAuditor.checkMobileSpecificChecks (src/utils/accessibilityAuditor.ts:736:35)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:92:10)
      at src/utils/accessibilityAuditor.test.ts:1002:17
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:1003:14)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:1003:14)

  ● accessibilityAuditor › Performance › should complete audit in reasonable time

    DOM error

    [0m [90m 953 |[39m       [36mconst[39m originalQuerySelector [33m=[39m document[33m.[39mquerySelector[33m;[39m
     [90m 954 |[39m       document[33m.[39mquerySelector [33m=[39m jest[33m.[39mfn(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 955 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'DOM error'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 956 |[39m       })[33m;[39m
     [90m 957 |[39m
     [90m 958 |[39m       expect(() [33m=>[39m {[0m

      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:955:15)
      at MobileAccessibilityAuditor.checkMobileSpecificChecks (src/utils/accessibilityAuditor.ts:736:35)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:92:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:1022:30)

  ● accessibilityAuditor › Performance › should not cause memory leaks with repeated audits

    DOM error

    [0m [90m 953 |[39m       [36mconst[39m originalQuerySelector [33m=[39m document[33m.[39mquerySelector[33m;[39m
     [90m 954 |[39m       document[33m.[39mquerySelector [33m=[39m jest[33m.[39mfn(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 955 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'DOM error'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 956 |[39m       })[33m;[39m
     [90m 957 |[39m
     [90m 958 |[39m       expect(() [33m=>[39m {[0m

      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:955:15)
      at MobileAccessibilityAuditor.checkMobileSpecificChecks (src/utils/accessibilityAuditor.ts:736:35)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:92:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:1035:17)

PASS tests/services/crisisEscalationWorkflow.test.ts
  Crisis Escalation Workflow Service
    Crisis Escalation Initiation
      √ should initiate peer support escalation for low-risk situations (3 ms)
      √ should initiate crisis counselor escalation for high-risk situations (1 ms)
      √ should initiate emergency team escalation for critical situations (1 ms)
      √ should initiate emergency services escalation for emergency situations (1 ms)
      √ should handle manual override for escalation tier (1 ms)
      √ should fallback to emergency services on escalation failure (1 ms)
    Emergency Escalation
      √ should handle immediate emergency escalation (1 ms)
      √ should handle medical emergency escalation
      √ should handle violence threat escalation
    Escalation Monitoring and Updates
      √ should track active escalations (51 ms)
      √ should update escalation status (1 ms)
      √ should handle non-existent escalation updates
    Emergency Contacts
      √ should return emergency contacts for US location (1 ms)
      √ should return emergency contacts with language preference
      √ should sort contacts by effectiveness (11 ms)
      √ should handle unknown location gracefully
    Escalation Metrics
      √ should return escalation metrics (1 ms)
      √ should track escalations by tier (1 ms)
    Escalation Tier Selection
      √ should select appropriate tier based on risk level (1 ms)
      √ should escalate to emergency services when explicitly required
    Cultural and Accessibility Considerations
      √ should handle cultural context in escalation (1 ms)
      √ should handle accessibility needs in escalation
    Error Handling and Edge Cases
      √ should handle missing user context gracefully (1 ms)
      √ should handle invalid escalation requests
      √ should handle concurrent escalations for same user (1 ms)
    Response Time Requirements
      √ should meet response time targets for emergency escalations
      √ should track escalation timeline accurately (1 ms)

FAIL src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts
  EnhancedCrisisKeywordDetectionService
    analyzeEnhancedCrisisKeywords
      √ should detect emergency-level suicide intent (15 ms)
      √ should detect suicide planning with specific methods (2 ms)
      √ should detect active suicidal ideation (1 ms)
      √ should detect self-harm escalation (1 ms)
      √ should detect substance crisis with suicidal intent (1 ms)
      √ should detect medical emergency situations (2 ms)
      √ should detect violence threats (1 ms)
      √ should detect psychotic episodes (1 ms)
      √ should detect panic crisis (1 ms)
      √ should detect abuse disclosure (1 ms)
      √ should reduce confidence for hypothetical language (1 ms)
      × should reduce confidence for negative flag words (1 ms)
      × should handle timeline urgency indicators (2 ms)
      × should detect emotional crisis patterns (1 ms)
      √ should generate appropriate intervention recommendations
      √ should handle text with no crisis indicators
      √ should calculate confidence scores properly (1 ms)
      √ should analyze surrounding context properly
      √ should handle emotional amplifiers (1 ms)
      × should detect multiple crisis categories (1 ms)
      √ should handle risk factors and protective factors
      × should provide analysis metadata (1 ms)
      √ should handle errors gracefully (5 ms)
      √ should handle medium-risk scenarios appropriately (1 ms)
      √ should handle low-risk scenarios with monitoring recommendations
    Edge cases and validation
      √ should handle empty text (1 ms)
      √ should handle whitespace-only text
      × should be case-insensitive (1 ms)
      √ should handle special characters and punctuation (2 ms)
      √ should handle numbers and dates in text (1 ms)
    Performance and reliability
      × should process text within reasonable time limits (1 ms)
      √ should handle moderately long text efficiently (1 ms)
      × should maintain consistent results for identical input (1 ms)
    Context and cultural considerations
      √ should handle context parameters (2 ms)
      √ should provide culturally appropriate intervention recommendations
    Intervention recommendation logic
      × should prioritize recommendations correctly (1 ms)
      √ should include appropriate resources in recommendations
      √ should provide different timeframes for different urgency levels (1 ms)
    Emotional analysis
      × should detect hopelessness emotional patterns (1 ms)
      √ should detect rage crisis patterns (1 ms)
      √ should calculate emotional profile correctly
    Risk assessment accuracy
      √ should assign maximum risk for emergency situations
      √ should assign appropriate risk for different severity levels (1 ms)
      √ should calculate different risk timeframes

  ● EnhancedCrisisKeywordDetectionService › analyzeEnhancedCrisisKeywords › should reduce confidence for negative flag words

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 146 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m service[33m.[39manalyzeEnhancedCrisisKeywords(text)[33m;[39m
     [90m 147 |[39m
    [31m[1m>[22m[39m[90m 148 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 149 |[39m       expect(result[33m.[39moverallSeverity)[33m.[39mtoBe([32m'none'[39m)[33m;[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts:148:42)

  ● EnhancedCrisisKeywordDetectionService › analyzeEnhancedCrisisKeywords › should handle timeline urgency indicators

    expect(received).toBeGreaterThan(expected)

    Expected: > 80
    Received:   70

    [0m [90m 158 |[39m       expect(result[33m.[39mriskAssessment[33m.[39mtimelineAnalysis[33m.[39mhasTemporalUrgency)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 159 |[39m       expect(result[33m.[39mriskAssessment[33m.[39mtimelineAnalysis[33m.[39mtimeframe)[33m.[39mtoContain([32m'immediate'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 160 |[39m       expect(result[33m.[39mriskAssessment[33m.[39mimmediateRisk)[33m.[39mtoBeGreaterThan([35m80[39m)[33m;[39m
     [90m     |[39m                                                   [31m[1m^[22m[39m
     [90m 161 |[39m     })[33m;[39m
     [90m 162 |[39m
     [90m 163 |[39m     it([32m'should detect emotional crisis patterns'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts:160:51)

  ● EnhancedCrisisKeywordDetectionService › analyzeEnhancedCrisisKeywords › should detect emotional crisis patterns

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 166 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m service[33m.[39manalyzeEnhancedCrisisKeywords(text)[33m;[39m
     [90m 167 |[39m
    [31m[1m>[22m[39m[90m 168 |[39m       expect(result[33m.[39memotionalIndicators[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                                 [31m[1m^[22m[39m
     [90m 169 |[39m       expect(result[33m.[39memotionalIndicators[33m.[39msome(indicator [33m=>[39m 
     [90m 170 |[39m         indicator[33m.[39memotionalState [33m===[39m [32m'hopelessness'[39m
     [90m 171 |[39m       ))[33m.[39mtoBe([36mtrue[39m)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts:168:49)

  ● EnhancedCrisisKeywordDetectionService › analyzeEnhancedCrisisKeywords › should detect multiple crisis categories

    expect(received).toContain(expected) // indexOf

    Expected value: "violence-threat"
    Received array: ["suicidal-ideation"]

    [0m [90m 229 |[39m       [36mconst[39m categories [33m=[39m result[33m.[39mkeywordMatches[33m.[39mmap(match [33m=>[39m match[33m.[39mcategory)[33m;[39m
     [90m 230 |[39m       expect(categories)[33m.[39mtoContain([32m'suicidal-ideation'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 231 |[39m       expect(categories)[33m.[39mtoContain([32m'violence-threat'[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 232 |[39m       expect(categories)[33m.[39mtoContain([32m'psychotic-episode'[39m)[33m;[39m
     [90m 233 |[39m     })[33m;[39m
     [90m 234 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts:231:26)

  ● EnhancedCrisisKeywordDetectionService › analyzeEnhancedCrisisKeywords › should provide analysis metadata

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 250 |[39m       expect(result[33m.[39manalysisMetadata)[33m.[39mtoHaveProperty([32m'confidence'[39m)[33m;[39m
     [90m 251 |[39m       expect(result[33m.[39manalysisMetadata)[33m.[39mtoHaveProperty([32m'processingTime'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 252 |[39m       expect(result[33m.[39manalysisMetadata[33m.[39mprocessingTime)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 253 |[39m     })[33m;[39m
     [90m 254 |[39m
     [90m 255 |[39m     it([32m'should handle errors gracefully'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts:252:54)

  ● EnhancedCrisisKeywordDetectionService › Edge cases and validation › should be case-insensitive

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 310 |[39m
     [90m 311 |[39m       expect(lowerCase[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 312 |[39m       expect(upperCase[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                             [31m[1m^[22m[39m
     [90m 313 |[39m       expect(mixedCase[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 314 |[39m       
     [90m 315 |[39m       expect(lowerCase[33m.[39moverallSeverity)[33m.[39mtoBe(upperCase[33m.[39moverallSeverity)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts:312:45)

  ● EnhancedCrisisKeywordDetectionService › Performance and reliability › should process text within reasonable time limits

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 345 |[39m
     [90m 346 |[39m       expect(processingTime)[33m.[39mtoBeLessThan([35m5000[39m)[33m;[39m [90m// Should complete within 5 seconds[39m
    [31m[1m>[22m[39m[90m 347 |[39m       expect(result[33m.[39manalysisMetadata[33m.[39mprocessingTime)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 348 |[39m     })[33m;[39m
     [90m 349 |[39m
     [90m 350 |[39m     it([32m'should handle moderately long text efficiently'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts:347:54)

  ● EnhancedCrisisKeywordDetectionService › Performance and reliability › should maintain consistent results for identical input

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 364 |[39m       [36mconst[39m result2 [33m=[39m [36mawait[39m service[33m.[39manalyzeEnhancedCrisisKeywords(text)[33m;[39m
     [90m 365 |[39m
    [31m[1m>[22m[39m[90m 366 |[39m       expect(result1[33m.[39mhasCrisisIndicators)[33m.[39mtoBe(result2[33m.[39mhasCrisisIndicators)[33m;[39m
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 367 |[39m       expect(result1[33m.[39moverallSeverity)[33m.[39mtoBe(result2[33m.[39moverallSeverity)[33m;[39m
     [90m 368 |[39m       expect(result1[33m.[39mescalationRequired)[33m.[39mtoBe(result2[33m.[39mescalationRequired)[33m;[39m
     [90m 369 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts:366:43)

  ● EnhancedCrisisKeywordDetectionService › Intervention recommendation logic › should prioritize recommendations correctly

    TypeError: Cannot read properties of undefined (reading 'type')

    [0m [90m 403 |[39m
     [90m 404 |[39m       [36mconst[39m sortedRecommendations [33m=[39m result[33m.[39minterventionRecommendations[33m.[39msort((a[33m,[39m b) [33m=>[39m a[33m.[39mpriority [33m-[39m b[33m.[39mpriority)[33m;[39m
    [31m[1m>[22m[39m[90m 405 |[39m       expect(sortedRecommendations[[35m0[39m][33m.[39mtype)[33m.[39mtoBe([32m'immediate'[39m)[33m;[39m
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 406 |[39m       expect(sortedRecommendations[[35m0[39m][33m.[39mpriority)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m 407 |[39m     })[33m;[39m
     [90m 408 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts:405:39)

  ● EnhancedCrisisKeywordDetectionService › Emotional analysis › should detect hopelessness emotional patterns

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 444 |[39m       expect(result[33m.[39memotionalIndicators[33m.[39msome(indicator [33m=>[39m 
     [90m 445 |[39m         indicator[33m.[39memotionalState [33m===[39m [32m'hopelessness'[39m
    [31m[1m>[22m[39m[90m 446 |[39m       ))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 447 |[39m     })[33m;[39m
     [90m 448 |[39m
     [90m 449 |[39m     it([32m'should detect rage crisis patterns'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts:446:10)

FAIL src/services/__tests__/advancedThemingSystem.test.ts
  ● Test suite failed to run

    ReferenceError: Cannot access 'mockCreateContext' before initialization

    [0m [90m 20 |[39m jest[33m.[39mmock([32m'react'[39m[33m,[39m () [33m=>[39m ({
     [90m 21 |[39m   [33m...[39mjest[33m.[39mrequireActual([32m'react'[39m)[33m,[39m
    [31m[1m>[22m[39m[90m 22 |[39m   createContext[33m:[39m mockCreateContext[33m,[39m
     [90m    |[39m                  [31m[1m^[22m[39m
     [90m 23 |[39m   useContext[33m:[39m mockUseContext[33m,[39m
     [90m 24 |[39m }))[33m;[39m
     [90m 25 |[39m[0m

      at src/services/__tests__/advancedThemingSystem.test.ts:22:18
      at Object.<anonymous> (src/services/advancedThemingSystem.ts:9:1)
      at Object.<anonymous> (src/services/__tests__/advancedThemingSystem.test.ts:5:1)

C:\Users\damat\_REPOS\CoreV2\src\services\__tests__\comprehensivePerformanceMonitor.test.ts:996
            mockAnalyticsService.track.mockRejectedValue(new Error('Analytics error'));
                                                         ^

Error: Analytics error
    at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\services\__tests__\comprehensivePerformanceMonitor.test.ts:1125:52)
    at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
    at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
    at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
    at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
    at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
    at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
    at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
    at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
    at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
    at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
    at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
    at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

Node.js v22.17.0
  console.warn
    localStorage error, generating fresh demo data

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at DemoDataService.getDemoData (src/services/demoDataService.ts:1200:21)
      at src/services/__tests__/demoDataService.test.ts:615:17
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/services/__tests__/demoDataService.test.ts:616:14)

  console.error
    AI chat error: Error: Demo mode - API skipped
        at _callApi (C:\Users\damat\_REPOS\CoreV2\src\utils\ApiClient.ts:97:26)
        at Object.chat (C:\Users\damat\_REPOS\CoreV2\src\utils\ApiClient.ts:494:34)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\utils\ApiClient.test.ts:903:22) {
      isDevelopmentError: true
    }

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at Object.chat (src/utils/ApiClient.ts:500:25)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:903:22)

FAIL tests/services/enhancedCrisisKeywordDetection.test.ts
  EnhancedCrisisKeywordDetectionService
    Emergency Level Crisis Detection
      √ should detect immediate suicide intent with high confidence (37 ms)
      √ should detect suicide planning with method consideration (1 ms)
      √ should detect medical emergency situations (47 ms)
      √ should detect violence threats toward others (1 ms)
    Critical Level Crisis Detection
      √ should detect active suicidal ideation (1 ms)
      √ should detect substance crisis with suicidal intent (1 ms)
      √ should detect abuse disclosure (1 ms)
    High Level Crisis Detection
      × should detect self-harm escalation (1 ms)
      √ should detect severe psychological distress (5 ms)
      √ should detect panic crisis (10 ms)
    Contextual Analysis
      × should reduce crisis level when negative modifiers are present (1 ms)
      √ should increase crisis level with positive amplifiers (1 ms)
      √ should detect timeline urgency
    Emotional Pattern Recognition
      × should detect hopelessness emotional pattern (1 ms)
      × should detect desperation emotional pattern (1 ms)
      √ should detect emotional numbness pattern
      √ should detect rage crisis pattern (1 ms)
    Risk Assessment Scoring
      × should calculate accurate immediate risk scores (1 ms)
      × should provide appropriate intervention urgency levels (1 ms)
    Intervention Recommendations
      × should provide immediate intervention for emergency cases (1 ms)
      × should provide urgent intervention for high-risk cases (1 ms)
      × should provide supportive intervention for medium-risk cases (1 ms)
      × should provide monitoring recommendations for ongoing support (1 ms)
    False Positive Prevention
      × should not trigger crisis for hypothetical or past scenarios (61 ms)
      √ should handle metaphorical language appropriately
    Analysis Metadata
      × should provide accurate analysis metadata (1 ms)
      × should flag appropriate concerns (2 ms)
    Error Handling
      √ should handle empty or invalid input gracefully (1 ms)
      √ should provide failsafe results when analysis fails (1 ms)
    Integration Testing
      × should handle complex multi-indicator scenarios (1 ms)
      × should handle mixed signals appropriately (1 ms)
    Performance Testing
      √ should complete analysis within reasonable time
      √ should handle long text inputs efficiently (2 ms)

  ● EnhancedCrisisKeywordDetectionService › High Level Crisis Detection › should detect self-harm escalation

    expect(received).toBe(expected) // Object.is equality

    Expected: "high"
    Received: "medium"

    [0m [90m 117 |[39m       expect(result[33m.[39moverallSeverity)[33m.[39mtoBe([32m'high'[39m)[33m;[39m
     [90m 118 |[39m       expect(result[33m.[39mkeywordMatches[33m.[39msome(m [33m=>[39m m[33m.[39mcategory [33m===[39m [32m'self-harm'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 119 |[39m       expect(result[33m.[39mriskAssessment[33m.[39minterventionUrgency)[33m.[39mtoBe([32m'high'[39m)[33m;[39m
     [90m     |[39m                                                         [31m[1m^[22m[39m
     [90m 120 |[39m     })[33m;[39m
     [90m 121 |[39m
     [90m 122 |[39m     test([32m'should detect severe psychological distress'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:119:57)

  ● EnhancedCrisisKeywordDetectionService › Contextual Analysis › should reduce crisis level when negative modifiers are present

    expect(received).toBeLessThan(expected)

    Expected: < 70
    Received:   70

    [0m [90m 150 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 151 |[39m       expect(result[33m.[39moverallSeverity)[33m.[39mnot[33m.[39mtoBe([32m'emergency'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 152 |[39m       expect(result[33m.[39mriskAssessment[33m.[39mimmediateRisk)[33m.[39mtoBeLessThan([35m70[39m)[33m;[39m
     [90m     |[39m                                                   [31m[1m^[22m[39m
     [90m 153 |[39m     })[33m;[39m
     [90m 154 |[39m
     [90m 155 |[39m     test([32m'should increase crisis level with positive amplifiers'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:152:51)

  ● EnhancedCrisisKeywordDetectionService › Emotional Pattern Recognition › should detect hopelessness emotional pattern

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.7
    Received:   0.3

    [0m [90m 183 |[39m       expect(result[33m.[39memotionalIndicators[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m 184 |[39m       expect(result[33m.[39memotionalIndicators[33m.[39msome(e [33m=>[39m e[33m.[39memotionalState [33m===[39m [32m'hopelessness'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 185 |[39m       expect(result[33m.[39mriskAssessment[33m.[39memotionalProfile[33m.[39mcrisisAlignment)[33m.[39mtoBeGreaterThan([35m0.7[39m)[33m;[39m
     [90m     |[39m                                                                      [31m[1m^[22m[39m
     [90m 186 |[39m     })[33m;[39m
     [90m 187 |[39m
     [90m 188 |[39m     test([32m'should detect desperation emotional pattern'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:185:70)

  ● EnhancedCrisisKeywordDetectionService › Emotional Pattern Recognition › should detect desperation emotional pattern

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.6
    Received:   0

    [0m [90m 192 |[39m       
     [90m 193 |[39m       expect(result[33m.[39memotionalIndicators[33m.[39msome(e [33m=>[39m e[33m.[39memotionalState [33m===[39m [32m'desperation'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 194 |[39m       expect(result[33m.[39mriskAssessment[33m.[39memotionalProfile[33m.[39mintensity)[33m.[39mtoBeGreaterThan([35m0.6[39m)[33m;[39m
     [90m     |[39m                                                                [31m[1m^[22m[39m
     [90m 195 |[39m     })[33m;[39m
     [90m 196 |[39m
     [90m 197 |[39m     test([32m'should detect emotional numbness pattern'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:194:64)

  ● EnhancedCrisisKeywordDetectionService › Risk Assessment Scoring › should calculate accurate immediate risk scores

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 224 |[39m       
     [90m 225 |[39m       expect(highResult[33m.[39mriskAssessment[33m.[39mimmediateRisk)[33m.[39mtoBeGreaterThan(mediumResult[33m.[39mriskAssessment[33m.[39mimmediateRisk)[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m       expect(mediumResult[33m.[39mriskAssessment[33m.[39mimmediateRisk)[33m.[39mtoBeGreaterThan(lowResult[33m.[39mriskAssessment[33m.[39mimmediateRisk)[33m;[39m
     [90m     |[39m                                                         [31m[1m^[22m[39m
     [90m 227 |[39m     })[33m;[39m
     [90m 228 |[39m
     [90m 229 |[39m     test([32m'should provide appropriate intervention urgency levels'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:226:57)

  ● EnhancedCrisisKeywordDetectionService › Risk Assessment Scoring › should provide appropriate intervention urgency levels

    expect(received).toBe(expected) // Object.is equality

    Expected: "immediate"
    Received: "none"

    [0m [90m 238 |[39m       [36mconst[39m lowResult [33m=[39m [36mawait[39m enhancedCrisisKeywordDetectionService[33m.[39manalyzeEnhancedCrisisKeywords(lowText)[33m;[39m
     [90m 239 |[39m       
    [31m[1m>[22m[39m[90m 240 |[39m       expect(immediateResult[33m.[39mriskAssessment[33m.[39minterventionUrgency)[33m.[39mtoBe([32m'immediate'[39m)[33m;[39m
     [90m     |[39m                                                                  [31m[1m^[22m[39m
     [90m 241 |[39m       expect(highResult[33m.[39mriskAssessment[33m.[39minterventionUrgency)[33m.[39mtoBe([32m'high'[39m)[33m;[39m
     [90m 242 |[39m       expect(mediumResult[33m.[39mriskAssessment[33m.[39minterventionUrgency)[33m.[39mtoBe([32m'medium'[39m)[33m;[39m
     [90m 243 |[39m       expect(lowResult[33m.[39mriskAssessment[33m.[39minterventionUrgency)[33m.[39mtoBe([32m'low'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:240:66)

  ● EnhancedCrisisKeywordDetectionService › Intervention Recommendations › should provide immediate intervention for emergency cases

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 251 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedCrisisKeywordDetectionService[33m.[39manalyzeEnhancedCrisisKeywords(text)[33m;[39m
     [90m 252 |[39m       
    [31m[1m>[22m[39m[90m 253 |[39m       expect(result[33m.[39minterventionRecommendations[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                                         [31m[1m^[22m[39m
     [90m 254 |[39m       expect(result[33m.[39minterventionRecommendations[[35m0[39m][33m.[39mtype)[33m.[39mtoBe([32m'immediate'[39m)[33m;[39m
     [90m 255 |[39m       expect(result[33m.[39minterventionRecommendations[[35m0[39m][33m.[39mactionItems)[33m.[39mtoContain([32m'Contact emergency services (911)'[39m)[33m;[39m
     [90m 256 |[39m       expect(result[33m.[39minterventionRecommendations[[35m0[39m][33m.[39mtimeframe)[33m.[39mtoBe([32m'Immediate'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:253:57)

  ● EnhancedCrisisKeywordDetectionService › Intervention Recommendations › should provide urgent intervention for high-risk cases

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 262 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedCrisisKeywordDetectionService[33m.[39manalyzeEnhancedCrisisKeywords(text)[33m;[39m
     [90m 263 |[39m       
    [31m[1m>[22m[39m[90m 264 |[39m       expect(result[33m.[39minterventionRecommendations[33m.[39msome(r [33m=>[39m r[33m.[39mtype [33m===[39m [32m'urgent'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                                                 [31m[1m^[22m[39m
     [90m 265 |[39m       expect(result[33m.[39minterventionRecommendations[33m.[39msome(r [33m=>[39m r[33m.[39mtimeframe [33m===[39m [32m'Within 2-4 hours'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 266 |[39m     })[33m;[39m
     [90m 267 |[39m[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:264:81)

  ● EnhancedCrisisKeywordDetectionService › Intervention Recommendations › should provide supportive intervention for medium-risk cases

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 271 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedCrisisKeywordDetectionService[33m.[39manalyzeEnhancedCrisisKeywords(text)[33m;[39m
     [90m 272 |[39m       
    [31m[1m>[22m[39m[90m 273 |[39m       expect(result[33m.[39minterventionRecommendations[33m.[39msome(r [33m=>[39m r[33m.[39mtype [33m===[39m [32m'supportive'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                                                     [31m[1m^[22m[39m
     [90m 274 |[39m       expect(result[33m.[39minterventionRecommendations[33m.[39msome(r [33m=>[39m r[33m.[39mtimeframe [33m===[39m [32m'Within 24 hours'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 275 |[39m     })[33m;[39m
     [90m 276 |[39m[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:273:85)

  ● EnhancedCrisisKeywordDetectionService › Intervention Recommendations › should provide monitoring recommendations for ongoing support

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 280 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedCrisisKeywordDetectionService[33m.[39manalyzeEnhancedCrisisKeywords(text)[33m;[39m
     [90m 281 |[39m       
    [31m[1m>[22m[39m[90m 282 |[39m       expect(result[33m.[39minterventionRecommendations[33m.[39msome(r [33m=>[39m r[33m.[39mtype [33m===[39m [32m'monitoring'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                                                     [31m[1m^[22m[39m
     [90m 283 |[39m       expect(result[33m.[39minterventionRecommendations[33m.[39msome(r [33m=>[39m r[33m.[39mtimeframe [33m===[39m [32m'Ongoing'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 284 |[39m     })[33m;[39m
     [90m 285 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:282:85)

  ● EnhancedCrisisKeywordDetectionService › False Positive Prevention › should not trigger crisis for hypothetical or past scenarios

    expect(received).not.toBe(expected) // Object.is equality

    Expected: not "emergency"

    [0m [90m 295 |[39m       [36mconst[39m academicResult [33m=[39m [36mawait[39m enhancedCrisisKeywordDetectionService[33m.[39manalyzeEnhancedCrisisKeywords(academicText)[33m;[39m
     [90m 296 |[39m       
    [31m[1m>[22m[39m[90m 297 |[39m       expect(hypotheticalResult[33m.[39moverallSeverity)[33m.[39mnot[33m.[39mtoBe([32m'emergency'[39m)[33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 298 |[39m       expect(pastResult[33m.[39mriskAssessment[33m.[39mimmediateRisk)[33m.[39mtoBeLessThan([35m50[39m)[33m;[39m
     [90m 299 |[39m       expect(academicResult[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 300 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:297:54)

  ● EnhancedCrisisKeywordDetectionService › Analysis Metadata › should provide accurate analysis metadata

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 318 |[39m       expect(result[33m.[39manalysisMetadata[33m.[39manalysisMethod)[33m.[39mtoBe([32m'contextual'[39m)[33m;[39m
     [90m 319 |[39m       expect(result[33m.[39manalysisMetadata[33m.[39mconfidence)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 320 |[39m       expect(result[33m.[39manalysisMetadata[33m.[39mprocessingTime)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 321 |[39m       expect([33mArray[39m[33m.[39misArray(result[33m.[39manalysisMetadata[33m.[39mflaggedConcerns))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 322 |[39m     })[33m;[39m
     [90m 323 |[39m[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:320:54)

  ● EnhancedCrisisKeywordDetectionService › Analysis Metadata › should flag appropriate concerns

    expect(received).toContain(expected) // indexOf

    Expected value: "Suicide planning indicators present"
    Received array: []

    [0m [90m 332 |[39m       
     [90m 333 |[39m       expect(emergencyResult[33m.[39manalysisMetadata[33m.[39mflaggedConcerns)[33m.[39mtoContain([32m'Emergency-level crisis indicators detected'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 334 |[39m       expect(planningResult[33m.[39manalysisMetadata[33m.[39mflaggedConcerns)[33m.[39mtoContain([32m'Suicide planning indicators present'[39m)[33m;[39m
     [90m     |[39m                                                               [31m[1m^[22m[39m
     [90m 335 |[39m       expect(violenceResult[33m.[39manalysisMetadata[33m.[39mflaggedConcerns)[33m.[39mtoContain([32m'Violence threat indicators detected'[39m)[33m;[39m
     [90m 336 |[39m     })[33m;[39m
     [90m 337 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:334:63)

  ● EnhancedCrisisKeywordDetectionService › Integration Testing › should handle complex multi-indicator scenarios

    expect(received).toBe(expected) // Object.is equality

    Expected: "emergency"
    Received: "critical"

    [0m [90m 371 |[39m       
     [90m 372 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 373 |[39m       expect(result[33m.[39moverallSeverity)[33m.[39mtoBe([32m'emergency'[39m)[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 374 |[39m       expect(result[33m.[39memergencyServicesRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 375 |[39m       expect(result[33m.[39mkeywordMatches[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m3[39m)[33m;[39m
     [90m 376 |[39m       expect(result[33m.[39memotionalIndicators[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m1[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:373:38)

  ● EnhancedCrisisKeywordDetectionService › Integration Testing › should handle mixed signals appropriately

    expect(received).not.toBe(expected) // Object.is equality

    Expected: not "emergency"

    [0m [90m 386 |[39m       
     [90m 387 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 388 |[39m       expect(result[33m.[39moverallSeverity)[33m.[39mnot[33m.[39mtoBe([32m'emergency'[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 389 |[39m       expect(result[33m.[39mriskAssessment[33m.[39mprotectiveFactors[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m 390 |[39m       expect(result[33m.[39mriskAssessment[33m.[39mimmediateRisk)[33m.[39mtoBeLessThan([35m70[39m)[33m;[39m
     [90m 391 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:388:42)

  console.error
    AI chat error: Error: Demo mode - API skipped
        at _callApi (C:\Users\damat\_REPOS\CoreV2\src\utils\ApiClient.ts:97:26)
        at Object.chat (C:\Users\damat\_REPOS\CoreV2\src\utils\ApiClient.ts:494:34)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\utils\ApiClient.test.ts:923:7) {
      isDevelopmentError: true
    }

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at Object.chat (src/utils/ApiClient.ts:500:25)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:923:7)

  console.warn
    Malformed demo data found, regenerating...

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at DemoDataService.getDemoData (src/services/demoDataService.ts:1195:29)
      at Object.<anonymous> (src/services/__tests__/demoDataService.test.ts:622:30)

PASS src/services/__tests__/demoDataService.test.ts
  DemoDataService
    Singleton pattern
      √ should return the same instance (2 ms)
      √ should export singleton instance (1 ms)
    Starkeeper (User) Data Methods
      getStarkeeperJournalEntries
        √ should return journal entries for user (3 ms)
        √ should have chronologically ordered entries (1 ms)
      getStarkeeperMoodCheckIns
        √ should return mood check-ins for user (47 ms)
        √ should show improvement trend in mood data (1 ms)
      getStarkeeperDilemmas
        √ should return dilemmas for user (3 ms)
        √ should have both resolved and active dilemmas (1 ms)
      getStarkeeperAssessments
        √ should return assessments for user (3 ms)
        √ should show improvement in assessment scores over time
    Constellation Guide (Helper) Data Methods
      getConstellationGuideProfile
        √ should return helper profile with required fields (2 ms)
      getAllDilemmasForHelper
        √ should return all dilemmas visible to helper (3 ms)
        √ should include different dilemma statuses
      getHelperChatSessions
        √ should return chat sessions for helper (7 ms)
      getHelperSessions
        √ should return help sessions (1 ms)
    Admin Data Methods
      getAdminHelperApplications
        √ should return helper applications (1 ms)
      getAdminModerationActions
        √ should return moderation actions (2 ms)
      getAdminCommunityStats
        √ should return community statistics (2 ms)
      getAstralAdminProfile
        √ should return admin profile (2 ms)
    Community Data Methods
      getCommunityReflections
        √ should return community reflections (1 ms)
      getForumThreads
        √ should return forum threads (3 ms)
      getAIChatDemoSession
        √ should return AI chat demo session (19 ms)
    Crisis and Workflow Data Methods
      getCrisisScenarioData
        √ should return crisis scenario data (1 ms)
      getInterconnectedWorkflowData
        √ should return interconnected workflow data (1 ms)
      getMultipleWorkflowScenarios
        √ should return multiple workflow scenarios (1 ms)
      getCrisisEscalationScenarios
        √ should return crisis escalation scenarios (1 ms)
    Additional Community Methods
      getWellnessChallenges
        √ should return wellness challenges array (1 ms)
      getGroupDiscussions
        √ should return group discussions array
      getCommunityForumPosts
        √ should return community forum posts array (1 ms)
      getCommunityEvents
        √ should return community events array
      getPeerConnections
        √ should return peer connections array
      getCommunityUsers
        √ should return community users array
    getDemoData
      √ should return user demo data (2 ms)
      √ should return helper demo data (1 ms)
      √ should return admin demo data (1 ms)
      √ should use cached data when available (1 ms)
      √ should store generated data in localStorage (1 ms)
    Data consistency and quality
      √ should have consistent user tokens in user data (1 ms)
      √ should have realistic timestamps (not future dates)
      √ should have consistent helper references (1 ms)
      √ should have non-empty content in all text fields (1 ms)
    Error handling
      √ should handle invalid user types in getDemoData
      √ should handle localStorage errors gracefully (152 ms)
      √ should handle malformed cached data (39 ms)

FAIL src/hooks/useEnhancedCrisisDetection.test.ts (9.565 s)
  useEnhancedCrisisDetection Hook
    √ should initialize with default state (68 ms)
    √ should initialize with custom options (3 ms)
    √ should analyze text successfully with ML (7 ms)
    √ should handle analysis errors gracefully (3 ms)
    √ should skip analysis for text that is too short (7 ms)
    √ should skip analysis when ML features are disabled (3 ms)
    √ should track emotional history (3 ms)
    √ should track risk trend (3 ms)
    √ should limit history size (4 ms)
    √ should call crisis detected callback (2 ms)
    √ should call risk escalation callback (3 ms)
    × should call intervention recommended callback (4 ms)
    √ should update crisis alert based on risk level (3 ms)
    √ should handle different severity levels correctly (11 ms)
    × should provide debounced analysis (16 ms)
    √ should monitor text input automatically (9 ms)
    √ should dismiss crisis alert (2 ms)
    √ should get emotional trend analysis (4 ms)
    × should get risk prediction (2 ms)
    × should get personalized intervention recommendations (2 ms)
    × should clear analysis history (3 ms)
    √ should handle insufficient data for trend analysis (1 ms)
    × should handle analysis without tracking history (4 ms)
    √ should cleanup debounce timeout on unmount (2 ms)
    √ should handle analysis without real-time risk (2 ms)

  ● useEnhancedCrisisDetection Hook › should call intervention recommended callback

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 290 |[39m     [90m// Check if callback was called - the hook only calls it when there are recommendations[39m
     [90m 291 |[39m     [90m// and it needs to have a proper realTimeRisk object[39m
    [31m[1m>[22m[39m[90m 292 |[39m     expect(onInterventionRecommended)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 293 |[39m     expect(onInterventionRecommended)[33m.[39mtoHaveBeenCalledWith(
     [90m 294 |[39m       expect[33m.[39marrayContaining([
     [90m 295 |[39m         [32m'Immediate professional intervention recommended'[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useEnhancedCrisisDetection.test.ts:292:39)

  ● useEnhancedCrisisDetection Hook › should provide debounced analysis

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 377 |[39m     [90m// Wait for the debounced function to execute[39m
     [90m 378 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 379 |[39m       expect(enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                                                    [31m[1m^[22m[39m
     [90m 380 |[39m     }[33m,[39m { timeout[33m:[39m [35m1000[39m })[33m;[39m
     [90m 381 |[39m
     [90m 382 |[39m     [90m// Should use the last text[39m[0m

      at timeout (src/hooks/useEnhancedCrisisDetection.test.ts:379:68)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at node_modules/@testing-library/dom/dist/wait-for.js:82:9

  ● useEnhancedCrisisDetection Hook › should get risk prediction

    expect(received).toBe(expected) // Object.is equality

    Expected: 65
    Received: undefined

    [0m [90m 483 |[39m
     [90m 484 |[39m     expect(prediction)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 485 |[39m     expect(prediction[33m.[39mcurrentRisk)[33m.[39mtoBe([35m65[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 486 |[39m     expect(prediction[33m.[39mpredictedRisk)[33m.[39mtoBeGreaterThanOrEqual([35m0[39m)[33m;[39m
     [90m 487 |[39m     expect(prediction[33m.[39mpredictedRisk)[33m.[39mtoBeLessThanOrEqual([35m100[39m)[33m;[39m
     [90m 488 |[39m     expect(prediction[33m.[39mconfidence)[33m.[39mtoBeGreaterThanOrEqual([35m0[39m)[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useEnhancedCrisisDetection.test.ts:485:36)

  ● useEnhancedCrisisDetection Hook › should get personalized intervention recommendations

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 504 |[39m     [90m// Check that interventions are returned with expected structure[39m
     [90m 505 |[39m     expect([33mArray[39m[33m.[39misArray(interventions))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 506 |[39m     expect(interventions[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 507 |[39m     
     [90m 508 |[39m     [90m// Verify the structure of returned interventions if any exist[39m
     [90m 509 |[39m     [36mif[39m (interventions[33m.[39mlength [33m>[39m [35m0[39m) {[0m

      at Object.<anonymous> (src/hooks/useEnhancedCrisisDetection.test.ts:506:34)

  ● useEnhancedCrisisDetection Hook › should clear analysis history

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 538 |[39m     [90m// Wait for state to be updated[39m
     [90m 539 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 540 |[39m       expect(result[33m.[39mcurrent[33m.[39manalysisHistory[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 541 |[39m     })[33m;[39m
     [90m 542 |[39m
     [90m 543 |[39m     expect(result[33m.[39mcurrent[33m.[39manalysisHistory)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m[0m

      at src/hooks/useEnhancedCrisisDetection.test.ts:540:53
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at node_modules/@testing-library/dom/dist/wait-for.js:82:9

  ● useEnhancedCrisisDetection Hook › should handle analysis without tracking history

    expect(received).toEqual(expected) // deep equality

    Expected: {"biasAdjustments": [{"confidence": 0.9, "factor": "Language bias adjustment"}], "culturalContext": "Western", "emotionalState": {"arousal": 0.6, "dominance": -0.3, "primaryEmotion": "despair", "timestamp": 1755460723000, "valence": -0.7}, "hasCrisisIndicators": true, "mlConfidence": 0.85, "realTimeRisk": {"immediateRisk": 75, "interventionUrgency": 8, "recommendedInterventions": [{"description": "Immediate professional intervention recommended", "priority": 8}, {"description": "Contact emergency mental health services", "priority": 6}]}}
    Received: null

    [0m [90m 580 |[39m     [36mawait[39m act([36masync[39m () [33m=>[39m {
     [90m 581 |[39m       [36mconst[39m analysisResult [33m=[39m [36mawait[39m result[33m.[39mcurrent[33m.[39manalyzeText([32m'Test text'[39m[33m,[39m { trackHistory[33m:[39m [36mfalse[39m })[33m;[39m
    [31m[1m>[22m[39m[90m 582 |[39m       expect(analysisResult)[33m.[39mtoEqual(mockMLAnalysisResult)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 583 |[39m     })[33m;[39m
     [90m 584 |[39m
     [90m 585 |[39m     [90m// When trackHistory is false, history arrays should remain empty[39m[0m

      at src/hooks/useEnhancedCrisisDetection.test.ts:582:30

FAIL src/services/__tests__/dataExportService.test.ts
  DataExportService
    exportUserData
      √ should export data as JSON format (9 ms)
      √ should export data as CSV format (2 ms)
      √ should export data as PDF format (40 ms)
      √ should throw error for unsupported format (17 ms)
      √ should filter data by date range (1 ms)
    gatherUserData
      √ should include user ID when includePersonalData is true
      √ should not include user ID when includePersonalData is false (1 ms)
    getStoredData
      √ should parse valid JSON data (1 ms)
      √ should return null for invalid JSON (1 ms)
      √ should return null when no data exists (1 ms)
    filterByDateRange
      √ should return original data when no date range provided
      √ should return original data when data is not an array (1 ms)
      √ should filter data by timestamp field
    calculateMoodPatterns
      √ should return null for empty data (1 ms)
      √ should calculate dominant moods (1 ms)
    calculateMoodTrends
      √ should return null for insufficient data
      √ should calculate trends for sufficient data (1 ms)
    calculateTrendDirection
      √ should return stable for insufficient data
      √ should return improving for increasing trend
      √ should return declining for decreasing trend (1 ms)
    calculateVolatility
      √ should return 0 for insufficient data
      √ should calculate volatility based on mood changes (1 ms)
    downloadExport
      √ should create download link and trigger click (1 ms)
    generateFilename
      √ should generate filename without user ID (1 ms)
      √ should generate filename with user ID
    deleteAllUserData
      √ should remove all specified localStorage keys (3 ms)
    deleteSpecificDataType
      √ should delete mood data keys
      √ should delete activity data keys
      √ should handle unknown data type (1 ms)
    getDataInventory
      √ should return inventory of stored data
    getDataRetentionInfo
      √ should return data retention information (1 ms)
  getDataExportService
    √ should return singleton instance (1 ms)
  useDataExport hook
    × should export data successfully (42 ms)
    × should handle export errors
    × should delete all data
    × should delete specific data type
    × should get data inventory (1 ms)
    × should get data retention info (1 ms)

  ● useDataExport hook › should export data successfully

    createRoot(...): Target container is not a DOM element.

    [0m [90m 528 |[39m   it([32m'should export data successfully'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 529 |[39m     [90m// Create a wrapper div for the hook[39m
    [31m[1m>[22m[39m[90m 530 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useDataExport())[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 531 |[39m
     [90m 532 |[39m     expect(result[33m.[39mcurrent[33m.[39misExporting)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 533 |[39m[0m

      at createRoot (node_modules/react-dom/cjs/react-dom.development.js:29384:11)
      at Object.createRoot$1 [as createRoot] (node_modules/react-dom/cjs/react-dom.development.js:29855:10)
      at Object.<anonymous>.exports.createRoot (node_modules/react-dom/client.js:12:16)
      at createConcurrentRoot (node_modules/@testing-library/react/dist/pure.js:147:27)
      at render (node_modules/@testing-library/react/dist/pure.js:266:12)
      at renderHook (node_modules/@testing-library/react/dist/pure.js:340:7)
      at Object.<anonymous> (src/services/__tests__/dataExportService.test.ts:530:34)

  ● useDataExport hook › should handle export errors

    createRoot(...): Target container is not a DOM element.

    [0m [90m 553 |[39m
     [90m 554 |[39m   it([32m'should handle export errors'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 555 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useDataExport())[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 556 |[39m
     [90m 557 |[39m     [36mconst[39m mockOptions[33m:[39m [33mExportOptions[39m [33m=[39m {
     [90m 558 |[39m       format[33m:[39m [32m'invalid'[39m [36mas[39m any[33m,[39m[0m

      at createRoot (node_modules/react-dom/cjs/react-dom.development.js:29384:11)
      at Object.createRoot$1 [as createRoot] (node_modules/react-dom/cjs/react-dom.development.js:29855:10)
      at Object.<anonymous>.exports.createRoot (node_modules/react-dom/client.js:12:16)
      at createConcurrentRoot (node_modules/@testing-library/react/dist/pure.js:147:27)
      at render (node_modules/@testing-library/react/dist/pure.js:266:12)
      at renderHook (node_modules/@testing-library/react/dist/pure.js:340:7)
      at Object.<anonymous> (src/services/__tests__/dataExportService.test.ts:555:34)

  ● useDataExport hook › should delete all data

    createRoot(...): Target container is not a DOM element.

    [0m [90m 575 |[39m
     [90m 576 |[39m   it([32m'should delete all data'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 577 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useDataExport())[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 578 |[39m
     [90m 579 |[39m     [36mawait[39m act([36masync[39m () [33m=>[39m {
     [90m 580 |[39m       [36mawait[39m result[33m.[39mcurrent[33m.[39mdeleteAllData()[33m;[39m[0m

      at createRoot (node_modules/react-dom/cjs/react-dom.development.js:29384:11)
      at Object.createRoot$1 [as createRoot] (node_modules/react-dom/cjs/react-dom.development.js:29855:10)
      at Object.<anonymous>.exports.createRoot (node_modules/react-dom/client.js:12:16)
      at createConcurrentRoot (node_modules/@testing-library/react/dist/pure.js:147:27)
      at render (node_modules/@testing-library/react/dist/pure.js:266:12)
      at renderHook (node_modules/@testing-library/react/dist/pure.js:340:7)
      at Object.<anonymous> (src/services/__tests__/dataExportService.test.ts:577:34)

  ● useDataExport hook › should delete specific data type

    createRoot(...): Target container is not a DOM element.

    [0m [90m 586 |[39m
     [90m 587 |[39m   it([32m'should delete specific data type'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 588 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useDataExport())[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 589 |[39m
     [90m 590 |[39m     [36mawait[39m act([36masync[39m () [33m=>[39m {
     [90m 591 |[39m       [36mawait[39m result[33m.[39mcurrent[33m.[39mdeleteDataType([32m'mood'[39m)[33m;[39m[0m

      at createRoot (node_modules/react-dom/cjs/react-dom.development.js:29384:11)
      at Object.createRoot$1 [as createRoot] (node_modules/react-dom/cjs/react-dom.development.js:29855:10)
      at Object.<anonymous>.exports.createRoot (node_modules/react-dom/client.js:12:16)
      at createConcurrentRoot (node_modules/@testing-library/react/dist/pure.js:147:27)
      at render (node_modules/@testing-library/react/dist/pure.js:266:12)
      at renderHook (node_modules/@testing-library/react/dist/pure.js:340:7)
      at Object.<anonymous> (src/services/__tests__/dataExportService.test.ts:588:34)

  ● useDataExport hook › should get data inventory

    createRoot(...): Target container is not a DOM element.

    [0m [90m 601 |[39m     })[33m;[39m
     [90m 602 |[39m
    [31m[1m>[22m[39m[90m 603 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useDataExport())[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 604 |[39m
     [90m 605 |[39m     [36mconst[39m inventory [33m=[39m result[33m.[39mcurrent[33m.[39mgetDataInventory()[33m;[39m
     [90m 606 |[39m[0m

      at createRoot (node_modules/react-dom/cjs/react-dom.development.js:29384:11)
      at Object.createRoot$1 [as createRoot] (node_modules/react-dom/cjs/react-dom.development.js:29855:10)
      at Object.<anonymous>.exports.createRoot (node_modules/react-dom/client.js:12:16)
      at createConcurrentRoot (node_modules/@testing-library/react/dist/pure.js:147:27)
      at render (node_modules/@testing-library/react/dist/pure.js:266:12)
      at renderHook (node_modules/@testing-library/react/dist/pure.js:340:7)
      at Object.<anonymous> (src/services/__tests__/dataExportService.test.ts:603:34)

  ● useDataExport hook › should get data retention info

    createRoot(...): Target container is not a DOM element.

    [0m [90m 609 |[39m
     [90m 610 |[39m   it([32m'should get data retention info'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 611 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useDataExport())[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 612 |[39m
     [90m 613 |[39m     [36mconst[39m retentionInfo [33m=[39m result[33m.[39mcurrent[33m.[39mgetDataRetentionInfo()[33m;[39m
     [90m 614 |[39m[0m

      at createRoot (node_modules/react-dom/cjs/react-dom.development.js:29384:11)
      at Object.createRoot$1 [as createRoot] (node_modules/react-dom/cjs/react-dom.development.js:29855:10)
      at Object.<anonymous>.exports.createRoot (node_modules/react-dom/client.js:12:16)
      at createConcurrentRoot (node_modules/@testing-library/react/dist/pure.js:147:27)
      at render (node_modules/@testing-library/react/dist/pure.js:266:12)
      at renderHook (node_modules/@testing-library/react/dist/pure.js:340:7)
      at Object.<anonymous> (src/services/__tests__/dataExportService.test.ts:611:34)

FAIL src/services/__tests__/culturalContextService.test.ts
  CulturalContextService
    Cultural Context Data Structure
      √ should have complete cultural contexts for all supported languages (2 ms)
      √ should have consistent structure across all cultural contexts (12 ms)
    English (Western) Cultural Context
      √ should have appropriate Western cultural characteristics (1 ms)
    Spanish (Hispanic/Latino) Cultural Context
      √ should have appropriate Hispanic/Latino cultural characteristics (1 ms)
    Portuguese (Brazilian) Cultural Context
      √ should have appropriate Brazilian cultural characteristics
    Portuguese (European) Cultural Context
      √ should have appropriate Portuguese cultural characteristics (1 ms)
    Arabic Cultural Context
      √ should have appropriate Arabic cultural characteristics
    Chinese Cultural Context
      √ should have appropriate Chinese cultural characteristics
    Vietnamese Cultural Context
      √ should have appropriate Vietnamese cultural characteristics
    Filipino Cultural Context
      √ should have appropriate Filipino cultural characteristics (1 ms)
    Fallback Behavior
      √ should return English context for unsupported languages (52 ms)
      √ should handle null and undefined language codes
      √ should handle empty string language code (1 ms)
    Mental Health Stigma Patterns
      √ should identify high stigma cultures correctly
      √ should identify medium stigma cultures correctly
      √ should not have any low stigma cultures in current configuration
    Family Involvement Patterns
      √ should identify individual-focused cultures correctly
      √ should identify family-centered cultures correctly (1 ms)
      √ should not have community-based cultures in current configuration
    Crisis Escalation Patterns
      √ should identify direct escalation cultures correctly (1 ms)
      √ should identify gradual escalation cultures correctly
      √ should identify authority-based escalation cultures correctly (1 ms)
    Communication Style Patterns
      √ should identify direct communication cultures correctly
      √ should identify indirect communication cultures correctly
      √ should identify contextual communication cultures correctly (1 ms)
    All Cultural Contexts Method
      √ should return all cultural contexts (1 ms)
      √ should return deep copy to prevent modification
    Cultural Regions Method
      √ should return unique list of cultural regions (3 ms)
      √ should return correct number of regions
    Cultural Context Validation
      √ should have consistent data types across all contexts (3 ms)
      √ should have meaningful region names (2 ms)
    Language Code Variations
      √ should handle language code case variations
      √ should handle language codes with country suffixes (1 ms)
      √ should handle various Chinese language codes consistently
    Regional Cultural Characteristics
      √ should have culturally appropriate high-context communication styles
      √ should have culturally appropriate collectivist family involvement (1 ms)
      √ should reflect research-based mental health stigma levels (1 ms)
    Singleton Instance
      √ should export singleton instance
      √ should maintain same instance
      √ should provide consistent data across calls (1 ms)
    Performance and Immutability
      × should not modify internal data when returning contexts (5 ms)
      √ should handle rapid successive calls efficiently (2 ms)

  ● CulturalContextService › Performance and Immutability › should not modify internal data when returning contexts

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 2

    @@ -1,8 +1,8 @@
      Object {
        "ar": Object {
    -     "communicationStyle": "indirect",
    +     "communicationStyle": "direct",
          "crisisEscalation": "authority-based",
          "familyInvolvement": "family-centered",
          "mentalHealthStigma": "high",
          "region": "Arabic",
        },
    @@ -15,11 +15,11 @@
        },
        "es": Object {
          "communicationStyle": "contextual",
          "crisisEscalation": "gradual",
          "familyInvolvement": "family-centered",
    -     "mentalHealthStigma": "high",
    +     "mentalHealthStigma": "low",
          "region": "Hispanic/Latino",
        },
        "pt": Object {
          "communicationStyle": "contextual",
          "crisisEscalation": "gradual",

    [0m [90m 464 |[39m       [90m// Internal data should remain unchanged[39m
     [90m 465 |[39m       [36mconst[39m currentContexts [33m=[39m (service [36mas[39m any)[33m.[39mculturalContexts[33m;[39m
    [31m[1m>[22m[39m[90m 466 |[39m       expect(currentContexts)[33m.[39mtoEqual(originalContexts)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 467 |[39m     })[33m;[39m
     [90m 468 |[39m
     [90m 469 |[39m     test([32m'should handle rapid successive calls efficiently'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/culturalContextService.test.ts:466:31)

FAIL src/services/__tests__/crisisEscalationWorkflowService.test.ts
  CrisisEscalationWorkflowService
    Escalation Initiation
      √ should initiate peer support for low risk (1 ms)
      √ should initiate crisis counselor for medium risk (1 ms)
      √ should initiate emergency team for high risk (5 ms)
      √ should initiate emergency services for immediate danger (1 ms)
    Emergency Contacts
      √ should get location-specific emergency contacts (1 ms)
      √ should prioritize contacts by effectiveness (3 ms)
      √ should include text-based support options (1 ms)
      √ should handle international locations (1 ms)
    Workflow Management
      √ should track escalation status (1 ms)
      √ should handle escalation handoff
      × should auto-escalate if no response (1 ms)
    Response Coordination
      √ should coordinate multiple responders (1 ms)
      √ should notify all responders
    Metrics and Reporting
      √ should track response times (1 ms)
      √ should generate escalation report (1 ms)
      √ should track escalation effectiveness (1 ms)
    Safety Features
      √ should prevent duplicate escalations
      √ should maintain escalation history (1 ms)
      √ should handle system failures gracefully

  ● CrisisEscalationWorkflowService › Workflow Management › should auto-escalate if no response

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 197 |[39m       expect(escalation)[33m.[39mtoBeDefined()[33m;[39m
     [90m 198 |[39m       expect(escalation[33m.[39mtier)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 199 |[39m       expect(escalation[33m.[39mescalatedTo)[33m.[39mtoBeDefined()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 200 |[39m     })[33m;[39m
     [90m 201 |[39m   })[33m;[39m
     [90m 202 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisEscalationWorkflowService.test.ts:199:38)

  console.log
    Starting data migration for HIPAA compliance...

      at DataMigrationService.performMigration (src/services/dataMigrationService.ts:95:17)

  console.log
    Backup created with key: data_backup_1755460723576

      at DataMigrationService.createBackup (src/services/dataMigrationService.ts:235:13)

FAIL src/hooks/useAnimations.test.ts (9.779 s)
  useScrollAnimation Hook
    √ should initialize with correct default values (24 ms)
    × should set up IntersectionObserver with correct threshold (40 ms)
    × should update visibility when intersection changes (2 ms)
    × should clean up observer on unmount (1 ms)
  useStaggeredAnimation Hook
    √ should initialize with empty animated items (5 ms)
    × should trigger staggered animations with correct delays (6 ms)
    √ should reset animations when triggered again (3 ms)
  useRippleEffect Hook
    √ should initialize with empty ripples (3 ms)
    √ should create ripple on mouse event (5 ms)
    √ should remove ripple after timeout (10 ms)
    √ should handle multiple ripples (2 ms)
  useDelayedHover Hook
    √ should initialize with not hovered state (2 ms)
    √ should handle mouse enter with delay (2 ms)
    √ should handle mouse leave with delay (3 ms)
    √ should cancel previous timeout when new event occurs (7 ms)
    √ should clean up timeout on unmount (2 ms)
  useLoadingState Hook
    √ should initialize with not loading state (4 ms)
    √ should start loading immediately (2 ms)
    √ should respect minimum duration (2 ms)
    × should stop loading immediately if minimum duration exceeded (3 ms)
  useAnimationSequence Hook
    √ should initialize with default values (2 ms)
    × should execute animation sequence with delays (4 ms)
    × should not start sequence if already playing (3 ms)
    √ should reset sequence (3 ms)
  useFormAnimations Hook
    √ should initialize with empty errors and success fields (3 ms)
    √ should show and clear field error (37 ms)
    √ should show and clear field success (8 ms)
    √ should clear field state manually (7 ms)
  usePageTransition Hook
    √ should initialize in idle state (9 ms)
    √ should execute transition sequence (2 ms)
  useReducedMotion Hook
    √ should initialize with current reduced motion preference (2 ms)
    √ should update when media query changes (1 ms)
    √ should clean up event listener on unmount (2 ms)

  ● useScrollAnimation Hook › should set up IntersectionObserver with correct threshold

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: Any<Function>, {"threshold": 0.5}

    Number of calls: 0

    [0m [90m 61 |[39m     renderHook(() [33m=>[39m useScrollAnimation(threshold))[33m;[39m
     [90m 62 |[39m     
    [31m[1m>[22m[39m[90m 63 |[39m     expect(mockIntersectionObserver)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                                      [31m[1m^[22m[39m
     [90m 64 |[39m       expect[33m.[39many([33mFunction[39m)[33m,[39m
     [90m 65 |[39m       { threshold }
     [90m 66 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAnimations.test.ts:63:38)

  ● useScrollAnimation Hook › should update visibility when intersection changes

    TypeError: callback is not a function

    [0m [90m 85 |[39m     [90m// Simulate intersection[39m
     [90m 86 |[39m     act(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 87 |[39m       callback([{ isIntersecting[33m:[39m [36mtrue[39m }])[33m;[39m
     [90m    |[39m       [31m[1m^[22m[39m
     [90m 88 |[39m     })[33m;[39m
     [90m 89 |[39m
     [90m 90 |[39m     expect(result[33m.[39mcurrent[33m.[39misVisible)[33m.[39mtoBe([36mtrue[39m)[33m;[39m[0m

      at src/hooks/useAnimations.test.ts:87:7
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.<anonymous> (src/hooks/useAnimations.test.ts:86:8)

  ● useScrollAnimation Hook › should clean up observer on unmount

    ReferenceError: mockDisconnect is not defined

    [0m [90m 103 |[39m     unmount()[33m;[39m
     [90m 104 |[39m     
    [31m[1m>[22m[39m[90m 105 |[39m     expect(mockDisconnect)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 106 |[39m   })[33m;[39m
     [90m 107 |[39m })[33m;[39m
     [90m 108 |[39m[0m

      at Object.<anonymous> (src/hooks/useAnimations.test.ts:105:12)

  ● useStaggeredAnimation Hook › should trigger staggered animations with correct delays

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 141 |[39m     })[33m;[39m
     [90m 142 |[39m     expect(result[33m.[39mcurrent[33m.[39misItemAnimated([35m0[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 143 |[39m     expect(result[33m.[39mcurrent[33m.[39misItemAnimated([35m1[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 144 |[39m
     [90m 145 |[39m     [90m// Advance time and check second item[39m
     [90m 146 |[39m     act(() [33m=>[39m {[0m

      at Object.<anonymous> (src/hooks/useAnimations.test.ts:143:46)

  ● useLoadingState Hook › should stop loading immediately if minimum duration exceeded

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 421 |[39m
     [90m 422 |[39m     expect(result[33m.[39mcurrent[33m.[39misLoading)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 423 |[39m     expect(result[33m.[39mcurrent[33m.[39mshowLoading)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                                        [31m[1m^[22m[39m
     [90m 424 |[39m   })[33m;[39m
     [90m 425 |[39m })[33m;[39m
     [90m 426 |[39m[0m

      at Object.<anonymous> (src/hooks/useAnimations.test.ts:423:40)

  ● useAnimationSequence Hook › should execute animation sequence with delays

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 459 |[39m
     [90m 460 |[39m     [90m// Execute first step immediately[39m
    [31m[1m>[22m[39m[90m 461 |[39m     expect(step1)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 462 |[39m     expect(result[33m.[39mcurrent[33m.[39mcurrentStep)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m 463 |[39m
     [90m 464 |[39m     [90m// Execute second step after delay[39m[0m

      at Object.<anonymous> (src/hooks/useAnimations.test.ts:461:19)

  ● useAnimationSequence Hook › should not start sequence if already playing

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 495 |[39m     })[33m;[39m
     [90m 496 |[39m
    [31m[1m>[22m[39m[90m 497 |[39m     expect(step1)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 498 |[39m   })[33m;[39m
     [90m 499 |[39m
     [90m 500 |[39m   it([32m'should reset sequence'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/hooks/useAnimations.test.ts:497:19)

  console.log
    === Data Migration Report ===

      at DataMigrationService.logMigrationReport (src/services/dataMigrationService.ts:242:13)

  console.log
    Total keys processed: 3

      at DataMigrationService.logMigrationReport (src/services/dataMigrationService.ts:243:13)

  console.log
    Keys migrated: 2

      at DataMigrationService.logMigrationReport (src/services/dataMigrationService.ts:244:13)

  console.log
    Keys skipped: 1

      at DataMigrationService.logMigrationReport (src/services/dataMigrationService.ts:245:13)

  console.log
    Keys failed: 0

      at DataMigrationService.logMigrationReport (src/services/dataMigrationService.ts:246:13)

  console.log
    Migration time: 42ms

      at DataMigrationService.logMigrationReport (src/services/dataMigrationService.ts:247:13)

  console.log
    Encryption stats: { isSupported: true, totalEncrypted: 0, failedOperations: 0 }

      at DataMigrationService.logMigrationReport (src/services/dataMigrationService.ts:257:13)

  console.log
    HIPAA compliance: { compliant: true, violations: [], recommendations: [] }

      at DataMigrationService.logMigrationReport (src/services/dataMigrationService.ts:258:13)

FAIL src/utils/ApiClient.test.ts (9.708 s)
  ApiClient
    Initialization
      √ should have initialize method (9 ms)
      √ should check Netlify Functions availability in development
      √ should assume Netlify Functions available in production (1 ms)
      × should detect Netlify Dev environment (2 ms)
    Resources API
      × should fetch resources (2 ms)
    Assessments API
      × should submit PHQ-9 result
      × should submit GAD-7 result
      × should get assessment history (1 ms)
    Habits API
      × should get predefined habits (1 ms)
      × should track habit (1 ms)
      × should log habit completion
    Mood API
      × should post mood check-in (1 ms)
      × should get mood history
    Journal API
      × should get journal entries with demo data fallback
      × should post journal entry (1 ms)
    Videos API
      × should get wellness videos
      × should like video (1 ms)
      × should upload video (1 ms)
    Safety Plan API
      × should get safety plan
      × should save safety plan (19 ms)
    Legal API
      × should check consent
      × should record consent (5 ms)
    Payment API
      √ should create donation intent (7 ms)
      √ should log donation amount in development (519 ms)
    Emergency API
      √ should trigger emergency without location (315 ms)
      √ should trigger emergency with location (363 ms)
    Error Handling
      × should handle 401 unauthorized responses (14 ms)
      × should handle network errors (7 ms)
      × should handle non-JSON error responses (11 ms)
      × should handle HTML responses in development (31 ms)
      × should handle successful HTML responses in development (44 ms)
    Authentication
      × should include authorization header when token is present (1 ms)
      × should not include authorization header when token is not present (1 ms)
    Demo Mode
      × should detect demo mode with demo_token
      √ should detect demo mode with environment variable
    Dilemmas API
      √ should get dilemmas and fallback to demo data (1 ms)
      × should post dilemma
    Helpers API
      √ should get helper profile in demo mode
      × should get online helper count (2 ms)
      √ should fallback to demo count on error (1 ms)
    AI API
      × should handle chat request (72 ms)
      × should throw error on invalid AI response (15 ms)
      √ should load chat history with demo fallback (1 ms)
    Configuration
      × should use custom API URL when provided
      × should use default Netlify Functions URL
    Response Handling
      × should handle 204 No Content responses
      × should handle responses without content-type header
    Performance
      × should handle concurrent API requests (1 ms)
      × should not interfere with parallel requests on error

  ● ApiClient › Initialization › should detect Netlify Dev environment

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "✓ Running through Netlify Dev - API functions available"

    Number of calls: 0

    [0m [90m 141 |[39m       [36mawait[39m [33mApiClient[39m[33m.[39minitialize()[33m;[39m
     [90m 142 |[39m       
    [31m[1m>[22m[39m[90m 143 |[39m       expect(consoleSpy)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 144 |[39m         [32m'✓ Running through Netlify Dev - API functions available'[39m
     [90m 145 |[39m       )[33m;[39m
     [90m 146 |[39m       [0m

      at Object.<anonymous> (src/utils/ApiClient.test.ts:143:26)

  ● ApiClient › Resources API › should fetch resources

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:161:22)

  ● ApiClient › Assessments API › should submit PHQ-9 result

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:185:22)

  ● ApiClient › Assessments API › should submit GAD-7 result

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:215:22)

  ● ApiClient › Assessments API › should get assessment history

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:248:22)

  ● ApiClient › Habits API › should get predefined habits

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:267:22)

  ● ApiClient › Habits API › should track habit

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:282:7)

  ● ApiClient › Habits API › should log habit completion

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:309:22)

  ● ApiClient › Mood API › should post mood check-in

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:354:22)

  ● ApiClient › Mood API › should get mood history

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:378:22)

  ● ApiClient › Journal API › should get journal entries with demo data fallback

    SyntaxError: Unexpected token 'd', "demo-token" is not valid JSON
        at JSON.parse (<anonymous>)

    [0m [90m 57 |[39m     [36mif[39m ([33m![39mdemoUser) [36mreturn[39m [36mnull[39m[33m;[39m
     [90m 58 |[39m     
    [31m[1m>[22m[39m[90m 59 |[39m     [36mconst[39m user [33m=[39m [33mJSON[39m[33m.[39mparse(demoUser)[33m;[39m
     [90m    |[39m                       [31m[1m^[22m[39m
     [90m 60 |[39m     [36mif[39m (user[33m.[39muserType [33m===[39m [32m'seeker'[39m) [36mreturn[39m [32m'user'[39m[33m;[39m
     [90m 61 |[39m     [36mif[39m (user[33m.[39muserType [33m===[39m [32m'helper'[39m) [36mreturn[39m [32m'helper'[39m[33m;[39m
     [90m 62 |[39m     [36mif[39m (user[33m.[39muserType [33m===[39m [32m'admin'[39m) [36mreturn[39m [32m'admin'[39m[33m;[39m[0m

      at getDemoUserType (src/utils/ApiClient.ts:59:23)
      at getDemoDataOrCallApi (src/utils/ApiClient.ts:71:26)
      at Object.getEntries (src/utils/ApiClient.ts:222:20)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:392:46)

  ● ApiClient › Journal API › should post journal entry

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:412:22)

  ● ApiClient › Videos API › should get wellness videos

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:444:22)

  ● ApiClient › Videos API › should like video

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:461:22)

  ● ApiClient › Videos API › should upload video

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)

  ● ApiClient › Safety Plan API › should get safety plan

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:519:22)

  ● ApiClient › Safety Plan API › should save safety plan

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:539:7)

  ● ApiClient › Legal API › should check consent

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:567:22)

  ● ApiClient › Legal API › should record consent

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:582:7)

  ● ApiClient › Error Handling › should handle 401 unauthorized responses

    expect(received).rejects.toThrow(expected)

    Expected substring: "Unauthorized"
    Received message:   "Demo mode - API skipped"

        [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
         [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
        [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
         [90m     |[39m                          [31m[1m^[22m[39m
         [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
         [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
         [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:676:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:676:64)

  ● ApiClient › Error Handling › should handle network errors

    expect(received).rejects.toThrow(expected)

    Expected substring: "Network error"
    Received message:   "Demo mode - API skipped"

        [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
         [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
        [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
         [90m     |[39m                          [31m[1m^[22m[39m
         [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
         [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
         [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:690:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:690:64)

  ● ApiClient › Error Handling › should handle non-JSON error responses

    expect(received).rejects.toThrow(expected)

    Expected substring: "Request failed with status 500"
    Received message:   "Demo mode - API skipped"

        [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
         [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
        [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
         [90m     |[39m                          [31m[1m^[22m[39m
         [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
         [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
         [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:703:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:703:64)

  ● ApiClient › Error Handling › should handle HTML responses in development

    expect(received).rejects.toThrow(expected)

    Expected substring: "API endpoint not available in development mode"
    Received message:   "Demo mode - API skipped"

        [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
         [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
        [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
         [90m     |[39m                          [31m[1m^[22m[39m
         [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
         [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
         [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:716:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:716:64)

  ● ApiClient › Error Handling › should handle successful HTML responses in development

    expect(received).rejects.toThrow(expected)

    Expected substring: "API endpoint not available in development mode"
    Received message:   "Demo mode - API skipped"

        [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
         [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
        [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
         [90m     |[39m                          [31m[1m^[22m[39m
         [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
         [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
         [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:729:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:729:64)

  ● ApiClient › Authentication › should include authorization header when token is present

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:745:7)

  ● ApiClient › Authentication › should not include authorization header when token is not present

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:766:7)

  ● ApiClient › Demo Mode › should detect demo mode with demo_token

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "demo_token"

    Number of calls: 0

    [0m [90m 778 |[39m
     [90m 779 |[39m       [90m// This is tested indirectly through the journal API which uses demo data[39m
    [31m[1m>[22m[39m[90m 780 |[39m       expect(localStorage[33m.[39mgetItem)[33m.[39mtoHaveBeenCalledWith([32m'demo_token'[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 781 |[39m     })[33m;[39m
     [90m 782 |[39m
     [90m 783 |[39m     test([32m'should detect demo mode with environment variable'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/ApiClient.test.ts:780:36)

  ● ApiClient › Dilemmas API › should post dilemma

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:826:22)

  ● ApiClient › Helpers API › should get online helper count

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/.netlify/functions/helpers/online-count", ObjectContaining {"headers": ObjectContaining {"Authorization": ""}}

    Number of calls: 0

    [0m [90m 863 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m [33mApiClient[39m[33m.[39mhelpers[33m.[39mgetOnlineHelperCount()[33m;[39m
     [90m 864 |[39m
    [31m[1m>[22m[39m[90m 865 |[39m       expect(mockFetch)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 866 |[39m         [32m'/.netlify/functions/helpers/online-count'[39m[33m,[39m
     [90m 867 |[39m         expect[33m.[39mobjectContaining({
     [90m 868 |[39m           headers[33m:[39m expect[33m.[39mobjectContaining({[0m

      at Object.<anonymous> (src/utils/ApiClient.test.ts:865:25)

  ● ApiClient › AI API › should handle chat request

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/.netlify/functions/ai", ObjectContaining {"body": "{\"messages\":[{\"id\":\"1\",\"sender\":\"user\",\"text\":\"Hello\",\"timestamp\":\"2023-01-01T00:00:00Z\"},{\"id\":\"2\",\"sender\":\"ai\",\"text\":\"Hi there!\",\"timestamp\":\"2023-01-01T00:00:01Z\"}],\"systemInstruction\":\"Be helpful\"}", "method": "POST"}

    Number of calls: 0

    [0m [90m 903 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m [33mApiClient[39m[33m.[39mai[33m.[39mchat(messages[33m,[39m systemInstruction)[33m;[39m
     [90m 904 |[39m
    [31m[1m>[22m[39m[90m 905 |[39m       expect(mockFetch)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 906 |[39m         [32m'/.netlify/functions/ai'[39m[33m,[39m
     [90m 907 |[39m         expect[33m.[39mobjectContaining({
     [90m 908 |[39m           method[33m:[39m [32m'POST'[39m[33m,[39m[0m

      at Object.<anonymous> (src/utils/ApiClient.test.ts:905:25)

  ● ApiClient › AI API › should throw error on invalid AI response

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"metadata": {"error": true}, "response": "I'm having trouble connecting right now. Please try again in a moment."}

    [0m [90m 921 |[39m       } [36mas[39m any)[33m;[39m
     [90m 922 |[39m
    [31m[1m>[22m[39m[90m 923 |[39m       [36mawait[39m expect(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 924 |[39m         [33mApiClient[39m[33m.[39mai[33m.[39mchat([][33m,[39m [32m'Be helpful'[39m)
     [90m 925 |[39m       )[33m.[39mrejects[33m.[39mtoThrow([32m'Received an invalid response from the AI service'[39m)[33m;[39m
     [90m 926 |[39m     })[33m;[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:923:13)

  ● ApiClient › Configuration › should use custom API URL when provided

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:949:7)

  ● ApiClient › Configuration › should use default Netlify Functions URL

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:966:7)

  ● ApiClient › Response Handling › should handle 204 No Content responses

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:983:22)

  ● ApiClient › Response Handling › should handle responses without content-type header

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:996:22)

  ● ApiClient › Performance › should handle concurrent API requests

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
          at async Promise.all (index 0)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:1022:23)

  ● ApiClient › Performance › should not interfere with parallel requests on error

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
          at async Promise.all (index 1)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:1044:23)

FAIL tests/service-worker/cross-browser.test.ts
  Cross-Browser Compatibility
    Browser Detection
      √ should detect Chrome browser (2 ms)
      √ should detect Firefox browser (1 ms)
      √ should detect Safari browser
      √ should detect Edge browser (1 ms)
    Service Worker Support Detection
      √ should check service worker support
      √ should handle browsers without service worker support (1 ms)
      √ should check cache API support
      √ should handle browsers without cache API support (2 ms)
    Chrome-specific Features
      √ should support background sync in Chrome (49 ms)
      √ should support push notifications in Chrome (1 ms)
      √ should handle Chrome cache quotas
    Firefox-specific Features
      √ should handle Firefox cache behavior (1 ms)
      √ should handle Firefox service worker scope restrictions (1 ms)
    Safari-specific Features
      √ should handle Safari service worker limitations (1 ms)
      √ should handle Safari cache size limitations
      √ should handle Safari private browsing mode (1 ms)
    Mobile Browser Compatibility
      × should handle iOS Safari mobile
      × should handle Android Chrome mobile (1 ms)
      × should handle mobile-specific service worker features
    Progressive Enhancement
      × should provide fallbacks when service worker is not supported
      × should provide cache fallbacks
      × should handle offline detection across browsers (1 ms)
    Feature Detection
      × should detect IndexedDB support (1 ms)
      × should detect Web Workers support (1 ms)
      × should detect Fetch API support (39 ms)
      × should detect Promise support
      × should create feature detection utility (1 ms)
    Error Handling Across Browsers
      × should handle registration failures gracefully (1 ms)
      × should handle cache operation failures (1 ms)
      × should handle network failures consistently

  ● Cross-Browser Compatibility › Mobile Browser Compatibility › should handle iOS Safari mobile

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Mobile Browser Compatibility › should handle Android Chrome mobile

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Mobile Browser Compatibility › should handle mobile-specific service worker features

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Progressive Enhancement › should provide fallbacks when service worker is not supported

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Progressive Enhancement › should provide cache fallbacks

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Progressive Enhancement › should handle offline detection across browsers

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Feature Detection › should detect IndexedDB support

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Feature Detection › should detect Web Workers support

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Feature Detection › should detect Fetch API support

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Feature Detection › should detect Promise support

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Feature Detection › should create feature detection utility

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Error Handling Across Browsers › should handle registration failures gracefully

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Error Handling Across Browsers › should handle cache operation failures

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Error Handling Across Browsers › should handle network failures consistently

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

FAIL src/hooks/useServiceWorker.test.ts (10.327 s)
  useServiceWorker Hook
    √ should initialize with correct default state (131 ms)
    √ should register event listeners on mount (5 ms)
    √ should remove event listeners on unmount (42 ms)
    √ should update online status when coming online (13 ms)
    × should update online status when going offline (6 ms)
    √ should update when service worker update is available (3 ms)
    √ should check offline readiness on mount (104 ms)
    √ should handle offline readiness check errors (20 ms)
    √ should get cache status on mount (165 ms)
    √ should handle cache status errors (160 ms)
    √ should skip waiting and clear update available (2 ms)
    √ should handle skip waiting errors (7 ms)
    √ should check for updates (3 ms)
    √ should handle check for updates errors (2 ms)
    √ should clear cache and update status (2 ms)
    √ should handle clear cache errors (3 ms)
    √ should cache crisis resource (2 ms)
    √ should handle cache crisis resource errors (2 ms)
    √ should precache crisis resources (1 ms)
    √ should handle precache crisis resources errors (2 ms)
    √ should force reload (2 ms)
    √ should sync with service worker manager network status (2 ms)
  useOfflineStatus Hook
    √ should initialize with navigator online status (3 ms)
    √ should register event listeners (2 ms)
    √ should remove event listeners on unmount (2 ms)
    √ should update status when going online (2 ms)
    √ should update status when going offline (2 ms)
  useCacheManager Hook
    √ should initialize with null cache status (4 ms)
    √ should get cache status on mount (202 ms)
    √ should show loading state during cache operations (153 ms)
    √ should clear cache and update status (2 ms)
    √ should handle clear cache errors (2 ms)
    √ should cache crisis resource (2 ms)
    √ should handle cache crisis resource errors (11 ms)
    √ should update cache status manually (171 ms)

  ● useServiceWorker Hook › should update online status when going offline

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 109 |[39m     })[33m;[39m
     [90m 110 |[39m
    [31m[1m>[22m[39m[90m 111 |[39m     expect(result[33m.[39mcurrent[33m.[39misOnline)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 112 |[39m   })[33m;[39m
     [90m 113 |[39m
     [90m 114 |[39m   it([32m'should update when service worker update is available'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/hooks/useServiceWorker.test.ts:111:37)

FAIL src/components/__tests__/Toast.test.tsx (9.956 s)
  Toast
    Toast Component
      √ should render toast with message (82 ms)
      √ should apply correct type class (74 ms)
      √ should have correct DOM structure (5 ms)
      √ should auto-dismiss after 5 seconds (4 ms)
      √ should not dismiss before timeout (3 ms)
      √ should clear timeout when component unmounts (6 ms)
      √ should create new timer when toast changes (6 ms)
      √ should handle different toast types (24 ms)
    ToastContainer Component
      √ should render empty container when no toasts (2 ms)
      × should render single toast (5 ms)
      × should render multiple toasts (4 ms)
      × should pass correct props to Toast components (3 ms)
      × should call removeToast when toast is dismissed (2 ms)
      × should handle toasts with same message but different IDs (3 ms)
      × should maintain correct order of toasts (3 ms)
    Integration Tests
      × should handle rapid toast additions and removals (3 ms)
      √ should handle edge case of empty toast message (63 ms)
      √ should handle very long toast messages (4 ms)
      √ should handle special characters in toast messages (2 ms)
      √ should handle toast with HTML-like content safely (3 ms)
    Error Handling
      √ should handle undefined onDismiss gracefully (2 ms)
      √ should handle malformed toast object (2 ms)
      √ should handle timer cleanup on multiple re-renders (3 ms)

  ● Toast › ToastContainer Component › should render single toast

    TestingLibraryElementError: Unable to find an element with the text: Test toast message. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"toast-container"[39m
        [36m/>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 233 |[39m       render([33m<[39m[33mToastContainer[39m [33m/[39m[33m>[39m)[33m;[39m
     [90m 234 |[39m       
    [31m[1m>[22m[39m[90m 235 |[39m       expect(screen[33m.[39mgetByText(toast[33m.[39mmessage))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 236 |[39m     })[33m;[39m
     [90m 237 |[39m
     [90m 238 |[39m     it([32m'should render multiple toasts'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/__tests__/Toast.test.tsx:235:21)

  ● Toast › ToastContainer Component › should render multiple toasts

    TestingLibraryElementError: Unable to find an element with the text: First toast. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"toast-container"[39m
        [36m/>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 245 |[39m       render([33m<[39m[33mToastContainer[39m [33m/[39m[33m>[39m)[33m;[39m
     [90m 246 |[39m       
    [31m[1m>[22m[39m[90m 247 |[39m       expect(screen[33m.[39mgetByText([32m'First toast'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 248 |[39m       expect(screen[33m.[39mgetByText([32m'Second toast'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m 249 |[39m       expect(screen[33m.[39mgetByText([32m'Third toast'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m 250 |[39m     })[33m;[39m[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/__tests__/Toast.test.tsx:247:21)

  ● Toast › ToastContainer Component › should pass correct props to Toast components

    expect(received).toHaveLength(expected)

    Expected length: 2
    Received length: 0
    Received object: []

    [0m [90m 259 |[39m       
     [90m 260 |[39m       [36mconst[39m toasts [33m=[39m container[33m.[39mquerySelectorAll([32m'.toast'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 261 |[39m       expect(toasts)[33m.[39mtoHaveLength([35m2[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 262 |[39m       expect(toasts[[35m0[39m])[33m.[39mtoHaveClass([32m'toast-success'[39m)[33m;[39m
     [90m 263 |[39m       expect(toasts[[35m1[39m])[33m.[39mtoHaveClass([32m'toast-error'[39m)[33m;[39m
     [90m 264 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/components/__tests__/Toast.test.tsx:261:22)

  ● Toast › ToastContainer Component › should call removeToast when toast is dismissed

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "test-toast-1"

    Number of calls: 0

    [0m [90m 275 |[39m       })[33m;[39m
     [90m 276 |[39m       
    [31m[1m>[22m[39m[90m 277 |[39m       expect(mockRemoveToast)[33m.[39mtoHaveBeenCalledWith(toast[33m.[39mid)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 278 |[39m     })[33m;[39m
     [90m 279 |[39m
     [90m 280 |[39m     it([32m'should handle toasts with same message but different IDs'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/components/__tests__/Toast.test.tsx:277:31)

  ● Toast › ToastContainer Component › should handle toasts with same message but different IDs

    expect(received).toHaveLength(expected)

    Expected length: 2
    Received length: 0
    Received object: []

    [0m [90m 287 |[39m       
     [90m 288 |[39m       [36mconst[39m toasts [33m=[39m container[33m.[39mquerySelectorAll([32m'.toast'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 289 |[39m       expect(toasts)[33m.[39mtoHaveLength([35m2[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 290 |[39m       
     [90m 291 |[39m       [36mconst[39m messages [33m=[39m screen[33m.[39mgetAllByText([32m'Same message'[39m)[33m;[39m
     [90m 292 |[39m       expect(messages)[33m.[39mtoHaveLength([35m2[39m)[33m;[39m[0m

      at Object.<anonymous> (src/components/__tests__/Toast.test.tsx:289:22)

  ● Toast › ToastContainer Component › should maintain correct order of toasts

    expect(received).toHaveTextContent()

    received value must be a Node.
    Received has value: undefined

    [0m [90m 303 |[39m       
     [90m 304 |[39m       [36mconst[39m toastElements [33m=[39m container[33m.[39mquerySelectorAll([32m'.toast-message'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 305 |[39m       expect(toastElements[[35m0[39m])[33m.[39mtoHaveTextContent([32m'First'[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 306 |[39m       expect(toastElements[[35m1[39m])[33m.[39mtoHaveTextContent([32m'Second'[39m)[33m;[39m
     [90m 307 |[39m       expect(toastElements[[35m2[39m])[33m.[39mtoHaveTextContent([32m'Third'[39m)[33m;[39m
     [90m 308 |[39m     })[33m;[39m[0m

      at __EXTERNAL_MATCHER_TRAP__ (node_modules/expect/build/index.js:325:30)
      at Object.throwingMatcher [as toHaveTextContent] (node_modules/expect/build/index.js:326:15)
      at Object.<anonymous> (src/components/__tests__/Toast.test.tsx:305:32)

  ● Toast › Integration Tests › should handle rapid toast additions and removals

    TestingLibraryElementError: Unable to find an element with the text: First toast. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"toast-container"[39m
        [36m/>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 318 |[39m       [36mconst[39m { rerender } [33m=[39m render([33m<[39m[33mToastContainer[39m [33m/[39m[33m>[39m)[33m;[39m
     [90m 319 |[39m       
    [31m[1m>[22m[39m[90m 320 |[39m       expect(screen[33m.[39mgetByText(toast1[33m.[39mmessage))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 321 |[39m       
     [90m 322 |[39m       [90m// Add another toast[39m
     [90m 323 |[39m       mockToasts[33m.[39mpush(toast2)[33m;[39m[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/__tests__/Toast.test.tsx:320:21)

FAIL src/hooks/useCulturalCrisisDetection.test.ts (9.907 s)
  useCulturalCrisisDetection Hook
    √ should initialize with default state (53 ms)
    √ should initialize with custom options (8 ms)
    √ should load cultural metrics on mount (163 ms)
    √ should analyze cultural crisis successfully (12 ms)
    × should handle analysis errors gracefully (5 ms)
    √ should skip analysis for text that is too short (4 ms)
    × should avoid analyzing same text repeatedly (62 ms)
    √ should track analysis history when enabled (7 ms)
    √ should limit analysis history size (3 ms)
    √ should call crisis detected callback (2 ms)
    × should call cultural bias detected callback (4 ms)
    × should call cultural intervention recommended callback (2 ms)
    √ should update cultural alert based on risk level (2 ms)
    × should provide debounced analysis (14 ms)
    × should get cultural interventions (3 ms)
    × should provide cultural feedback (2 ms)
    √ should dismiss cultural alert (2 ms)
    × should clear analysis history (7 ms)
    × should compute derived state correctly (3 ms)
    × should handle cultural override in analysis (2 ms)
    √ should handle immediate analysis override (2 ms)
    √ should cleanup debounce timeout on unmount (3 ms)

  ● useCulturalCrisisDetection Hook › should handle analysis errors gracefully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[Cultural Crisis Detection Hook] Analysis failed:", [Error: Cultural analysis service unavailable]

    Number of calls: 0

    [0m [90m 165 |[39m     expect(analysisResult)[33m.[39mtoBeNull()[33m;[39m
     [90m 166 |[39m     expect(result[33m.[39mcurrent[33m.[39misAnalyzing)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 167 |[39m     expect(consoleSpy)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 168 |[39m       [32m'[Cultural Crisis Detection Hook] Analysis failed:'[39m[33m,[39m
     [90m 169 |[39m       analysisError
     [90m 170 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCulturalCrisisDetection.test.ts:167:24)

  ● useCulturalCrisisDetection Hook › should avoid analyzing same text repeatedly

    expect(received).toEqual(expected) // deep equality

    Expected: {"culturalBiasAdjustments": [{"adjustedValue": 25, "confidence": 0.85, "factor": "Western individualistic bias", "originalValue": 30}], "culturalContext": "Western", "culturalIndicators": [{"culturalRegions": ["Western", "English-speaking"], "culturalRelevance": 0.8, "phrase": "feeling isolated"}], "culturalInterventions": {"communityApproach": false, "culturalResources": ["Western counseling approaches"], "familyInvolvement": "medium", "languageSpecificResources": ["English mental health resources"], "religiousConsideration": false}, "culturallyAdjustedRisk": {"adjustedRisk": 25, "culturalFactors": ["western-individualistic-adjustment"], "originalRisk": 30}, "hasCrisisIndicators": false, "realTimeRisk": {"immediateRisk": 25, "recommendedInterventions": [{"description": "Connect with culturally appropriate counselor", "priority": 3}]}}
    Received: null

    [0m [90m 207 |[39m
     [90m 208 |[39m     expect(culturalCrisisDetectionService[33m.[39manalyzeCrisisWithCulturalContext)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 209 |[39m     expect(secondResult)[33m.[39mtoEqual(mockAnalysisResult)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 210 |[39m   })[33m;[39m
     [90m 211 |[39m
     [90m 212 |[39m   it([32m'should track analysis history when enabled'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/hooks/useCulturalCrisisDetection.test.ts:209:26)

  ● useCulturalCrisisDetection Hook › should call cultural bias detected callback

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ["Western individualistic bias"]

    Number of calls: 0

    [0m [90m 274 |[39m     })[33m;[39m
     [90m 275 |[39m
    [31m[1m>[22m[39m[90m 276 |[39m     expect(onCulturalBiasDetected)[33m.[39mtoHaveBeenCalledWith([[32m'Western individualistic bias'[39m])[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 277 |[39m   })[33m;[39m
     [90m 278 |[39m
     [90m 279 |[39m   it([32m'should call cultural intervention recommended callback'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/hooks/useCulturalCrisisDetection.test.ts:276:36)

  ● useCulturalCrisisDetection Hook › should call cultural intervention recommended callback

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 288 |[39m     })[33m;[39m
     [90m 289 |[39m
    [31m[1m>[22m[39m[90m 290 |[39m     expect(onCulturalInterventionRecommended)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                               [31m[1m^[22m[39m
     [90m 291 |[39m     expect(onCulturalInterventionRecommended)[33m.[39mtoHaveBeenCalledWith(
     [90m 292 |[39m       expect[33m.[39mobjectContaining({
     [90m 293 |[39m         familyInvolvement[33m:[39m [32m'medium'[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useCulturalCrisisDetection.test.ts:290:47)

  ● useCulturalCrisisDetection Hook › should provide debounced analysis

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 348 |[39m
     [90m 349 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 350 |[39m       expect(culturalCrisisDetectionService[33m.[39manalyzeCrisisWithCulturalContext)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                                                               [31m[1m^[22m[39m
     [90m 351 |[39m     }[33m,[39m { timeout[33m:[39m [35m1000[39m })[33m;[39m
     [90m 352 |[39m
     [90m 353 |[39m     expect(culturalCrisisDetectionService[33m.[39manalyzeCrisisWithCulturalContext)[33m.[39mtoHaveBeenCalledWith([0m

      at timeout (src/hooks/useCulturalCrisisDetection.test.ts:350:79)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at node_modules/@testing-library/dom/dist/wait-for.js:82:9

  ● useCulturalCrisisDetection Hook › should get cultural interventions

    expect(received).toContain(expected) // indexOf

    Expected value: "Family-centered crisis intervention approach recommended"
    Received array: []

    [0m [90m 374 |[39m     [36mconst[39m interventions [33m=[39m result[33m.[39mcurrent[33m.[39mgetCulturalInterventions()[33m;[39m
     [90m 375 |[39m
    [31m[1m>[22m[39m[90m 376 |[39m     expect(interventions)[33m.[39mtoContain([32m'Family-centered crisis intervention approach recommended'[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 377 |[39m     expect(interventions)[33m.[39mtoContain([32m'Western counseling approaches'[39m)[33m;[39m
     [90m 378 |[39m     expect(interventions)[33m.[39mtoContain([32m'English mental health resources'[39m)[33m;[39m
     [90m 379 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCulturalCrisisDetection.test.ts:376:27)

  ● useCulturalCrisisDetection Hook › should provide cultural feedback

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"actualRisk": 30, "culturalRegion": "Western", "culturallyAppropriate": true, "predictedRisk": 25, "text": "Test text"}

    Number of calls: 0

    [0m [90m 394 |[39m     })[33m;[39m
     [90m 395 |[39m
    [31m[1m>[22m[39m[90m 396 |[39m     expect(culturalCrisisDetectionService[33m.[39mupdateCulturalPatterns)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                                                   [31m[1m^[22m[39m
     [90m 397 |[39m       text[33m:[39m [32m'Test text'[39m[33m,[39m
     [90m 398 |[39m       culturalRegion[33m:[39m [32m'Western'[39m[33m,[39m
     [90m 399 |[39m       actualRisk[33m:[39m [35m30[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useCulturalCrisisDetection.test.ts:396:67)

  ● useCulturalCrisisDetection Hook › should clear analysis history

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 440 |[39m     [90m// Wait for state to be updated[39m
     [90m 441 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 442 |[39m       expect(result[33m.[39mcurrent[33m.[39manalysisHistory[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 443 |[39m     })[33m;[39m
     [90m 444 |[39m
     [90m 445 |[39m     expect(result[33m.[39mcurrent[33m.[39manalysisHistory)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m[0m

      at src/hooks/useCulturalCrisisDetection.test.ts:442:53
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at node_modules/@testing-library/dom/dist/wait-for.js:82:9

  ● useCulturalCrisisDetection Hook › should compute derived state correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 478 |[39m     })[33m;[39m
     [90m 479 |[39m
    [31m[1m>[22m[39m[90m 480 |[39m     expect(result[33m.[39mcurrent[33m.[39mrequiresFamilyInvolvement)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 481 |[39m     expect(result[33m.[39mcurrent[33m.[39mneedsCommunitySupport)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 482 |[39m     expect(result[33m.[39mcurrent[33m.[39mincludesReligiousSupport)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 483 |[39m     expect(result[33m.[39mcurrent[33m.[39mcurrentCulturalContext)[33m.[39mtoBe([32m'Western'[39m)[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCulturalCrisisDetection.test.ts:480:54)

  ● useCulturalCrisisDetection Hook › should handle cultural override in analysis

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "Test text", undefined, "en", "Asian"

    Number of calls: 0

    [0m [90m 494 |[39m     })[33m;[39m
     [90m 495 |[39m
    [31m[1m>[22m[39m[90m 496 |[39m     expect(culturalCrisisDetectionService[33m.[39manalyzeCrisisWithCulturalContext)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                                                             [31m[1m^[22m[39m
     [90m 497 |[39m       [32m'Test text'[39m[33m,[39m
     [90m 498 |[39m       undefined[33m,[39m
     [90m 499 |[39m       [32m'en'[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useCulturalCrisisDetection.test.ts:496:77)

FAIL src/hooks/useAIChat.test.ts (10.271 s)
  useAIChat Hook
    √ should initialize with empty session (83 ms)
    √ should fetch chat history on mount (124 ms)
    √ should handle chat history fetch error gracefully (26 ms)
    √ should handle non-array response from API (61 ms)
    √ should send message when user is authenticated (41 ms)
    √ should not send message when user is not authenticated (12 ms)
    √ should handle send message errors (47 ms)
    √ should reset chat session (104 ms)
    × should set typing indicator when sending message (1082 ms)
    × should maintain message history across sends (2 ms)

  ● useAIChat Hook › should set typing indicator when sending message

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 224 |[39m     
     [90m 225 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 226 |[39m       expect(result[33m.[39mcurrent[33m.[39msession[33m.[39misTyping)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                               [31m[1m^[22m[39m
     [90m 227 |[39m     })[33m;[39m
     [90m 228 |[39m     
     [90m 229 |[39m     [36mawait[39m sendPromise[33m;[39m[0m

      at src/hooks/useAIChat.test.ts:226:47
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useAIChat Hook › should maintain message history across sends

    TypeError: Cannot read properties of null (reading 'sendMessage')

    [0m [90m 244 |[39m     
     [90m 245 |[39m     [36mawait[39m act([36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 246 |[39m       [36mawait[39m result[33m.[39mcurrent[33m.[39msendMessage([32m'First message'[39m)[33m;[39m
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 247 |[39m     })[33m;[39m
     [90m 248 |[39m     
     [90m 249 |[39m     [36mawait[39m act([36masync[39m () [33m=>[39m {[0m

      at src/hooks/useAIChat.test.ts:246:28
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.<anonymous> (src/hooks/useAIChat.test.ts:245:14)

  console.log
    [IntelligentCache] Database initialized successfully

      at IntelligentCachingService.initializeDatabase (src/services/intelligentCachingService.ts:158:15)

  console.error
    [IntelligentCache] Storage monitoring failed: TypeError: Cannot read properties of undefined (reading 'estimate')
        at checkQuota (C:\Users\damat\_REPOS\CoreV2\src\services\intelligentCachingService.ts:336:50)
        at IntelligentCachingService.monitorStorageQuota (C:\Users\damat\_REPOS\CoreV2\src\services\intelligentCachingService.ts:365:13)
        at new IntelligentCachingService (C:\Users\damat\_REPOS\CoreV2\src\services\intelligentCachingService.ts:127:10)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\services\intelligentCachingService.ts:604:33)
        at Runtime._execModule (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runtime\build\index.js:1439:24)
        at Runtime._loadModule (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runtime\build\index.js:1022:12)
        at Runtime.requireModule (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runtime\build\index.js:882:12)
        at Runtime.requireModuleOrMock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runtime\build\index.js:1048:21)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\services\__tests__\intelligentCachingService.test.ts:1:1)
        at Runtime._execModule (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runtime\build\index.js:1439:24)
        at Runtime._loadModule (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runtime\build\index.js:1022:12)
        at Runtime.requireModule (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runtime\build\index.js:882:12)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:77:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 366 |[39m       setInterval(checkQuota[33m,[39m [35m5[39m [33m*[39m [35m60[39m [33m*[39m [35m1000[39m)[33m;[39m
     [90m 367 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 368 |[39m       console[33m.[39merror([32m'[IntelligentCache] Storage monitoring failed:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 369 |[39m     }
     [90m 370 |[39m   }
     [90m 371 |[39m[0m

      at IntelligentCachingService.monitorStorageQuota (src/services/intelligentCachingService.ts:368:15)

FAIL src/components/safety/__tests__/CrisisAlertBanner.test.tsx (10.129 s)
  CrisisAlertBanner
    Rendering
      √ should render when crisis is detected (140 ms)
      √ should not render when show is false (4 ms)
      √ should display appropriate message based on severity (13 ms)
    Crisis Resources
      × should display crisis hotline number (16 ms)
      × should display text support option (8 ms)
      × should show emergency services for critical severity (6 ms)
      × should display location-specific resources when provided (58 ms)
    Interactive Elements
      × should have clickable phone numbers (48 ms)
      √ should open chat support in new window (8 ms)
      √ should navigate to resources page (16 ms)
    Dismiss Functionality
      √ should call onDismiss when X button clicked (52 ms)
      √ should not show dismiss button for emergency severity (4 ms)
      √ should allow dismissal after delay for high severity (5 ms)
    Visual Styling
      √ should apply severity-based styling (8 ms)
      √ should have pulsing animation for emergency (5 ms)
      √ should stick to top of viewport (4 ms)
    Accessibility
      √ should have appropriate ARIA role and labels (5 ms)
      × should be keyboard navigable (5 ms)
      √ should announce to screen readers immediately (4 ms)
    Quick Actions
      × should show breathing exercise button (33 ms)
      × should trigger breathing exercise overlay (16 ms)
      √ should show safety plan button when available (7 ms)
      √ should trigger safety plan view (5 ms)
    Animation and Transitions
      √ should slide in when appearing (5 ms)
      √ should fade out when dismissing (9 ms)
    Responsive Design
      √ should stack resources vertically on mobile (4 ms)
      × should use icons only on very small screens (79 ms)
    Error Handling
      × should handle missing resources gracefully (5 ms)
      × should handle click errors gracefully (23 ms)

  ● CrisisAlertBanner › Crisis Resources › should display crisis hotline number

    TestingLibraryElementError: Unable to find an element with the text: 988. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"crisis-alert-banner crisis-alert-banner--urgent"[39m
          [33mdata-testid[39m=[32m"crisis-alert-banner"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"crisis-alert-content"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-header"[39m
            [36m>[39m
              [36m<h3>[39m
                [0mYou're Not Alone - Help is Available 24/7[0m
              [36m</h3>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Close crisis alert"[39m
                [33mclass[39m=[32m"crisis-alert-close"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-resources"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
                [33mhref[39m=[32m"tel:findahelpline.com"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mCall [0m
                    [0mInternational Crisis Lines[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mfindahelpline.com[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</a>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mText Support[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mVisit website for local resources[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<p[39m
              [33mclass[39m=[32m"crisis-alert-message"[39m
            [36m>[39m
              [0mIf you're thinking about suicide, are worried about a friend or loved one, or would like emotional support, help is available.[0m
            [36m</p>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-actions"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-action-primary"[39m
                [33mhref[39m=[32m"https://findahelpline.com"[39m
                [33mrel[39m=[32m"noopener noreferrer"[39m
                [33mtarget[39m=[32m"_blank"[39m
              [36m>[39m
                [0mGet Help Now[0m
              [36m</a>[39m
              [36m<button[39m
                [33mclass[39m=[32m"crisis-action-secondary"[39m
              [36m>[39m
                [0mView All Resources[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 90 |[39m       )[33m;[39m
     [90m 91 |[39m
    [31m[1m>[22m[39m[90m 92 |[39m       expect(screen[33m.[39mgetByText([32m'988'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 93 |[39m       expect(screen[33m.[39mgetByText([35m/988 Suicide & Crisis Lifeline/i[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m 94 |[39m     })[33m;[39m
     [90m 95 |[39m[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:92:21)

  ● CrisisAlertBanner › Crisis Resources › should display text support option

    TestingLibraryElementError: Unable to find an element with the text: Text HOME to 741741. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"crisis-alert-banner crisis-alert-banner--urgent"[39m
          [33mdata-testid[39m=[32m"crisis-alert-banner"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"crisis-alert-content"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-header"[39m
            [36m>[39m
              [36m<h3>[39m
                [0mYou're Not Alone - Help is Available 24/7[0m
              [36m</h3>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Close crisis alert"[39m
                [33mclass[39m=[32m"crisis-alert-close"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-resources"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
                [33mhref[39m=[32m"tel:findahelpline.com"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mCall [0m
                    [0mInternational Crisis Lines[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mfindahelpline.com[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</a>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mText Support[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mVisit website for local resources[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<p[39m
              [33mclass[39m=[32m"crisis-alert-message"[39m
            [36m>[39m
              [0mIf you're thinking about suicide, are worried about a friend or loved one, or would like emotional support, help is available.[0m
            [36m</p>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-actions"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-action-primary"[39m
                [33mhref[39m=[32m"https://findahelpline.com"[39m
                [33mrel[39m=[32m"noopener noreferrer"[39m
                [33mtarget[39m=[32m"_blank"[39m
              [36m>[39m
                [0mGet Help Now[0m
              [36m</a>[39m
              [36m<button[39m
                [33mclass[39m=[32m"crisis-action-secondary"[39m
              [36m>[39m
                [0mView All Resources[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 105 |[39m       )[33m;[39m
     [90m 106 |[39m
    [31m[1m>[22m[39m[90m 107 |[39m       expect(screen[33m.[39mgetByText([32m'Text HOME to 741741'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 108 |[39m     })[33m;[39m
     [90m 109 |[39m
     [90m 110 |[39m     it([32m'should show emergency services for critical severity'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:107:21)

  ● CrisisAlertBanner › Crisis Resources › should show emergency services for critical severity

    expect(received).toBeInTheDocument()

    received value must be an HTMLElement or an SVGElement.
    Received has value: null

    [0m [90m 121 |[39m       [90m// The component shows 988 as the main crisis line[39m
     [90m 122 |[39m       [36mconst[39m phoneLink [33m=[39m container[33m.[39mquerySelector([32m'a[href="tel:988"]'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 123 |[39m       expect(phoneLink)[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 124 |[39m     })[33m;[39m
     [90m 125 |[39m
     [90m 126 |[39m     it([32m'should display location-specific resources when provided'[39m[33m,[39m () [33m=>[39m {[0m

      at __EXTERNAL_MATCHER_TRAP__ (node_modules/expect/build/index.js:325:30)
      at Object.throwingMatcher [as toBeInTheDocument] (node_modules/expect/build/index.js:326:15)
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:123:25)

  ● CrisisAlertBanner › Crisis Resources › should display location-specific resources when provided

    TestingLibraryElementError: Unable to find an element with the text: 988. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"crisis-alert-banner crisis-alert-banner--urgent"[39m
          [33mdata-testid[39m=[32m"crisis-alert-banner"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"crisis-alert-content"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-header"[39m
            [36m>[39m
              [36m<h3>[39m
                [0mYou're Not Alone - Help is Available 24/7[0m
              [36m</h3>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Close crisis alert"[39m
                [33mclass[39m=[32m"crisis-alert-close"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-resources"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
                [33mhref[39m=[32m"tel:findahelpline.com"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mCall [0m
                    [0mInternational Crisis Lines[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mfindahelpline.com[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</a>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mText Support[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mVisit website for local resources[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<p[39m
              [33mclass[39m=[32m"crisis-alert-message"[39m
            [36m>[39m
              [0mIf you're thinking about suicide, are worried about a friend or loved one, or would like emotional support, help is available.[0m
            [36m</p>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-actions"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-action-primary"[39m
                [33mhref[39m=[32m"https://findahelpline.com"[39m
                [33mrel[39m=[32m"noopener noreferrer"[39m
                [33mtarget[39m=[32m"_blank"[39m
              [36m>[39m
                [0mGet Help Now[0m
              [36m</a>[39m
              [36m<button[39m
                [33mclass[39m=[32m"crisis-action-secondary"[39m
              [36m>[39m
                [0mView All Resources[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 136 |[39m
     [90m 137 |[39m       [90m// Default resources should be US-based[39m
    [31m[1m>[22m[39m[90m 138 |[39m       expect(screen[33m.[39mgetByText([32m'988'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 139 |[39m     })[33m;[39m
     [90m 140 |[39m   })[33m;[39m
     [90m 141 |[39m[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:138:21)

  ● CrisisAlertBanner › Interactive Elements › should have clickable phone numbers

    expect(received).toBeInTheDocument()

    received value must be an HTMLElement or an SVGElement.
    Received has value: null

    [0m [90m 153 |[39m
     [90m 154 |[39m       [36mconst[39m phoneLink [33m=[39m container[33m.[39mquerySelector([32m'a[href="tel:988"]'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 155 |[39m       expect(phoneLink)[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 156 |[39m     })[33m;[39m
     [90m 157 |[39m
     [90m 158 |[39m     it([32m'should open chat support in new window'[39m[33m,[39m () [33m=>[39m {[0m

      at __EXTERNAL_MATCHER_TRAP__ (node_modules/expect/build/index.js:325:30)
      at Object.throwingMatcher [as toBeInTheDocument] (node_modules/expect/build/index.js:326:15)
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:155:25)

  ● CrisisAlertBanner › Accessibility › should be keyboard navigable

    expect(received).toBeInTheDocument()

    received value must be an HTMLElement or an SVGElement.
    Received has value: null

    [0m [90m 348 |[39m       [36mconst[39m helpLink [33m=[39m screen[33m.[39mgetByText([32m'Get Help Now'[39m)[33m;[39m
     [90m 349 |[39m
    [31m[1m>[22m[39m[90m 350 |[39m       expect(phoneLink)[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 351 |[39m       expect(helpLink)[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m 352 |[39m     })[33m;[39m
     [90m 353 |[39m[0m

      at __EXTERNAL_MATCHER_TRAP__ (node_modules/expect/build/index.js:325:30)
      at Object.throwingMatcher [as toBeInTheDocument] (node_modules/expect/build/index.js:326:15)
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:350:25)

  ● CrisisAlertBanner › Quick Actions › should show breathing exercise button

    TestingLibraryElementError: Unable to find an accessible element with the role "button" and name `/Breathing Exercise/i`

    Here are the accessible roles:

      heading:

      Name "You're Not Alone - Help is Available 24/7":
      [36m<h3 />[39m

      --------------------------------------------------
      button:

      Name "Close crisis alert":
      [36m<button[39m
        [33maria-label[39m=[32m"Close crisis alert"[39m
        [33mclass[39m=[32m"crisis-alert-close"[39m
      [36m/>[39m

      Name "View All Resources":
      [36m<button[39m
        [33mclass[39m=[32m"crisis-action-secondary"[39m
      [36m/>[39m

      --------------------------------------------------
      link:

      Name "Call International Crisis Lines findahelpline.com":
      [36m<a[39m
        [33mclass[39m=[32m"crisis-resource-item"[39m
        [33mhref[39m=[32m"tel:findahelpline.com"[39m
      [36m/>[39m

      Name "Get Help Now":
      [36m<a[39m
        [33mclass[39m=[32m"crisis-action-primary"[39m
        [33mhref[39m=[32m"https://findahelpline.com"[39m
        [33mrel[39m=[32m"noopener noreferrer"[39m
        [33mtarget[39m=[32m"_blank"[39m
      [36m/>[39m

      --------------------------------------------------
      strong:

      Name "":
      [36m<strong />[39m

      Name "":
      [36m<strong />[39m

      --------------------------------------------------
      paragraph:

      Name "":
      [36m<p[39m
        [33mclass[39m=[32m"crisis-alert-message"[39m
      [36m/>[39m

      --------------------------------------------------

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"crisis-alert-banner crisis-alert-banner--urgent"[39m
          [33mdata-testid[39m=[32m"crisis-alert-banner"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"crisis-alert-content"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-header"[39m
            [36m>[39m
              [36m<h3>[39m
                [0mYou're Not Alone - Help is Available 24/7[0m
              [36m</h3>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Close crisis alert"[39m
                [33mclass[39m=[32m"crisis-alert-close"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-resources"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
                [33mhref[39m=[32m"tel:findahelpline.com"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mCall [0m
                    [0mInternational Crisis Lines[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mfindahelpline.com[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</a>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mText Support[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mVisit website for local resources[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<p[39m
              [33mclass[39m=[32m"crisis-alert-message"[39m
            [36m>[39m
              [0mIf you're thinking about suicide, are worried about a friend or loved one, or would like emotional support, help is available.[0m
            [36m</p>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-actions"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-action-primary"[39m
                [33mhref[39m=[32m"https://findahelpline.com"[39m
                [33mrel[39m=[32m"noopener noreferrer"[39m
                [33mtarget[39m=[32m"_blank"[39m
              [36m>[39m
                [0mGet Help Now[0m
              [36m</a>[39m
              [36m<button[39m
                [33mclass[39m=[32m"crisis-action-secondary"[39m
              [36m>[39m
                [0mView All Resources[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 381 |[39m       )[33m;[39m
     [90m 382 |[39m
    [31m[1m>[22m[39m[90m 383 |[39m       expect(screen[33m.[39mgetByRole([32m'button'[39m[33m,[39m { name[33m:[39m [35m/Breathing Exercise/i[39m }))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 384 |[39m     })[33m;[39m
     [90m 385 |[39m
     [90m 386 |[39m     it([32m'should trigger breathing exercise overlay'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:383:21)

  ● CrisisAlertBanner › Quick Actions › should trigger breathing exercise overlay

    TestingLibraryElementError: Unable to find an accessible element with the role "button" and name `/Breathing Exercise/i`

    Here are the accessible roles:

      heading:

      Name "You're Not Alone - Help is Available 24/7":
      [36m<h3 />[39m

      --------------------------------------------------
      button:

      Name "Close crisis alert":
      [36m<button[39m
        [33maria-label[39m=[32m"Close crisis alert"[39m
        [33mclass[39m=[32m"crisis-alert-close"[39m
      [36m/>[39m

      Name "View All Resources":
      [36m<button[39m
        [33mclass[39m=[32m"crisis-action-secondary"[39m
      [36m/>[39m

      --------------------------------------------------
      link:

      Name "Call International Crisis Lines findahelpline.com":
      [36m<a[39m
        [33mclass[39m=[32m"crisis-resource-item"[39m
        [33mhref[39m=[32m"tel:findahelpline.com"[39m
      [36m/>[39m

      Name "Get Help Now":
      [36m<a[39m
        [33mclass[39m=[32m"crisis-action-primary"[39m
        [33mhref[39m=[32m"https://findahelpline.com"[39m
        [33mrel[39m=[32m"noopener noreferrer"[39m
        [33mtarget[39m=[32m"_blank"[39m
      [36m/>[39m

      --------------------------------------------------
      strong:

      Name "":
      [36m<strong />[39m

      Name "":
      [36m<strong />[39m

      --------------------------------------------------
      paragraph:

      Name "":
      [36m<p[39m
        [33mclass[39m=[32m"crisis-alert-message"[39m
      [36m/>[39m

      --------------------------------------------------

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"crisis-alert-banner crisis-alert-banner--urgent"[39m
          [33mdata-testid[39m=[32m"crisis-alert-banner"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"crisis-alert-content"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-header"[39m
            [36m>[39m
              [36m<h3>[39m
                [0mYou're Not Alone - Help is Available 24/7[0m
              [36m</h3>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Close crisis alert"[39m
                [33mclass[39m=[32m"crisis-alert-close"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-resources"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
                [33mhref[39m=[32m"tel:findahelpline.com"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mCall [0m
                    [0mInternational Crisis Lines[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mfindahelpline.com[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</a>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mText Support[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mVisit website for local resources[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<p[39m
              [33mclass[39m=[32m"crisis-alert-message"[39m
            [36m>[39m
              [0mIf you're thinking about suicide, are worried about a friend or loved one, or would like emotional support, help is available.[0m
            [36m</p>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-actions"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-action-primary"[39m
                [33mhref[39m=[32m"https://findahelpline.com"[39m
                [33mrel[39m=[32m"noopener noreferrer"[39m
                [33mtarget[39m=[32m"_blank"[39m
              [36m>[39m
                [0mGet Help Now[0m
              [36m</a>[39m
              [36m<button[39m
                [33mclass[39m=[32m"crisis-action-secondary"[39m
              [36m>[39m
                [0mView All Resources[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 398 |[39m       )[33m;[39m
     [90m 399 |[39m
    [31m[1m>[22m[39m[90m 400 |[39m       [36mconst[39m breathingButton [33m=[39m screen[33m.[39mgetByRole([32m'button'[39m[33m,[39m { name[33m:[39m [35m/Breathing Exercise/i[39m })[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 401 |[39m       fireEvent[33m.[39mclick(breathingButton)[33m;[39m
     [90m 402 |[39m
     [90m 403 |[39m       expect(onBreathingExercise)[33m.[39mtoHaveBeenCalled()[33m;[39m[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:400:38)

  ● CrisisAlertBanner › Responsive Design › should use icons only on very small screens

    TestingLibraryElementError: Unable to find an element with the text: 988. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"crisis-alert-banner crisis-alert-banner--urgent"[39m
          [33mdata-testid[39m=[32m"crisis-alert-banner"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"crisis-alert-content"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-header"[39m
            [36m>[39m
              [36m<h3>[39m
                [0mYou're Not Alone - Help is Available 24/7[0m
              [36m</h3>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Close crisis alert"[39m
                [33mclass[39m=[32m"crisis-alert-close"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-resources"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
                [33mhref[39m=[32m"tel:findahelpline.com"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mCall [0m
                    [0mInternational Crisis Lines[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mfindahelpline.com[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</a>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mText Support[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mVisit website for local resources[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<p[39m
              [33mclass[39m=[32m"crisis-alert-message"[39m
            [36m>[39m
              [0mIf you're thinking about suicide, are worried about a friend or loved one, or would like emotional support, help is available.[0m
            [36m</p>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-actions"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-action-primary"[39m
                [33mhref[39m=[32m"https://findahelpline.com"[39m
                [33mrel[39m=[32m"noopener noreferrer"[39m
                [33mtarget[39m=[32m"_blank"[39m
              [36m>[39m
                [0mGet Help Now[0m
              [36m</a>[39m
              [36m<button[39m
                [33mclass[39m=[32m"crisis-action-secondary"[39m
              [36m>[39m
                [0mView All Resources[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 536 |[39m
     [90m 537 |[39m       [90m// Check that the component still displays key information[39m
    [31m[1m>[22m[39m[90m 538 |[39m       expect(screen[33m.[39mgetByText([32m'988'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 539 |[39m       [90m// Icons should be present[39m
     [90m 540 |[39m       expect(container[33m.[39mquerySelector([32m'svg'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m 541 |[39m     })[33m;[39m[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:538:21)

  ● CrisisAlertBanner › Error Handling › should handle missing resources gracefully

    TestingLibraryElementError: Unable to find an element with the text: 988. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"crisis-alert-banner crisis-alert-banner--urgent"[39m
          [33mdata-testid[39m=[32m"crisis-alert-banner"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"crisis-alert-content"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-header"[39m
            [36m>[39m
              [36m<h3>[39m
                [0mYou're Not Alone - Help is Available 24/7[0m
              [36m</h3>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Close crisis alert"[39m
                [33mclass[39m=[32m"crisis-alert-close"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-resources"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
                [33mhref[39m=[32m"tel:findahelpline.com"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mCall [0m
                    [0mInternational Crisis Lines[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mfindahelpline.com[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</a>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mText Support[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mVisit website for local resources[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<p[39m
              [33mclass[39m=[32m"crisis-alert-message"[39m
            [36m>[39m
              [0mIf you're thinking about suicide, are worried about a friend or loved one, or would like emotional support, help is available.[0m
            [36m</p>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-actions"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-action-primary"[39m
                [33mhref[39m=[32m"https://findahelpline.com"[39m
                [33mrel[39m=[32m"noopener noreferrer"[39m
                [33mtarget[39m=[32m"_blank"[39m
              [36m>[39m
                [0mGet Help Now[0m
              [36m</a>[39m
              [36m<button[39m
                [33mclass[39m=[32m"crisis-action-secondary"[39m
              [36m>[39m
                [0mView All Resources[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 555 |[39m
     [90m 556 |[39m       [90m// Should still show default resources[39m
    [31m[1m>[22m[39m[90m 557 |[39m       expect(screen[33m.[39mgetByText([32m'988'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 558 |[39m     })[33m;[39m
     [90m 559 |[39m
     [90m 560 |[39m     it([32m'should handle click errors gracefully'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:557:21)

  ● CrisisAlertBanner › Error Handling › should handle click errors gracefully

    Dismiss error

    [0m [90m 561 |[39m       [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 562 |[39m       [36mconst[39m onDismiss [33m=[39m jest[33m.[39mfn(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 563 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Dismiss error'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 564 |[39m       })[33m;[39m
     [90m 565 |[39m
     [90m 566 |[39m       render([0m

      at src/components/safety/__tests__/CrisisAlertBanner.test.tsx:563:15
      at handleClose (src/components/CrisisAlertBanner.tsx:19:14)
      at HTMLUnknownElement.callCallback (node_modules/react-dom/cjs/react-dom.development.js:4164:14)
      at HTMLUnknownElement.callTheUserObjectsOperation (node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
      at innerInvokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
      at invokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
      at HTMLUnknownElementImpl._dispatch (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
      at HTMLUnknownElementImpl.dispatchEvent (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
      at HTMLUnknownElement.dispatchEvent (node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
      at Object.invokeGuardedCallbackDev (node_modules/react-dom/cjs/react-dom.development.js:4213:16)
      at invokeGuardedCallback (node_modules/react-dom/cjs/react-dom.development.js:4277:31)
      at invokeGuardedCallbackAndCatchFirstError (node_modules/react-dom/cjs/react-dom.development.js:4291:25)
      at executeDispatch (node_modules/react-dom/cjs/react-dom.development.js:9041:3)
      at processDispatchQueueItemsInOrder (node_modules/react-dom/cjs/react-dom.development.js:9073:7)
      at processDispatchQueue (node_modules/react-dom/cjs/react-dom.development.js:9086:5)
      at dispatchEventsForPlugins (node_modules/react-dom/cjs/react-dom.development.js:9097:3)
      at node_modules/react-dom/cjs/react-dom.development.js:9288:12
      at batchedUpdates$1 (node_modules/react-dom/cjs/react-dom.development.js:26179:12)
      at batchedUpdates (node_modules/react-dom/cjs/react-dom.development.js:3991:12)
      at dispatchEventForPluginEventSystem (node_modules/react-dom/cjs/react-dom.development.js:9287:3)
      at dispatchEventWithEnableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay (node_modules/react-dom/cjs/react-dom.development.js:6465:5)
      at dispatchEvent (node_modules/react-dom/cjs/react-dom.development.js:6457:5)
      at dispatchDiscreteEvent (node_modules/react-dom/cjs/react-dom.development.js:6430:5)
      at HTMLDivElement.callTheUserObjectsOperation (node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
      at innerInvokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
      at invokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
      at HTMLButtonElementImpl._dispatch (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
      at HTMLButtonElementImpl.dispatchEvent (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
      at HTMLButtonElement.dispatchEvent (node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
      at node_modules/@testing-library/dom/dist/events.js:19:20
      at node_modules/@testing-library/react/dist/pure.js:108:16
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.eventWrapper (node_modules/@testing-library/react/dist/pure.js:107:28)
      at fireEvent (node_modules/@testing-library/dom/dist/events.js:12:35)
      at Function.fireEvent.<computed> [as click] (node_modules/@testing-library/dom/dist/events.js:110:36)
      at Function.fireEvent.<computed> [as click] (node_modules/@testing-library/react/dist/fire-event.js:15:52)
      at src/components/safety/__tests__/CrisisAlertBanner.test.tsx:579:30
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:579:56)

FAIL src/services/__tests__/dataMigrationService.test.ts
  DataMigrationService
    performMigration
      × should perform complete migration successfully (132 ms)
      × should handle dry run without making changes (10 ms)
      × should handle migration errors gracefully (2 ms)
      √ should skip system keys during migration (1 ms)
      √ should skip already encrypted data (2 ms)
      √ should add compliance warnings when violations are detected (1 ms)
    validateMigration
      × should validate successful migration (1 ms)
      √ should detect encryption support issues (1 ms)
      √ should detect HIPAA compliance violations (1 ms)
      √ should detect data integrity issues (1 ms)
    getMigrationStatus
      √ should detect no migration needed when all data is encrypted (2 ms)
      √ should detect migration needed with critical urgency for crisis data (1 ms)
      √ should detect migration needed with high urgency for health data (1 ms)
      √ should detect migration needed with medium urgency for chat data (1 ms)
    setupDataProtection
      √ should override localStorage methods for sensitive data
      × should use secure storage for sensitive keys (1 ms)
      × should use regular localStorage for non-sensitive keys (1 ms)
    private methods
      isSystemKey
        × should identify system keys correctly (1 ms)
      isAlreadyEncrypted
        × should detect encrypted data correctly
      shouldEncryptKey
        × should identify keys that need encryption (1 ms)
      getAllLocalStorageKeys
        × should retrieve all localStorage keys
        × should handle empty localStorage (1 ms)
      createBackup
        × should create and store backup (1 ms)
      logMigrationReport
        × should log migration report details
  getDataMigrationService
    × should return singleton instance (1 ms)
  useDataMigration hook
    × should provide migration methods
    × should perform migration through hook (1 ms)
    × should validate migration through hook
    × should get migration status through hook (1 ms)
    × should setup data protection through hook

  ● DataMigrationService › performMigration › should perform complete migration successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: 5
    Received: 3

    [0m [90m 87 |[39m       [36mconst[39m report [33m=[39m [36mawait[39m service[33m.[39mperformMigration(options)[33m;[39m
     [90m 88 |[39m
    [31m[1m>[22m[39m[90m 89 |[39m       expect(report[33m.[39mtotalKeys)[33m.[39mtoBe([35m5[39m)[33m;[39m [90m// Based on mocked keys[39m
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 90 |[39m       expect(report[33m.[39mmigratedKeys)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m 91 |[39m       expect(report[33m.[39mmigrationTime)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m 92 |[39m       expect(mockSecureStorage[33m.[39mexportData)[33m.[39mtoHaveBeenCalledWith([36mtrue[39m)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/dataMigrationService.test.ts:89:32)

  ● DataMigrationService › performMigration › should handle dry run without making changes

    expect(received).toBe(expected) // Object.is equality

    Expected: 5
    Received: 2

    [0m [90m 109 |[39m       [36mconst[39m report [33m=[39m [36mawait[39m service[33m.[39mperformMigration(options)[33m;[39m
     [90m 110 |[39m
    [31m[1m>[22m[39m[90m 111 |[39m       expect(report[33m.[39mtotalKeys)[33m.[39mtoBe([35m5[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 112 |[39m       expect(mockSecureStorage[33m.[39msetItem)[33m.[39mnot[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m 113 |[39m       expect(mockEncryptionService[33m.[39mmigrateExistingData)[33m.[39mnot[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m 114 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/dataMigrationService.test.ts:111:32)

  ● DataMigrationService › performMigration › should handle migration errors gracefully

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 124 |[39m       [36mconst[39m report [33m=[39m [36mawait[39m service[33m.[39mperformMigration()[33m;[39m
     [90m 125 |[39m
    [31m[1m>[22m[39m[90m 126 |[39m       expect(report[33m.[39mfailedKeys)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 127 |[39m       expect(report[33m.[39merrors)[33m.[39mtoContain(expect[33m.[39mstringContaining([32m'Storage error'[39m))[33m;[39m
     [90m 128 |[39m     })[33m;[39m
     [90m 129 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/dataMigrationService.test.ts:126:33)

  ● DataMigrationService › validateMigration › should validate successful migration

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 184 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m service[33m.[39mvalidateMigration()[33m;[39m
     [90m 185 |[39m
    [31m[1m>[22m[39m[90m 186 |[39m       expect(result[33m.[39misValid)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 187 |[39m       expect(result[33m.[39missues)[33m.[39mtoHaveLength([35m0[39m)[33m;[39m
     [90m 188 |[39m     })[33m;[39m
     [90m 189 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/dataMigrationService.test.ts:186:30)

  ● DataMigrationService › setupDataProtection › should use secure storage for sensitive keys

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● DataMigrationService › setupDataProtection › should use regular localStorage for non-sensitive keys

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● DataMigrationService › private methods › isSystemKey › should identify system keys correctly

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● DataMigrationService › private methods › isAlreadyEncrypted › should detect encrypted data correctly

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● DataMigrationService › private methods › shouldEncryptKey › should identify keys that need encryption

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● DataMigrationService › private methods › getAllLocalStorageKeys › should retrieve all localStorage keys

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● DataMigrationService › private methods › getAllLocalStorageKeys › should handle empty localStorage

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● DataMigrationService › private methods › createBackup › should create and store backup

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● DataMigrationService › private methods › logMigrationReport › should log migration report details

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● getDataMigrationService › should return singleton instance

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● useDataMigration hook › should provide migration methods

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● useDataMigration hook › should perform migration through hook

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● useDataMigration hook › should validate migration through hook

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● useDataMigration hook › should get migration status through hook

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● useDataMigration hook › should setup data protection through hook

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  console.log
    [Enhanced Offline Hook] Service initialized successfully

      at initializeOfflineService (src/hooks/useEnhancedOffline.ts:85:17)

PASS src/services/__tests__/authService.test.ts
  authService
    setUpdater
      √ should set the updater function (1 ms)
      √ should allow setting updater multiple times (1 ms)
      √ should accept updater function that takes Helper parameter (1 ms)
    updateHelperProfile
      √ should call the updater function when set (1 ms)
      √ should pass complete helper profile to updater
      √ should log error when updater is not set (1 ms)
      √ should not throw error when updater is not set
      √ should handle multiple profile updates with same updater (1 ms)
      √ should work with minimal helper profile (1 ms)
      √ should work with certified helper profile (1 ms)
      √ should work with moderator profile
      √ should handle helper with pending application status (7 ms)
      √ should handle helper with rejected application status (1 ms)
      √ should preserve all optional helper properties (1 ms)
    error handling
      √ should handle updater function that throws error (12 ms)
      √ should handle null updater parameter gracefully (1 ms)
      √ should handle undefined updater parameter gracefully
    integration scenarios
      √ should support profile update workflow (1 ms)
      √ should support multiple profile management systems
      √ should work with async updater function (104 ms)
    state management
      √ should maintain updater state between calls
      √ should replace previous updater when new one is set (2 ms)

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:182:13)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:182:13)

  console.log
    [Enhanced Offline Hook] Service initialized successfully

      at initializeOfflineService (src/hooks/useEnhancedOffline.ts:85:17)

  console.log
    Container HTML: <div class="quick-exit-wrapper position-top-left" data-testid="quick-exit-wrapper" style="position: fixed; z-index: 9999; top: 20px; left: 20px;"><button class="quick-exit-button size-medium" aria-label="Emergency exit - leaves site immediately" aria-describedby="quick-exit-instructions" style="position: relative; border-radius: var(--safe-radius-md); padding: 10px 16px; font-size: 14px; font-weight: 600; cursor: pointer; box-shadow: var(--safe-shadow-lg); transition: all 0.2s ease-out; transform: scale(1); display: flex; align-items: center; gap: 8px; min-width: 120px;"><svg data-testid="exit-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" style="animation: none;"><path d="M9 3l-6 6l6 6"></path><path d="M3 9h12"></path><path d="M21 3v18"></path></svg><span>Quick Exit</span><span style="margin-left: 8px; font-size: 11px; opacity: 0.9; font-weight: normal;">ESC x3</span></button><div id="quick-exit-instructions" style="display: none;">Press Escape 3 times quickly or click this button to immediately leave the site</div></div><style>
            @keyframes pulse {
              0%, 100% { opacity: 1; }
              50% { opacity: 0.6; }
            }
            
            @keyframes fadeIn {
              from { 
                opacity: 0;
                transform: translateY(-10px);
              }
              to { 
                opacity: 1;
                transform: translateY(0);
              }
            }
          </style>

      at Object.<anonymous> (src/components/safety/__tests__/QuickExitButton.test.tsx:117:15)

  console.warn
    [useConnectionStatus] Failed to check crisis resources: TypeError: Cannot read properties of undefined (reading 'keys')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useConnectionStatus.ts:119:38
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at src/hooks/useConnectionStatus.ts:132:15

  console.error
    Failed to parse content filters from localStorage SyntaxError: Unexpected token 'i', "invalid-json" is not valid JSON
        at JSON.parse (<anonymous>)
        at Object.loadFilters (C:\Users\damat\_REPOS\CoreV2\src\stores\preferenceStore.ts:15:38)
        at C:\Users\damat\_REPOS\CoreV2\src\stores\preferenceStore.test.ts:129:39
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:48:24
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2512:16)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\stores\preferenceStore.test.ts:128:10)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at Object.loadFilters (src/stores/preferenceStore.ts:18:17)
      at src/stores/preferenceStore.test.ts:129:39
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.<anonymous> (src/stores/preferenceStore.test.ts:128:10)

  console.warn
    Sentry DSN not configured

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at initializeSentry (src/services/errorTrackingService.ts:80:13)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:53:23)

  console.warn
    [useConnectionStatus] Failed to check crisis resources: TypeError: Cannot read properties of undefined (reading 'keys')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useConnectionStatus.ts:119:38

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at src/hooks/useConnectionStatus.ts:132:15

FAIL src/hooks/useCrisisStressTesting.test.tsx (10.484 s)
  useCrisisStressTesting Hook
    × should initialize with default state (63 ms)
    √ should initialize with custom callbacks (3 ms)
    × should run crisis stress tests successfully (35 ms)
    × should handle stress test failures (4 ms)
    × should detect critical safety failures and trigger emergency (1060 ms)
    × should run failover tests successfully (3 ms)
    × should handle failover test errors (3 ms)
    × should execute emergency stop (2 ms)
    × should clear emergency status (3 ms)
    × should update test configuration (2 ms)
    × should toggle scenario selection (3 ms)
    × should clear results (8 ms)
    × should export results as JSON (4 ms)
    × should calculate test statistics correctly (3 ms)
    × should prevent concurrent test execution (2 ms)
    × should call onTestComplete callback when tests finish (2 ms)
    × should filter scenarios based on selection when running tests (2 ms)
    × should set testing status during test execution (2 ms)

  ● useCrisisStressTesting Hook › should initialize with default state

    expect(received).toHaveLength(expected)

    Expected length: 2
    Received length: 0
    Received array:  []

    [0m [90m 40 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39mfailoverResults)[33m.[39mtoEqual([])[33m;[39m
     [90m 41 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39memergencyStatus[33m.[39mactive)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 42 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39mselectedScenarios)[33m.[39mtoHaveLength([35m2[39m)[33m;[39m [90m// All scenarios selected by default[39m
     [90m    |[39m                                                    [31m[1m^[22m[39m
     [90m 43 |[39m     expect(result[33m.[39mcurrent[33m.[39mstats)[33m.[39mtoBeNull()[33m;[39m
     [90m 44 |[39m     expect(result[33m.[39mcurrent[33m.[39misEmergency)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 45 |[39m     expect(result[33m.[39mcurrent[33m.[39mhasResults)[33m.[39mtoBe([36mfalse[39m)[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:42:52)

  ● useCrisisStressTesting Hook › should run crisis stress tests successfully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"maxConcurrentUsers": 1000, "scenarios": Any<Array>, "testDuration": 300}

    Number of calls: 0

    [0m [90m 80 |[39m     })[33m;[39m
     [90m 81 |[39m
    [31m[1m>[22m[39m[90m 82 |[39m     expect(crisisStressTestingSystem[33m.[39mrunCrisisStressTests)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                                                            [31m[1m^[22m[39m
     [90m 83 |[39m       expect[33m.[39mobjectContaining({
     [90m 84 |[39m         scenarios[33m:[39m expect[33m.[39many([33mArray[39m)[33m,[39m
     [90m 85 |[39m         maxConcurrentUsers[33m:[39m [35m1000[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:82:60)

  ● useCrisisStressTesting Hook › should handle stress test failures

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 105 |[39m     })[33m;[39m
     [90m 106 |[39m
    [31m[1m>[22m[39m[90m 107 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39memergencyStatus[33m.[39mactive)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                         [31m[1m^[22m[39m
     [90m 108 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39memergencyStatus[33m.[39mreason)[33m.[39mtoContain([32m'Testing system failure'[39m)[33m;[39m
     [90m 109 |[39m     expect(result[33m.[39mcurrent[33m.[39misEmergency)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 110 |[39m     expect(onEmergencyBreak)[33m.[39mtoHaveBeenCalledWith(expect[33m.[39mstringContaining([32m'Testing system failure'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:107:57)

  ● useCrisisStressTesting Hook › should detect critical safety failures and trigger emergency

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 136 |[39m
     [90m 137 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 138 |[39m       expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39memergencyStatus[33m.[39mactive)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                           [31m[1m^[22m[39m
     [90m 139 |[39m       expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39memergencyStatus[33m.[39mreason)[33m.[39mtoContain([32m'critical safety failures detected'[39m)[33m;[39m
     [90m 140 |[39m       expect(onEmergencyBreak)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m 141 |[39m     })[33m;[39m[0m

      at src/hooks/useCrisisStressTesting.test.tsx:138:59
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useCrisisStressTesting Hook › should run failover tests successfully

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 161 |[39m     })[33m;[39m
     [90m 162 |[39m
    [31m[1m>[22m[39m[90m 163 |[39m     expect(crisisStressTestingSystem[33m.[39mrunEmergencyFailoverTests)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                                                 [31m[1m^[22m[39m
     [90m 164 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39mfailoverResults)[33m.[39mtoEqual(mockFailoverResults)[33m;[39m
     [90m 165 |[39m     expect(result[33m.[39mcurrent[33m.[39mhasResults)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 166 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:163:65)

  ● useCrisisStressTesting Hook › should handle failover test errors

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 177 |[39m     })[33m;[39m
     [90m 178 |[39m
    [31m[1m>[22m[39m[90m 179 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39memergencyStatus[33m.[39mactive)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                         [31m[1m^[22m[39m
     [90m 180 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39memergencyStatus[33m.[39mreason)[33m.[39mtoContain([32m'Failover testing failure'[39m)[33m;[39m
     [90m 181 |[39m     expect(onEmergencyBreak)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m 182 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:179:57)

  ● useCrisisStressTesting Hook › should execute emergency stop

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 191 |[39m
     [90m 192 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39misTestingActive)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 193 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39memergencyStatus[33m.[39mactive)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                         [31m[1m^[22m[39m
     [90m 194 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39memergencyStatus[33m.[39mreason)[33m.[39mtoBe([32m'Manual emergency stop'[39m)[33m;[39m
     [90m 195 |[39m     expect(onEmergencyBreak)[33m.[39mtoHaveBeenCalledWith([32m'Manual emergency stop activated'[39m)[33m;[39m
     [90m 196 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:193:57)

  ● useCrisisStressTesting Hook › should clear emergency status

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 204 |[39m     })[33m;[39m
     [90m 205 |[39m
    [31m[1m>[22m[39m[90m 206 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39memergencyStatus[33m.[39mactive)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                         [31m[1m^[22m[39m
     [90m 207 |[39m
     [90m 208 |[39m     [90m// Then clear it[39m
     [90m 209 |[39m     act(() [33m=>[39m {[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:206:57)

  ● useCrisisStressTesting Hook › should update test configuration

    expect(received).toBe(expected) // Object.is equality

    Expected: 2000
    Received: 10

    [0m [90m 227 |[39m     })[33m;[39m
     [90m 228 |[39m
    [31m[1m>[22m[39m[90m 229 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39mtestConfig[33m.[39mmaxConcurrentUsers)[33m.[39mtoBe([35m2000[39m)[33m;[39m
     [90m     |[39m                                                                [31m[1m^[22m[39m
     [90m 230 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39mtestConfig[33m.[39mtestDuration)[33m.[39mtoBe([35m600[39m)[33m;[39m
     [90m 231 |[39m     [90m// Other config values should remain unchanged[39m
     [90m 232 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39mtestConfig[33m.[39mrampUpTime)[33m.[39mtoBe([35m30[39m)[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:229:64)

  ● useCrisisStressTesting Hook › should toggle scenario selection

    expect(received).toContain(expected) // indexOf

    Expected value: "scenario-1"
    Received array: []

    [0m [90m 237 |[39m
     [90m 238 |[39m     [90m// Initially all scenarios are selected[39m
    [31m[1m>[22m[39m[90m 239 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39mselectedScenarios)[33m.[39mtoContain([32m'scenario-1'[39m)[33m;[39m
     [90m     |[39m                                                    [31m[1m^[22m[39m
     [90m 240 |[39m
     [90m 241 |[39m     act(() [33m=>[39m {
     [90m 242 |[39m       result[33m.[39mcurrent[33m.[39mactions[33m.[39mtoggleScenario([32m'scenario-1'[39m)[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:239:52)

  ● useCrisisStressTesting Hook › should clear results

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 0
    Received array:  []

    [0m [90m 278 |[39m     })[33m;[39m
     [90m 279 |[39m
    [31m[1m>[22m[39m[90m 280 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39mtestResults)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 281 |[39m
     [90m 282 |[39m     [90m// Then clear results[39m
     [90m 283 |[39m     act(() [33m=>[39m {[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:280:46)

  ● useCrisisStressTesting Hook › should export results as JSON

    expect(received).toHaveProperty(path)

    Expected path: "timestamp"
    Received path: []

    Received value: {}

    [0m [90m 297 |[39m     [36mconst[39m parsedData [33m=[39m [33mJSON[39m[33m.[39mparse(exportedData)[33m;[39m
     [90m 298 |[39m
    [31m[1m>[22m[39m[90m 299 |[39m     expect(parsedData)[33m.[39mtoHaveProperty([32m'timestamp'[39m)[33m;[39m
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 300 |[39m     expect(parsedData)[33m.[39mtoHaveProperty([32m'testConfig'[39m)[33m;[39m
     [90m 301 |[39m     expect(parsedData)[33m.[39mtoHaveProperty([32m'selectedScenarios'[39m)[33m;[39m
     [90m 302 |[39m     expect(parsedData)[33m.[39mtoHaveProperty([32m'testResults'[39m)[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:299:24)

  ● useCrisisStressTesting Hook › should calculate test statistics correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 2
    Received: 0

    [0m [90m 342 |[39m     [36mconst[39m stats [33m=[39m result[33m.[39mcurrent[33m.[39mstats[33m;[39m
     [90m 343 |[39m     expect(stats)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 344 |[39m     expect(stats[33m![39m[33m.[39mtotal)[33m.[39mtoBe([35m2[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 345 |[39m     expect(stats[33m![39m[33m.[39msuccessful)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m 346 |[39m     expect(stats[33m![39m[33m.[39mfailed)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m 347 |[39m     expect(stats[33m![39m[33m.[39mcritical)[33m.[39mtoBe([35m1[39m)[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:344:26)

  ● useCrisisStressTesting Hook › should prevent concurrent test execution

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 368 |[39m     })[33m;[39m
     [90m 369 |[39m
    [31m[1m>[22m[39m[90m 370 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39misTestingActive)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                  [31m[1m^[22m[39m
     [90m 371 |[39m     
     [90m 372 |[39m     [90m// Wait for first test to complete[39m
     [90m 373 |[39m     [36mawait[39m firstTest[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:370:50)

  ● useCrisisStressTesting Hook › should call onTestComplete callback when tests finish

    TypeError: Cannot read properties of null (reading 'actions')

    [0m [90m 398 |[39m
     [90m 399 |[39m     [36mawait[39m act([36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 400 |[39m       [36mawait[39m result[33m.[39mcurrent[33m.[39mactions[33m.[39mrunStressTests()[33m;[39m
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 401 |[39m     })[33m;[39m
     [90m 402 |[39m
     [90m 403 |[39m     expect(onTestComplete)[33m.[39mtoHaveBeenCalledWith(mockResults)[33m;[39m[0m

      at src/hooks/useCrisisStressTesting.test.tsx:400:28
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:399:14)

  ● useCrisisStressTesting Hook › should filter scenarios based on selection when running tests

    TypeError: Cannot read properties of null (reading 'actions')

    [0m [90m 409 |[39m     [90m// Deselect scenario-2[39m
     [90m 410 |[39m     act(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 411 |[39m       result[33m.[39mcurrent[33m.[39mactions[33m.[39mtoggleScenario([32m'scenario-2'[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 412 |[39m     })[33m;[39m
     [90m 413 |[39m
     [90m 414 |[39m     [36mconst[39m mockResults[33m:[39m unknown[] [33m=[39m [][33m;[39m[0m

      at src/hooks/useCrisisStressTesting.test.tsx:411:22
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:410:8)

  ● useCrisisStressTesting Hook › should set testing status during test execution

    TypeError: Cannot read properties of null (reading 'actions')

    [0m [90m 444 |[39m     [90m// Start test[39m
     [90m 445 |[39m     [36mawait[39m act([36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 446 |[39m       result[33m.[39mcurrent[33m.[39mactions[33m.[39mrunStressTests()[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 447 |[39m     })[33m;[39m
     [90m 448 |[39m
     [90m 449 |[39m     [90m// Should be in testing state[39m[0m

      at src/hooks/useCrisisStressTesting.test.tsx:446:22
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:445:14)

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at commitRootImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26974:5)
        at commitRoot (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26721:5)
        at performSyncWorkOnRoot (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26156:3)
        at flushSyncCallbacks (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:12042:22)
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at Object.eventWrapper (C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\pure.js:107:28)
        at fireEvent (C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\dom\dist\events.js:12:35)
        at Function.fireEvent.<computed> [as click] (C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\dom\dist\events.js:110:36)
        at Function.fireEvent.<computed> [as click] (C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\fire-event.js:15:52)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:192:17)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at commitRootImpl (node_modules/react-dom/cjs/react-dom.development.js:26974:5)
      at commitRoot (node_modules/react-dom/cjs/react-dom.development.js:26721:5)
      at performSyncWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:26156:3)
      at flushSyncCallbacks (node_modules/react-dom/cjs/react-dom.development.js:12042:22)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.eventWrapper (node_modules/@testing-library/react/dist/pure.js:107:28)
      at fireEvent (node_modules/@testing-library/dom/dist/events.js:12:35)
      at Function.fireEvent.<computed> [as click] (node_modules/@testing-library/dom/dist/events.js:110:36)
      at Function.fireEvent.<computed> [as click] (node_modules/@testing-library/react/dist/fire-event.js:15:52)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:192:17)

  console.log
    Body HTML: <div id="root"></div><div data-testid="test-container"><div class="quick-exit-wrapper position-top-left" data-testid="quick-exit-wrapper" style="position: fixed; z-index: 9999; top: 20px; left: 20px;"><button class="quick-exit-button size-medium" aria-label="Emergency exit - leaves site immediately" aria-describedby="quick-exit-instructions" style="position: relative; border-radius: var(--safe-radius-md); padding: 10px 16px; font-size: 14px; font-weight: 600; cursor: pointer; box-shadow: var(--safe-shadow-lg); transition: all 0.2s ease-out; transform: scale(1); display: flex; align-items: center; gap: 8px; min-width: 120px;"><svg data-testid="exit-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" style="animation: none;"><path d="M9 3l-6 6l6 6"></path><path d="M3 9h12"></path><path d="M21 3v18"></path></svg><span>Quick Exit</span><span style="margin-left: 8px; font-size: 11px; opacity: 0.9; font-weight: normal;">ESC x3</span></button><div id="quick-exit-instructions" style="display: none;">Press Escape 3 times quickly or click this button to immediately leave the site</div></div><style>
            @keyframes pulse {
              0%, 100% { opacity: 1; }
              50% { opacity: 0.6; }
            }
            
            @keyframes fadeIn {
              from { 
                opacity: 0;
                transform: translateY(-10px);
              }
              to { 
                opacity: 1;
                transform: translateY(0);
              }
            }
          </style></div>

      at Object.<anonymous> (src/components/safety/__tests__/QuickExitButton.test.tsx:118:15)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'map')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:238:43
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

  console.log
    All buttons found: 1

      at Object.<anonymous> (src/components/safety/__tests__/QuickExitButton.test.tsx:122:15)

  console.error
    Failed to parse content filters from localStorage SyntaxError: Expected ',' or '}' after property value in JSON at position 19 (line 1 column 20)
        at JSON.parse (<anonymous>)
        at Object.loadFilters (C:\Users\damat\_REPOS\CoreV2\src\stores\preferenceStore.ts:15:38)
        at C:\Users\damat\_REPOS\CoreV2\src\stores\preferenceStore.test.ts:145:39
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:48:24
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2512:16)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\stores\preferenceStore.test.ts:144:10)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at Object.loadFilters (src/stores/preferenceStore.ts:18:17)
      at src/stores/preferenceStore.test.ts:145:39
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.<anonymous> (src/stores/preferenceStore.test.ts:144:10)

  console.error
    Failed to parse content filters from localStorage Error: Storage error
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\stores\preferenceStore.test.ts:172:15)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\jest-mock\build\index.js:397:39
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-mock\build\index.js:404:13)
        at Object.mockConstructor [as getItem] (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-mock\build\index.js:103:19)
        at Object.loadFilters (C:\Users\damat\_REPOS\CoreV2\src\stores\preferenceStore.ts:13:43)
        at C:\Users\damat\_REPOS\CoreV2\src\stores\preferenceStore.test.ts:176:39
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:48:24
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2512:16)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\stores\preferenceStore.test.ts:175:10)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at Object.loadFilters (src/stores/preferenceStore.ts:18:17)
      at src/stores/preferenceStore.test.ts:176:39
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.<anonymous> (src/stores/preferenceStore.test.ts:175:10)

FAIL src/services/__tests__/notificationService.test.ts
  notificationService
    setToastFunction
      × should set the toast function correctly (1 ms)
      × should replace the previous toast function (1 ms)
      × should accept undefined to clear the toast function
    addToast
      when toast function is set
        × should call the toast function with message and default type
        × should call the toast function with message and specified type - success (1 ms)
        × should call the toast function with message and specified type - error
        × should call the toast function with message and specified type - info
        × should call the toast function with message and specified type - warning (1 ms)
        × should handle empty message strings (1 ms)
        × should handle long message strings
        × should handle special characters in messages
        × should handle multiple consecutive calls (7 ms)
      when toast function is not set
        × should warn and fall back to alert
        × should fall back to alert with different message types (1 ms)
        × should handle multiple fallback calls
        × should handle empty message in fallback (1 ms)
      when toast function throws an error
        × should not handle errors from the toast function
    integration scenarios
      × should work correctly after multiple function changes (1 ms)
      × should maintain correct behavior with rapid successive calls
      × should handle real-world usage pattern (1 ms)
    type safety and edge cases
      × should handle null message gracefully
      × should handle undefined message gracefully (1 ms)
      × should work with numeric message converted to string
      × should preserve message with whitespace (1 ms)
      × should handle newlines in messages

  ● notificationService › setToastFunction › should set the toast function correctly

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › setToastFunction › should replace the previous toast function

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › setToastFunction › should accept undefined to clear the toast function

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is set › should call the toast function with message and default type

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is set › should call the toast function with message and specified type - success

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is set › should call the toast function with message and specified type - error

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is set › should call the toast function with message and specified type - info

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is set › should call the toast function with message and specified type - warning

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is set › should handle empty message strings

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is set › should handle long message strings

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is set › should handle special characters in messages

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is set › should handle multiple consecutive calls

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is not set › should warn and fall back to alert

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is not set › should fall back to alert with different message types

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is not set › should handle multiple fallback calls

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is not set › should handle empty message in fallback

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function throws an error › should not handle errors from the toast function

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › integration scenarios › should work correctly after multiple function changes

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › integration scenarios › should maintain correct behavior with rapid successive calls

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › integration scenarios › should handle real-world usage pattern

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › type safety and edge cases › should handle null message gracefully

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › type safety and edge cases › should handle undefined message gracefully

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › type safety and edge cases › should work with numeric message converted to string

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › type safety and edge cases › should preserve message with whitespace

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › type safety and edge cases › should handle newlines in messages

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  console.warn
    Sentry DSN not configured

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at initializeSentry (src/services/errorTrackingService.ts:80:13)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:66:23)

  console.warn
    Sentry DSN not configured

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at initializeSentry (src/services/errorTrackingService.ts:80:13)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:79:23)

  console.warn
    Sentry DSN not configured

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at initializeSentry (src/services/errorTrackingService.ts:80:13)
      at src/services/__tests__/errorTrackingService.test.ts:96:25
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:97:14)

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:206:13)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:206:13)

  console.error
    Failed to parse content filters from localStorage Error: localStorage access denied
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\stores\preferenceStore.test.ts:308:15)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\jest-mock\build\index.js:397:39
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-mock\build\index.js:404:13)
        at Object.mockConstructor [as getItem] (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-mock\build\index.js:103:19)
        at Object.loadFilters (C:\Users\damat\_REPOS\CoreV2\src\stores\preferenceStore.ts:13:43)
        at C:\Users\damat\_REPOS\CoreV2\src\stores\preferenceStore.test.ts:313:41
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:48:24
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2512:16)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at C:\Users\damat\_REPOS\CoreV2\src\stores\preferenceStore.test.ts:312:12
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\node_modules\expect\build\toThrowMatchers.js:74:11)
        at Object.throwingMatcher [as toThrow] (C:\Users\damat\_REPOS\CoreV2\node_modules\expect\build\index.js:320:21)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\stores\preferenceStore.test.ts:315:14)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at Object.loadFilters (src/stores/preferenceStore.ts:18:17)
      at src/stores/preferenceStore.test.ts:313:41
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at src/stores/preferenceStore.test.ts:312:12
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/stores/preferenceStore.test.ts:315:14)

  console.error
    Failed to parse content filters from localStorage Error: Storage error
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\stores\preferenceStore.test.ts:324:15)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\jest-mock\build\index.js:397:39
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-mock\build\index.js:404:13)
        at Object.mockConstructor [as getItem] (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-mock\build\index.js:103:19)
        at Object.loadFilters (C:\Users\damat\_REPOS\CoreV2\src\stores\preferenceStore.ts:13:43)
        at C:\Users\damat\_REPOS\CoreV2\src\stores\preferenceStore.test.ts:328:39
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:48:24
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2512:16)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\stores\preferenceStore.test.ts:327:10)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at Object.loadFilters (src/stores/preferenceStore.ts:18:17)
      at src/stores/preferenceStore.test.ts:328:39
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.<anonymous> (src/stores/preferenceStore.test.ts:327:10)

FAIL src/stores/preferenceStore.test.ts
  preferenceStore
    initial state
      √ should have empty contentFilters array as initial state (2 ms)
      √ should have setFilters and loadFilters functions (1 ms)
    setFilters action
      √ should update contentFilters in state
      √ should save filters to localStorage (1 ms)
      √ should handle empty array
      √ should handle filters with special characters (1 ms)
      √ should overwrite previous filters (1 ms)
    loadFilters action
      √ should load filters from localStorage when data exists
      √ should not change state when localStorage is empty (1 ms)
      √ should handle invalid JSON in localStorage (176 ms)
      √ should handle malformed JSON objects (80 ms)
      × should handle empty string in localStorage (2 ms)
      √ should preserve existing filters when localStorage throws error (10 ms)
    state persistence
      √ should maintain state consistency between set and load operations
      √ should handle complex filter data (1 ms)
    edge cases
      √ should handle duplicate filters
      √ should handle very long filter arrays
      √ should handle filters with unicode characters (1 ms)
    concurrent operations
      √ should handle rapid consecutive setFilters calls
      √ should handle setFilters and loadFilters called together (1 ms)
    error recovery
      √ should recover gracefully from localStorage access errors (65 ms)
      √ should continue working after localStorage error (8 ms)

  ● preferenceStore › loadFilters action › should handle empty string in localStorage

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 161 |[39m       [36mconst[39m state [33m=[39m usePreferenceStore[33m.[39mgetState()[33m;[39m
     [90m 162 |[39m       expect(state[33m.[39mcontentFilters)[33m.[39mtoEqual([])[33m;[39m
    [31m[1m>[22m[39m[90m 163 |[39m       expect(console[33m.[39merror)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 164 |[39m       expect(localStorageMock[33m.[39mremoveItem)[33m.[39mtoHaveBeenCalledWith([32m'contentFilters'[39m)[33m;[39m
     [90m 165 |[39m     })[33m;[39m
     [90m 166 |[39m[0m

      at Object.<anonymous> (src/stores/preferenceStore.test.ts:163:29)

  console.warn
    Sentry DSN not configured

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at initializeSentry (src/services/errorTrackingService.ts:80:13)
      at src/services/__tests__/errorTrackingService.test.ts:108:25
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:109:14)

  console.warn
    Sentry DSN not configured

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at initializeSentry (src/services/errorTrackingService.ts:80:13)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:118:23)

  console.warn
    Sentry DSN not configured

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at initializeSentry (src/services/errorTrackingService.ts:80:13)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:127:23)

  console.warn
    Sentry DSN not configured

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at initializeSentry (src/services/errorTrackingService.ts:80:13)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:146:23)

FAIL src/services/__tests__/enhancedOfflineService.test.ts
  EnhancedOfflineService
    Service Initialization
      √ should be properly initialized (1 ms)
      √ should initialize successfully
      √ should handle multiple initialization calls
    Offline Capabilities
      × should get offline capabilities (2 ms)
      × should handle status change listeners (2 ms)
    Crisis Resources
      √ should get crisis resources with default parameters (1 ms)
      √ should get crisis resources for specific language
      √ should get crisis resources for specific cultural context
      √ should get crisis resources with type filter
    Crisis Detection
      × should detect crisis offline (1 ms)
      × should handle different languages in crisis detection (1 ms)
      × should provide appropriate recommendations
    Sync Queue Management
      × should add items to sync queue
      × should handle different sync item types (4 ms)
    Data Management
      √ should clear offline data
      × should update offline resources (1 ms)
    Error Handling
      √ should handle errors gracefully during initialization
      × should handle crisis detection errors (1 ms)
      × should handle sync queue errors
    Multilingual Support
      √ should support multiple languages (1 ms)
      √ should support different cultural contexts
    Service Lifecycle
      × should handle complete workflow (1 ms)

  ● EnhancedOfflineService › Offline Capabilities › should get offline capabilities

    expect(received).toHaveProperty(path)

    Expected path: "hasStorage"
    Received path: []

    Received value: {"canCache": true, "canSync": true}

    [0m [90m 72 |[39m       expect(capabilities)[33m.[39mtoBeDefined()[33m;[39m
     [90m 73 |[39m       [36mif[39m (capabilities) {
    [31m[1m>[22m[39m[90m 74 |[39m         expect(capabilities)[33m.[39mtoHaveProperty([32m'hasStorage'[39m)[33m;[39m
     [90m    |[39m                              [31m[1m^[22m[39m
     [90m 75 |[39m         expect(capabilities)[33m.[39mtoHaveProperty([32m'isOnline'[39m)[33m;[39m
     [90m 76 |[39m       }
     [90m 77 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:74:30)

  ● EnhancedOfflineService › Offline Capabilities › should handle status change listeners

    expect(received).toBe(expected) // Object.is equality

    Expected: "function"
    Received: "undefined"

    [0m [90m 82 |[39m       [36mconst[39m unsubscribe [33m=[39m enhancedOfflineService[33m.[39monStatusChange(mockCallback)[33m;[39m
     [90m 83 |[39m       
    [31m[1m>[22m[39m[90m 84 |[39m       expect([36mtypeof[39m unsubscribe)[33m.[39mtoBe([32m'function'[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 85 |[39m       unsubscribe()[33m;[39m
     [90m 86 |[39m     })[33m;[39m
     [90m 87 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:84:34)

  ● EnhancedOfflineService › Crisis Detection › should detect crisis offline

    TypeError: enhancedOfflineService_1.enhancedOfflineService.detectCrisisOffline is not a function

    [0m [90m 115 |[39m   describe([32m'Crisis Detection'[39m[33m,[39m () [33m=>[39m {
     [90m 116 |[39m     it([32m'should detect crisis offline'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 117 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedOfflineService[33m.[39mdetectCrisisOffline(
     [90m     |[39m                                                   [31m[1m^[22m[39m
     [90m 118 |[39m         [32m'I am feeling very stressed'[39m[33m,[39m
     [90m 119 |[39m         [32m'en'[39m[33m,[39m
     [90m 120 |[39m         [32m'western'[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:117:51)

  ● EnhancedOfflineService › Crisis Detection › should handle different languages in crisis detection

    TypeError: enhancedOfflineService_1.enhancedOfflineService.detectCrisisOffline is not a function

    [0m [90m 128 |[39m
     [90m 129 |[39m     it([32m'should handle different languages in crisis detection'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 130 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedOfflineService[33m.[39mdetectCrisisOffline(
     [90m     |[39m                                                   [31m[1m^[22m[39m
     [90m 131 |[39m         [32m'Me siento muy mal'[39m[33m,[39m
     [90m 132 |[39m         [32m'es'[39m[33m,[39m
     [90m 133 |[39m         [32m'hispanic'[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:130:51)

  ● EnhancedOfflineService › Crisis Detection › should provide appropriate recommendations

    TypeError: enhancedOfflineService_1.enhancedOfflineService.detectCrisisOffline is not a function

    [0m [90m 139 |[39m
     [90m 140 |[39m     it([32m'should provide appropriate recommendations'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 141 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedOfflineService[33m.[39mdetectCrisisOffline(
     [90m     |[39m                                                   [31m[1m^[22m[39m
     [90m 142 |[39m         [32m'I need help urgently'[39m[33m,[39m
     [90m 143 |[39m         [32m'en'[39m[33m,[39m
     [90m 144 |[39m         [32m'western'[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:141:51)

  ● EnhancedOfflineService › Sync Queue Management › should add items to sync queue

    expect(received).resolves.not.toThrow()

    Matcher error: received value must be a promise

    Received has value: undefined

    [0m [90m 162 |[39m       }[33m;[39m
     [90m 163 |[39m
    [31m[1m>[22m[39m[90m 164 |[39m       [36mawait[39m expect(enhancedOfflineService[33m.[39maddToSyncQueue(syncItem))[33m.[39mresolves[33m.[39mnot[33m.[39mtoThrow()[33m;[39m
     [90m     |[39m                                                                                  [31m[1m^[22m[39m
     [90m 165 |[39m     })[33m;[39m
     [90m 166 |[39m
     [90m 167 |[39m     it([32m'should handle different sync item types'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toThrow (node_modules/expect/build/index.js:162:13)
      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:164:82)

  ● EnhancedOfflineService › Sync Queue Management › should handle different sync item types

    expect(received).resolves.not.toThrow()

    Matcher error: received value must be a promise

    Received has value: undefined

    [0m [90m 186 |[39m
     [90m 187 |[39m       [36mfor[39m ([36mconst[39m item [36mof[39m syncItems) {
    [31m[1m>[22m[39m[90m 188 |[39m         [36mawait[39m expect(enhancedOfflineService[33m.[39maddToSyncQueue(item))[33m.[39mresolves[33m.[39mnot[33m.[39mtoThrow()[33m;[39m
     [90m     |[39m                                                                                [31m[1m^[22m[39m
     [90m 189 |[39m       }
     [90m 190 |[39m     })[33m;[39m
     [90m 191 |[39m   })[33m;[39m[0m

      at Object.toThrow (node_modules/expect/build/index.js:162:13)
      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:188:80)

  ● EnhancedOfflineService › Data Management › should update offline resources

    TypeError: enhancedOfflineService_1.enhancedOfflineService.updateOfflineResources is not a function

    [0m [90m 197 |[39m
     [90m 198 |[39m     it([32m'should update offline resources'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 199 |[39m       [36mawait[39m expect(enhancedOfflineService[33m.[39mupdateOfflineResources())[33m.[39mresolves[33m.[39mnot[33m.[39mtoThrow()[33m;[39m
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 200 |[39m     })[33m;[39m
     [90m 201 |[39m   })[33m;[39m
     [90m 202 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:199:43)

  ● EnhancedOfflineService › Error Handling › should handle crisis detection errors

    TypeError: enhancedOfflineService_1.enhancedOfflineService.detectCrisisOffline is not a function

    [0m [90m 221 |[39m     it([32m'should handle crisis detection errors'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 222 |[39m       [36mawait[39m expect(
    [31m[1m>[22m[39m[90m 223 |[39m         enhancedOfflineService[33m.[39mdetectCrisisOffline([32m''[39m[33m,[39m [32m''[39m[33m,[39m [32m''[39m)
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 224 |[39m       )[33m.[39mresolves[33m.[39mnot[33m.[39mtoThrow()[33m;[39m
     [90m 225 |[39m     })[33m;[39m
     [90m 226 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:223:32)

  ● EnhancedOfflineService › Error Handling › should handle sync queue errors

    expect(received).resolves.not.toThrow()

    Matcher error: received value must be a promise

    Received has value: undefined

    [0m [90m 235 |[39m       }[33m;[39m
     [90m 236 |[39m
    [31m[1m>[22m[39m[90m 237 |[39m       [36mawait[39m expect(enhancedOfflineService[33m.[39maddToSyncQueue(invalidSyncItem))[33m.[39mresolves[33m.[39mnot[33m.[39mtoThrow()[33m;[39m
     [90m     |[39m                                                                                         [31m[1m^[22m[39m
     [90m 238 |[39m     })[33m;[39m
     [90m 239 |[39m   })[33m;[39m
     [90m 240 |[39m[0m

      at Object.toThrow (node_modules/expect/build/index.js:162:13)
      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:237:89)

  ● EnhancedOfflineService › Service Lifecycle › should handle complete workflow

    TypeError: enhancedOfflineService_1.enhancedOfflineService.detectCrisisOffline is not a function

    [0m [90m 269 |[39m       expect([33mArray[39m[33m.[39misArray(resources))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 270 |[39m       
    [31m[1m>[22m[39m[90m 271 |[39m       [36mconst[39m detection [33m=[39m [36mawait[39m enhancedOfflineService[33m.[39mdetectCrisisOffline(
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 272 |[39m         [32m'test message'[39m[33m,[39m
     [90m 273 |[39m         [32m'en'[39m[33m,[39m
     [90m 274 |[39m         [32m'western'[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:271:54)

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at commitRootImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26974:5)
        at commitRoot (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26721:5)
        at performSyncWorkOnRoot (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26156:3)
        at flushSyncCallbacks (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:12042:22)
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at Object.eventWrapper (C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\pure.js:107:28)
        at fireEvent (C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\dom\dist\events.js:12:35)
        at Function.fireEvent.<computed> [as click] (C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\dom\dist\events.js:110:36)
        at Function.fireEvent.<computed> [as click] (C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\fire-event.js:15:52)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:222:17)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at commitRootImpl (node_modules/react-dom/cjs/react-dom.development.js:26974:5)
      at commitRoot (node_modules/react-dom/cjs/react-dom.development.js:26721:5)
      at performSyncWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:26156:3)
      at flushSyncCallbacks (node_modules/react-dom/cjs/react-dom.development.js:12042:22)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.eventWrapper (node_modules/@testing-library/react/dist/pure.js:107:28)
      at fireEvent (node_modules/@testing-library/dom/dist/events.js:12:35)
      at Function.fireEvent.<computed> [as click] (node_modules/@testing-library/dom/dist/events.js:110:36)
      at Function.fireEvent.<computed> [as click] (node_modules/@testing-library/react/dist/fire-event.js:15:52)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:222:17)

  console.error
    [Enhanced Crisis Detection Integration] Analysis failed: TypeError: Cannot read properties of undefined (reading 'primaryEmotion')
        at EnhancedCrisisDetectionIntegrationService.consolidateEmotionalProfile (C:\Users\damat\_REPOS\CoreV2\src\services\enhancedCrisisDetectionIntegrationService.ts:540:33)
        at EnhancedCrisisDetectionIntegrationService.consolidateAnalysisResults (C:\Users\damat\_REPOS\CoreV2\src\services\enhancedCrisisDetectionIntegrationService.ts:234:35)
        at EnhancedCrisisDetectionIntegrationService.performComprehensiveCrisisAnalysis (C:\Users\damat\_REPOS\CoreV2\src\services\enhancedCrisisDetectionIntegrationService.ts:136:45)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\tests\unit\crisisEscalationIntegration.test.ts:184:22)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at EnhancedCrisisDetectionIntegrationService.performComprehensiveCrisisAnalysis (src/services/enhancedCrisisDetectionIntegrationService.ts:149:15)
      at Object.<anonymous> (tests/unit/crisisEscalationIntegration.test.ts:184:22)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'map')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:238:43
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

  console.error
    [Enhanced Crisis Detection Integration] Analysis failed: TypeError: Cannot read properties of undefined (reading 'primaryEmotion')
        at EnhancedCrisisDetectionIntegrationService.consolidateEmotionalProfile (C:\Users\damat\_REPOS\CoreV2\src\services\enhancedCrisisDetectionIntegrationService.ts:540:33)
        at EnhancedCrisisDetectionIntegrationService.consolidateAnalysisResults (C:\Users\damat\_REPOS\CoreV2\src\services\enhancedCrisisDetectionIntegrationService.ts:234:35)
        at EnhancedCrisisDetectionIntegrationService.performComprehensiveCrisisAnalysis (C:\Users\damat\_REPOS\CoreV2\src\services\enhancedCrisisDetectionIntegrationService.ts:136:45)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\tests\unit\crisisEscalationIntegration.test.ts:209:22)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at EnhancedCrisisDetectionIntegrationService.performComprehensiveCrisisAnalysis (src/services/enhancedCrisisDetectionIntegrationService.ts:149:15)
      at Object.<anonymous> (tests/unit/crisisEscalationIntegration.test.ts:209:22)

  console.error
    [Enhanced Crisis Detection Integration] Analysis failed: TypeError: Cannot read properties of undefined (reading 'confidence')
        at EnhancedCrisisDetectionIntegrationService.calculateConfidenceBreakdown (C:\Users\damat\_REPOS\CoreV2\src\services\enhancedCrisisDetectionIntegrationService.ts:421:64)
        at EnhancedCrisisDetectionIntegrationService.consolidateAnalysisResults (C:\Users\damat\_REPOS\CoreV2\src\services\enhancedCrisisDetectionIntegrationService.ts:211:38)
        at EnhancedCrisisDetectionIntegrationService.performComprehensiveCrisisAnalysis (C:\Users\damat\_REPOS\CoreV2\src\services\enhancedCrisisDetectionIntegrationService.ts:136:45)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\tests\unit\crisisEscalationIntegration.test.ts:256:22)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at EnhancedCrisisDetectionIntegrationService.performComprehensiveCrisisAnalysis (src/services/enhancedCrisisDetectionIntegrationService.ts:149:15)
      at Object.<anonymous> (tests/unit/crisisEscalationIntegration.test.ts:256:22)

  console.log
    [Enhanced Offline Hook] Service initialized successfully

      at initializeOfflineService (src/hooks/useEnhancedOffline.ts:85:17)

  console.error
    [Enhanced Crisis Detection Integration] Analysis failed: TypeError: Cannot read properties of undefined (reading 'primaryEmotion')
        at EnhancedCrisisDetectionIntegrationService.consolidateEmotionalProfile (C:\Users\damat\_REPOS\CoreV2\src\services\enhancedCrisisDetectionIntegrationService.ts:540:33)
        at EnhancedCrisisDetectionIntegrationService.consolidateAnalysisResults (C:\Users\damat\_REPOS\CoreV2\src\services\enhancedCrisisDetectionIntegrationService.ts:234:35)
        at EnhancedCrisisDetectionIntegrationService.performComprehensiveCrisisAnalysis (C:\Users\damat\_REPOS\CoreV2\src\services\enhancedCrisisDetectionIntegrationService.ts:136:45)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\tests\unit\crisisEscalationIntegration.test.ts:279:22)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at EnhancedCrisisDetectionIntegrationService.performComprehensiveCrisisAnalysis (src/services/enhancedCrisisDetectionIntegrationService.ts:149:15)
      at Object.<anonymous> (tests/unit/crisisEscalationIntegration.test.ts:279:22)

FAIL src/hooks/usePerformanceMonitor.test.ts (10.342 s)
  usePerformanceMonitor Hook
    √ should initialize with default state (64 ms)
    √ should initialize with custom options (73 ms)
    √ should identify crisis routes correctly (6 ms)
    √ should identify non-crisis routes correctly (3 ms)
    √ should detect mobile devices correctly (3 ms)
    √ should detect desktop devices correctly (3 ms)
    √ should calculate performance scores correctly for normal pages (3 ms)
    √ should apply crisis-specific performance thresholds (3 ms)
    √ should generate appropriate recommendations for poor LCP (4 ms)
    √ should generate crisis-specific recommendations (3 ms)
    √ should monitor emergency button performance (104 ms)
    √ should detect critical performance issues in crisis scenarios (3 ms)
    √ should generate performance reports (2 ms)
    √ should get performance summary (2 ms)
    √ should identify critical performance conditions (3 ms)
    √ should not flag non-crisis pages as critical with moderate issues (2 ms)
    √ should handle mobile-specific performance considerations (2 ms)
    √ should reset metrics on route change (4 ms)
    √ should enable crisis optimization features (10 ms)
    √ should handle initialization errors gracefully (245 ms)
    √ should store performance reports locally when automatic reporting is enabled (5 ms)
    √ should limit stored reports to 50 (4 ms)
    × should handle localStorage errors gracefully (4 ms)
    √ should cleanup intervals and event listeners on unmount (235 ms)

  ● usePerformanceMonitor Hook › should handle localStorage errors gracefully

    ReferenceError: setImmediate is not defined

    [0m [90m 288 |[39m     [36mawait[39m [33mPromise[39m[33m.[39mresolve()[33m;[39m
     [90m 289 |[39m     [90m// Flush any pending promises[39m
    [31m[1m>[22m[39m[90m 290 |[39m     [36mawait[39m [36mnew[39m [33mPromise[39m(resolve [33m=>[39m setImmediate(resolve))[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 291 |[39m   }[33m;[39m
     [90m 292 |[39m   
     [90m 293 |[39m   [90m// Helper to run all timers and flush promises[39m[0m

      at src/test-utils/performanceMocks.ts:290:34
      at advanceTimersAndFlushPromises (src/test-utils/performanceMocks.ts:290:11)
      at src/hooks/usePerformanceMonitor.test.ts:475:7

  console.log
    [Enhanced Offline Hook] Service initialized successfully

      at initializeOfflineService (src/hooks/useEnhancedOffline.ts:85:17)

  console.error
    [Enhanced Crisis Detection Integration] Analysis failed: TypeError: Cannot read properties of undefined (reading 'primaryEmotion')
        at EnhancedCrisisDetectionIntegrationService.consolidateEmotionalProfile (C:\Users\damat\_REPOS\CoreV2\src\services\enhancedCrisisDetectionIntegrationService.ts:540:33)
        at EnhancedCrisisDetectionIntegrationService.consolidateAnalysisResults (C:\Users\damat\_REPOS\CoreV2\src\services\enhancedCrisisDetectionIntegrationService.ts:234:35)
        at EnhancedCrisisDetectionIntegrationService.performComprehensiveCrisisAnalysis (C:\Users\damat\_REPOS\CoreV2\src\services\enhancedCrisisDetectionIntegrationService.ts:136:45)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\tests\unit\crisisEscalationIntegration.test.ts:302:22)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at EnhancedCrisisDetectionIntegrationService.performComprehensiveCrisisAnalysis (src/services/enhancedCrisisDetectionIntegrationService.ts:149:15)
      at Object.<anonymous> (tests/unit/crisisEscalationIntegration.test.ts:302:22)

FAIL src/components/safety/__tests__/QuickExitButton.test.tsx
  ● Test suite failed to run

    TypeError: Converting circular structure to JSON
        --> starting at object with constructor 'HTMLButtonElement'
        |     property '__reactFiber$7q4cqzoj0mx' -> object with constructor 'FiberNode'
        --- property 'stateNode' closes the circle
        at stringify (<anonymous>)

      at messageParent (node_modules/jest-worker/build/workers/messageParent.js:29:19)

FAIL tests/unit/crisisEscalationIntegration.test.ts
  Crisis Escalation Integration Unit Tests
    Crisis Escalation Workflow Integration
      × should integrate crisis escalation workflow for emergency cases (222 ms)
      × should provide escalation recommendations without initiating when no userId (12 ms)
      √ should not trigger escalation for low-risk cases (7 ms)
    Escalation Error Handling
      × should handle escalation service errors gracefully (11 ms)
    Performance and Timing
      × should complete analysis and escalation quickly (7 ms)

  ● Crisis Escalation Integration Unit Tests › Crisis Escalation Workflow Integration › should integrate crisis escalation workflow for emergency cases

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 192 |[39m
     [90m 193 |[39m       [90m// Should detect crisis indicators[39m
    [31m[1m>[22m[39m[90m 194 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 195 |[39m       expect(result[33m.[39moverallSeverity)[33m.[39mtoBe([32m'emergency'[39m)[33m;[39m
     [90m 196 |[39m       expect(result[33m.[39memergencyServicesRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 197 |[39m       expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/unit/crisisEscalationIntegration.test.ts:194:42)

  ● Crisis Escalation Integration Unit Tests › Crisis Escalation Workflow Integration › should provide escalation recommendations without initiating when no userId

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 213 |[39m
     [90m 214 |[39m       [90m// Should detect crisis but not initiate escalation[39m
    [31m[1m>[22m[39m[90m 215 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 216 |[39m       expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 217 |[39m       
     [90m 218 |[39m       [90m// Should have escalation recommendations but not initiate[39m[0m

      at Object.<anonymous> (tests/unit/crisisEscalationIntegration.test.ts:215:42)

  ● Crisis Escalation Integration Unit Tests › Escalation Error Handling › should handle escalation service errors gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 283 |[39m
     [90m 284 |[39m       [90m// Should still provide crisis analysis[39m
    [31m[1m>[22m[39m[90m 285 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 286 |[39m       expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [90m// Should handle escalation error gracefully[39m[0m

      at Object.<anonymous> (tests/unit/crisisEscalationIntegration.test.ts:285:42)

  ● Crisis Escalation Integration Unit Tests › Performance and Timing › should complete analysis and escalation quickly

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 310 |[39m       expect(processingTime)[33m.[39mtoBeLessThan([35m1000[39m)[33m;[39m
     [90m 311 |[39m       expect(result[33m.[39manalysisMetadata[33m.[39mprocessingTime)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 312 |[39m       expect(result[33m.[39mescalationWorkflow[33m?[39m[33m.[39mescalationInitiated)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                              [31m[1m^[22m[39m
     [90m 313 |[39m     })[33m;[39m
     [90m 314 |[39m   })[33m;[39m
     [90m 315 |[39m })[33m;[39m[0m

      at Object.<anonymous> (tests/unit/crisisEscalationIntegration.test.ts:312:62)

  console.warn
    Sentry DSN not configured

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at initializeSentry (src/services/errorTrackingService.ts:80:13)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:424:23)

FAIL src/services/__tests__/enhancedAiCrisisDetectionService.test.ts
  enhancedAICrisisDetectionService
    AI Model Detection
      √ should detect crisis using AI model (2 ms)
      × should detect high-risk suicidal ideation
      × should identify self-harm indicators (1 ms)
      × should detect substance abuse crisis
    Natural Language Understanding
      × should understand context and nuance
      × should detect implied crisis without explicit keywords (1 ms)
      √ should handle metaphorical language
    Sentiment Analysis
      √ should analyze emotional sentiment
      √ should detect mixed emotions (1 ms)
    Temporal Analysis
      × should detect urgency markers
      √ should identify chronic vs acute crisis
    Multi-language Support
      × should detect crisis in Spanish (1 ms)
      × should handle code-switching
    Pattern Recognition
      × should identify escalation patterns (1 ms)
      √ should detect de-escalation
    Contextual Factors
      × should consider user history (1 ms)
      × should factor in protective factors
    Model Performance
      × should provide confidence scores
      √ should handle ambiguous input (1 ms)
      √ should complete analysis quickly
    Explainability
      × should provide reasoning for detection (1 ms)
      × should explain false positives

  ● enhancedAICrisisDetectionService › AI Model Detection › should detect high-risk suicidal ideation

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.8
    Received:   0

    [0m [90m 30 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text)[33m;[39m
     [90m 31 |[39m       
    [31m[1m>[22m[39m[90m 32 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeGreaterThan([35m0.8[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 33 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 34 |[39m       expect(result[33m.[39mconfidence)[33m.[39mtoBeGreaterThan([35m0.8[39m)[33m;[39m
     [90m 35 |[39m       expect(result[33m.[39mriskFactors)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:32:34)

  ● enhancedAICrisisDetectionService › AI Model Detection › should identify self-harm indicators

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.5
    Received:   0.4

    [0m [90m 42 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text)[33m;[39m
     [90m 43 |[39m       
    [31m[1m>[22m[39m[90m 44 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeGreaterThan([35m0.5[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 45 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBeDefined()[33m;[39m
     [90m 46 |[39m       expect(result[33m.[39mriskFactors)[33m.[39mtoBeDefined()[33m;[39m
     [90m 47 |[39m       expect(result[33m.[39mriskFactors[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:44:34)

  ● enhancedAICrisisDetectionService › AI Model Detection › should detect substance abuse crisis

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.7
    Received:   0.4

    [0m [90m 53 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text)[33m;[39m
     [90m 54 |[39m       
    [31m[1m>[22m[39m[90m 55 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeGreaterThan([35m0.7[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 56 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 57 |[39m       expect(result[33m.[39mriskFactors)[33m.[39mtoBeDefined()[33m;[39m
     [90m 58 |[39m       expect(result[33m.[39mrecommendations)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:55:34)

  ● enhancedAICrisisDetectionService › Natural Language Understanding › should understand context and nuance

    expect(received).toBeLessThan(expected)

    Expected: < 0.3
    Received:   0.4

    [0m [90m 66 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text)[33m;[39m
     [90m 67 |[39m       
    [31m[1m>[22m[39m[90m 68 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeLessThan([35m0.3[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 69 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 70 |[39m       expect(result[33m.[39mconfidence)[33m.[39mtoBeDefined()[33m;[39m
     [90m 71 |[39m       expect(result[33m.[39mrecommendations)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:68:34)

  ● enhancedAICrisisDetectionService › Natural Language Understanding › should detect implied crisis without explicit keywords

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.5
    Received:   0

    [0m [90m 77 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text)[33m;[39m
     [90m 78 |[39m       
    [31m[1m>[22m[39m[90m 79 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeGreaterThan([35m0.5[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 80 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBeDefined()[33m;[39m
     [90m 81 |[39m       expect(result[33m.[39memotionalState)[33m.[39mtoBeDefined()[33m;[39m
     [90m 82 |[39m       expect(result[33m.[39mriskFactors[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:79:34)

  ● enhancedAICrisisDetectionService › Temporal Analysis › should detect urgency markers

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.8
    Received:   0

    [0m [90m 125 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text)[33m;[39m
     [90m 126 |[39m       
    [31m[1m>[22m[39m[90m 127 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeGreaterThan([35m0.8[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 128 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 129 |[39m       expect(result[33m.[39mriskFactors)[33m.[39mtoBeDefined()[33m;[39m
     [90m 130 |[39m       expect(result[33m.[39mrecommendations[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:127:34)

  ● enhancedAICrisisDetectionService › Multi-language Support › should detect crisis in Spanish

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.7
    Received:   0

    [0m [90m 150 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text[33m,[39m { language[33m:[39m [32m'es'[39m })[33m;[39m
     [90m 151 |[39m       
    [31m[1m>[22m[39m[90m 152 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeGreaterThan([35m0.7[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 153 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 154 |[39m       expect(result[33m.[39mriskFactors)[33m.[39mtoBeDefined()[33m;[39m
     [90m 155 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:152:34)

  ● enhancedAICrisisDetectionService › Multi-language Support › should handle code-switching

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.5
    Received:   0.4

    [0m [90m 160 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text)[33m;[39m
     [90m 161 |[39m       
    [31m[1m>[22m[39m[90m 162 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeGreaterThan([35m0.5[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 163 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBeDefined()[33m;[39m
     [90m 164 |[39m       expect(result[33m.[39mconfidence)[33m.[39mtoBeDefined()[33m;[39m
     [90m 165 |[39m       expect(result[33m.[39mrecommendations)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:162:34)

  ● enhancedAICrisisDetectionService › Pattern Recognition › should identify escalation patterns

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.7
    Received:   0

    [0m [90m 178 |[39m       [36mconst[39m results [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(messages[33m.[39mjoin([32m' '[39m))[33m;[39m
     [90m 179 |[39m       
    [31m[1m>[22m[39m[90m 180 |[39m       expect(results[33m.[39mcrisisLevel)[33m.[39mtoBeGreaterThan([35m0.7[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 181 |[39m       expect(results[33m.[39mimmediateAction)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 182 |[39m       expect(results[33m.[39mriskFactors)[33m.[39mtoBeDefined()[33m;[39m
     [90m 183 |[39m       expect(results[33m.[39mrecommendations[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:180:35)

  ● enhancedAICrisisDetectionService › Contextual Factors › should consider user history

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.7
    Received:   0

    [0m [90m 211 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text[33m,[39m userContext)[33m;[39m
     [90m 212 |[39m       
    [31m[1m>[22m[39m[90m 213 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeGreaterThan([35m0.7[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 214 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 215 |[39m       expect(result[33m.[39mriskFactors)[33m.[39mtoBeDefined()[33m;[39m
     [90m 216 |[39m       expect(result[33m.[39mrecommendations)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:213:34)

  ● enhancedAICrisisDetectionService › Contextual Factors › should factor in protective factors

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.3
    Received:   0

    [0m [90m 225 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text[33m,[39m userContext)[33m;[39m
     [90m 226 |[39m       
    [31m[1m>[22m[39m[90m 227 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeGreaterThan([35m0.3[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 228 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeLessThan([35m0.7[39m)[33m;[39m
     [90m 229 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBeDefined()[33m;[39m
     [90m 230 |[39m       expect(result[33m.[39mrecommendations)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:227:34)

  ● enhancedAICrisisDetectionService › Model Performance › should provide confidence scores

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.7
    Received:   0.3

    [0m [90m 239 |[39m       
     [90m 240 |[39m       expect(result[33m.[39mconfidence)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 241 |[39m       expect(result[33m.[39mconfidence)[33m.[39mtoBeGreaterThan([35m0.7[39m)[33m;[39m [90m// High confidence for clear crisis[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 242 |[39m       expect(result[33m.[39mriskFactors)[33m.[39mtoBeDefined()[33m;[39m
     [90m 243 |[39m       expect(result[33m.[39mrecommendations)[33m.[39mtoBeDefined()[33m;[39m
     [90m 244 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:241:33)

  ● enhancedAICrisisDetectionService › Explainability › should provide reasoning for detection

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.8
    Received:   0.8

    [0m [90m 274 |[39m       expect(result[33m.[39mriskFactors[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m 275 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 276 |[39m       expect(result[33m.[39mconfidence)[33m.[39mtoBeGreaterThan([35m0.8[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 277 |[39m     })[33m;[39m
     [90m 278 |[39m
     [90m 279 |[39m     it([32m'should explain false positives'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:276:33)

  ● enhancedAICrisisDetectionService › Explainability › should explain false positives

    expect(received).toBeLessThan(expected)

    Expected: < 0.3
    Received:   0.4

    [0m [90m 282 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text)[33m;[39m
     [90m 283 |[39m       
    [31m[1m>[22m[39m[90m 284 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeLessThan([35m0.3[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 285 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 286 |[39m       expect(result[33m.[39mconfidence)[33m.[39mtoBeDefined()[33m;[39m
     [90m 287 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:284:34)

  console.warn
    [IntelligentCache] Storage warning: 85% used

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at IntelligentCachingService.emitStorageWarning (src/services/intelligentCachingService.ts:482:13)
      at checkQuota (src/services/intelligentCachingService.ts:355:16)
      at IntelligentCachingService.monitorStorageQuota (src/services/intelligentCachingService.ts:365:7)

FAIL src/hooks/usePrivacyAnalytics.test.ts (10.59 s)
  usePrivacyAnalytics Hook
    × should initialize with default state (52 ms)
    √ should load analytics insights on mount (162 ms)
    √ should handle insights loading errors (179 ms)
    √ should record intervention outcome successfully (11 ms)
    √ should handle intervention recording errors (4 ms)
    √ should record follow-up engagement successfully (4 ms)
    √ should handle follow-up recording errors (3 ms)
    √ should generate effectiveness report successfully (2 ms)
    √ should handle report generation errors (3 ms)
    √ should export anonymized data successfully (3 ms)
    √ should handle data export errors (2 ms)
    √ should refresh insights manually (8 ms)
    √ should reset privacy budget (3 ms)
    √ should update privacy budget after operations (2 ms)
    √ should track privacy budget exhaustion (215 ms)
    √ should handle privacy metrics errors gracefully (4 ms)
    × should maintain HIPAA compliance indicators (70 ms)
    × should handle differential privacy budget tracking (63 ms)
    × should provide cultural metrics for analysis (156 ms)
    √ should handle concurrent privacy operations safely (3 ms)

  ● usePrivacyAnalytics Hook › should initialize with default state

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 122 |[39m       retentionCompliant[33m:[39m [36mtrue[39m
     [90m 123 |[39m     })[33m;[39m
    [31m[1m>[22m[39m[90m 124 |[39m     expect(result[33m.[39mcurrent[33m.[39misLoading)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 125 |[39m     expect(result[33m.[39mcurrent[33m.[39merror)[33m.[39mtoBeNull()[33m;[39m
     [90m 126 |[39m     expect([36mtypeof[39m result[33m.[39mcurrent[33m.[39mrecordIntervention)[33m.[39mtoBe([32m'function'[39m)[33m;[39m
     [90m 127 |[39m     expect([36mtypeof[39m result[33m.[39mcurrent[33m.[39mrecordFollowUp)[33m.[39mtoBe([32m'function'[39m)[33m;[39m[0m

      at Object.<anonymous> (src/hooks/usePrivacyAnalytics.test.ts:124:38)

  ● usePrivacyAnalytics Hook › should maintain HIPAA compliance indicators

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 445 |[39m     [90m// Verify HIPAA compliance indicators[39m
     [90m 446 |[39m     expect(result[33m.[39mcurrent[33m.[39mprivacyBudget[33m.[39mretentionCompliant)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 447 |[39m     expect(result[33m.[39mcurrent[33m.[39minsights[33m?[39m[33m.[39mprivacyMetrics[33m.[39mdataRetentionCompliance)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                                             [31m[1m^[22m[39m
     [90m 448 |[39m     expect(result[33m.[39mcurrent[33m.[39minsights[33m?[39m[33m.[39mglobalMetrics[33m.[39mtotalInterventions)[33m.[39mtoBeGreaterThanOrEqual([35m0[39m)[33m;[39m
     [90m 449 |[39m   })[33m;[39m
     [90m 450 |[39m[0m

      at Object.<anonymous> (src/hooks/usePrivacyAnalytics.test.ts:447:77)

  ● usePrivacyAnalytics Hook › should handle differential privacy budget tracking

    expect(received).toBeLessThan(expected)

    Matcher error: received value must be a number or bigint

    Received has value: undefined

    [0m [90m 457 |[39m
     [90m 458 |[39m     [90m// Verify differential privacy is being tracked[39m
    [31m[1m>[22m[39m[90m 459 |[39m     expect(result[33m.[39mcurrent[33m.[39minsights[33m?[39m[33m.[39mprivacyMetrics[33m.[39mtotalBudgetConsumed)[33m.[39mtoBeLessThan([35m1.0[39m)[33m;[39m
     [90m     |[39m                                                                         [31m[1m^[22m[39m
     [90m 460 |[39m     expect(result[33m.[39mcurrent[33m.[39mprivacyBudget[33m.[39mused)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m 461 |[39m   })[33m;[39m
     [90m 462 |[39m[0m

      at Object.<anonymous> (src/hooks/usePrivacyAnalytics.test.ts:459:73)

  ● usePrivacyAnalytics Hook › should provide cultural metrics for analysis

    expect(received).toBe(expected) // Object.is equality

    Expected: "Western"
    Received: undefined

    [0m [90m 468 |[39m     })[33m;[39m
     [90m 469 |[39m
    [31m[1m>[22m[39m[90m 470 |[39m     expect(result[33m.[39mcurrent[33m.[39mculturalMetrics[[35m0[39m][33m.[39mculturalGroup)[33m.[39mtoBe([32m'Western'[39m)[33m;[39m
     [90m     |[39m                                                             [31m[1m^[22m[39m
     [90m 471 |[39m     expect(result[33m.[39mcurrent[33m.[39mculturalMetrics[[35m1[39m][33m.[39mculturalGroup)[33m.[39mtoBe([32m'Eastern'[39m)[33m;[39m
     [90m 472 |[39m     expect(result[33m.[39mcurrent[33m.[39mculturalMetrics[[35m0[39m][33m.[39msuccessRate)[33m.[39mtoBeGreaterThan([35m0.5[39m)[33m;[39m
     [90m 473 |[39m     expect(result[33m.[39mcurrent[33m.[39mculturalMetrics[[35m1[39m][33m.[39msuccessRate)[33m.[39mtoBeGreaterThan([35m0.5[39m)[33m;[39m[0m

      at Object.<anonymous> (src/hooks/usePrivacyAnalytics.test.ts:470:61)

FAIL src/components/privacy/__tests__/ConsentBanner.test.tsx (10.418 s)
  ConsentBanner
    Initial Rendering
      √ should render banner when no previous consent exists (54 ms)
      √ should not render banner when consent already exists (8 ms)
      √ should render all action buttons (101 ms)
    Accept All Functionality
      √ should call updateConsent with all permissions when Accept All is clicked (12 ms)
      √ should hide banner after accepting all (8 ms)
    Essential Only Functionality
      √ should call updateConsent with only essential permissions when Essential Only is clicked (6 ms)
      √ should hide banner after accepting essential only (9 ms)
    Preferences Modal
      √ should open preferences modal when Customize Preferences is clicked (19 ms)
      √ should render all preference options in modal (114 ms)
      √ should have required checkboxes disabled (93 ms)
      √ should allow toggling optional checkboxes (16 ms)
      √ should close modal when cancel is clicked (20 ms)
      √ should save preferences and close modal when Save Preferences is clicked (91 ms)
    Existing Consent Loading
      √ should load existing preferences when consent status exists (2 ms)
      √ should handle consent status without timestamp (3 ms)
    Accessibility
      √ should have proper heading structure (11 ms)
      √ should have properly labeled checkboxes in preferences modal (16 ms)
      √ should have appropriate ARIA attributes for required fields (8 ms)
    Edge Cases
      √ should handle analytics service returning undefined (3 ms)
      √ should work without onConsentChange callback (3 ms)
      √ should handle rapid button clicks gracefully (59 ms)
      √ should handle checkbox state changes correctly (15 ms)
    Content and Messaging
      √ should display mental health specific messaging (4 ms)
      √ should display data retention and anonymization information (4 ms)
      × should display mental health data protection notice in modal (91 ms)

  ● ConsentBanner › Content and Messaging › should display mental health data protection notice in modal

    TestingLibraryElementError: Unable to find an element with the text: Customize Privacy Preferences. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"fixed bottom-0 left-0 right-0 z-50 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"max-w-6xl mx-auto p-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex flex-col md:flex-row md:items-center md:justify-between gap-4"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex-1"[39m
              [36m>[39m
                [36m<h3[39m
                  [33mclass[39m=[32m"text-lg font-semibold text-gray-900 dark:text-white mb-2"[39m
                [36m>[39m
                  [0mPrivacy & Mental Health Data Protection[0m
                [36m</h3>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"text-sm text-gray-600 dark:text-gray-300 mb-2"[39m
                [36m>[39m
                  [0mWe use privacy-compliant analytics to improve our mental health platform while protecting your sensitive information. All data is anonymized after 7 days, and crisis intervention data is handled with the highest security standards.[0m
                [36m</p>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"text-xs text-gray-500 dark:text-gray-400"[39m
                [36m>[39m
                  [0mGDPR & HIPAA-adjacent compliant • Data retention: 30 days • Automatic anonymization: 7 days[0m
                [36m</p>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col sm:flex-row gap-2 min-w-max"[39m
              [36m>[39m
                [36m<button[39m
                  [33mclass[39m=[32m"text-xs"[39m
                  [33mdata-testid[39m=[32m"button-customize-preferences"[39m
                  [33mvariant[39m=[32m"secondary"[39m
                [36m>[39m
                  [0mCustomize Preferences[0m
                [36m</button>[39m
                [36m<button[39m
                  [33mclass[39m=[32m"text-xs"[39m
                  [33mdata-testid[39m=[32m"button-essential-only"[39m
                  [33mvariant[39m=[32m"secondary"[39m
                [36m>[39m
                  [0mEssential Only[0m
                [36m</button>[39m
                [36m<button[39m
                  [33mclass[39m=[32m"text-xs"[39m
                  [33mdata-testid[39m=[32m"button-accept-all"[39m
                  [33mvariant[39m=[32m"primary"[39m
                [36m>[39m
                  [0mAccept All[0m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
        [36m<div[39m
          [33mdata-testid[39m=[32m"modal"[39m
          [33mrole[39m=[32m"dialog"[39m
        [36m>[39m
          [36m<h2>[39m
            [0mPrivacy Preferences[0m
          [36m</h2>[39m
          [36m<button[39m
            [33mdata-testid[39m=[32m"modal-close"[39m
          [36m>[39m
            [0mClose[0m
          [36m</button>[39m
          [36m<div[39m
            [33mclass[39m=[32m"space-y-6"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"text-sm text-gray-600 dark:text-gray-300"[39m
            [36m>[39m
              [36m<p[39m
                [33mclass[39m=[32m"mb-4"[39m
              [36m>[39m
                [0mYour privacy is our priority. Customize how we collect and use data to improve your mental health platform experience.[0m
              [36m</p>[39m
              [36m<div[39m
                [33mclass[39m=[32m"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg mb-4"[39m
              [36m>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"text-xs font-medium text-blue-800 dark:text-blue-200"[39m
                [36m>[39m
                  [0m🔒 Mental Health Data Protection: Crisis intervention data is encrypted, anonymized after use, and retained only for safety analysis.[0m
                [36m</p>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"space-y-4"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-start space-x-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"[39m
              [36m>[39m
                [36m<input[39m
                  [33mchecked[39m=[32m""[39m
                  [33mclass[39m=[32m"mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 opacity-50"[39m
                  [33mdisabled[39m=[32m""[39m
                  [33mid[39m=[32m"functionality"[39m
                  [33mtype[39m=[32m"checkbox"[39m
                [36m/>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex-1"[39m
                [36m>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"text-sm font-medium text-gray-900 dark:text-white"[39m
                    [33mfor[39m=[32m"functionality"[39m
                  [36m>[39m
                    [0mEssential Functionality[0m
                    [36m<span[39m
                      [33mclass[39m=[32m"ml-2 text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded"[39m
                    [36m>[39m
                      [0mRequired[0m
                    [36m</span>[39m
                  [36m</label>[39m
                  [36m<p[39m
                    [33mclass[39m=[32m"text-xs text-gray-600 dark:text-gray-300 mt-1"[39m
                  [36m>[39m
                    [0mCore platform features, user sessions, and security. Cannot be disabled.[0m
                  [36m</p>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-start space-x-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"[39m
              [36m>[39m
                [36m<input[39m
                  [33mchecked[39m=[32m""[39m
                  [33mclass[39m=[32m"mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 opacity-50"[39m
                  [33mdisabled[39m=[32m""[39m
                  [33mid[39m=[32m"performance"[39m
                  [33mtype[39m=[32m"checkbox"[39m
                [36m/>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex-1"[39m
                [36m>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"text-sm font-medium text-gray-900 dark:text-white"[39m
                    [33mfor[39m=[32m"performance"[39m
                  [36m>[39m
                    [0mPerformance Monitoring[0m
                    [36m<span[39m
                      [33mclass[39m=[32m"ml-2 text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded"[39m
                    [36m>[39m
                      [0mRequired[0m
                    [36m</span>[39m
                  [36m</label>[39m
                  [36m<p[39m
                    [33mclass[39m=[32m"text-xs text-gray-600 dark:text-gray-300 mt-1"[39m
                  [36m>[39m
                    [0mLoad times, error tracking, and platform optimization. Essential for mental health platform reliability.[0m
                  [36m</p>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-start space-x-3 p-3 border border-gray-200 dark:border-gray-600 rounded-lg"[39m
              [36m>[39m
                [36m<input[39m
                  [33mclass[39m=[32m"mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"[39m
                  [33mid[39m=[32m"analytics"[39m
                  [33mtype[39m=[32m"checkbox"[39m
                [36m/>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex-1"[39m
                [36m>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"text-sm font-medium text-gray-900 dark:text-white"[39m
                    [33mfor[39m=[32m"analytics"[39m
                  [36m>[39m
                    [0mUsage Analytics[0m
                    [36m<span[39m
                      [33mclass[39m=[32m"ml-2 text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-1 rounded"[39m
                    [36m>[39m
                      [0mOptional[0m
                    [36m</span>[39m
                  [36m</label>[39m
                  [36m<p[39m
                    [33mclass[39m=[32m"text-xs text-gray-600 dark:text-gray-300 mt-1"[39m
                  [36m>[39m
                    [0mAnonymous usage patterns to improve mental health features. Data anonymized after 7 days.[0m
                  [36m</p>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-start space-x-3 p-3 border border-gray-200 dark:border-gray-600 rounded-lg"[39m
              [36m>[39m
                [36m<input[39m
                  [33mclass[39m=[32m"mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"[39m
                  [33mid[39m=[32m"marketing"[39m
                  [33mtype[39m=[32m"checkbox"[39m
                [36m/>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex-1"[39m
                [36m>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"text-sm font-medium text-gray-900 dark:text-white"[39m
                    [33mfor[39m=[32m"marketing"[39m
                  [36m>[39m
                    [0mMarketing Communications[0m
                    [36m<span[39m
                      [33mclass[39m=[32m"ml-2 text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-1 rounded"[39m
                    [36m>[39m
                      [0mOptional[0m
                    [36m</span>[39m
                  [36m</label>[39m
                  [36m<p[39m
                    [33mclass[39m=[32m"text-xs text-gray-600 dark:text-gray-300 mt-1"[39m
                  [36m>[39m
                    [0mPersonalized wellness tips and platform updates. No sensitive health data used.[0m
                  [36m</p>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"border-t border-gray-200 dark:border-gray-600 pt-4"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"text-xs text-gray-500 dark:text-gray-400 space-y-1"[39m
              [36m>[39m
                [36m<p>[39m
                  [0m• All data is processed according to GDPR and mental health privacy standards[0m
                [36m</p>[39m
                [36m<p>[39m
                  [0m• Crisis intervention data is encrypted and anonymized immediately after use[0m
                [36m</p>[39m
                [36m<p>[39m
                  [0m• You can change these preferences anytime in your privacy settings[0m
                [36m</p>[39m
                [36m<p>[39m
                  [0m• Data is automatically purged after 90 days maximum[0m
                [36m</p>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex justify-end space-x-3"[39m
            [36m>[39m
              [36m<button[39m
                [33mdata-testid[39m=[32m"button-cancel"[39m
                [33mvariant[39m=[32m"secondary"[39m
              [36m>[39m
                [0mCancel[0m
              [36m</button>[39m
              [36m<button[39m
                [33mdata-testid[39m=[32m"button-save-preferences"[39m
                [33mvariant[39m=[32m"primary"[39m
              [36m>[39m
                [0mSave Preferences[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 463 |[39m       
     [90m 464 |[39m       [90m// Check for the modal title and content that exists[39m
    [31m[1m>[22m[39m[90m 465 |[39m       expect(screen[33m.[39mgetByText([32m'Customize Privacy Preferences'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 466 |[39m       [90m// Check for actual content in the preferences modal[39m
     [90m 467 |[39m       expect(screen[33m.[39mgetByLabelText([35m/Essential Functionality/[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m 468 |[39m     })[33m;[39m[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/privacy/__tests__/ConsentBanner.test.tsx:465:21)

  console.warn
    [IntelligentCache] Storage warning: 85% used

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at IntelligentCachingService.emitStorageWarning (src/services/intelligentCachingService.ts:482:13)
      at checkQuota (src/services/intelligentCachingService.ts:355:16)
      at IntelligentCachingService.monitorStorageQuota (src/services/intelligentCachingService.ts:365:7)

FAIL tests/integration/crisis-detection-validation.test.ts
  Crisis Detection and Escalation System
    Basic Crisis Detection
      × detects explicit crisis keywords (1 ms)
      × detects implicit crisis signals
      × handles euphemisms and indirect language
    Multilingual Crisis Detection
      × detects crisis in Spanish
      × detects crisis in French
      × detects crisis in Mandarin
    Context-Aware Analysis
      × analyzes conversation context (1 ms)
      × detects rapid mood deterioration
      × identifies crisis patterns in journal entries
    Crisis Escalation Workflow
      × escalates to emergency services for critical risk
      × notifies support network for high risk
      × provides immediate resources for medium risk (1 ms)
      × tracks intervention effectiveness
    False Positive Prevention
      × does not flag normal negative emotions (1 ms)
      × distinguishes crisis from creative writing
      × handles sarcasm and humor appropriately
    Privacy and Consent
      × anonymizes data before analysis
      × respects user consent preferences
      × maintains audit trail for interventions (1 ms)
    Performance and Reliability
      × responds within acceptable time limits
      × handles high volume of concurrent requests
      × gracefully handles service failures (1 ms)
      × maintains accuracy under edge cases
    Integration with Support Systems
      × integrates with AI counseling service (1 ms)
      × coordinates with human support team
      × provides culturally appropriate resources (1 ms)

  ● Crisis Detection and Escalation System › Basic Crisis Detection › detects explicit crisis keywords

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Basic Crisis Detection › detects implicit crisis signals

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Basic Crisis Detection › handles euphemisms and indirect language

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Multilingual Crisis Detection › detects crisis in Spanish

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Multilingual Crisis Detection › detects crisis in French

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Multilingual Crisis Detection › detects crisis in Mandarin

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Context-Aware Analysis › analyzes conversation context

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Context-Aware Analysis › detects rapid mood deterioration

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Context-Aware Analysis › identifies crisis patterns in journal entries

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Crisis Escalation Workflow › escalates to emergency services for critical risk

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Crisis Escalation Workflow › notifies support network for high risk

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Crisis Escalation Workflow › provides immediate resources for medium risk

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Crisis Escalation Workflow › tracks intervention effectiveness

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › False Positive Prevention › does not flag normal negative emotions

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › False Positive Prevention › distinguishes crisis from creative writing

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › False Positive Prevention › handles sarcasm and humor appropriately

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Privacy and Consent › anonymizes data before analysis

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Privacy and Consent › respects user consent preferences

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Privacy and Consent › maintains audit trail for interventions

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Performance and Reliability › responds within acceptable time limits

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Performance and Reliability › handles high volume of concurrent requests

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Performance and Reliability › gracefully handles service failures

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Performance and Reliability › maintains accuracy under edge cases

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Integration with Support Systems › integrates with AI counseling service

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Integration with Support Systems › coordinates with human support team

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Integration with Support Systems › provides culturally appropriate resources

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  console.error
    [Cultural Crisis Detection] Failed to log analytics: TypeError: privacyPreservingAnalyticsService_1.privacyPreservingAnalyticsService.recordInterventionOutcome is not a function
        at CulturalCrisisDetectionService.logCulturalAnalytics (C:\Users\damat\_REPOS\CoreV2\src\services\culturalCrisisDetectionService.ts:736:47)
        at CulturalCrisisDetectionService.analyzeCrisisWithCulturalContext (C:\Users\damat\_REPOS\CoreV2\src\services\culturalCrisisDetectionService.ts:418:16)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at async Promise.all (index 2)
        at EnhancedCrisisDetectionIntegrationService.performComprehensiveCrisisAnalysis (C:\Users\damat\_REPOS\CoreV2\src\services\enhancedCrisisDetectionIntegrationService.ts:117:63)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\tests\integration\crisisDetectionEscalationIntegration.test.ts:22:22)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at CulturalCrisisDetectionService.logCulturalAnalytics (src/services/culturalCrisisDetectionService.ts:749:15)
      at CulturalCrisisDetectionService.analyzeCrisisWithCulturalContext (src/services/culturalCrisisDetectionService.ts:418:16)
          at async Promise.all (index 2)
      at EnhancedCrisisDetectionIntegrationService.performComprehensiveCrisisAnalysis (src/services/enhancedCrisisDetectionIntegrationService.ts:117:63)
      at Object.<anonymous> (tests/integration/crisisDetectionEscalationIntegration.test.ts:22:22)

  console.error
    Enhanced crisis detection failed, falling back to basic: Error: Service unavailable
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\services\__tests__\optimizedAIService.test.ts:104:97)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at Object.analyze (src/services/optimizedAIService.ts:102:21)
      at Object.<anonymous> (src/services/__tests__/optimizedAIService.test.ts:107:22)

  console.error
    [Cultural Crisis Detection] Failed to log analytics: TypeError: privacyPreservingAnalyticsService_1.privacyPreservingAnalyticsService.recordInterventionOutcome is not a function
        at CulturalCrisisDetectionService.logCulturalAnalytics (C:\Users\damat\_REPOS\CoreV2\src\services\culturalCrisisDetectionService.ts:736:47)
        at CulturalCrisisDetectionService.analyzeCrisisWithCulturalContext (C:\Users\damat\_REPOS\CoreV2\src\services\culturalCrisisDetectionService.ts:418:16)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at async Promise.all (index 2)
        at EnhancedCrisisDetectionIntegrationService.performComprehensiveCrisisAnalysis (C:\Users\damat\_REPOS\CoreV2\src\services\enhancedCrisisDetectionIntegrationService.ts:117:63)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\tests\integration\crisisDetectionEscalationIntegration.test.ts:50:22)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at CulturalCrisisDetectionService.logCulturalAnalytics (src/services/culturalCrisisDetectionService.ts:749:15)
      at CulturalCrisisDetectionService.analyzeCrisisWithCulturalContext (src/services/culturalCrisisDetectionService.ts:418:16)
          at async Promise.all (index 2)
      at EnhancedCrisisDetectionIntegrationService.performComprehensiveCrisisAnalysis (src/services/enhancedCrisisDetectionIntegrationService.ts:117:63)
      at Object.<anonymous> (tests/integration/crisisDetectionEscalationIntegration.test.ts:50:22)

FAIL src/services/__tests__/errorTrackingService.test.ts
  Error Tracking Service (Vite Version)
    Environment detection
      × should detect production environment correctly (137 ms)
      × should detect development environment correctly (88 ms)
      × should use environment DSN when available (8 ms)
    Vite-specific configuration
      √ should handle missing import.meta gracefully (10 ms)
      √ should handle missing env variables gracefully (55 ms)
      × should default to development behavior when env is unclear (11 ms)
    Error sanitization (Vite version)
      × should work identically to non-Vite version (7 ms)
      × should sanitize Vite-specific error patterns (6 ms)
    Mental health specific error tracking
      × should track crisis-related errors with appropriate sensitivity (1 ms)
      × should handle therapy session errors sensitively (27 ms)
      × should track mood tracking errors (1 ms)
      × should track safety plan errors with high priority (1 ms)
      × should track community moderation errors (1 ms)
    User action tracking
      × should track emergency resource access (1 ms)
      × should track helper response actions (1 ms)
      × should track safety plan activations (1 ms)
    Context and breadcrumb management
      × should set appropriate user context for seekers (1 ms)
      × should set appropriate user context for helpers
      × should add crisis-related breadcrumbs (3 ms)
      √ should add therapy session breadcrumbs
    Performance and reliability
      × should handle high volume of error tracking (2 ms)
      × should handle malformed error objects (5 ms)
      × should handle circular references in context (5 ms)
    Privacy compliance edge cases
      × should handle deeply nested sensitive data (1 ms)
      × should handle URLs with sensitive query parameters (9 ms)
      × should maintain error context while protecting privacy (1 ms)

  ● Error Tracking Service (Vite Version) › Environment detection › should detect production environment correctly

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"tracesSampleRate": 0.1}

    Number of calls: 0

    [0m [90m 53 |[39m       initializeSentry()[33m;[39m
     [90m 54 |[39m
    [31m[1m>[22m[39m[90m 55 |[39m       expect([33mSentry[39m[33m.[39minit)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                           [31m[1m^[22m[39m
     [90m 56 |[39m         expect[33m.[39mobjectContaining({
     [90m 57 |[39m           tracesSampleRate[33m:[39m [35m0.1[39m
     [90m 58 |[39m         })[0m

      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:55:27)

  ● Error Tracking Service (Vite Version) › Environment detection › should detect development environment correctly

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"tracesSampleRate": 1}

    Number of calls: 0

    [0m [90m 66 |[39m       initializeSentry()[33m;[39m
     [90m 67 |[39m
    [31m[1m>[22m[39m[90m 68 |[39m       expect([33mSentry[39m[33m.[39minit)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                           [31m[1m^[22m[39m
     [90m 69 |[39m         expect[33m.[39mobjectContaining({
     [90m 70 |[39m           tracesSampleRate[33m:[39m [35m1.0[39m
     [90m 71 |[39m         })[0m

      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:68:27)

  ● Error Tracking Service (Vite Version) › Environment detection › should use environment DSN when available

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"dsn": "https://env-dsn@sentry.io/789"}

    Number of calls: 0

    [0m [90m 79 |[39m       initializeSentry()[33m;[39m
     [90m 80 |[39m
    [31m[1m>[22m[39m[90m 81 |[39m       expect([33mSentry[39m[33m.[39minit)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                           [31m[1m^[22m[39m
     [90m 82 |[39m         expect[33m.[39mobjectContaining({
     [90m 83 |[39m           dsn[33m:[39m envDsn
     [90m 84 |[39m         })[0m

      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:81:27)

  ● Error Tracking Service (Vite Version) › Vite-specific configuration › should default to development behavior when env is unclear

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 119 |[39m
     [90m 120 |[39m       [90m// Should default to development-like behavior[39m
    [31m[1m>[22m[39m[90m 121 |[39m       expect([33mSentry[39m[33m.[39minit)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 122 |[39m     })[33m;[39m
     [90m 123 |[39m   })[33m;[39m
     [90m 124 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:121:27)

  ● Error Tracking Service (Vite Version) › Error sanitization (Vite version) › should work identically to non-Vite version

    TypeError: Cannot read properties of undefined (reading '0')

    [0m [90m 127 |[39m       initializeSentry()[33m;[39m
     [90m 128 |[39m       
    [31m[1m>[22m[39m[90m 129 |[39m       [36mconst[39m beforeSendFn [33m=[39m ([33mSentry[39m[33m.[39minit [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmock[33m.[39mcalls[[35m0[39m][[35m0[39m][33m.[39mbeforeSend[33m;[39m
     [90m     |[39m                                                                    [31m[1m^[22m[39m
     [90m 130 |[39m       
     [90m 131 |[39m       [36mconst[39m error [33m=[39m [36mnew[39m [33mError[39m([32m'Authentication failed with token: abc123'[39m)[33m;[39m
     [90m 132 |[39m       [36mconst[39m event [33m=[39m {[0m

      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:129:68)

  ● Error Tracking Service (Vite Version) › Error sanitization (Vite version) › should sanitize Vite-specific error patterns

    TypeError: Cannot read properties of undefined (reading '0')

    [0m [90m 146 |[39m       initializeSentry()[33m;[39m
     [90m 147 |[39m       
    [31m[1m>[22m[39m[90m 148 |[39m       [36mconst[39m beforeSendFn [33m=[39m ([33mSentry[39m[33m.[39minit [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmock[33m.[39mcalls[[35m0[39m][[35m0[39m][33m.[39mbeforeSend[33m;[39m
     [90m     |[39m                                                                    [31m[1m^[22m[39m
     [90m 149 |[39m       
     [90m 150 |[39m       [36mconst[39m error [33m=[39m [36mnew[39m [33mError[39m([32m'Vite HMR failed to update module with session data'[39m)[33m;[39m
     [90m 151 |[39m       [36mconst[39m event [33m=[39m {[0m

      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:148:68)

  ● Error Tracking Service (Vite Version) › Mental health specific error tracking › should track crisis-related errors with appropriate sensitivity

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:174:28)

  ● Error Tracking Service (Vite Version) › Mental health specific error tracking › should handle therapy session errors sensitively

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at Function.captureCrisisError (src/services/errorTrackingService.ts:212:10)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:183:28)

  ● Error Tracking Service (Vite Version) › Mental health specific error tracking › should track mood tracking errors

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:205:28)

  ● Error Tracking Service (Vite Version) › Mental health specific error tracking › should track safety plan errors with high priority

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:220:28)

  ● Error Tracking Service (Vite Version) › Mental health specific error tracking › should track community moderation errors

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:235:28)

  ● Error Tracking Service (Vite Version) › User action tracking › should track emergency resource access

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at Function.captureUserActionError (src/services/errorTrackingService.ts:235:10)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:243:28)

  ● Error Tracking Service (Vite Version) › User action tracking › should track helper response actions

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at Function.captureUserActionError (src/services/errorTrackingService.ts:235:10)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:252:28)

  ● Error Tracking Service (Vite Version) › User action tracking › should track safety plan activations

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at Function.captureUserActionError (src/services/errorTrackingService.ts:235:10)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:261:28)

  ● Error Tracking Service (Vite Version) › Context and breadcrumb management › should set appropriate user context for seekers

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"id": "seeker-123", "userType": "seeker"}
    Received: {"id": "[USER_ID]"}

    Number of calls: 1

    [0m [90m 276 |[39m       })[33m;[39m
     [90m 277 |[39m
    [31m[1m>[22m[39m[90m 278 |[39m       expect([33mSentry[39m[33m.[39msetUser)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 279 |[39m         expect[33m.[39mobjectContaining({
     [90m 280 |[39m           id[33m:[39m [32m'seeker-123'[39m[33m,[39m
     [90m 281 |[39m           userType[33m:[39m [32m'seeker'[39m[0m

      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:278:30)

  ● Error Tracking Service (Vite Version) › Context and breadcrumb management › should set appropriate user context for helpers

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"id": "helper-789", "userType": "helper"}
    Received: {"id": "[USER_ID]"}

    Number of calls: 1

    [0m [90m 292 |[39m       })[33m;[39m
     [90m 293 |[39m
    [31m[1m>[22m[39m[90m 294 |[39m       expect([33mSentry[39m[33m.[39msetUser)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 295 |[39m         expect[33m.[39mobjectContaining({
     [90m 296 |[39m           id[33m:[39m [32m'helper-789'[39m[33m,[39m
     [90m 297 |[39m           userType[33m:[39m [32m'helper'[39m[0m

      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:294:30)

  ● Error Tracking Service (Vite Version) › Context and breadcrumb management › should add crisis-related breadcrumbs

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

    @@ -7,6 +7,7 @@
          ],
          "model_version": "v2.1",
        },
        "level": "warning",
        "message": "Crisis keywords detected in user input",
    +   "timestamp": 1755460724.295,
      },

    Number of calls: 1

    [0m [90m 312 |[39m       )[33m;[39m
     [90m 313 |[39m
    [31m[1m>[22m[39m[90m 314 |[39m       expect([33mSentry[39m[33m.[39maddBreadcrumb)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 315 |[39m         message[33m:[39m [32m'Crisis keywords detected in user input'[39m[33m,[39m
     [90m 316 |[39m         category[33m:[39m [32m'crisis-detection'[39m[33m,[39m
     [90m 317 |[39m         level[33m:[39m [32m'warning'[39m[33m,[39m[0m

      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:314:36)

  ● Error Tracking Service (Vite Version) › Performance and reliability › should handle high volume of error tracking

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at src/services/__tests__/errorTrackingService.test.ts:356:30
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:355:14)

  ● Error Tracking Service (Vite Version) › Performance and reliability › should handle malformed error objects

    expect(received).not.toThrow()

    Error name:    "TypeError"
    Error message: "scope.setExtra is not a function"

        [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
         [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
        [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
         [90m     |[39m               [31m[1m^[22m[39m
         [90m 194 |[39m       }
         [90m 195 |[39m
         [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at src/services/__tests__/errorTrackingService.test.ts:374:30
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:379:14)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:379:14)

  ● Error Tracking Service (Vite Version) › Performance and reliability › should handle circular references in context

    expect(received).not.toThrow()

    Error name:    "TypeError"
    Error message: "scope.setExtra is not a function"

        [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
         [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
        [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
         [90m     |[39m               [31m[1m^[22m[39m
         [90m 194 |[39m       }
         [90m 195 |[39m
         [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at src/services/__tests__/errorTrackingService.test.ts:387:30
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:392:14)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:392:14)

  ● Error Tracking Service (Vite Version) › Privacy compliance edge cases › should handle deeply nested sensitive data

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:412:28)

  ● Error Tracking Service (Vite Version) › Privacy compliance edge cases › should handle URLs with sensitive query parameters

    TypeError: Cannot read properties of undefined (reading '0')

    [0m [90m 423 |[39m       
     [90m 424 |[39m       initializeSentry()[33m;[39m
    [31m[1m>[22m[39m[90m 425 |[39m       [36mconst[39m beforeSendFn [33m=[39m ([33mSentry[39m[33m.[39minit [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmock[33m.[39mcalls[[35m0[39m][[35m0[39m][33m.[39mbeforeSend[33m;[39m
     [90m     |[39m                                                                    [31m[1m^[22m[39m
     [90m 426 |[39m       
     [90m 427 |[39m       [36mconst[39m event [33m=[39m {
     [90m 428 |[39m         message[33m:[39m error[33m.[39mmessage[33m,[39m[0m

      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:425:68)

  ● Error Tracking Service (Vite Version) › Privacy compliance edge cases › should maintain error context while protecting privacy

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:449:28)

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:233:13)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:233:13)

  console.log
    [Enhanced Offline Hook] Service initialized successfully

      at initializeOfflineService (src/hooks/useEnhancedOffline.ts:85:17)

FAIL src/contexts/__tests__/NotificationContext.test.tsx
  NotificationContext
    NotificationProvider
      √ should provide default values (11 ms)
      × should add toast notifications (6 ms)
      × should remove toast notifications (7 ms)
      × should handle multiple toasts (4 ms)
      × should show confirmation modal (3 ms)
      × should hide confirmation modal (3 ms)
      √ should generate unique IDs for toasts (3 ms)
      × should use default toast type when not specified (4 ms)
    useNotification hook
      √ should throw error when used outside provider (106 ms)
      √ should return notification context when used within provider (3 ms)

  ● NotificationContext › NotificationProvider › should add toast notifications

    expect(element).toHaveTextContent()

    Expected element to have text content:
      Test message - success
    Received:

    [0m [90m 70 |[39m       })[33m;[39m
     [90m 71 |[39m
    [31m[1m>[22m[39m[90m 72 |[39m       expect(screen[33m.[39mgetByTestId([32m'toasts'[39m))[33m.[39mtoHaveTextContent([32m'Test message - success'[39m)[33m;[39m
     [90m    |[39m                                            [31m[1m^[22m[39m
     [90m 73 |[39m     })[33m;[39m
     [90m 74 |[39m
     [90m 75 |[39m     it([32m'should remove toast notifications'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/contexts/__tests__/NotificationContext.test.tsx:72:44)

  ● NotificationContext › NotificationProvider › should remove toast notifications

    TestingLibraryElementError: Unable to find an element with the text: Test message. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div>[39m
          [36m<button>[39m
            [0mAdd Toast[0m
          [36m</button>[39m
          [36m<div[39m
            [33mdata-testid[39m=[32m"toasts"[39m
          [36m/>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 104 |[39m       })[33m;[39m
     [90m 105 |[39m
    [31m[1m>[22m[39m[90m 106 |[39m       expect(screen[33m.[39mgetByText([32m'Test message'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 107 |[39m
     [90m 108 |[39m       [90m// Remove the toast[39m
     [90m 109 |[39m       act(() [33m=>[39m {[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/contexts/__tests__/NotificationContext.test.tsx:106:21)

  ● NotificationContext › NotificationProvider › should handle multiple toasts

    expect(element).toHaveTextContent()

    Expected element to have text content:
      1
    Received:
      0

    [0m [90m 140 |[39m         screen[33m.[39mgetByText([32m'Add First'[39m)[33m.[39mclick()[33m;[39m
     [90m 141 |[39m       })[33m;[39m
    [31m[1m>[22m[39m[90m 142 |[39m       expect(screen[33m.[39mgetByTestId([32m'toast-count'[39m))[33m.[39mtoHaveTextContent([32m'1'[39m)[33m;[39m
     [90m     |[39m                                                 [31m[1m^[22m[39m
     [90m 143 |[39m
     [90m 144 |[39m       act(() [33m=>[39m {
     [90m 145 |[39m         screen[33m.[39mgetByText([32m'Add Second'[39m)[33m.[39mclick()[33m;[39m[0m

      at Object.<anonymous> (src/contexts/__tests__/NotificationContext.test.tsx:142:49)

  ● NotificationContext › NotificationProvider › should show confirmation modal

    TestingLibraryElementError: Unable to find an element by: [data-testid="modal"]

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div>[39m
          [36m<button>[39m
            [0mShow Modal[0m
          [36m</button>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 190 |[39m       })[33m;[39m
     [90m 191 |[39m
    [31m[1m>[22m[39m[90m 192 |[39m       expect(screen[33m.[39mgetByTestId([32m'modal'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 193 |[39m       expect(screen[33m.[39mgetByText([32m'Confirm Action'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m 194 |[39m       expect(screen[33m.[39mgetByText([32m'Are you sure?'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m 195 |[39m     })[33m;[39m[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/contexts/__tests__/NotificationContext.test.tsx:192:21)

  ● NotificationContext › NotificationProvider › should hide confirmation modal

    expect(element).toHaveTextContent()

    Expected element to have text content:
      Visible
    Received:
      Hidden

    [0m [90m 231 |[39m         screen[33m.[39mgetByText([32m'Show'[39m)[33m.[39mclick()[33m;[39m
     [90m 232 |[39m       })[33m;[39m
    [31m[1m>[22m[39m[90m 233 |[39m       expect(screen[33m.[39mgetByTestId([32m'modal-status'[39m))[33m.[39mtoHaveTextContent([32m'Visible'[39m)[33m;[39m
     [90m     |[39m                                                  [31m[1m^[22m[39m
     [90m 234 |[39m
     [90m 235 |[39m       [90m// Hide modal[39m
     [90m 236 |[39m       act(() [33m=>[39m {[0m

      at Object.<anonymous> (src/contexts/__tests__/NotificationContext.test.tsx:233:50)

  ● NotificationContext › NotificationProvider › should use default toast type when not specified

    TestingLibraryElementError: Unable to find an element by: [data-testid="toast-type"]

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div>[39m
          [36m<button>[39m
            [0mAdd Default[0m
          [36m</button>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 302 |[39m       })[33m;[39m
     [90m 303 |[39m
    [31m[1m>[22m[39m[90m 304 |[39m       expect(screen[33m.[39mgetByTestId([32m'toast-type'[39m))[33m.[39mtoHaveTextContent([32m'info'[39m)[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 305 |[39m     })[33m;[39m
     [90m 306 |[39m   })[33m;[39m
     [90m 307 |[39m[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/contexts/__tests__/NotificationContext.test.tsx:304:21)

FAIL src/services/__tests__/crisisDetectionIntegrationService.test.ts
  CrisisDetectionIntegrationService
    Integrated Crisis Analysis
      √ should integrate multiple detection services (99 ms)
      × should detect crisis from multiple sources (5 ms)
      √ should handle cultural context in integration (74 ms)
      × should provide consensus-based severity (2 ms)
    Escalation Decisions
      × should recommend escalation for high-risk cases (1 ms)
      √ should not escalate false positives (1 ms)
    Multi-Model Consensus
      √ should aggregate results from all detection models (1 ms)
      √ should handle model disagreements (11 ms)
    Response Generation
      × should generate appropriate crisis response (2 ms)
      × should include safety plan in response (1 ms)
    Performance and Reliability
      √ should handle service failures gracefully (1 ms)
      √ should complete analysis within timeout (1 ms)
      √ should cache recent analyses (2 ms)
    Audit Trail
      √ should log all crisis detections (1 ms)
      √ should track intervention recommendations (2 ms)

  ● CrisisDetectionIntegrationService › Integrated Crisis Analysis › should detect crisis from multiple sources

    expect(received).toBe(expected) // Object.is equality

    Expected: "critical"
    Received: "emergency"

    [0m [90m 38 |[39m       
     [90m 39 |[39m       expect(result[33m.[39misCrisis)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 40 |[39m       expect(result[33m.[39mseverity)[33m.[39mtoBe([32m'critical'[39m)[33m;[39m
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 41 |[39m       expect(result[33m.[39mscore)[33m.[39mtoBeGreaterThan([35m0.8[39m)[33m;[39m
     [90m 42 |[39m       expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 43 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetectionIntegrationService.test.ts:40:31)

  ● CrisisDetectionIntegrationService › Integrated Crisis Analysis › should provide consensus-based severity

    expect(received).toContain(expected) // indexOf

    Expected value: "low"
    Received array: ["high", "critical"]

    [0m [90m 64 |[39m       
     [90m 65 |[39m       expect(result[33m.[39mseverity)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 66 |[39m       expect([[32m'high'[39m[33m,[39m [32m'critical'[39m])[33m.[39mtoContain(result[33m.[39mseverity)[33m;[39m
     [90m    |[39m                                    [31m[1m^[22m[39m
     [90m 67 |[39m     })[33m;[39m
     [90m 68 |[39m   })[33m;[39m
     [90m 69 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetectionIntegrationService.test.ts:66:36)

  ● CrisisDetectionIntegrationService › Escalation Decisions › should recommend escalation for high-risk cases

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 77 |[39m       )[33m;[39m
     [90m 78 |[39m       
    [31m[1m>[22m[39m[90m 79 |[39m       expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m    |[39m                                         [31m[1m^[22m[39m
     [90m 80 |[39m       expect(result[33m.[39memergencyServicesRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 81 |[39m       expect(result[33m.[39minterventionRecommendations)[33m.[39mtoBeDefined()[33m;[39m
     [90m 82 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetectionIntegrationService.test.ts:79:41)

  ● CrisisDetectionIntegrationService › Response Generation › should generate appropriate crisis response

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 134 |[39m       
     [90m 135 |[39m       expect(result[33m.[39minterventionRecommendations)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 136 |[39m       expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                         [31m[1m^[22m[39m
     [90m 137 |[39m       expect([[32m'high'[39m[33m,[39m [32m'critical'[39m])[33m.[39mtoContain(result[33m.[39mseverity)[33m;[39m
     [90m 138 |[39m       expect(result[33m.[39misCrisis)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 139 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetectionIntegrationService.test.ts:136:41)

  ● CrisisDetectionIntegrationService › Response Generation › should include safety plan in response

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 149 |[39m       expect(result[33m.[39minterventionRecommendations)[33m.[39mtoBeDefined()[33m;[39m
     [90m 150 |[39m       expect(result[33m.[39mescalationResponse)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 151 |[39m       expect(result[33m.[39misCrisis)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 152 |[39m     })[33m;[39m
     [90m 153 |[39m   })[33m;[39m
     [90m 154 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetectionIntegrationService.test.ts:151:31)

  console.warn
    [IntelligentCache] Storage warning: 85% used

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at IntelligentCachingService.emitStorageWarning (src/services/intelligentCachingService.ts:482:13)
      at checkQuota (src/services/intelligentCachingService.ts:355:16)
      at IntelligentCachingService.monitorStorageQuota (src/services/intelligentCachingService.ts:365:7)

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at commitRootImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26974:5)
        at commitRoot (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26721:5)
        at performSyncWorkOnRoot (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26156:3)
        at flushSyncCallbacks (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:12042:22)
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at Object.eventWrapper (C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\pure.js:107:28)
        at fireEvent (C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\dom\dist\events.js:12:35)
        at Function.fireEvent.<computed> [as click] (C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\dom\dist\events.js:110:36)
        at Function.fireEvent.<computed> [as click] (C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\fire-event.js:15:52)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:249:17)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at commitRootImpl (node_modules/react-dom/cjs/react-dom.development.js:26974:5)
      at commitRoot (node_modules/react-dom/cjs/react-dom.development.js:26721:5)
      at performSyncWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:26156:3)
      at flushSyncCallbacks (node_modules/react-dom/cjs/react-dom.development.js:12042:22)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.eventWrapper (node_modules/@testing-library/react/dist/pure.js:107:28)
      at fireEvent (node_modules/@testing-library/dom/dist/events.js:12:35)
      at Function.fireEvent.<computed> [as click] (node_modules/@testing-library/dom/dist/events.js:110:36)
      at Function.fireEvent.<computed> [as click] (node_modules/@testing-library/react/dist/fire-event.js:15:52)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:249:17)

  console.error
    [Cultural Crisis Detection] Failed to log analytics: TypeError: privacyPreservingAnalyticsService_1.privacyPreservingAnalyticsService.recordInterventionOutcome is not a function
        at CulturalCrisisDetectionService.logCulturalAnalytics (C:\Users\damat\_REPOS\CoreV2\src\services\culturalCrisisDetectionService.ts:736:47)
        at CulturalCrisisDetectionService.analyzeCrisisWithCulturalContext (C:\Users\damat\_REPOS\CoreV2\src\services\culturalCrisisDetectionService.ts:418:16)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at async Promise.all (index 2)
        at EnhancedCrisisDetectionIntegrationService.performComprehensiveCrisisAnalysis (C:\Users\damat\_REPOS\CoreV2\src\services\enhancedCrisisDetectionIntegrationService.ts:117:63)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\tests\integration\crisisDetectionEscalationIntegration.test.ts:95:22)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at CulturalCrisisDetectionService.logCulturalAnalytics (src/services/culturalCrisisDetectionService.ts:749:15)
      at CulturalCrisisDetectionService.analyzeCrisisWithCulturalContext (src/services/culturalCrisisDetectionService.ts:418:16)
          at async Promise.all (index 2)
      at EnhancedCrisisDetectionIntegrationService.performComprehensiveCrisisAnalysis (src/services/enhancedCrisisDetectionIntegrationService.ts:117:63)
      at Object.<anonymous> (tests/integration/crisisDetectionEscalationIntegration.test.ts:95:22)

PASS src/services/__tests__/optimizedAIService.test.ts
  AIServiceManager
    getCrisisDetectionService
      √ should return a crisis detection service (2 ms)
      √ should analyze text for crisis indicators (18 ms)
      √ should use basic detection when useAdvanced is false (1 ms)
      √ should handle errors in enhanced crisis detection (160 ms)
      √ should cache the service instance
    getAdvancedAIService
      √ should throw error when device does not support advanced AI (6 ms)
      √ should return advanced AI service when available (103 ms)
    preloadCriticalServices
      √ should preload critical services during idle time (2 ms)
      √ should handle preload failures gracefully (10 ms)
      √ should not crash when requestIdleCallback is not available
    lazyLoader through createLazyAIService
      √ should lazy load TensorFlow when needed (1 ms)
      √ should handle TensorFlow loading failures (1 ms)
      √ should return null for Natural NLP (not installed) (1 ms)
      √ should return null for sentiment analysis (disabled)
    service singleton behavior
      √ should use the same instance across imports
      √ should maintain state across method calls (1 ms)

PASS src/services/__tests__/webAuthService.test.ts
  WebAuthSession
    makeRedirectUri
      √ should return the correct redirect URI (1 ms)
      √ should work with different origins
    useAutoDiscovery
      √ should generate correct OAuth endpoints (1 ms)
      √ should handle domains without protocol
    ResponseType
      √ should have correct response type constants (1 ms)
    useAuthRequest
      √ should return a request object with correct URL (2 ms)
      √ should handle missing extraParams (1 ms)
      √ should return null response when no URL hash present (1 ms)
      √ should parse a successful auth response from the URL hash (1 ms)
      √ should parse an error auth response from the URL hash
      √ should handle error response without description (71 ms)
      √ should provide promptAsync function that redirects (2 ms)
      √ should generate different state values for different requests (2 ms)
    exchangeCodeAsync
      √ should return a mock access token (1 ms)
      √ should handle empty config
    integration scenarios
      √ should handle complete OAuth flow simulation (2 ms)
      √ should handle error scenarios in OAuth flow (1 ms)
      √ should handle multiple authentication attempts (1 ms)

PASS tests/service-worker/cache-strategies.test.ts
  Service Worker Cache Strategies
    Crisis Resources Cache (Cache First)
      √ should cache crisis resources with highest priority (2 ms)
      √ should serve crisis resources from cache first (1 ms)
      √ should return undefined for cache miss
      √ should handle cache storage errors gracefully (85 ms)
    Offline Pages Cache
      √ should cache offline fallback pages
      √ should serve offline page when network fails (1 ms)
      √ should prioritize crisis offline page for crisis routes (1 ms)
    API Cache (Network First)
      √ should cache API responses
      √ should serve cached API response when network fails (1 ms)
      √ should handle network timeout for API calls (185 ms)
    Image Cache (Stale While Revalidate)
      √ should cache images (1 ms)
      √ should serve cached images immediately (1 ms)
    Cache Management
      √ should list all cached requests (1 ms)
      √ should delete specific cache entries (1 ms)
      √ should handle cache deletion failures
      √ should check if cache exists
      √ should get all cache names (1 ms)
      √ should delete entire cache
    Cache Size Management
      √ should respect maximum cache size limits
      √ should implement cache eviction for API cache (1 ms)

  console.warn
    EncryptionService: Browser does not support required cryptographic operations

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at EncryptionService.checkBrowserSupport (src/services/encryptionService.ts:151:15)
      at new EncryptionService (src/services/encryptionService.ts:135:10)
      at getEncryptionService (src/services/encryptionService.ts:797:33)
      at new SecureStorageService (src/services/secureStorageService.ts:23:51)
      at getSecureStorage (src/services/secureStorageService.ts:509:29)
      at MoodAnalysisService.getMoodHistory (src/services/moodAnalysisService.ts:450:27)
      at Object.<anonymous> (src/services/__tests__/moodAnalysisService.test.ts:216:23)

PASS src/services/__tests__/multilingualCrisisDetectionService.test.ts
  MultilingualCrisisDetectionService
    Language Detection
      √ should auto-detect language (7 ms)
      √ should handle mixed language content (1 ms)
      √ should detect dialects and variants (1 ms)
    Crisis Detection Across Languages
      √ should detect crisis in Spanish
      √ should detect crisis in Chinese (1 ms)
      √ should detect crisis in Arabic (1 ms)
      √ should detect crisis in Hindi
    Translation and Understanding
      √ should provide translations for crisis content (1 ms)
      √ should preserve meaning in translation
      √ should handle untranslatable expressions
    Colloquialisms and Slang
      √ should detect crisis in colloquial expressions
      √ should understand youth slang (1 ms)
      √ should handle internet language
    Regional Variations
      √ should handle British vs American English (1 ms)
      √ should handle Latin American vs European Spanish
    Script and Character Support
      √ should handle Cyrillic script (1 ms)
      √ should handle right-to-left languages
      √ should handle emoji and emoticons (1 ms)
    Confidence and Accuracy
      √ should provide language-specific confidence scores (1 ms)
      √ should handle low-resource languages
    Response Localization
      √ should provide localized crisis resources
      √ should provide culturally appropriate responses (1 ms)
    Performance Across Languages
      √ should process all languages within timeout (7 ms)
      √ should cache language models efficiently (1 ms)
    Error Handling
      √ should handle unsupported languages gracefully
      √ should handle encoding issues (1 ms)

  console.group
      🧠 Intelligent Preloading Results

      at src/hooks/useIntelligentPreloading.ts:103:17

PASS src/services/__tests__/moodAnalysisService.test.ts
  MoodAnalysisService
    Service Initialization
      √ should create service instance (1 ms)
      √ should return same instance on multiple calls
    Mood Analysis
      √ should analyze mood from text (3 ms)
      √ should detect different mood types (1 ms)
      √ should handle empty or short text (1 ms)
      √ should provide intensity and confidence scores (1 ms)
    Pattern Analysis
      √ should analyze mood patterns from multiple analyses (2 ms)
      √ should handle single mood analysis
      √ should handle empty analysis array (1 ms)
    Personalized Recommendations
      √ should generate recommendations from mood pattern (1 ms)
      √ should prioritize recommendations based on mood severity (1 ms)
    Mood History
      √ should get mood history (189 ms)
      √ should handle empty mood history (2 ms)
    Different Mood Types Coverage
      √ should handle all supported mood types (6 ms)
      √ should provide relevant keywords for different moods (2 ms)
    Edge Cases and Error Handling
      √ should handle special characters and emojis (2 ms)
      √ should handle very long text (1 ms)
      √ should handle mixed emotions in text
      √ should handle non-English or unclear text (1 ms)
    Performance and Reliability
      √ should analyze mood quickly (1 ms)
      √ should be consistent with same input

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'map')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:238:43
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

  console.warn
    [IntelligentCache] Storage critical: 91% used

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at IntelligentCachingService.emitStorageWarning (src/services/intelligentCachingService.ts:482:13)
      at checkQuota (src/services/intelligentCachingService.ts:353:16)
      at IntelligentCachingService.monitorStorageQuota (src/services/intelligentCachingService.ts:365:7)

  console.log
    Crisis escalation triggered, stopping analysis

      at CrisisDetectionIntegrationService.analyzeConversationForCrisis (src/services/crisisDetectionIntegrationService.ts:131:17)

FAIL src/services/__tests__/websocketService.test.ts
  WebSocketService
    connection management
      × should establish WebSocket connection (247 ms)
      × should handle connection with authentication (1 ms)
      × should reconnect automatically on disconnection (1 ms)
      × should handle connection failures gracefully (1 ms)
    message handling
      × should send crisis alert messages
      × should send chat messages in real-time (1 ms)
      × should handle incoming messages
      × should handle presence updates (1 ms)
    room and channel management
      × should join crisis support room
      × should leave room gracefully (1 ms)
      × should handle room events
    crisis-specific features
      × should escalate crisis with high priority
      × should handle emergency interventions
      × should send safety check requests
    connection health and monitoring
      × should implement heartbeat mechanism
      × should monitor connection health
      × should detect and report connection issues
    message queuing and offline support
      × should queue messages when disconnected (1 ms)
      × should send queued messages when reconnected
      × should handle message priority in queue
    security and validation
      × should validate message format
      × should reject invalid messages
      × should sanitize message content
    error handling and recovery
      × should handle WebSocket errors gracefully
      × should implement exponential backoff for reconnection
      × should cleanup resources on disconnect (1 ms)

  ● WebSocketService › connection management › should establish WebSocket connection

    TypeError: Cannot read properties of undefined (reading 'connected')

    [0m [90m 61 |[39m       [36mconst[39m connection [33m=[39m [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/crisis-support'[39m)[33m;[39m
     [90m 62 |[39m
    [31m[1m>[22m[39m[90m 63 |[39m       expect(connection[33m.[39mconnected)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 64 |[39m       expect(connection[33m.[39murl)[33m.[39mtoBe([32m'ws://localhost:8080/crisis-support'[39m)[33m;[39m
     [90m 65 |[39m     })[33m;[39m
     [90m 66 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:63:25)

  ● WebSocketService › connection management › should handle connection with authentication

    TypeError: service.connectWithAuth is not a function

    [0m [90m 68 |[39m       [36mconst[39m authToken [33m=[39m [32m'bearer-token-123'[39m[33m;[39m
     [90m 69 |[39m       
    [31m[1m>[22m[39m[90m 70 |[39m       [36mconst[39m connection [33m=[39m [36mawait[39m service[33m.[39mconnectWithAuth([32m'ws://localhost:8080/secure'[39m[33m,[39m authToken)[33m;[39m
     [90m    |[39m                                        [31m[1m^[22m[39m
     [90m 71 |[39m
     [90m 72 |[39m       expect(connection[33m.[39mauthenticated)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 73 |[39m       expect(connection[33m.[39mconnected)[33m.[39mtoBe([36mtrue[39m)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:70:40)

  ● WebSocketService › connection management › should reconnect automatically on disconnection

    Property `reconnect` does not exist in the provided object

    [0m [90m 77 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
     [90m 78 |[39m       
    [31m[1m>[22m[39m[90m 79 |[39m       [36mconst[39m reconnectSpy [33m=[39m jest[33m.[39mspyOn(service[33m,[39m [32m'reconnect'[39m)[33m;[39m
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 80 |[39m       
     [90m 81 |[39m       [90m// Simulate connection loss[39m
     [90m 82 |[39m       service[33m.[39msimulateDisconnection()[33m;[39m[0m

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:731:13)
      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:79:33)

  ● WebSocketService › connection management › should handle connection failures gracefully

    TypeError: Cannot read properties of undefined (reading 'connected')

    [0m [90m 102 |[39m       [36mconst[39m connection [33m=[39m [36mawait[39m service[33m.[39mconnect([32m'ws://invalid-url'[39m)[33m;[39m
     [90m 103 |[39m
    [31m[1m>[22m[39m[90m 104 |[39m       expect(connection[33m.[39mconnected)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 105 |[39m       expect(connection[33m.[39merror)[33m.[39mtoBeDefined()[33m;[39m
     [90m 106 |[39m     })[33m;[39m
     [90m 107 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:104:25)

  ● WebSocketService › message handling › should send crisis alert messages

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 110 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 111 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 113 |[39m     })[33m;[39m
     [90m 114 |[39m
     [90m 115 |[39m     it([32m'should send crisis alert messages'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:112:54)

  ● WebSocketService › message handling › should send chat messages in real-time

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 110 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 111 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 113 |[39m     })[33m;[39m
     [90m 114 |[39m
     [90m 115 |[39m     it([32m'should send crisis alert messages'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:112:54)

  ● WebSocketService › message handling › should handle incoming messages

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 110 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 111 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 113 |[39m     })[33m;[39m
     [90m 114 |[39m
     [90m 115 |[39m     it([32m'should send crisis alert messages'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:112:54)

  ● WebSocketService › message handling › should handle presence updates

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 110 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 111 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 113 |[39m     })[33m;[39m
     [90m 114 |[39m
     [90m 115 |[39m     it([32m'should send crisis alert messages'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:112:54)

  ● WebSocketService › room and channel management › should join crisis support room

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 201 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 202 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 203 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 204 |[39m     })[33m;[39m
     [90m 205 |[39m
     [90m 206 |[39m     it([32m'should join crisis support room'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:203:54)

  ● WebSocketService › room and channel management › should leave room gracefully

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 201 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 202 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 203 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 204 |[39m     })[33m;[39m
     [90m 205 |[39m
     [90m 206 |[39m     it([32m'should join crisis support room'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:203:54)

  ● WebSocketService › room and channel management › should handle room events

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 201 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 202 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 203 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 204 |[39m     })[33m;[39m
     [90m 205 |[39m
     [90m 206 |[39m     it([32m'should join crisis support room'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:203:54)

  ● WebSocketService › crisis-specific features › should escalate crisis with high priority

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 262 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 263 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/crisis-ws'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 264 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 265 |[39m     })[33m;[39m
     [90m 266 |[39m
     [90m 267 |[39m     it([32m'should escalate crisis with high priority'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:264:54)

  ● WebSocketService › crisis-specific features › should handle emergency interventions

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 262 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 263 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/crisis-ws'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 264 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 265 |[39m     })[33m;[39m
     [90m 266 |[39m
     [90m 267 |[39m     it([32m'should escalate crisis with high priority'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:264:54)

  ● WebSocketService › crisis-specific features › should send safety check requests

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 262 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 263 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/crisis-ws'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 264 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 265 |[39m     })[33m;[39m
     [90m 266 |[39m
     [90m 267 |[39m     it([32m'should escalate crisis with high priority'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:264:54)

  ● WebSocketService › connection health and monitoring › should implement heartbeat mechanism

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 331 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 332 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 333 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 334 |[39m     })[33m;[39m
     [90m 335 |[39m
     [90m 336 |[39m     it([32m'should implement heartbeat mechanism'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:333:54)

  ● WebSocketService › connection health and monitoring › should monitor connection health

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 331 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 332 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 333 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 334 |[39m     })[33m;[39m
     [90m 335 |[39m
     [90m 336 |[39m     it([32m'should implement heartbeat mechanism'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:333:54)

  ● WebSocketService › connection health and monitoring › should detect and report connection issues

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 331 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 332 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 333 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 334 |[39m     })[33m;[39m
     [90m 335 |[39m
     [90m 336 |[39m     it([32m'should implement heartbeat mechanism'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:333:54)

  ● WebSocketService › message queuing and offline support › should queue messages when disconnected

    TypeError: service.getQueuedMessages is not a function

    [0m [90m 381 |[39m       [36mawait[39m service[33m.[39msendMessage(message)[33m;[39m
     [90m 382 |[39m
    [31m[1m>[22m[39m[90m 383 |[39m       [36mconst[39m queuedMessages [33m=[39m service[33m.[39mgetQueuedMessages()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 384 |[39m       expect(queuedMessages)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
     [90m 385 |[39m       expect(queuedMessages[[35m0[39m])[33m.[39mtoEqual(expect[33m.[39mobjectContaining(message))[33m;[39m
     [90m 386 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:383:38)

  ● WebSocketService › message queuing and offline support › should send queued messages when reconnected

    TypeError: service.getQueuedMessages is not a function

    [0m [90m 391 |[39m       [36mawait[39m service[33m.[39msendMessage({ type[33m:[39m [32m'test'[39m[33m,[39m payload[33m:[39m { data[33m:[39m [32m'2'[39m } })[33m;[39m
     [90m 392 |[39m
    [31m[1m>[22m[39m[90m 393 |[39m       expect(service[33m.[39mgetQueuedMessages())[33m.[39mtoHaveLength([35m2[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 394 |[39m
     [90m 395 |[39m       [90m// Connect and verify messages are sent[39m
     [90m 396 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:393:22)

  ● WebSocketService › message queuing and offline support › should handle message priority in queue

    TypeError: service.getQueuedMessages is not a function

    [0m [90m 410 |[39m       [36mawait[39m service[33m.[39msendMessage(highPriorityMsg)[33m;[39m
     [90m 411 |[39m
    [31m[1m>[22m[39m[90m 412 |[39m       [36mconst[39m queue [33m=[39m service[33m.[39mgetQueuedMessages()[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 413 |[39m       expect(queue[[35m0[39m][33m.[39mpriority)[33m.[39mtoBe([32m'high'[39m)[33m;[39m
     [90m 414 |[39m       expect(queue[[35m1[39m][33m.[39mpriority)[33m.[39mtoBe([32m'low'[39m)[33m;[39m
     [90m 415 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:412:29)

  ● WebSocketService › security and validation › should validate message format

    TypeError: service.validateMessage is not a function

    [0m [90m 424 |[39m       }[33m;[39m
     [90m 425 |[39m
    [31m[1m>[22m[39m[90m 426 |[39m       [36mconst[39m isValid [33m=[39m service[33m.[39mvalidateMessage(validMessage)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 427 |[39m       expect(isValid)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 428 |[39m     })[33m;[39m
     [90m 429 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:426:31)

  ● WebSocketService › security and validation › should reject invalid messages

    TypeError: service.validateMessage is not a function

    [0m [90m 434 |[39m       }[33m;[39m
     [90m 435 |[39m
    [31m[1m>[22m[39m[90m 436 |[39m       [36mconst[39m isValid [33m=[39m service[33m.[39mvalidateMessage(invalidMessage)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 437 |[39m       expect(isValid)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 438 |[39m     })[33m;[39m
     [90m 439 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:436:31)

  ● WebSocketService › security and validation › should sanitize message content

    TypeError: service.sanitizeMessage is not a function

    [0m [90m 446 |[39m       }[33m;[39m
     [90m 447 |[39m
    [31m[1m>[22m[39m[90m 448 |[39m       [36mconst[39m sanitized [33m=[39m service[33m.[39msanitizeMessage(unsafeMessage)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 449 |[39m       expect(sanitized[33m.[39mpayload[33m.[39mtext)[33m.[39mnot[33m.[39mtoContain([32m'<script>'[39m)[33m;[39m
     [90m 450 |[39m       expect(sanitized[33m.[39mpayload[33m.[39mtext)[33m.[39mtoContain([32m'Safe text'[39m)[33m;[39m
     [90m 451 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:448:33)

  ● WebSocketService › error handling and recovery › should handle WebSocket errors gracefully

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 455 |[39m     it([32m'should handle WebSocket errors gracefully'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 456 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 457 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 458 |[39m
     [90m 459 |[39m       [36mconst[39m errorHandler [33m=[39m jest[33m.[39mfn()[33m;[39m
     [90m 460 |[39m       service[33m.[39monError(errorHandler)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:457:54)

  ● WebSocketService › error handling and recovery › should implement exponential backoff for reconnection

    Property `reconnectWithBackoff` does not exist in the provided object

    [0m [90m 469 |[39m
     [90m 470 |[39m     it([32m'should implement exponential backoff for reconnection'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 471 |[39m       [36mconst[39m reconnectSpy [33m=[39m jest[33m.[39mspyOn(service[33m,[39m [32m'reconnectWithBackoff'[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 472 |[39m       
     [90m 473 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
     [90m 474 |[39m       [0m

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:731:13)
      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:471:33)

  ● WebSocketService › error handling and recovery › should cleanup resources on disconnect

    Property `cleanup` does not exist in the provided object

    [0m [90m 485 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
     [90m 486 |[39m       
    [31m[1m>[22m[39m[90m 487 |[39m       [36mconst[39m cleanupSpy [33m=[39m jest[33m.[39mspyOn(service[33m,[39m [32m'cleanup'[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 488 |[39m       
     [90m 489 |[39m       [36mawait[39m service[33m.[39mdisconnect()[33m;[39m
     [90m 490 |[39m[0m

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:731:13)
      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:487:31)

FAIL tests/integration/crisisEscalationWorkflowIntegration.test.ts
  Crisis Escalation Workflow Integration
    √ should trigger escalation workflow for severe crisis (7 ms)
    √ should not trigger escalation for non-crisis content (86 ms)
    √ should analyze conversation and trigger escalation when needed (8 ms)
    × should check user crisis state across multiple messages (2 ms)
    × should handle escalation service failures gracefully (2 ms)
    × should provide appropriate user context to escalation service (3 ms)

  ● Crisis Escalation Workflow Integration › should check user crisis state across multiple messages

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 123 |[39m     )[33m;[39m
     [90m 124 |[39m
    [31m[1m>[22m[39m[90m 125 |[39m     expect(crisisState[33m.[39misInCrisis)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 126 |[39m     expect([[32m'high'[39m[33m,[39m [32m'critical'[39m])[33m.[39mtoContain(crisisState[33m.[39mhighestSeverity)[33m;[39m
     [90m 127 |[39m     expect(crisisState[33m.[39mescalationTriggered)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 128 |[39m     expect(crisisState[33m.[39mrecommendedActions[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisisEscalationWorkflowIntegration.test.ts:125:36)

  ● Crisis Escalation Workflow Integration › should handle escalation service failures gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 145 |[39m     [90m// Should still detect crisis even if escalation fails[39m
     [90m 146 |[39m     expect(result[33m.[39misCrisis)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 147 |[39m     expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 148 |[39m     expect(result[33m.[39mescalationResponse)[33m.[39mtoBeUndefined()[33m;[39m [90m// Escalation failed[39m
     [90m 149 |[39m     expect(result[33m.[39menhanced)[33m.[39mtoBe([36mtrue[39m)[33m;[39m [90m// Enhanced detection still worked[39m
     [90m 150 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisisEscalationWorkflowIntegration.test.ts:147:39)

  ● Crisis Escalation Workflow Integration › should provide appropriate user context to escalation service

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: Any<Object>, "context-test-user", ObjectContaining {"accessibilityNeeds": ["screen-reader"], "culturalContext": "hispanic", "languageCode": "es", "location": ObjectContaining {"country": "US", "hasGeolocation": true, "region": "CA"}, "preferredContactMethod": "phone", "timeZone": "America/Los_Angeles"}, ObjectContaining {"conversationId": "context-test-session", "messagesSent": 5, "previousEscalations": 1, "riskTrend": "increasing", "sessionDuration": 300000}

    Number of calls: 0

    [0m [90m 180 |[39m
     [90m 181 |[39m     [90m// Verify escalation service was called with correct parameters[39m
    [31m[1m>[22m[39m[90m 182 |[39m     expect(crisisEscalationWorkflowService[33m.[39minitiateCrisisEscalation)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                                                      [31m[1m^[22m[39m
     [90m 183 |[39m       expect[33m.[39many([33mObject[39m)[33m,[39m [90m// crisis analysis[39m
     [90m 184 |[39m       [32m'context-test-user'[39m[33m,[39m [90m// user ID[39m
     [90m 185 |[39m       expect[33m.[39mobjectContaining({[0m

      at Object.<anonymous> (tests/integration/crisisEscalationWorkflowIntegration.test.ts:182:70)

  console.error
    [Cultural Crisis Detection] Failed to log analytics: TypeError: privacyPreservingAnalyticsService_1.privacyPreservingAnalyticsService.recordInterventionOutcome is not a function
        at CulturalCrisisDetectionService.logCulturalAnalytics (C:\Users\damat\_REPOS\CoreV2\src\services\culturalCrisisDetectionService.ts:736:47)
        at CulturalCrisisDetectionService.analyzeCrisisWithCulturalContext (C:\Users\damat\_REPOS\CoreV2\src\services\culturalCrisisDetectionService.ts:418:16)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at async Promise.all (index 2)
        at EnhancedCrisisDetectionIntegrationService.performComprehensiveCrisisAnalysis (C:\Users\damat\_REPOS\CoreV2\src\services\enhancedCrisisDetectionIntegrationService.ts:117:63)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\tests\integration\crisisDetectionEscalationIntegration.test.ts:159:22)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at CulturalCrisisDetectionService.logCulturalAnalytics (src/services/culturalCrisisDetectionService.ts:749:15)
      at CulturalCrisisDetectionService.analyzeCrisisWithCulturalContext (src/services/culturalCrisisDetectionService.ts:418:16)
          at async Promise.all (index 2)
      at EnhancedCrisisDetectionIntegrationService.performComprehensiveCrisisAnalysis (src/services/enhancedCrisisDetectionIntegrationService.ts:117:63)
      at Object.<anonymous> (tests/integration/crisisDetectionEscalationIntegration.test.ts:159:22)

  console.log
    [Enhanced Offline Hook] Service initialized successfully

      at initializeOfflineService (src/hooks/useEnhancedOffline.ts:85:17)

  console.log
    [ServiceWorker] Skipping registration in development mode

      at registerServiceWorker (src/services/serviceWorkerConfig.ts:39:13)

  console.error
    [Cultural Crisis Detection] Failed to log analytics: TypeError: privacyPreservingAnalyticsService_1.privacyPreservingAnalyticsService.recordInterventionOutcome is not a function
        at CulturalCrisisDetectionService.logCulturalAnalytics (C:\Users\damat\_REPOS\CoreV2\src\services\culturalCrisisDetectionService.ts:736:47)
        at CulturalCrisisDetectionService.analyzeCrisisWithCulturalContext (C:\Users\damat\_REPOS\CoreV2\src\services\culturalCrisisDetectionService.ts:418:16)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at async Promise.all (index 2)
        at EnhancedCrisisDetectionIntegrationService.performComprehensiveCrisisAnalysis (C:\Users\damat\_REPOS\CoreV2\src\services\enhancedCrisisDetectionIntegrationService.ts:117:63)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\tests\integration\crisisDetectionEscalationIntegration.test.ts:211:22)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at CulturalCrisisDetectionService.logCulturalAnalytics (src/services/culturalCrisisDetectionService.ts:749:15)
      at CulturalCrisisDetectionService.analyzeCrisisWithCulturalContext (src/services/culturalCrisisDetectionService.ts:418:16)
          at async Promise.all (index 2)
      at EnhancedCrisisDetectionIntegrationService.performComprehensiveCrisisAnalysis (src/services/enhancedCrisisDetectionIntegrationService.ts:117:63)
      at Object.<anonymous> (tests/integration/crisisDetectionEscalationIntegration.test.ts:211:22)

  console.log
    [ServiceWorker] Skipping registration in development mode

      at registerServiceWorker (src/services/serviceWorkerConfig.ts:39:13)

  console.log
    [ServiceWorker] Skipping registration in development mode

      at registerServiceWorker (src/services/serviceWorkerConfig.ts:39:13)

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:282:13)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:282:13)

  console.log
    [ServiceWorker] Skipping registration in development mode

      at registerServiceWorker (src/services/serviceWorkerConfig.ts:39:13)

PASS tests/service-worker/registration.test.ts
  Service Worker Registration
    Registration Process
      √ should register service worker successfully (2 ms)
      √ should handle registration failure gracefully (11 ms)
      √ should check if service worker is supported
      √ should handle registration with options (1 ms)
    Service Worker Ready State
      √ should resolve when service worker is ready
    Service Worker Controller
      √ should have controller when service worker is active (1 ms)
      √ should send messages to controller
    Service Worker Events
      √ should add event listeners (1 ms)
      √ should remove event listeners
    Service Worker Registration Retrieval
      √ should get registration for scope (1 ms)
      √ should return undefined for non-existent registration

  console.warn
    [IntelligentCache] Storage critical: 91% used

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at IntelligentCachingService.emitStorageWarning (src/services/intelligentCachingService.ts:482:13)
      at checkQuota (src/services/intelligentCachingService.ts:353:16)
      at IntelligentCachingService.monitorStorageQuota (src/services/intelligentCachingService.ts:365:7)

FAIL tests/integration/crisisDetectionEscalationIntegration.test.ts
  Crisis Detection and Escalation Integration
    Automatic Escalation Triggering
      √ should trigger emergency services escalation for suicide attempt (110 ms)
      × should trigger crisis counselor escalation for high-risk ideation (11 ms)
      √ should trigger medical emergency escalation for overdose situation (3 ms)
      × should provide escalation recommendations without user ID (106 ms)
    Escalation Tier Selection
      √ should recommend peer support for moderate anxiety (1 ms)
      × should recommend crisis counselor for severe distress (147 ms)
    Cultural Context Integration
      × should handle cultural considerations in escalation (8 ms)
    Error Handling
      √ should handle escalation errors gracefully (1 ms)
    Multi-Method Integration
      × should combine keyword, AI, and cultural analysis for escalation decisions (8 ms)
    Response Time and Performance
      × should process and escalate severe cases quickly (1 ms)

  ● Crisis Detection and Escalation Integration › Automatic Escalation Triggering › should trigger crisis counselor escalation for high-risk ideation

    expect(received).toEqual(expected) // deep equality

    Expected: StringMatching /high|critical/
    Received: "medium"

    [0m [90m 59 |[39m       [90m// Should detect crisis indicators[39m
     [90m 60 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 61 |[39m       expect(result[33m.[39moverallSeverity)[33m.[39mtoEqual(expect[33m.[39mstringMatching([35m/high|critical/[39m))[33m;[39m
     [90m    |[39m                                      [31m[1m^[22m[39m
     [90m 62 |[39m       expect(result[33m.[39mimmediateRisk)[33m.[39mtoBeGreaterThan([35m60[39m)[33m;[39m
     [90m 63 |[39m       expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 64 |[39m[0m

      at Object.<anonymous> (tests/integration/crisisDetectionEscalationIntegration.test.ts:61:38)

  ● Crisis Detection and Escalation Integration › Automatic Escalation Triggering › should provide escalation recommendations without user ID

    expect(received).toBe(expected) // Object.is equality

    Expected: "violence-threat"
    Received: "suicide-attempt"

    [0m [90m 110 |[39m       expect(result[33m.[39mescalationWorkflow)[33m.[39mtoBeDefined()[33m;[39m
     [90m 111 |[39m       expect(result[33m.[39mescalationWorkflow[33m?[39m[33m.[39mrecommendedTier)[33m.[39mtoBe([32m'emergency-services'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m       expect(result[33m.[39mescalationWorkflow[33m?[39m[33m.[39mtriggerReason)[33m.[39mtoBe([32m'violence-threat'[39m)[33m;[39m
     [90m     |[39m                                                        [31m[1m^[22m[39m
     [90m 113 |[39m       expect(result[33m.[39mescalationWorkflow[33m?[39m[33m.[39mescalationInitiated)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 114 |[39m       expect(result[33m.[39mescalationWorkflow[33m?[39m[33m.[39mescalationId)[33m.[39mtoBeUndefined()[33m;[39m
     [90m 115 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisisDetectionEscalationIntegration.test.ts:112:56)

  ● Crisis Detection and Escalation Integration › Escalation Tier Selection › should recommend crisis counselor for severe distress

    expect(received).toBeGreaterThan(expected)

    Expected: > 60
    Received:   12.118400000000001

    [0m [90m 143 |[39m
     [90m 144 |[39m       [90m// Should detect high risk requiring professional help[39m
    [31m[1m>[22m[39m[90m 145 |[39m       expect(result[33m.[39mimmediateRisk)[33m.[39mtoBeGreaterThan([35m60[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 146 |[39m       expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 147 |[39m
     [90m 148 |[39m       [90m// Should have appropriate escalation tier[39m[0m

      at Object.<anonymous> (tests/integration/crisisDetectionEscalationIntegration.test.ts:145:36)

  ● Crisis Detection and Escalation Integration › Cultural Context Integration › should handle cultural considerations in escalation

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 167 |[39m
     [90m 168 |[39m       [90m// Should detect crisis with cultural context[39m
    [31m[1m>[22m[39m[90m 169 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 170 |[39m       expect(result[33m.[39mculturalAnalysis)[33m.[39mtoBeDefined()[33m;[39m
     [90m 171 |[39m       expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 172 |[39m[0m

      at Object.<anonymous> (tests/integration/crisisDetectionEscalationIntegration.test.ts:169:42)

  ● Crisis Detection and Escalation Integration › Multi-Method Integration › should combine keyword, AI, and cultural analysis for escalation decisions

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 226 |[39m
     [90m 227 |[39m       [90m// Should make escalation decision based on combined analysis[39m
    [31m[1m>[22m[39m[90m 228 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 229 |[39m       expect(result[33m.[39manalysisMetadata[33m.[39mmethodsUsed)[33m.[39mtoContain([32m'keyword'[39m)[33m;[39m
     [90m 230 |[39m       expect(result[33m.[39manalysisMetadata[33m.[39mmethodsUsed)[33m.[39mtoContain([32m'ai'[39m)[33m;[39m
     [90m 231 |[39m       expect(result[33m.[39manalysisMetadata[33m.[39mmethodsUsed)[33m.[39mtoContain([32m'cultural'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisisDetectionEscalationIntegration.test.ts:228:42)

  ● Crisis Detection and Escalation Integration › Response Time and Performance › should process and escalate severe cases quickly

    expect(received).toBe(expected) // Object.is equality

    Expected: "emergency"
    Received: "medium"

    [0m [90m 257 |[39m
     [90m 258 |[39m       [90m// Should properly escalate emergency case[39m
    [31m[1m>[22m[39m[90m 259 |[39m       expect(result[33m.[39moverallSeverity)[33m.[39mtoBe([32m'emergency'[39m)[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 260 |[39m       expect(result[33m.[39mescalationWorkflow[33m?[39m[33m.[39mrecommendedTier)[33m.[39mtoBe([32m'emergency-services'[39m)[33m;[39m
     [90m 261 |[39m       expect(result[33m.[39mescalationWorkflow[33m?[39m[33m.[39mescalationInitiated)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 262 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisisDetectionEscalationIntegration.test.ts:259:38)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'map')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:238:43
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

  console.log
    [CacheIntegration] Initializing intelligent caching...

      at CacheIntegration.initialize (src/services/cacheIntegration.ts:39:13)

  console.log
    [ServiceWorker] Skipping registration in development mode

      at registerServiceWorker (src/services/serviceWorkerConfig.ts:39:13)

  console.log
    [ServiceWorker] Skipping registration in development mode

      at registerServiceWorker (src/services/serviceWorkerConfig.ts:39:13)

  console.log
    [ServiceWorker] Skipping registration in development mode

      at registerServiceWorker (src/services/serviceWorkerConfig.ts:39:13)

  console.log
    [ServiceWorker] Skipping registration in development mode

      at registerServiceWorker (src/services/serviceWorkerConfig.ts:39:13)

  console.log
    [ServiceWorker] Skipping registration in development mode

      at registerServiceWorker (src/services/serviceWorkerConfig.ts:39:13)

  console.log
    [ServiceWorker] Skipping registration in development mode

      at registerServiceWorker (src/services/serviceWorkerConfig.ts:39:13)

  console.log
    [ServiceWorker] Skipping registration in development mode

      at registerServiceWorker (src/services/serviceWorkerConfig.ts:39:13)

  console.log
    [ServiceWorker] Skipping registration in development mode

      at registerServiceWorker (src/services/serviceWorkerConfig.ts:39:13)

  console.log
    [Enhanced Offline Hook] Service initialized successfully

      at initializeOfflineService (src/hooks/useEnhancedOffline.ts:85:17)

  console.log
    [ServiceWorker] Skipping registration in development mode

      at registerServiceWorker (src/services/serviceWorkerConfig.ts:39:13)

  console.log
    [ServiceWorker] Skipping registration in development mode

      at registerServiceWorker (src/services/serviceWorkerConfig.ts:39:13)

  console.log
    [CacheIntegration] Starting cache warming...

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:66:15)

  console.log
    [ServiceWorker] Skipping registration in development mode

      at registerServiceWorker (src/services/serviceWorkerConfig.ts:39:13)

  console.log
    [CacheIntegration] Cache warming completed

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:74:15)

  console.log
    [CacheIntegration] Periodic maintenance scheduled every 30 minutes

      at CacheIntegration.setupPeriodicMaintenance (src/services/cacheIntegration.ts:107:13)

  console.log
    [ServiceWorker] Skipping registration in development mode

      at registerServiceWorker (src/services/serviceWorkerConfig.ts:39:13)

  console.log
    [CacheIntegration] Intelligent caching initialized successfully

      at CacheIntegration.initialize (src/services/cacheIntegration.ts:54:15)

  console.log
    [ServiceWorker] Skipping registration in development mode

      at registerServiceWorker (src/services/serviceWorkerConfig.ts:39:13)

  console.warn
    EncryptionService: Browser does not support required cryptographic operations

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at EncryptionService.checkBrowserSupport (src/services/encryptionService.ts:151:15)
      at new EncryptionService (src/services/encryptionService.ts:135:10)
      at getEncryptionService (src/services/encryptionService.ts:797:33)
      at Object.<anonymous> (src/services/__tests__/encryptionService.test.ts:19:51)

  console.log
    [CacheIntegration] Initializing intelligent caching...

      at CacheIntegration.initialize (src/services/cacheIntegration.ts:39:13)

  console.log
    [CacheIntegration] Starting cache warming...

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:66:15)

  console.log
    [ServiceWorker] Skipping registration in development mode

      at registerServiceWorker (src/services/serviceWorkerConfig.ts:39:13)

  console.log
    [CacheIntegration] Cache warming completed

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:74:15)

  console.log
    [CacheIntegration] Periodic maintenance scheduled every 30 minutes

      at CacheIntegration.setupPeriodicMaintenance (src/services/cacheIntegration.ts:107:13)

  console.log
    [CacheIntegration] Intelligent caching initialized successfully

      at CacheIntegration.initialize (src/services/cacheIntegration.ts:54:15)

  console.log
    [CacheIntegration] Initializing intelligent caching...

      at CacheIntegration.initialize (src/services/cacheIntegration.ts:39:13)

  console.log
    [CacheIntegration] Periodic maintenance scheduled every 30 minutes

      at CacheIntegration.setupPeriodicMaintenance (src/services/cacheIntegration.ts:107:13)

  console.log
    [CacheIntegration] Intelligent caching initialized successfully

      at CacheIntegration.initialize (src/services/cacheIntegration.ts:54:15)

  console.log
    [CacheIntegration] Initializing intelligent caching...

      at CacheIntegration.initialize (src/services/cacheIntegration.ts:39:13)

  console.log
    [CacheIntegration] Starting cache warming...

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:66:15)

  console.log
    [CacheIntegration] Cache warming completed

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:74:15)

  console.log
    [CacheIntegration] Periodic maintenance scheduled every 30 minutes

      at CacheIntegration.setupPeriodicMaintenance (src/services/cacheIntegration.ts:107:13)

  console.log
    [CacheIntegration] Intelligent caching initialized successfully

      at CacheIntegration.initialize (src/services/cacheIntegration.ts:54:15)

  console.log
    [CacheIntegration] Manual cache warming triggered

      at CacheIntegration.warmCaches (src/services/cacheIntegration.ts:175:13)

  console.log
    [CacheIntegration] Starting cache warming...

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:66:15)

  console.log
    [CacheIntegration] Cache warming completed

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:74:15)

  console.log
    [CacheIntegration] Cache warming requested but not initialized, skipping

      at CacheIntegration.warmCaches (src/services/cacheIntegration.ts:171:15)

  console.log
    [CacheIntegration] Initializing intelligent caching...

      at CacheIntegration.initialize (src/services/cacheIntegration.ts:39:13)

  console.log
    [CacheIntegration] Starting cache warming...

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:66:15)

  console.log
    [CacheIntegration] Cache warming completed

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:74:15)

  console.log
    [CacheIntegration] Periodic maintenance scheduled every 30 minutes

      at CacheIntegration.setupPeriodicMaintenance (src/services/cacheIntegration.ts:107:13)

  console.log
    [CacheIntegration] Intelligent caching initialized successfully

      at CacheIntegration.initialize (src/services/cacheIntegration.ts:54:15)

  console.log
    [CacheIntegration] Manual cache warming triggered

      at CacheIntegration.warmCaches (src/services/cacheIntegration.ts:175:13)

  console.log
    Data migration completed: 0 keys migrated, 0 failed in 0ms

      at EncryptionService.migrateExistingData (src/services/encryptionService.ts:595:13)

  console.log
    [CacheIntegration] Starting cache warming...

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:66:15)

  console.log
    [CacheIntegration] Cache warming completed

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:74:15)

  console.log
    [CacheIntegration] Initializing intelligent caching...

      at CacheIntegration.initialize (src/services/cacheIntegration.ts:39:13)

  console.log
    [CacheIntegration] Starting cache warming...

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:66:15)

  console.log
    [CacheIntegration] Cache warming completed

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:74:15)

  console.log
    [CacheIntegration] Periodic maintenance scheduled every 30 minutes

      at CacheIntegration.setupPeriodicMaintenance (src/services/cacheIntegration.ts:107:13)

  console.log
    [CacheIntegration] Intelligent caching initialized successfully

      at CacheIntegration.initialize (src/services/cacheIntegration.ts:54:15)

  console.log
    [CacheIntegration] Manual cache cleanup triggered

      at CacheIntegration.cleanupCaches (src/services/cacheIntegration.ts:189:13)

  console.log
    [CacheIntegration] Cache cleanup requested but not initialized, skipping

      at CacheIntegration.cleanupCaches (src/services/cacheIntegration.ts:185:15)

  console.log
    [CacheIntegration] Manual cache cleanup triggered

      at CacheIntegration.cleanupCaches (src/services/cacheIntegration.ts:189:13)

  console.log
    [CacheIntegration] Cache integration destroyed

      at CacheIntegration.destroy (src/services/cacheIntegration.ts:406:13)

  console.log
    [CacheIntegration] Cache integration destroyed

      at CacheIntegration.destroy (src/services/cacheIntegration.ts:406:13)

  console.log
    [CacheIntegration] Cache integration destroyed

      at CacheIntegration.destroy (src/services/cacheIntegration.ts:406:13)

  console.log
    [CacheIntegration] Initializing intelligent caching...

      at CacheIntegration.initialize (src/services/cacheIntegration.ts:39:13)

  console.log
    [CacheIntegration] Starting cache warming...

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:66:15)

  console.log
    [CacheIntegration] Cache warming completed

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:74:15)

  console.log
    [CacheIntegration] Periodic maintenance scheduled every 30 minutes

      at CacheIntegration.setupPeriodicMaintenance (src/services/cacheIntegration.ts:107:13)

  console.log
    [CacheIntegration] Intelligent caching initialized successfully

      at CacheIntegration.initialize (src/services/cacheIntegration.ts:54:15)

  console.log
    [CacheIntegration] Cache warming requested but not initialized, skipping

      at CacheIntegration.warmCaches (src/services/cacheIntegration.ts:171:15)

  console.log
    [CacheIntegration] Cache cleanup requested but not initialized, skipping

      at CacheIntegration.cleanupCaches (src/services/cacheIntegration.ts:185:15)

  console.log
    [ServiceWorker] Registered: {
      waiting: null,
      installing: null,
      active: { state: 'activated' },
      update: [Function: mockConstructor] {
        _isMockFunction: true,
        getMockImplementation: [Function (anonymous)],
        mock: [Getter/Setter],
        mockClear: [Function (anonymous)],
        mockReset: [Function (anonymous)],
        mockRestore: [Function (anonymous)],
        mockReturnValueOnce: [Function (anonymous)],
        mockResolvedValueOnce: [Function (anonymous)],
        mockRejectedValueOnce: [Function (anonymous)],
        mockReturnValue: [Function (anonymous)],
        mockResolvedValue: [Function (anonymous)],
        mockRejectedValue: [Function (anonymous)],
        mockImplementationOnce: [Function (anonymous)],
        withImplementation: [Function: bound withImplementation],
        mockImplementation: [Function (anonymous)],
        mockReturnThis: [Function (anonymous)],
        mockName: [Function (anonymous)],
        getMockName: [Function (anonymous)]
      },
      unregister: [Function: mockConstructor] {
        _isMockFunction: true,
        getMockImplementation: [Function (anonymous)],
        mock: [Getter/Setter],
        mockClear: [Function (anonymous)],
        mockReset: [Function (anonymous)],
        mockRestore: [Function (anonymous)],
        mockReturnValueOnce: [Function (anonymous)],
        mockResolvedValueOnce: [Function (anonymous)],
        mockRejectedValueOnce: [Function (anonymous)],
        mockReturnValue: [Function (anonymous)],
        mockResolvedValue: [Function (anonymous)],
        mockRejectedValue: [Function (anonymous)],
        mockImplementationOnce: [Function (anonymous)],
        withImplementation: [Function: bound withImplementation],
        mockImplementation: [Function (anonymous)],
        mockReturnThis: [Function (anonymous)],
        mockName: [Function (anonymous)],
        getMockName: [Function (anonymous)]
      },
      addEventListener: [Function: mockConstructor] {
        _isMockFunction: true,
        getMockImplementation: [Function (anonymous)],
        mock: [Getter/Setter],
        mockClear: [Function (anonymous)],
        mockReset: [Function (anonymous)],
        mockRestore: [Function (anonymous)],
        mockReturnValueOnce: [Function (anonymous)],
        mockResolvedValueOnce: [Function (anonymous)],
        mockRejectedValueOnce: [Function (anonymous)],
        mockReturnValue: [Function (anonymous)],
        mockResolvedValue: [Function (anonymous)],
        mockRejectedValue: [Function (anonymous)],
        mockImplementationOnce: [Function (anonymous)],
        withImplementation: [Function: bound withImplementation],
        mockImplementation: [Function (anonymous)],
        mockReturnThis: [Function (anonymous)],
        mockName: [Function (anonymous)],
        getMockName: [Function (anonymous)]
      },
      removeEventListener: [Function: mockConstructor] {
        _isMockFunction: true,
        getMockImplementation: [Function (anonymous)],
        mock: [Getter/Setter],
        mockClear: [Function (anonymous)],
        mockReset: [Function (anonymous)],
        mockRestore: [Function (anonymous)],
        mockReturnValueOnce: [Function (anonymous)],
        mockResolvedValueOnce: [Function (anonymous)],
        mockRejectedValueOnce: [Function (anonymous)],
        mockReturnValue: [Function (anonymous)],
        mockResolvedValue: [Function (anonymous)],
        mockRejectedValue: [Function (anonymous)],
        mockImplementationOnce: [Function (anonymous)],
        withImplementation: [Function: bound withImplementation],
        mockImplementation: [Function (anonymous)],
        mockReturnThis: [Function (anonymous)],
        mockName: [Function (anonymous)],
        getMockName: [Function (anonymous)]
      },
      pushManager: {
        subscribe: [Function: mockConstructor] {
          _isMockFunction: true,
          getMockImplementation: [Function (anonymous)],
          mock: [Getter/Setter],
          mockClear: [Function (anonymous)],
          mockReset: [Function (anonymous)],
          mockRestore: [Function (anonymous)],
          mockReturnValueOnce: [Function (anonymous)],
          mockResolvedValueOnce: [Function (anonymous)],
          mockRejectedValueOnce: [Function (anonymous)],
          mockReturnValue: [Function (anonymous)],
          mockResolvedValue: [Function (anonymous)],
          mockRejectedValue: [Function (anonymous)],
          mockImplementationOnce: [Function (anonymous)],
          withImplementation: [Function: bound withImplementation],
          mockImplementation: [Function (anonymous)],
          mockReturnThis: [Function (anonymous)],
          mockName: [Function (anonymous)],
          getMockName: [Function (anonymous)]
        },
        getSubscription: [Function: mockConstructor] {
          _isMockFunction: true,
          getMockImplementation: [Function (anonymous)],
          mock: [Getter/Setter],
          mockClear: [Function (anonymous)],
          mockReset: [Function (anonymous)],
          mockRestore: [Function (anonymous)],
          mockReturnValueOnce: [Function (anonymous)],
          mockResolvedValueOnce: [Function (anonymous)],
          mockRejectedValueOnce: [Function (anonymous)],
          mockReturnValue: [Function (anonymous)],
          mockResolvedValue: [Function (anonymous)],
          mockRejectedValue: [Function (anonymous)],
          mockImplementationOnce: [Function (anonymous)],
          withImplementation: [Function: bound withImplementation],
          mockImplementation: [Function (anonymous)],
          mockReturnThis: [Function (anonymous)],
          mockName: [Function (anonymous)],
          getMockName: [Function (anonymous)]
        }
      },
      sync: {
        register: [Function: mockConstructor] {
          _isMockFunction: true,
          getMockImplementation: [Function (anonymous)],
          mock: [Getter/Setter],
          mockClear: [Function (anonymous)],
          mockReset: [Function (anonymous)],
          mockRestore: [Function (anonymous)],
          mockReturnValueOnce: [Function (anonymous)],
          mockResolvedValueOnce: [Function (anonymous)],
          mockRejectedValueOnce: [Function (anonymous)],
          mockReturnValue: [Function (anonymous)],
          mockResolvedValue: [Function (anonymous)],
          mockRejectedValue: [Function (anonymous)],
          mockImplementationOnce: [Function (anonymous)],
          withImplementation: [Function: bound withImplementation],
          mockImplementation: [Function (anonymous)],
          mockReturnThis: [Function (anonymous)],
          mockName: [Function (anonymous)],
          getMockName: [Function (anonymous)]
        }
      },
      showNotification: [Function: mockConstructor] {
        _isMockFunction: true,
        getMockImplementation: [Function (anonymous)],
        mock: [Getter/Setter],
        mockClear: [Function (anonymous)],
        mockReset: [Function (anonymous)],
        mockRestore: [Function (anonymous)],
        mockReturnValueOnce: [Function (anonymous)],
        mockResolvedValueOnce: [Function (anonymous)],
        mockRejectedValueOnce: [Function (anonymous)],
        mockReturnValue: [Function (anonymous)],
        mockResolvedValue: [Function (anonymous)],
        mockRejectedValue: [Function (anonymous)],
        mockImplementationOnce: [Function (anonymous)],
        withImplementation: [Function: bound withImplementation],
        mockImplementation: [Function (anonymous)],
        mockReturnThis: [Function (anonymous)],
        mockName: [Function (anonymous)],
        getMockName: [Function (anonymous)]
      }
    }

      at ServiceWorkerManager.initialize (src/services/serviceWorkerManager.ts:32:15)

  console.log
    [ServiceWorker] Registered: {
      waiting: null,
      installing: null,
      active: { state: 'activated' },
      update: [Function: mockConstructor] {
        _isMockFunction: true,
        getMockImplementation: [Function (anonymous)],
        mock: [Getter/Setter],
        mockClear: [Function (anonymous)],
        mockReset: [Function (anonymous)],
        mockRestore: [Function (anonymous)],
        mockReturnValueOnce: [Function (anonymous)],
        mockResolvedValueOnce: [Function (anonymous)],
        mockRejectedValueOnce: [Function (anonymous)],
        mockReturnValue: [Function (anonymous)],
        mockResolvedValue: [Function (anonymous)],
        mockRejectedValue: [Function (anonymous)],
        mockImplementationOnce: [Function (anonymous)],
        withImplementation: [Function: bound withImplementation],
        mockImplementation: [Function (anonymous)],
        mockReturnThis: [Function (anonymous)],
        mockName: [Function (anonymous)],
        getMockName: [Function (anonymous)]
      },
      unregister: [Function: mockConstructor] {
        _isMockFunction: true,
        getMockImplementation: [Function (anonymous)],
        mock: [Getter/Setter],
        mockClear: [Function (anonymous)],
        mockReset: [Function (anonymous)],
        mockRestore: [Function (anonymous)],
        mockReturnValueOnce: [Function (anonymous)],
        mockResolvedValueOnce: [Function (anonymous)],
        mockRejectedValueOnce: [Function (anonymous)],
        mockReturnValue: [Function (anonymous)],
        mockResolvedValue: [Function (anonymous)],
        mockRejectedValue: [Function (anonymous)],
        mockImplementationOnce: [Function (anonymous)],
        withImplementation: [Function: bound withImplementation],
        mockImplementation: [Function (anonymous)],
        mockReturnThis: [Function (anonymous)],
        mockName: [Function (anonymous)],
        getMockName: [Function (anonymous)]
      },
      addEventListener: [Function: mockConstructor] {
        _isMockFunction: true,
        getMockImplementation: [Function (anonymous)],
        mock: [Getter/Setter],
        mockClear: [Function (anonymous)],
        mockReset: [Function (anonymous)],
        mockRestore: [Function (anonymous)],
        mockReturnValueOnce: [Function (anonymous)],
        mockResolvedValueOnce: [Function (anonymous)],
        mockRejectedValueOnce: [Function (anonymous)],
        mockReturnValue: [Function (anonymous)],
        mockResolvedValue: [Function (anonymous)],
        mockRejectedValue: [Function (anonymous)],
        mockImplementationOnce: [Function (anonymous)],
        withImplementation: [Function: bound withImplementation],
        mockImplementation: [Function (anonymous)],
        mockReturnThis: [Function (anonymous)],
        mockName: [Function (anonymous)],
        getMockName: [Function (anonymous)]
      },
      removeEventListener: [Function: mockConstructor] {
        _isMockFunction: true,
        getMockImplementation: [Function (anonymous)],
        mock: [Getter/Setter],
        mockClear: [Function (anonymous)],
        mockReset: [Function (anonymous)],
        mockRestore: [Function (anonymous)],
        mockReturnValueOnce: [Function (anonymous)],
        mockResolvedValueOnce: [Function (anonymous)],
        mockRejectedValueOnce: [Function (anonymous)],
        mockReturnValue: [Function (anonymous)],
        mockResolvedValue: [Function (anonymous)],
        mockRejectedValue: [Function (anonymous)],
        mockImplementationOnce: [Function (anonymous)],
        withImplementation: [Function: bound withImplementation],
        mockImplementation: [Function (anonymous)],
        mockReturnThis: [Function (anonymous)],
        mockName: [Function (anonymous)],
        getMockName: [Function (anonymous)]
      },
      pushManager: {
        subscribe: [Function: mockConstructor] {
          _isMockFunction: true,
          getMockImplementation: [Function (anonymous)],
          mock: [Getter/Setter],
          mockClear: [Function (anonymous)],
          mockReset: [Function (anonymous)],
          mockRestore: [Function (anonymous)],
          mockReturnValueOnce: [Function (anonymous)],
          mockResolvedValueOnce: [Function (anonymous)],
          mockRejectedValueOnce: [Function (anonymous)],
          mockReturnValue: [Function (anonymous)],
          mockResolvedValue: [Function (anonymous)],
          mockRejectedValue: [Function (anonymous)],
          mockImplementationOnce: [Function (anonymous)],
          withImplementation: [Function: bound withImplementation],
          mockImplementation: [Function (anonymous)],
          mockReturnThis: [Function (anonymous)],
          mockName: [Function (anonymous)],
          getMockName: [Function (anonymous)]
        },
        getSubscription: [Function: mockConstructor] {
          _isMockFunction: true,
          getMockImplementation: [Function (anonymous)],
          mock: [Getter/Setter],
          mockClear: [Function (anonymous)],
          mockReset: [Function (anonymous)],
          mockRestore: [Function (anonymous)],
          mockReturnValueOnce: [Function (anonymous)],
          mockResolvedValueOnce: [Function (anonymous)],
          mockRejectedValueOnce: [Function (anonymous)],
          mockReturnValue: [Function (anonymous)],
          mockResolvedValue: [Function (anonymous)],
          mockRejectedValue: [Function (anonymous)],
          mockImplementationOnce: [Function (anonymous)],
          withImplementation: [Function: bound withImplementation],
          mockImplementation: [Function (anonymous)],
          mockReturnThis: [Function (anonymous)],
          mockName: [Function (anonymous)],
          getMockName: [Function (anonymous)]
        }
      },
      sync: {
        register: [Function: mockConstructor] {
          _isMockFunction: true,
          getMockImplementation: [Function (anonymous)],
          mock: [Getter/Setter],
          mockClear: [Function (anonymous)],
          mockReset: [Function (anonymous)],
          mockRestore: [Function (anonymous)],
          mockReturnValueOnce: [Function (anonymous)],
          mockResolvedValueOnce: [Function (anonymous)],
          mockRejectedValueOnce: [Function (anonymous)],
          mockReturnValue: [Function (anonymous)],
          mockResolvedValue: [Function (anonymous)],
          mockRejectedValue: [Function (anonymous)],
          mockImplementationOnce: [Function (anonymous)],
          withImplementation: [Function: bound withImplementation],
          mockImplementation: [Function (anonymous)],
          mockReturnThis: [Function (anonymous)],
          mockName: [Function (anonymous)],
          getMockName: [Function (anonymous)]
        }
      },
      showNotification: [Function: mockConstructor] {
        _isMockFunction: true,
        getMockImplementation: [Function (anonymous)],
        mock: [Getter/Setter],
        mockClear: [Function (anonymous)],
        mockReset: [Function (anonymous)],
        mockRestore: [Function (anonymous)],
        mockReturnValueOnce: [Function (anonymous)],
        mockResolvedValueOnce: [Function (anonymous)],
        mockRejectedValueOnce: [Function (anonymous)],
        mockReturnValue: [Function (anonymous)],
        mockResolvedValue: [Function (anonymous)],
        mockRejectedValue: [Function (anonymous)],
        mockImplementationOnce: [Function (anonymous)],
        withImplementation: [Function: bound withImplementation],
        mockImplementation: [Function (anonymous)],
        mockReturnThis: [Function (anonymous)],
        mockName: [Function (anonymous)],
        getMockName: [Function (anonymous)]
      }
    }

      at ServiceWorkerManager.initialize (src/services/serviceWorkerManager.ts:32:15)

  console.log
    [ServiceWorker] Cache resources: [ '/static/js/main.js', '/static/css/main.css' ]

      at ServiceWorkerManager.cacheResources (src/services/serviceWorkerManager.ts:45:13)

  console.log
    [ServiceWorker] Clear cache: static-assets

      at ServiceWorkerManager.clearCache (src/services/serviceWorkerManager.ts:102:13)

  console.log
    [Preloading Engine] New session started: session_1755460724777_e9d8o47yc (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:306:13)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:306:13)

  console.log
    [ServiceWorker] Preload critical resources: [ '/emergency-contacts', '/crisis-resources' ]

      at ServiceWorkerManager.preloadCriticalResources (src/services/serviceWorkerManager.ts:50:13)

  console.log
    [Preloading Engine] New session started: session_1755460724933_1rhzck0ip (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [ServiceWorker] Register background sync: {
      tag: 'mood-sync',
      data: { mood: 'anxious', timestamp: 1755460724935 }
    }

      at ServiceWorkerManager.registerBackgroundSync (src/services/serviceWorkerManager.ts:54:13)

  console.log
    [ServiceWorker] Queue offline action: {
      type: 'POST_MOOD_ENTRY',
      url: '/api/moods',
      data: { mood: 'happy', energy: 8 }
    }

      at ServiceWorkerManager.queueOfflineAction (src/services/serviceWorkerManager.ts:58:13)

  console.log
    [ServiceWorker] Setup push notifications with VAPID key: test-vapid-key

      at ServiceWorkerManager.setupPushNotifications (src/services/serviceWorkerManager.ts:62:13)

  console.log
    [ServiceWorker] Send notification: {
      title: 'Mental Health Check',
      body: 'How are you feeling today?',
      icon: '/icon-192x192.png'
    }

      at ServiceWorkerManager.sendNotification (src/services/serviceWorkerManager.ts:67:13)

  console.log
    [Preloading Engine] New session started: session_1755460724936_ueou2tc6n (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [ServiceWorker] Skip waiting requested

      at ServiceWorkerManager.skipWaiting (src/services/serviceWorkerManager.ts:92:13)

  console.log
    [ServiceWorker] Cache crisis resource: /crisis-helpline

      at ServiceWorkerManager.cacheCrisisResource (src/services/serviceWorkerManager.ts:107:13)

  console.log
    [Preloading Engine] New session started: session_1755460724945_6hnfqa77y (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [ServiceWorker] Precache crisis resources

      at ServiceWorkerManager.precacheCrisisResources (src/services/serviceWorkerManager.ts:112:13)

  console.log
    [Preloading Engine] New session started: session_1755460724947_2ucse4db2 (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:367:19)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:367:19)

FAIL src/services/__tests__/serviceWorkerManager.test.ts
  ServiceWorkerManager
    initialization
      √ should initialize service worker manager (123 ms)
      √ should return supported status (2 ms)
    caching
      √ should cache resources (4 ms)
      √ should clear cache (2 ms)
      × should get cache status
    critical resources
      √ should preload critical resources (1 ms)
    background sync
      √ should register background sync (1 ms)
      √ should queue offline action (2 ms)
    push notifications
      √ should setup push notifications (1 ms)
      √ should send notification (2 ms)
    offline status
      √ should check offline readiness
    updates
      √ should check for updates (1 ms)
      √ should skip waiting (1 ms)
    crisis features
      √ should cache crisis resource (1 ms)
      √ should precache crisis resources (1 ms)

  ● ServiceWorkerManager › caching › should get cache status

    expect(received).toHaveProperty(path)

    Expected path: "cached"
    Received path: []

    Received value: {"aiModels": false, "cacheVersion": "1.0.0", "crisisResources": false, "culturalContent": false, "staticResources": false, "swRegistered": true, "translations": false, "updateAvailable": false}

    [0m [90m 74 |[39m     it([32m'should get cache status'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 75 |[39m       [36mconst[39m status [33m=[39m [36mawait[39m serviceWorkerManager[33m.[39mgetCacheStatus()[33m;[39m
    [31m[1m>[22m[39m[90m 76 |[39m       expect(status)[33m.[39mtoHaveProperty([32m'cached'[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 77 |[39m       expect(status)[33m.[39mtoHaveProperty([32m'size'[39m)[33m;[39m
     [90m 78 |[39m     })[33m;[39m
     [90m 79 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerManager.test.ts:76:22)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'join')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:72
        at Array.map (<anonymous>)
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:38
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

FAIL src/services/__tests__/serviceWorkerConfig.test.ts
  Service Worker Configuration
    service worker registration
      × should register service worker successfully (111 ms)
      √ should handle registration failures gracefully (3 ms)
      √ should handle browsers without service worker support (3 ms)
    service worker updates
      × should check for updates
      √ should handle update check failures
      × should notify when new version is available (77 ms)
    service worker unregistration
      × should unregister service worker (1 ms)
      × should handle unregistration when no service worker exists (1 ms)
    service worker lifecycle
      × should handle install event (3 ms)
      × should handle activate event (7 ms)
      × should handle fetch event for offline support (3 ms)
    caching strategies
      × should implement cache-first strategy for static assets (2 ms)
      × should implement network-first strategy for API calls (2 ms)
      × should implement stale-while-revalidate for dynamic content (2 ms)
    offline functionality
      × should configure offline page (1 ms)
      × should handle crisis resources offline (2 ms)
    push notification support
      × should configure push notification handling (6 ms)
      × should handle background sync for offline actions (2 ms)
    performance optimization
      × should preload critical resources (2 ms)
      × should implement resource hinting (1 ms)
    error handling and monitoring
      √ should handle service worker errors (2 ms)
      × should track service worker performance (3 ms)

  ● Service Worker Configuration › service worker registration › should register service worker successfully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/sw.js", {"scope": "/", "updateViaCache": "none"}

    Number of calls: 0

    [0m [90m 32 |[39m       [36mconst[39m registration [33m=[39m [36mawait[39m registerServiceWorker()[33m;[39m
     [90m 33 |[39m
    [31m[1m>[22m[39m[90m 34 |[39m       expect(navigator[33m.[39mserviceWorker[33m.[39mregister)[33m.[39mtoHaveBeenCalledWith([32m'/sw.js'[39m[33m,[39m {
     [90m    |[39m                                                [31m[1m^[22m[39m
     [90m 35 |[39m         scope[33m:[39m [32m'/'[39m[33m,[39m
     [90m 36 |[39m         updateViaCache[33m:[39m [32m'none'[39m
     [90m 37 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:34:48)

  ● Service Worker Configuration › service worker updates › should check for updates

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 60 |[39m       [36mawait[39m updateServiceWorker()[33m;[39m
     [90m 61 |[39m
    [31m[1m>[22m[39m[90m 62 |[39m       expect(mockServiceWorkerRegistration[33m.[39mupdate)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m    |[39m                                                    [31m[1m^[22m[39m
     [90m 63 |[39m     })[33m;[39m
     [90m 64 |[39m
     [90m 65 |[39m     it([32m'should handle update check failures'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:62:52)

  ● Service Worker Configuration › service worker updates › should notify when new version is available

    expect(received).toBeInstanceOf(expected)

    Expected constructor: Function
    Received constructor: Function

    [0m [90m 79 |[39m       })[33m;[39m
     [90m 80 |[39m
    [31m[1m>[22m[39m[90m 81 |[39m       expect(updateHandler)[33m.[39mtoBeInstanceOf([33mFunction[39m)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 82 |[39m     })[33m;[39m
     [90m 83 |[39m   })[33m;[39m
     [90m 84 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:81:29)

  ● Service Worker Configuration › service worker unregistration › should unregister service worker

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 87 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m unregisterServiceWorker()[33m;[39m
     [90m 88 |[39m
    [31m[1m>[22m[39m[90m 89 |[39m       expect(mockServiceWorkerRegistration[33m.[39munregister)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m    |[39m                                                        [31m[1m^[22m[39m
     [90m 90 |[39m       expect(result)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 91 |[39m     })[33m;[39m
     [90m 92 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:89:56)

  ● Service Worker Configuration › service worker unregistration › should handle unregistration when no service worker exists

    TypeError: Cannot read properties of undefined (reading 'getRegistration')

    [0m [90m 92 |[39m
     [90m 93 |[39m     it([32m'should handle unregistration when no service worker exists'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 94 |[39m       (navigator[33m.[39mserviceWorker[33m.[39mgetRegistration [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockResolvedValue([36mnull[39m)[33m;[39m
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 95 |[39m
     [90m 96 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m unregisterServiceWorker()[33m;[39m
     [90m 97 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:94:32)

  ● Service Worker Configuration › service worker lifecycle › should handle install event

    expect(received).toBeInstanceOf(expected)

    Expected constructor: Function
    Received constructor: Function

    [0m [90m 108 |[39m       })[33m;[39m
     [90m 109 |[39m
    [31m[1m>[22m[39m[90m 110 |[39m       expect(installHandler)[33m.[39mtoBeInstanceOf([33mFunction[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 111 |[39m     })[33m;[39m
     [90m 112 |[39m
     [90m 113 |[39m     it([32m'should handle activate event'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:110:30)

  ● Service Worker Configuration › service worker lifecycle › should handle activate event

    expect(received).toBeInstanceOf(expected)

    Expected constructor: Function
    Received constructor: Function

    [0m [90m 118 |[39m       })[33m;[39m
     [90m 119 |[39m
    [31m[1m>[22m[39m[90m 120 |[39m       expect(activateHandler)[33m.[39mtoBeInstanceOf([33mFunction[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 121 |[39m     })[33m;[39m
     [90m 122 |[39m
     [90m 123 |[39m     it([32m'should handle fetch event for offline support'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:120:31)

  ● Service Worker Configuration › service worker lifecycle › should handle fetch event for offline support

    expect(received).toBeInstanceOf(expected)

    Expected constructor: Function
    Received constructor: Function

    [0m [90m 128 |[39m       })[33m;[39m
     [90m 129 |[39m
    [31m[1m>[22m[39m[90m 130 |[39m       expect(fetchHandler)[33m.[39mtoBeInstanceOf([33mFunction[39m)[33m;[39m
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 131 |[39m     })[33m;[39m
     [90m 132 |[39m   })[33m;[39m
     [90m 133 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:130:28)

  ● Service Worker Configuration › caching strategies › should implement cache-first strategy for static assets

    TypeError: Cannot read properties of undefined (reading 'register')

    [0m [90m 141 |[39m       registerServiceWorker(config)[33m;[39m
     [90m 142 |[39m
    [31m[1m>[22m[39m[90m 143 |[39m       expect(navigator[33m.[39mserviceWorker[33m.[39mregister)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 144 |[39m     })[33m;[39m
     [90m 145 |[39m
     [90m 146 |[39m     it([32m'should implement network-first strategy for API calls'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:143:38)

  ● Service Worker Configuration › caching strategies › should implement network-first strategy for API calls

    TypeError: Cannot read properties of undefined (reading 'register')

    [0m [90m 152 |[39m       registerServiceWorker(config)[33m;[39m
     [90m 153 |[39m
    [31m[1m>[22m[39m[90m 154 |[39m       expect(navigator[33m.[39mserviceWorker[33m.[39mregister)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 155 |[39m     })[33m;[39m
     [90m 156 |[39m
     [90m 157 |[39m     it([32m'should implement stale-while-revalidate for dynamic content'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:154:38)

  ● Service Worker Configuration › caching strategies › should implement stale-while-revalidate for dynamic content

    TypeError: Cannot read properties of undefined (reading 'register')

    [0m [90m 163 |[39m       registerServiceWorker(config)[33m;[39m
     [90m 164 |[39m
    [31m[1m>[22m[39m[90m 165 |[39m       expect(navigator[33m.[39mserviceWorker[33m.[39mregister)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 166 |[39m     })[33m;[39m
     [90m 167 |[39m   })[33m;[39m
     [90m 168 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:165:38)

  ● Service Worker Configuration › offline functionality › should configure offline page

    TypeError: Cannot read properties of undefined (reading 'register')

    [0m [90m 176 |[39m       registerServiceWorker(config)[33m;[39m
     [90m 177 |[39m
    [31m[1m>[22m[39m[90m 178 |[39m       expect(navigator[33m.[39mserviceWorker[33m.[39mregister)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 179 |[39m     })[33m;[39m
     [90m 180 |[39m
     [90m 181 |[39m     it([32m'should handle crisis resources offline'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:178:38)

  ● Service Worker Configuration › offline functionality › should handle crisis resources offline

    TypeError: Cannot read properties of undefined (reading 'register')

    [0m [90m 190 |[39m       registerServiceWorker(config)[33m;[39m
     [90m 191 |[39m
    [31m[1m>[22m[39m[90m 192 |[39m       expect(navigator[33m.[39mserviceWorker[33m.[39mregister)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 193 |[39m     })[33m;[39m
     [90m 194 |[39m   })[33m;[39m
     [90m 195 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:192:38)

  ● Service Worker Configuration › push notification support › should configure push notification handling

    TypeError: Cannot read properties of undefined (reading 'register')

    [0m [90m 205 |[39m       registerServiceWorker(config)[33m;[39m
     [90m 206 |[39m
    [31m[1m>[22m[39m[90m 207 |[39m       expect(navigator[33m.[39mserviceWorker[33m.[39mregister)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 208 |[39m     })[33m;[39m
     [90m 209 |[39m
     [90m 210 |[39m     it([32m'should handle background sync for offline actions'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:207:38)

  ● Service Worker Configuration › push notification support › should handle background sync for offline actions

    TypeError: Cannot read properties of undefined (reading 'register')

    [0m [90m 218 |[39m       registerServiceWorker(config)[33m;[39m
     [90m 219 |[39m
    [31m[1m>[22m[39m[90m 220 |[39m       expect(navigator[33m.[39mserviceWorker[33m.[39mregister)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 221 |[39m     })[33m;[39m
     [90m 222 |[39m   })[33m;[39m
     [90m 223 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:220:38)

  ● Service Worker Configuration › performance optimization › should preload critical resources

    TypeError: Cannot read properties of undefined (reading 'register')

    [0m [90m 234 |[39m       registerServiceWorker(config)[33m;[39m
     [90m 235 |[39m
    [31m[1m>[22m[39m[90m 236 |[39m       expect(navigator[33m.[39mserviceWorker[33m.[39mregister)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 237 |[39m     })[33m;[39m
     [90m 238 |[39m
     [90m 239 |[39m     it([32m'should implement resource hinting'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:236:38)

  ● Service Worker Configuration › performance optimization › should implement resource hinting

    TypeError: Cannot read properties of undefined (reading 'register')

    [0m [90m 247 |[39m       registerServiceWorker(config)[33m;[39m
     [90m 248 |[39m
    [31m[1m>[22m[39m[90m 249 |[39m       expect(navigator[33m.[39mserviceWorker[33m.[39mregister)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 250 |[39m     })[33m;[39m
     [90m 251 |[39m   })[33m;[39m
     [90m 252 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:249:38)

  ● Service Worker Configuration › error handling and monitoring › should track service worker performance

    expect(received).toBeInstanceOf(expected)

    Expected constructor: Function
    Received constructor: Function

    [0m [90m 273 |[39m       })[33m;[39m
     [90m 274 |[39m
    [31m[1m>[22m[39m[90m 275 |[39m       expect(performanceHandler)[33m.[39mtoBeInstanceOf([33mFunction[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 276 |[39m     })[33m;[39m
     [90m 277 |[39m   })[33m;[39m
     [90m 278 |[39m })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:275:34)

  console.log
    [CacheIntegration] Initializing intelligent caching...

      at CacheIntegration.initialize (src/services/cacheIntegration.ts:39:13)

  console.log
    [CacheIntegration] Starting cache warming...

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:66:15)

  console.log
    [CacheIntegration] Cache warming completed

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:74:15)

  console.log
    [CacheIntegration] Periodic maintenance scheduled every 30 minutes

      at CacheIntegration.setupPeriodicMaintenance (src/services/cacheIntegration.ts:107:13)

  console.log
    [CacheIntegration] Intelligent caching initialized successfully

      at CacheIntegration.initialize (src/services/cacheIntegration.ts:54:15)

  console.log
    [CacheIntegration] Manual cache warming triggered

      at CacheIntegration.warmCaches (src/services/cacheIntegration.ts:175:13)

  console.log
    [CacheIntegration] Starting cache warming...

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:66:15)

FAIL src/services/__tests__/intelligentCachingService.test.ts
  IntelligentCachingService
    initialization
      √ should initialize successfully (15 ms)
      √ should set up database schema during upgrade (16 ms)
      √ should handle initialization errors gracefully (15 ms)
    cache management
      √ should cache critical resources with highest priority (16 ms)
      × should invalidate cache entries (16 ms)
      √ should get storage info (89 ms)
      × should clean up expired entries (88 ms)
      √ should get cache analytics (68 ms)
    cache eviction and cleanup
      × should perform intelligent eviction when storage is high (79 ms)
      √ should never evict critical resources (200 ms)
      × should clean up expired entries based on retention policy (109 ms)
    storage monitoring
      √ should get storage info correctly (32 ms)
      √ should handle storage quota warnings (16 ms)
    cache warming
      √ should warm critical caches on initialization (164 ms)
      √ should handle cache warming errors gracefully (23 ms)
    analytics and monitoring
      √ should return cache analytics (14 ms)
      √ should return default analytics when DB is not available (18 ms)
      √ should track performance metrics (15 ms)
    cache invalidation
      × should invalidate cache entries (16 ms)
      √ should handle invalidation errors gracefully (14 ms)
    cleanup operations
      √ should clean up expired entries by priority (15 ms)
    error handling
      √ should handle cache operations when DB is not initialized (17 ms)
      √ should handle storage estimate errors (14 ms)

  ● IntelligentCachingService › cache management › should invalidate cache entries

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/cached-resource"

    Number of calls: 0

    [0m [90m 204 |[39m       [36mawait[39m service[33m.[39minvalidateCache(url[33m,[39m [32m'manual'[39m)[33m;[39m
     [90m 205 |[39m       
    [31m[1m>[22m[39m[90m 206 |[39m       expect(mockCache[33m.[39m[36mdelete[39m)[33m.[39mtoHaveBeenCalledWith(url)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 207 |[39m       expect(mockDatabase[33m.[39m[36mdelete[39m)[33m.[39mtoHaveBeenCalledWith(url)[33m;[39m
     [90m 208 |[39m     })[33m;[39m
     [90m 209 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/intelligentCachingService.test.ts:206:32)

  ● IntelligentCachingService › cache management › should clean up expired entries

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/old-resource"

    Number of calls: 0

    [0m [90m 246 |[39m       
     [90m 247 |[39m       expect(cleanedCount)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 248 |[39m       expect(mockCache[33m.[39m[36mdelete[39m)[33m.[39mtoHaveBeenCalledWith([32m'/old-resource'[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 249 |[39m     })[33m;[39m
     [90m 250 |[39m
     [90m 251 |[39m     it([32m'should get cache analytics'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/intelligentCachingService.test.ts:248:32)

  ● IntelligentCachingService › cache eviction and cleanup › should perform intelligent eviction when storage is high

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 307 |[39m       [36mawait[39m service[33m.[39mperformIntelligentEviction()[33m;[39m
     [90m 308 |[39m
    [31m[1m>[22m[39m[90m 309 |[39m       expect(mockCache[33m.[39m[36mdelete[39m)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 310 |[39m     })[33m;[39m
     [90m 311 |[39m
     [90m 312 |[39m     it([32m'should never evict critical resources'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/intelligentCachingService.test.ts:309:32)

  ● IntelligentCachingService › cache eviction and cleanup › should clean up expired entries based on retention policy

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/old-low-priority"

    Number of calls: 0

    [0m [90m 359 |[39m
     [90m 360 |[39m       expect(cleanedCount)[33m.[39mtoBe([35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 361 |[39m       expect(mockCache[33m.[39m[36mdelete[39m)[33m.[39mtoHaveBeenCalledWith([32m'/old-low-priority'[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 362 |[39m       expect(mockCache[33m.[39m[36mdelete[39m)[33m.[39mnot[33m.[39mtoHaveBeenCalledWith([32m'/recent-high-priority'[39m)[33m;[39m
     [90m 363 |[39m     })[33m;[39m
     [90m 364 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/intelligentCachingService.test.ts:361:32)

  ● IntelligentCachingService › cache invalidation › should invalidate cache entries

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/resource-to-invalidate"
    Received: "cache_entries", "/resource-to-invalidate"

    Number of calls: 1

    [0m [90m 512 |[39m       
     [90m 513 |[39m       expect(mockCache[33m.[39m[36mdelete[39m)[33m.[39mtoHaveBeenCalledWith(url)[33m;[39m
    [31m[1m>[22m[39m[90m 514 |[39m       expect(mockDatabase[33m.[39m[36mdelete[39m)[33m.[39mtoHaveBeenCalledWith(url)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 515 |[39m     })[33m;[39m
     [90m 516 |[39m
     [90m 517 |[39m     it([32m'should handle invalidation errors gracefully'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/intelligentCachingService.test.ts:514:35)

  console.log
    [CacheIntegration] Cache warming completed

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:74:15)

  console.log
    [CacheIntegration] Manual cache cleanup triggered

      at CacheIntegration.cleanupCaches (src/services/cacheIntegration.ts:189:13)

  console.log
    [CacheIntegration] Cache integration destroyed

      at CacheIntegration.destroy (src/services/cacheIntegration.ts:406:13)

  console.log
    [CacheIntegration] Initializing intelligent caching...

      at CacheIntegration.initialize (src/services/cacheIntegration.ts:39:13)

  console.log
    [CacheIntegration] Starting cache warming...

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:66:15)

  console.log
    [CacheIntegration] Cache warming completed

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:74:15)

  console.log
    [CacheIntegration] Periodic maintenance scheduled every 30 minutes

      at CacheIntegration.setupPeriodicMaintenance (src/services/cacheIntegration.ts:107:13)

  console.log
    [CacheIntegration] Intelligent caching initialized successfully

      at CacheIntegration.initialize (src/services/cacheIntegration.ts:54:15)

FAIL src/services/__tests__/encryptionService.test.ts
  EncryptionService
    Encryption and Decryption
      × should encrypt and decrypt data successfully (79 ms)
      × should handle string data (1 ms)
      × should handle complex objects (1 ms)
      × should generate different encrypted values for same data
    Key Management
      √ should handle encrypted keys (1 ms)
      √ should clear encryption keys
    Encryption Stats
      × should get encryption statistics (3 ms)
    Secure Storage
      × should store encrypted data in localStorage (1 ms)
      √ should handle missing data gracefully
      √ should remove encrypted data (1 ms)
    HIPAA Compliance
      × should perform HIPAA compliance check (1 ms)
    Data Validation
      √ should validate data integrity (1 ms)
    Error Handling
      √ should handle decryption with invalid data (1 ms)
      √ should handle encryption of undefined data (1 ms)
      × should handle corrupted stored data (1 ms)
    Data Migration
      √ should migrate existing data (2 ms)

  ● EncryptionService › Encryption and Decryption › should encrypt and decrypt data successfully

    Encryption not supported in this browser

    [0m [90m 290 |[39m   [36mpublic[39m [36masync[39m encrypt(data[33m:[39m string[33m,[39m key[33m:[39m string)[33m:[39m [33mPromise[39m[33m<[39m[33mEncryptedData[39m[33m>[39m {
     [90m 291 |[39m     [36mif[39m ([33m![39m[36mthis[39m[33m.[39misSupported) {
    [31m[1m>[22m[39m[90m 292 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Encryption not supported in this browser'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 293 |[39m     }
     [90m 294 |[39m
     [90m 295 |[39m     [36mtry[39m {[0m

      at EncryptionService.encrypt (src/services/encryptionService.ts:292:13)
      at Object.<anonymous> (src/services/__tests__/encryptionService.test.ts:19:54)

  ● EncryptionService › Encryption and Decryption › should handle string data

    Encryption not supported in this browser

    [0m [90m 290 |[39m   [36mpublic[39m [36masync[39m encrypt(data[33m:[39m string[33m,[39m key[33m:[39m string)[33m:[39m [33mPromise[39m[33m<[39m[33mEncryptedData[39m[33m>[39m {
     [90m 291 |[39m     [36mif[39m ([33m![39m[36mthis[39m[33m.[39misSupported) {
    [31m[1m>[22m[39m[90m 292 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Encryption not supported in this browser'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 293 |[39m     }
     [90m 294 |[39m
     [90m 295 |[39m     [36mtry[39m {[0m

      at EncryptionService.encrypt (src/services/encryptionService.ts:292:13)
      at Object.<anonymous> (src/services/__tests__/encryptionService.test.ts:31:54)

  ● EncryptionService › Encryption and Decryption › should handle complex objects

    Encryption not supported in this browser

    [0m [90m 290 |[39m   [36mpublic[39m [36masync[39m encrypt(data[33m:[39m string[33m,[39m key[33m:[39m string)[33m:[39m [33mPromise[39m[33m<[39m[33mEncryptedData[39m[33m>[39m {
     [90m 291 |[39m     [36mif[39m ([33m![39m[36mthis[39m[33m.[39misSupported) {
    [31m[1m>[22m[39m[90m 292 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Encryption not supported in this browser'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 293 |[39m     }
     [90m 294 |[39m
     [90m 295 |[39m     [36mtry[39m {[0m

      at EncryptionService.encrypt (src/services/encryptionService.ts:292:13)
      at Object.<anonymous> (src/services/__tests__/encryptionService.test.ts:54:54)

  ● EncryptionService › Encryption and Decryption › should generate different encrypted values for same data

    Encryption not supported in this browser

    [0m [90m 290 |[39m   [36mpublic[39m [36masync[39m encrypt(data[33m:[39m string[33m,[39m key[33m:[39m string)[33m:[39m [33mPromise[39m[33m<[39m[33mEncryptedData[39m[33m>[39m {
     [90m 291 |[39m     [36mif[39m ([33m![39m[36mthis[39m[33m.[39misSupported) {
    [31m[1m>[22m[39m[90m 292 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Encryption not supported in this browser'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 293 |[39m     }
     [90m 294 |[39m
     [90m 295 |[39m     [36mtry[39m {[0m

      at EncryptionService.encrypt (src/services/encryptionService.ts:292:13)
      at Object.<anonymous> (src/services/__tests__/encryptionService.test.ts:63:55)

  ● EncryptionService › Encryption Stats › should get encryption statistics

    expect(received).toHaveProperty(path)

    Expected path: "totalEncrypted"
    Received path: []

    Received value: {"classifications": {}, "encryptedKeys": 0, "hipaaCompliantKeys": 0, "isSupported": false, "totalKeys": 0}

    [0m [90m 92 |[39m       
     [90m 93 |[39m       expect(stats)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 94 |[39m       expect(stats)[33m.[39mtoHaveProperty([32m'totalEncrypted'[39m)[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 95 |[39m       expect(stats)[33m.[39mtoHaveProperty([32m'totalDecrypted'[39m)[33m;[39m
     [90m 96 |[39m       expect(stats)[33m.[39mtoHaveProperty([32m'encryptionErrors'[39m)[33m;[39m
     [90m 97 |[39m       expect(stats)[33m.[39mtoHaveProperty([32m'decryptionErrors'[39m)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/encryptionService.test.ts:94:21)

  ● EncryptionService › Secure Storage › should store encrypted data in localStorage

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "John Doe"
    Received string:        "{\"id\":1,\"name\":\"John Doe\"}"

    [0m [90m 108 |[39m       [36mconst[39m stored [33m=[39m localStorage[33m.[39mgetItem(key)[33m;[39m
     [90m 109 |[39m       expect(stored)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 110 |[39m       expect(stored)[33m.[39mnot[33m.[39mtoContain([32m'John Doe'[39m)[33m;[39m [90m// Should be encrypted[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 111 |[39m       
     [90m 112 |[39m       [36mconst[39m retrieved [33m=[39m [36mawait[39m getEncryptionService()[33m.[39msecureGetItem(key)[33m;[39m
     [90m 113 |[39m       [36mconst[39m parsedRetrieved [33m=[39m retrieved [33m?[39m [33mJSON[39m[33m.[39mparse(retrieved) [33m:[39m [36mnull[39m[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/encryptionService.test.ts:110:26)

  ● EncryptionService › HIPAA Compliance › should perform HIPAA compliance check

    expect(received).toHaveProperty(path)

    Expected path: "checks"
    Received path: []

    Received value: {"compliant": true, "recommendations": [], "violations": []}

    [0m [90m 137 |[39m       expect(complianceCheck)[33m.[39mtoBeDefined()[33m;[39m
     [90m 138 |[39m       expect(complianceCheck)[33m.[39mtoHaveProperty([32m'compliant'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 139 |[39m       expect(complianceCheck)[33m.[39mtoHaveProperty([32m'checks'[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 140 |[39m     })[33m;[39m
     [90m 141 |[39m   })[33m;[39m
     [90m 142 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/encryptionService.test.ts:139:31)

  ● EncryptionService › Error Handling › should handle corrupted stored data

    expect(received).toBeNull()

    Received: "not-encrypted-data"

    [0m [90m 166 |[39m       localStorage[33m.[39msetItem([32m'corrupted'[39m[33m,[39m [32m'not-encrypted-data'[39m)[33m;[39m
     [90m 167 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getEncryptionService()[33m.[39msecureGetItem([32m'corrupted'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 168 |[39m       expect(result)[33m.[39mtoBeNull()[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 169 |[39m     })[33m;[39m
     [90m 170 |[39m   })[33m;[39m
     [90m 171 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/encryptionService.test.ts:168:22)

  console.log
    [CacheIntegration] Manual cache warming triggered

      at CacheIntegration.warmCaches (src/services/cacheIntegration.ts:175:13)

  console.log
    [CacheIntegration] Starting cache warming...

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:66:15)

  console.log
    [CacheIntegration] Cache warming completed

      at CacheIntegration.initializeCacheWarming (src/services/cacheIntegration.ts:74:15)

  console.log
    [CacheIntegration] Manual cache cleanup triggered

      at CacheIntegration.cleanupCaches (src/services/cacheIntegration.ts:189:13)

PASS src/services/__tests__/cacheIntegration.test.ts
  CacheIntegration
    Class Instantiation
      √ should create a new instance with default config (8 ms)
      √ should create instance with custom config
      √ should use singleton instance
    Initialization
      √ should initialize successfully (176 ms)
      √ should handle multiple initialization calls (7 ms)
      √ should initialize with cache warming disabled (13 ms)
    Cache Warming
      √ should warm caches when initialized (8 ms)
      √ should handle cache warming before initialization (3 ms)
      √ should warm caches with singleton (7 ms)
    Cache Cleanup
      √ should cleanup caches when initialized (5 ms)
      √ should handle cleanup before initialization (2 ms)
      √ should cleanup caches with singleton (2 ms)
    Service Lifecycle
      √ should destroy service cleanly (2 ms)
      √ should handle destroy without initialization (2 ms)
      √ should destroy singleton service (2 ms)
    Error Handling
      √ should handle errors during initialization (6 ms)
      √ should handle errors during cache warming (2 ms)
      √ should handle errors during cleanup (3 ms)
    Configuration Options
      √ should respect enableCacheWarming setting (1 ms)
      √ should respect enableIntelligentEviction setting (1 ms)
      √ should respect enableAnalytics setting (1 ms)
      √ should respect maintenanceInterval setting
    Integration Workflow
      √ should handle full lifecycle (76 ms)
      √ should work with singleton workflow (6 ms)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (35.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /dashboard (2000ms, neutral)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.6000000000000001, Keywords: crisis

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /crisis-resources.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /emergency-contacts.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /offline-crisis.html (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-hotlines.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /immediate-coping-strategies.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-chat-templates.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /crisis-resources (1500ms, neutral)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.6000000000000001, Keywords: crisis

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /crisis-resources.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /emergency-contacts.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /offline-crisis.html (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-hotlines.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /immediate-coping-strategies.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-chat-templates.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /mood-tracker (3000ms, neutral)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.6000000000000001, Keywords: crisis

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading Engine] New session started: session_1755460725051_x28prv45l (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Preloading Engine] New session started: session_1755460725052_xdhoguo7q (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.info
    ✓ Running in demo mode on port 80

      at checkNetlifyFunctions (src/utils/ApiClient.ts:38:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Enhanced Offline Hook] Service initialized successfully

      at initializeOfflineService (src/hooks/useEnhancedOffline.ts:85:17)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (35.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /dashboard (2000ms, neutral)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.warn
    [useConnectionStatus] Failed to check crisis resources: TypeError: Cannot read properties of undefined (reading 'keys')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useConnectionStatus.ts:119:38

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at src/hooks/useConnectionStatus.ts:132:15

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /journal (40.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /mood-tracker (1500ms, neutral)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.info
    ✓ Running in demo mode on port 80

      at checkNetlifyFunctions (src/utils/ApiClient.ts:38:17)

  console.log
    [Preloading] ✅ /mood-tracker (35.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /dashboard (1000ms, neutral)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /journal (40.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /mood-tracker (2000ms, neutral)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'culturallyAdjustedRisk')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:216:32
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:367:19)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at runNextTicks (node:internal/process/task_queues:65:5)
        at listOnTimeout (node:internal/timers:549:9)
        at processTimers (node:internal/timers:523:7)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:367:19)

FAIL src/services/__tests__/peerSupportNetworkService.test.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'join')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:72
        at Array.map (<anonymous>)
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:38
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7
        at runNextTicks (node:internal/process/task_queues:65:5)
        at listOnTimeout (node:internal/timers:549:9)
        at processTimers (node:internal/timers:523:7)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

  console.log
    [Preloading Engine] New session started: session_1755460725117_72cuc62o5 (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Preloading Engine] New session started: session_1755460725119_ecvu7lf8v (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (35.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

FAIL src/contexts/__tests__/AuthContext.test.tsx
  AuthContext
    AuthProvider
      × should provide default values (1 ms)
      × should handle login function
      × should handle logout function (1 ms)
      × should handle updateHelperProfile
    useAuth hook
      × should throw error when used outside provider
      × should return auth context when used within provider
    Global authState
      × should be accessible and updatable (1 ms)

  ● AuthContext › AuthProvider › should provide default values

    TypeError: mockUseNotification.mockReturnValue is not a function

    [0m [90m 15 |[39m   beforeEach(() [33m=>[39m {
     [90m 16 |[39m     jest[33m.[39mclearAllMocks()[33m;[39m
    [31m[1m>[22m[39m[90m 17 |[39m     mockUseNotification[33m.[39mmockReturnValue({
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 18 |[39m       toasts[33m:[39m [][33m,[39m
     [90m 19 |[39m       addToast[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 20 |[39m       removeToast[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.<anonymous> (src/contexts/__tests__/AuthContext.test.tsx:17:25)

  ● AuthContext › AuthProvider › should handle login function

    TypeError: mockUseNotification.mockReturnValue is not a function

    [0m [90m 15 |[39m   beforeEach(() [33m=>[39m {
     [90m 16 |[39m     jest[33m.[39mclearAllMocks()[33m;[39m
    [31m[1m>[22m[39m[90m 17 |[39m     mockUseNotification[33m.[39mmockReturnValue({
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 18 |[39m       toasts[33m:[39m [][33m,[39m
     [90m 19 |[39m       addToast[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 20 |[39m       removeToast[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.<anonymous> (src/contexts/__tests__/AuthContext.test.tsx:17:25)

  ● AuthContext › AuthProvider › should handle logout function

    TypeError: mockUseNotification.mockReturnValue is not a function

    [0m [90m 15 |[39m   beforeEach(() [33m=>[39m {
     [90m 16 |[39m     jest[33m.[39mclearAllMocks()[33m;[39m
    [31m[1m>[22m[39m[90m 17 |[39m     mockUseNotification[33m.[39mmockReturnValue({
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 18 |[39m       toasts[33m:[39m [][33m,[39m
     [90m 19 |[39m       addToast[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 20 |[39m       removeToast[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.<anonymous> (src/contexts/__tests__/AuthContext.test.tsx:17:25)

  ● AuthContext › AuthProvider › should handle updateHelperProfile

    TypeError: mockUseNotification.mockReturnValue is not a function

    [0m [90m 15 |[39m   beforeEach(() [33m=>[39m {
     [90m 16 |[39m     jest[33m.[39mclearAllMocks()[33m;[39m
    [31m[1m>[22m[39m[90m 17 |[39m     mockUseNotification[33m.[39mmockReturnValue({
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 18 |[39m       toasts[33m:[39m [][33m,[39m
     [90m 19 |[39m       addToast[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 20 |[39m       removeToast[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.<anonymous> (src/contexts/__tests__/AuthContext.test.tsx:17:25)

  ● AuthContext › useAuth hook › should throw error when used outside provider

    TypeError: mockUseNotification.mockReturnValue is not a function

    [0m [90m 15 |[39m   beforeEach(() [33m=>[39m {
     [90m 16 |[39m     jest[33m.[39mclearAllMocks()[33m;[39m
    [31m[1m>[22m[39m[90m 17 |[39m     mockUseNotification[33m.[39mmockReturnValue({
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 18 |[39m       toasts[33m:[39m [][33m,[39m
     [90m 19 |[39m       addToast[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 20 |[39m       removeToast[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.<anonymous> (src/contexts/__tests__/AuthContext.test.tsx:17:25)

  ● AuthContext › useAuth hook › should return auth context when used within provider

    TypeError: mockUseNotification.mockReturnValue is not a function

    [0m [90m 15 |[39m   beforeEach(() [33m=>[39m {
     [90m 16 |[39m     jest[33m.[39mclearAllMocks()[33m;[39m
    [31m[1m>[22m[39m[90m 17 |[39m     mockUseNotification[33m.[39mmockReturnValue({
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 18 |[39m       toasts[33m:[39m [][33m,[39m
     [90m 19 |[39m       addToast[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 20 |[39m       removeToast[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.<anonymous> (src/contexts/__tests__/AuthContext.test.tsx:17:25)

  ● AuthContext › Global authState › should be accessible and updatable

    TypeError: mockUseNotification.mockReturnValue is not a function

    [0m [90m 15 |[39m   beforeEach(() [33m=>[39m {
     [90m 16 |[39m     jest[33m.[39mclearAllMocks()[33m;[39m
    [31m[1m>[22m[39m[90m 17 |[39m     mockUseNotification[33m.[39mmockReturnValue({
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 18 |[39m       toasts[33m:[39m [][33m,[39m
     [90m 19 |[39m       addToast[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 20 |[39m       removeToast[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.<anonymous> (src/contexts/__tests__/AuthContext.test.tsx:17:25)

  console.log
    [Preloading Engine] Route tracked: /dashboard (1000ms, neutral)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (35.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /dashboard (1100ms, neutral)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.45, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.error
    Error: Uncaught [TypeError: Cannot read properties of undefined (reading 'culturallyAdjustedRisk')]
        at reportException (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\helpers\runtime-script-errors.js:66:24)
        at innerInvokeEventListeners (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:353:9)
        at invokeEventListeners (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:286:3)
        at HTMLUnknownElementImpl._dispatch (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:233:9)
        at HTMLUnknownElementImpl.dispatchEvent (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:104:17)
        at HTMLUnknownElement.dispatchEvent (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\generated\EventTarget.js:241:34)
        at Object.invokeGuardedCallbackDev (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:4213:16)
        at invokeGuardedCallback (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:4277:31)
        at beginWork$1 (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27490:7)
        at performUnitOfWork (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26599:12)
        at workLoopSync (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26505:5)
        at renderRootSync (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26473:7)
        at performConcurrentWorkOnRoot (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:25777:74)
        at workLoop (C:\Users\damat\_REPOS\CoreV2\node_modules\scheduler\cjs\scheduler.development.js:266:34)
        at flushWork (C:\Users\damat\_REPOS\CoreV2\node_modules\scheduler\cjs\scheduler.development.js:239:14)
        at performWorkUntilDeadline (C:\Users\damat\_REPOS\CoreV2\node_modules\scheduler\cjs\scheduler.development.js:533:21)
        at Timeout.task [as _onTimeout] (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\browser\Window.js:520:19)
        at listOnTimeout (node:internal/timers:588:17)
        at processTimers (node:internal/timers:523:7) {
      detail: TypeError: Cannot read properties of undefined (reading 'culturallyAdjustedRisk')
          at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:150:44
          at basicStateReducer (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:15721:41)
          at updateReducer (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:15845:22)
          at updateState (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:16185:10)
          at Object.useState (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:17096:16)
          at useState (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:1622:21)
          at useCulturalCrisisDetection (C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:79:37)
          at CulturalCrisisAlert (C:\Users\damat\_REPOS\CoreV2\src\components\CulturalCrisisAlert.tsx:84:33)
          at renderWithHooks (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
          at updateFunctionComponent (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:19617:20)
          at beginWork (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:21640:16)
          at HTMLUnknownElement.callCallback (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
          at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
          at innerInvokeEventListeners (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:350:25)
          at invokeEventListeners (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:286:3)
          at HTMLUnknownElementImpl._dispatch (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:233:9)
          at HTMLUnknownElementImpl.dispatchEvent (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:104:17)
          at HTMLUnknownElement.dispatchEvent (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\generated\EventTarget.js:241:34)
          at Object.invokeGuardedCallbackDev (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:4213:16)
          at invokeGuardedCallback (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:4277:31)
          at beginWork$1 (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27490:7)
          at performUnitOfWork (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26599:12)
          at workLoopSync (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26505:5)
          at renderRootSync (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26473:7)
          at performConcurrentWorkOnRoot (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:25777:74)
          at workLoop (C:\Users\damat\_REPOS\CoreV2\node_modules\scheduler\cjs\scheduler.development.js:266:34)
          at flushWork (C:\Users\damat\_REPOS\CoreV2\node_modules\scheduler\cjs\scheduler.development.js:239:14)
          at performWorkUntilDeadline (C:\Users\damat\_REPOS\CoreV2\node_modules\scheduler\cjs\scheduler.development.js:533:21)
          at Timeout.task [as _onTimeout] (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\browser\Window.js:520:19)
          at listOnTimeout (node:internal/timers:588:17)
          at processTimers (node:internal/timers:523:7),
      type: 'unhandled exception'
    }

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at reportException (node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:70:28)
      at innerInvokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
      at invokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
      at HTMLUnknownElementImpl._dispatch (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
      at HTMLUnknownElementImpl.dispatchEvent (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
      at HTMLUnknownElement.dispatchEvent (node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
      at Object.invokeGuardedCallbackDev (node_modules/react-dom/cjs/react-dom.development.js:4213:16)
      at invokeGuardedCallback (node_modules/react-dom/cjs/react-dom.development.js:4277:31)
      at beginWork$1 (node_modules/react-dom/cjs/react-dom.development.js:27490:7)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26599:12)
      at workLoopSync (node_modules/react-dom/cjs/react-dom.development.js:26505:5)
      at renderRootSync (node_modules/react-dom/cjs/react-dom.development.js:26473:7)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25777:74)
      at workLoop (node_modules/scheduler/cjs/scheduler.development.js:266:34)
      at flushWork (node_modules/scheduler/cjs/scheduler.development.js:239:14)
      at performWorkUntilDeadline (node_modules/scheduler/cjs/scheduler.development.js:533:21)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  console.log
    [Preloading] ✅ /crisis-resources.json (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /emergency-contacts.json (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /offline-crisis.html (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-hotlines.json (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /immediate-coping-strategies.json (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-chat-templates.json (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /dashboard (1200ms, neutral)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.45, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /crisis-resources.json (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /emergency-contacts.json (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /offline-crisis.html (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-hotlines.json (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /immediate-coping-strategies.json (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-chat-templates.json (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

FAIL tests/integration/enhancedCrisisDetectionIntegration.test.ts
  Enhanced Crisis Detection Integration
    √ should use enhanced crisis detection by default (6 ms)
    × should fallback to basic detection when enhanced fails (2 ms)
    × should detect various crisis indicators (2 ms)
    √ should not flag normal content as crisis (4 ms)
    √ should provide intervention recommendations for crisis content (3 ms)

  ● Enhanced Crisis Detection Integration › should fallback to basic detection when enhanced fails

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 34 |[39m     [90m// Should still detect crisis even in fallback mode[39m
     [90m 35 |[39m     expect(result)[33m.[39mtoHaveProperty([32m'isCrisis'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 36 |[39m     expect(result[33m.[39misCrisis)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 37 |[39m
     [90m 38 |[39m     console[33m.[39merror [33m=[39m originalConsoleError[33m;[39m
     [90m 39 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/enhancedCrisisDetectionIntegration.test.ts:36:29)

  ● Enhanced Crisis Detection Integration › should detect various crisis indicators

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 51 |[39m     [36mfor[39m ([36mconst[39m text [36mof[39m testCases) {
     [90m 52 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m crisisService[33m.[39manalyze(text)[33m;[39m
    [31m[1m>[22m[39m[90m 53 |[39m       expect(result[33m.[39misCrisis)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 54 |[39m       expect(result[33m.[39mseverity)[33m.[39mnot[33m.[39mtoBe([32m'none'[39m)[33m;[39m
     [90m 55 |[39m     }
     [90m 56 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/enhancedCrisisDetectionIntegration.test.ts:53:31)

  console.log
    [Preloading Engine] Route tracked: /dashboard (1300ms, neutral)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.45, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /crisis-resources.json (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /emergency-contacts.json (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /offline-crisis.html (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-hotlines.json (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /immediate-coping-strategies.json (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-chat-templates.json (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

FAIL src/stores/assessmentStore.test.ts
  assessmentStore
    √ fetchHistory should update state on successful API call (1 ms)
    × submitPhq9Result should call the API and then refresh history (5 ms)
    × submitGad7Result should call the API and then refresh history (2 ms)

  ● assessmentStore › submitPhq9Result should call the API and then refresh history

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/api/assessments/submit", {"body": "{\"type\":\"phq-9\",\"score\":15,\"answers\":[1,2,3,1,2,3,1,2,0],\"timestamp\":{\"inverse\":false}}", "headers": {"Authorization": "Bearer user123", "Content-Type": "application/json"}, "method": "POST"}
    Received
           1
              "/api/assessments/submit",
            @@ -1,7 +1,7 @@
              Object {
            -   "body": "{\"type\":\"phq-9\",\"score\":15,\"answers\":[1,2,3,1,2,3,1,2,0],\"timestamp\":{\"inverse\":false}}",
            +   "body": "{\"type\":\"phq-9\",\"score\":15,\"answers\":[1,2,3,1,2,3,1,2,0],\"timestamp\":\"2025-08-17T19:58:45.070Z\"}",
                "headers": Object {
                  "Authorization": "Bearer user123",
                  "Content-Type": "application/json",
                },
                "method": "POST",,
           2
              "/api/assessments/history",
              Object {
            -   "body": "{\"type\":\"phq-9\",\"score\":15,\"answers\":[1,2,3,1,2,3,1,2,0],\"timestamp\":{\"inverse\":false}}",
                "headers": Object {
                  "Authorization": "Bearer user123",
                  "Content-Type": "application/json",
                },
            -   "method": "POST",
              },

    Number of calls: 2

    [0m [90m 65 |[39m     })[33m;[39m
     [90m 66 |[39m
    [31m[1m>[22m[39m[90m 67 |[39m     expect(mockedFetch)[33m.[39mtoHaveBeenCalledWith([32m'/api/assessments/submit'[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 68 |[39m       method[33m:[39m [32m'POST'[39m[33m,[39m
     [90m 69 |[39m       headers[33m:[39m {
     [90m 70 |[39m         [32m'Authorization'[39m[33m:[39m [32m'Bearer user123'[39m[33m,[39m[0m

      at Object.<anonymous> (src/stores/assessmentStore.test.ts:67:25)

  ● assessmentStore › submitGad7Result should call the API and then refresh history

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/api/assessments/submit", {"body": "{\"type\":\"gad-7\",\"score\":12,\"answers\":[1,2,3,1,2,3,0],\"timestamp\":{\"inverse\":false}}", "headers": {"Authorization": "Bearer user123", "Content-Type": "application/json"}, "method": "POST"}
    Received
           1
              "/api/assessments/submit",
            @@ -1,7 +1,7 @@
              Object {
            -   "body": "{\"type\":\"gad-7\",\"score\":12,\"answers\":[1,2,3,1,2,3,0],\"timestamp\":{\"inverse\":false}}",
            +   "body": "{\"type\":\"gad-7\",\"score\":12,\"answers\":[1,2,3,1,2,3,0],\"timestamp\":\"2025-08-17T19:58:45.077Z\"}",
                "headers": Object {
                  "Authorization": "Bearer user123",
                  "Content-Type": "application/json",
                },
                "method": "POST",,
           2
              "/api/assessments/history",
              Object {
            -   "body": "{\"type\":\"gad-7\",\"score\":12,\"answers\":[1,2,3,1,2,3,0],\"timestamp\":{\"inverse\":false}}",
                "headers": Object {
                  "Authorization": "Bearer user123",
                  "Content-Type": "application/json",
                },
            -   "method": "POST",
              },

    Number of calls: 2

    [0m [90m 101 |[39m     })[33m;[39m
     [90m 102 |[39m
    [31m[1m>[22m[39m[90m 103 |[39m     expect(mockedFetch)[33m.[39mtoHaveBeenCalledWith([32m'/api/assessments/submit'[39m[33m,[39m {
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 104 |[39m       method[33m:[39m [32m'POST'[39m[33m,[39m
     [90m 105 |[39m       headers[33m:[39m {
     [90m 106 |[39m         [32m'Authorization'[39m[33m:[39m [32m'Bearer user123'[39m[33m,[39m[0m

      at Object.<anonymous> (src/stores/assessmentStore.test.ts:103:25)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /dashboard (1400ms, neutral)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.45, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /crisis-resources.json (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /emergency-contacts.json (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /offline-crisis.html (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-hotlines.json (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /immediate-coping-strategies.json (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-chat-templates.json (45.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /mood-tracker (1500ms, neutral)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.45, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading Engine] New session started: session_1755460725171_n830wz7y1 (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Preloading Engine] New session started: session_1755460725172_h7ppljtwb (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Crisis Detection] Risk level: 0.6000000000000001, Keywords: crisis

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /crisis-resources.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /emergency-contacts.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /offline-crisis.html (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-hotlines.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /immediate-coping-strategies.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-chat-templates.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /emergency-contacts (80.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /crisis-resources (500ms, crisis)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.6000000000000001, Keywords: crisis, emergency

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /coping-strategies.json (85.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /emergency-contacts.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /offline-crisis.html (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-hotlines.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /immediate-coping-strategies.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-chat-templates.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /emergency-coping.json (75.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /helpers (72.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /emergency-contacts (300ms, distressed)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.6000000000000001, Keywords: crisis, emergency

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading Engine] New session started: session_1755460725190_vppc3yfpb (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Preloading Engine] New session started: session_1755460725191_qp9jc5zt5 (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Crisis Detection] Risk level: 0.6000000000000001, Keywords: crisis

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /crisis-resources.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /emergency-contacts.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /offline-crisis.html (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.info
    ✓ Running in demo mode on port 80

      at checkNetlifyFunctions (src/utils/ApiClient.ts:38:17)

  console.log
    [Preloading] ✅ /crisis-hotlines.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /immediate-coping-strategies.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-chat-templates.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /emergency-contacts (80.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /crisis-resources (1000ms, crisis)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.6000000000000001, Keywords: crisis

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading Engine] New session started: session_1755460725199_bz8udd6mk (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Preloading Engine] New session started: session_1755460725200_7znu8vmuh (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /meditation (2000ms, neutral)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /breathing-exercises (1500ms, neutral)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading Engine] New session started: session_1755460725209_sk5pmad1p (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

FAIL src/contexts/__tests__/ThemeContext.test.tsx
  ThemeContext
    ThemeProvider
      √ should provide default light theme (83 ms)
      × should handle theme toggle (6 ms)
      × should persist theme to localStorage (2 ms)
      √ should load theme from localStorage on mount (2 ms)
      × should provide correct dark theme config (3 ms)
      × should apply theme class to document root (4 ms)
    useTheme hook
      √ should throw error when used outside provider (111 ms)
      √ should return theme context when used within provider (3 ms)
      √ should provide all expected theme properties (3 ms)

  ● ThemeContext › ThemeProvider › should handle theme toggle

    expect(element).toHaveTextContent()

    Expected element to have text content:
      dark
    Received:
      light

    [0m [90m 58 |[39m       })[33m;[39m
     [90m 59 |[39m
    [31m[1m>[22m[39m[90m 60 |[39m       expect(screen[33m.[39mgetByTestId([32m'theme'[39m))[33m.[39mtoHaveTextContent([32m'dark'[39m)[33m;[39m
     [90m    |[39m                                           [31m[1m^[22m[39m
     [90m 61 |[39m
     [90m 62 |[39m       [90m// Toggle back to light theme[39m
     [90m 63 |[39m       act(() [33m=>[39m {[0m

      at Object.<anonymous> (src/contexts/__tests__/ThemeContext.test.tsx:60:43)

  ● ThemeContext › ThemeProvider › should persist theme to localStorage

    expect(received).toBeNull()

    Received: "light"

    [0m [90m 81 |[39m
     [90m 82 |[39m       [90m// Initially no theme in localStorage[39m
    [31m[1m>[22m[39m[90m 83 |[39m       expect(localStorage[33m.[39mgetItem([32m'theme'[39m))[33m.[39mtoBeNull()[33m;[39m
     [90m    |[39m                                             [31m[1m^[22m[39m
     [90m 84 |[39m
     [90m 85 |[39m       [90m// Toggle to dark theme[39m
     [90m 86 |[39m       act(() [33m=>[39m {[0m

      at Object.<anonymous> (src/contexts/__tests__/ThemeContext.test.tsx:83:45)

  ● ThemeContext › ThemeProvider › should provide correct dark theme config

    expect(element).toHaveTextContent()

    Expected element to have text content:
      #1a1a1a
    Received:
      #161b22

    [0m [90m 136 |[39m       )[33m;[39m
     [90m 137 |[39m
    [31m[1m>[22m[39m[90m 138 |[39m       expect(screen[33m.[39mgetByTestId([32m'bg-primary'[39m))[33m.[39mtoHaveTextContent([32m'#1a1a1a'[39m)[33m;[39m
     [90m     |[39m                                                [31m[1m^[22m[39m
     [90m 139 |[39m       expect(screen[33m.[39mgetByTestId([32m'text-primary'[39m))[33m.[39mtoHaveTextContent([32m'#e0e0e0'[39m)[33m;[39m
     [90m 140 |[39m     })[33m;[39m
     [90m 141 |[39m[0m

      at Object.<anonymous> (src/contexts/__tests__/ThemeContext.test.tsx:138:48)

  ● ThemeContext › ThemeProvider › should apply theme class to document root

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 153 |[39m
     [90m 154 |[39m       [90m// Initially light theme[39m
    [31m[1m>[22m[39m[90m 155 |[39m       expect(document[33m.[39mdocumentElement[33m.[39mclassList[33m.[39mcontains([32m'theme-light'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                                          [31m[1m^[22m[39m
     [90m 156 |[39m       expect(document[33m.[39mdocumentElement[33m.[39mclassList[33m.[39mcontains([32m'theme-dark'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 157 |[39m
     [90m 158 |[39m       [90m// Toggle to dark theme[39m[0m

      at Object.<anonymous> (src/contexts/__tests__/ThemeContext.test.tsx:155:74)

  console.log
    [Preloading Engine] New session started: session_1755460725211_4jey8fayu (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Crisis Detection] Risk level: 0, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.warn
    [Push] Push notifications not supported in this browser

    [0m [90m 258 |[39m       console[33m.[39mlog([32m'[Push] Push notifications supported, permission:'[39m[33m,[39m [36mthis[39m[33m.[39mpermissionStatus)[33m;[39m
     [90m 259 |[39m     } [36melse[39m {
    [31m[1m>[22m[39m[90m 260 |[39m       console[33m.[39mwarn([32m'[Push] Push notifications not supported in this browser'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 261 |[39m     }
     [90m 262 |[39m   }
     [90m 263 |[39m[0m

      at PushNotificationService.checkSupport (src/services/pushNotificationService.ts:260:15)
      at new PushNotificationService (src/services/pushNotificationService.ts:45:10)
      at Object.<anonymous> (src/services/pushNotificationService.ts:742:40)
      at Object.<anonymous> (src/services/__tests__/pushNotificationService.test.ts:1:1)

  console.info
    ✓ Running in demo mode on port 80

      at checkNetlifyFunctions (src/utils/ApiClient.ts:38:17)

  console.warn
    [useConnectionStatus] Failed to check crisis resources: TypeError: Cannot read properties of undefined (reading 'keys')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useConnectionStatus.ts:119:38

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at src/hooks/useConnectionStatus.ts:132:15

  console.error
    Error: Uncaught [TypeError: Cannot read properties of undefined (reading 'culturallyAdjustedRisk')]
        at reportException (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\helpers\runtime-script-errors.js:66:24)
        at innerInvokeEventListeners (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:353:9)
        at invokeEventListeners (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:286:3)
        at HTMLUnknownElementImpl._dispatch (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:233:9)
        at HTMLUnknownElementImpl.dispatchEvent (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:104:17)
        at HTMLUnknownElement.dispatchEvent (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\generated\EventTarget.js:241:34)
        at Object.invokeGuardedCallbackDev (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:4213:16)
        at invokeGuardedCallback (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:4277:31)
        at beginWork$1 (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27490:7)
        at performUnitOfWork (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26599:12)
        at workLoopSync (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26505:5)
        at renderRootSync (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26473:7)
        at recoverFromConcurrentError (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:25889:20)
        at performConcurrentWorkOnRoot (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:25789:22)
        at workLoop (C:\Users\damat\_REPOS\CoreV2\node_modules\scheduler\cjs\scheduler.development.js:266:34)
        at flushWork (C:\Users\damat\_REPOS\CoreV2\node_modules\scheduler\cjs\scheduler.development.js:239:14)
        at performWorkUntilDeadline (C:\Users\damat\_REPOS\CoreV2\node_modules\scheduler\cjs\scheduler.development.js:533:21)
        at Timeout.task [as _onTimeout] (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\browser\Window.js:520:19)
        at listOnTimeout (node:internal/timers:588:17)
        at processTimers (node:internal/timers:523:7) {
      detail: TypeError: Cannot read properties of undefined (reading 'culturallyAdjustedRisk')
          at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:150:44
          at basicStateReducer (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:15721:41)
          at updateReducer (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:15845:22)
          at updateState (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:16185:10)
          at Object.useState (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:17096:16)
          at useState (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:1622:21)
          at useCulturalCrisisDetection (C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:79:37)
          at CulturalCrisisAlert (C:\Users\damat\_REPOS\CoreV2\src\components\CulturalCrisisAlert.tsx:84:33)
          at renderWithHooks (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
          at updateFunctionComponent (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:19617:20)
          at beginWork (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:21640:16)
          at HTMLUnknownElement.callCallback (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
          at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
          at innerInvokeEventListeners (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:350:25)
          at invokeEventListeners (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:286:3)
          at HTMLUnknownElementImpl._dispatch (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:233:9)
          at HTMLUnknownElementImpl.dispatchEvent (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:104:17)
          at HTMLUnknownElement.dispatchEvent (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\generated\EventTarget.js:241:34)
          at Object.invokeGuardedCallbackDev (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:4213:16)
          at invokeGuardedCallback (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:4277:31)
          at beginWork$1 (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27490:7)
          at performUnitOfWork (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26599:12)
          at workLoopSync (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26505:5)
          at renderRootSync (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26473:7)
          at recoverFromConcurrentError (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:25889:20)
          at performConcurrentWorkOnRoot (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:25789:22)
          at workLoop (C:\Users\damat\_REPOS\CoreV2\node_modules\scheduler\cjs\scheduler.development.js:266:34)
          at flushWork (C:\Users\damat\_REPOS\CoreV2\node_modules\scheduler\cjs\scheduler.development.js:239:14)
          at performWorkUntilDeadline (C:\Users\damat\_REPOS\CoreV2\node_modules\scheduler\cjs\scheduler.development.js:533:21)
          at Timeout.task [as _onTimeout] (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\browser\Window.js:520:19)
          at listOnTimeout (node:internal/timers:588:17)
          at processTimers (node:internal/timers:523:7),
      type: 'unhandled exception'
    }

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at reportException (node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:70:28)
      at innerInvokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
      at invokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
      at HTMLUnknownElementImpl._dispatch (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
      at HTMLUnknownElementImpl.dispatchEvent (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
      at HTMLUnknownElement.dispatchEvent (node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
      at Object.invokeGuardedCallbackDev (node_modules/react-dom/cjs/react-dom.development.js:4213:16)
      at invokeGuardedCallback (node_modules/react-dom/cjs/react-dom.development.js:4277:31)
      at beginWork$1 (node_modules/react-dom/cjs/react-dom.development.js:27490:7)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26599:12)
      at workLoopSync (node_modules/react-dom/cjs/react-dom.development.js:26505:5)
      at renderRootSync (node_modules/react-dom/cjs/react-dom.development.js:26473:7)
      at recoverFromConcurrentError (node_modules/react-dom/cjs/react-dom.development.js:25889:20)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25789:22)
      at workLoop (node_modules/scheduler/cjs/scheduler.development.js:266:34)
      at flushWork (node_modules/scheduler/cjs/scheduler.development.js:239:14)
      at performWorkUntilDeadline (node_modules/scheduler/cjs/scheduler.development.js:533:21)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  console.error
    The above error occurred in the <CulturalCrisisAlert> component:
    
        at CulturalCrisisAlert (C:\Users\damat\_REPOS\CoreV2\src\components\CulturalCrisisAlert.tsx:42:3)
        at MockAuthProvider (C:\Users\damat\_REPOS\CoreV2\src\test-utils\mockContexts.tsx:91:3)
        at MockNotificationProvider (C:\Users\damat\_REPOS\CoreV2\src\test-utils\mockContexts.tsx:117:3)
        at MockThemeProvider (C:\Users\damat\_REPOS\CoreV2\src\test-utils\mockContexts.tsx:140:3)
        at AllMockProviders (C:\Users\damat\_REPOS\CoreV2\src\test-utils\mockContexts.tsx:166:3)
        at AllTheProviders (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:26:69)
    
    Consider adding an error boundary to your tree to customize error handling behavior.
    Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at logCapturedError (node_modules/react-dom/cjs/react-dom.development.js:18704:23)
      at update.callback (node_modules/react-dom/cjs/react-dom.development.js:18737:5)
      at callCallback (node_modules/react-dom/cjs/react-dom.development.js:15036:12)
      at commitUpdateQueue (node_modules/react-dom/cjs/react-dom.development.js:15057:9)
      at commitLayoutEffectOnFiber (node_modules/react-dom/cjs/react-dom.development.js:23430:13)
      at commitLayoutMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24727:9)
      at commitLayoutEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24713:7)
      at commitLayoutEffects (node_modules/react-dom/cjs/react-dom.development.js:24651:3)
      at commitRootImpl (node_modules/react-dom/cjs/react-dom.development.js:26862:5)
      at commitRoot (node_modules/react-dom/cjs/react-dom.development.js:26721:5)
      at finishConcurrentRender (node_modules/react-dom/cjs/react-dom.development.js:25931:9)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25848:7)
      at workLoop (node_modules/scheduler/cjs/scheduler.development.js:266:34)
      at flushWork (node_modules/scheduler/cjs/scheduler.development.js:239:14)
      at performWorkUntilDeadline (node_modules/scheduler/cjs/scheduler.development.js:533:21)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

PASS src/services/__tests__/enhancedCrisisDetectionIntegrationService.test.ts
  EnhancedCrisisDetectionIntegrationService
    Comprehensive Crisis Analysis
      √ should perform comprehensive crisis analysis (154 ms)
      √ should provide intervention recommendations (1 ms)
      √ should analyze risk levels (1 ms)
      √ should include component analysis results
    Error Handling
      √ should handle empty text input (1 ms)
      √ should handle very long text input (1 ms)

  console.info
    ✓ Running in demo mode on port 80

      at checkNetlifyFunctions (src/utils/ApiClient.ts:38:17)

  console.error
    Error: Uncaught [TypeError: Cannot read properties of undefined (reading 'culturallyAdjustedRisk')]
        at reportException (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\living\helpers\runtime-script-errors.js:66:24)
        at Timeout.task [as _onTimeout] (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\browser\Window.js:525:9)
        at listOnTimeout (node:internal/timers:588:17)
        at processTimers (node:internal/timers:523:7) {
      detail: TypeError: Cannot read properties of undefined (reading 'culturallyAdjustedRisk')
          at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:150:44
          at basicStateReducer (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:15721:41)
          at updateReducer (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:15845:22)
          at updateState (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:16185:10)
          at Object.useState (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:17096:16)
          at useState (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:1622:21)
          at useCulturalCrisisDetection (C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:79:37)
          at CulturalCrisisAlert (C:\Users\damat\_REPOS\CoreV2\src\components\CulturalCrisisAlert.tsx:84:33)
          at renderWithHooks (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
          at updateFunctionComponent (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:19617:20)
          at beginWork (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:21640:16)
          at beginWork$1 (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27465:14)
          at performUnitOfWork (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26599:12)
          at workLoopSync (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26505:5)
          at renderRootSync (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26473:7)
          at recoverFromConcurrentError (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:25889:20)
          at performConcurrentWorkOnRoot (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:25789:22)
          at workLoop (C:\Users\damat\_REPOS\CoreV2\node_modules\scheduler\cjs\scheduler.development.js:266:34)
          at flushWork (C:\Users\damat\_REPOS\CoreV2\node_modules\scheduler\cjs\scheduler.development.js:239:14)
          at performWorkUntilDeadline (C:\Users\damat\_REPOS\CoreV2\node_modules\scheduler\cjs\scheduler.development.js:533:21)
          at Timeout.task [as _onTimeout] (C:\Users\damat\_REPOS\CoreV2\node_modules\jsdom\lib\jsdom\browser\Window.js:520:19)
          at listOnTimeout (node:internal/timers:588:17)
          at processTimers (node:internal/timers:523:7),
      type: 'unhandled exception'
    }

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at reportException (node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:70:28)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:525:9)

  console.warn
    [useConnectionStatus] Failed to check crisis resources: TypeError: Cannot read properties of undefined (reading 'keys')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useConnectionStatus.ts:119:38

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at src/hooks/useConnectionStatus.ts:132:15

PASS src/services/__tests__/pwaService.test.ts
  PWAService
    √ should have at least one test (55 ms)

  console.log
    [Enhanced Offline Hook] Service initialized successfully

      at initializeOfflineService (src/hooks/useEnhancedOffline.ts:85:17)

  console.log
    [Preloading Engine] New session started: session_1755460725272_9skcah5gq (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Preloading Engine] New session started: session_1755460725273_yq6rclewu (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /help-resources.json (90.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /support-options.json (85.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.warn
    [useConnectionStatus] Failed to check crisis resources: TypeError: Cannot read properties of undefined (reading 'keys')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useConnectionStatus.ts:119:38

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at src/hooks/useConnectionStatus.ts:132:15

  console.log
    [Preloading] ✅ /coping-strategies.json (80.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.error
    Failed to fetch dilemmas: TypeError: Cannot read properties of undefined (reading 'filter')
        at calculateDerivedState (C:\Users\damat\_REPOS\CoreV2\src\stores\dilemmaStore.ts:55:46)
        at C:\Users\damat\_REPOS\CoreV2\src\stores\dilemmaStore.ts:119:20
        at setState (C:\Users\damat\_REPOS\CoreV2\node_modules\zustand\vanilla.js:7:53)
        at Object.fetchDilemmas (C:\Users\damat\_REPOS\CoreV2\src\stores\dilemmaStore.ts:115:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

    [0m [90m 120 |[39m             }))[33m;[39m
     [90m 121 |[39m         } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 122 |[39m             console[33m.[39merror([32m"Failed to fetch dilemmas:"[39m[33m,[39m error)[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 123 |[39m             [90m// Provide sample community posts when API fails[39m
     [90m 124 |[39m             [36mconst[39m sampleCommunityPosts[33m:[39m [33mDilemma[39m[] [33m=[39m [
     [90m 125 |[39m                 {[0m

      at Object.fetchDilemmas (src/stores/dilemmaStore.ts:122:21)

  console.log
    [Preloading] ✅ /helper-availability.json (80.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /assessment-follow-up.json (70.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /journal (40.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /mood-tracker (2000ms, seeking-help)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /progress-insights.json (75.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /progress-goals.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /guided-meditation (1500ms, maintenance)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading Engine] New session started: session_1755460725287_ltvdyntth (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Preloading Engine] New session started: session_1755460725289_8heg9zxhx (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.warn
    [useConnectionStatus] Failed to check crisis resources: TypeError: Cannot read properties of undefined (reading 'keys')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useConnectionStatus.ts:119:38

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at src/hooks/useConnectionStatus.ts:132:15

  console.error
    Failed to fetch dilemmas: Error: API Error
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\stores\dilemmaStore.test.ts:42:60)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at Object.fetchDilemmas (src/stores/dilemmaStore.ts:122:21)
      at src/stores/dilemmaStore.test.ts:45:7

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (35.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /dashboard (2000ms, neutral)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

PASS src/stores/wellnessStore.test.ts
  wellnessStore
    √ fetchHistory should update state on successful API call (14 ms)
    √ postCheckIn should call the API and then refresh history (1 ms)
    √ fetchHabits should fetch all data and calculate streaks (2 ms)

  console.log
    [Preloading Engine] New session started: session_1755460725297_divoubre9 (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Preloading Engine] New session started: session_1755460725298_avxsirin5 (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Crisis Detection] Risk level: 0, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading Engine] New session started: session_1755460725300_lea3vscb4 (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Preloading Engine] New session started: session_1755460725301_8ol2p39mm (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Crisis Detection] Risk level: 0, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

PASS src/stores/dilemmaStore.test.ts
  dilemmaStore
    √ fetchDilemmas should update state on successful API call (3 ms)
    √ fetchDilemmas should handle API errors (20 ms)
    √ postDilemma should call the API and refresh dilemmas
    √ toggleSupport should optimistically update the state and call the API

  console.log
    [Preloading Engine] New session started: session_1755460725303_53zvgcqf7 (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Preloading Engine] New session started: session_1755460725304_o4acjfkvu (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Crisis Detection] Risk level: 0, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)
          at async Promise.all (index 0)

  console.log
    [Crisis Detection] Risk level: 0, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)
          at async Promise.all (index 1)

  console.warn
    [Push] Push notifications not supported in this browser

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at PushNotificationService.checkSupport (src/services/pushNotificationService.ts:260:15)
      at PushNotificationService.initialize (src/services/pushNotificationService.ts:53:10)
      at Object.<anonymous> (src/services/__tests__/pushNotificationService.test.ts:39:21)

  console.log
    [Crisis Detection] Risk level: 0, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)
          at async Promise.all (index 2)

  console.log
    [Crisis Detection] Risk level: 0, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)
          at async Promise.all (index 3)

  console.log
    [Crisis Detection] Risk level: 0, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)
          at async Promise.all (index 4)

  console.log
    [Preloading Engine] New session started: session_1755460725319_tgszvsklt (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Preloading Engine] New session started: session_1755460725320_ga6o91vau (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /help-resources.json (90.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /support-options.json (85.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /coping-strategies.json (80.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /helper-availability.json (80.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.warn
    [Push] Push notifications not supported

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at PushNotificationService.requestPermission (src/services/pushNotificationService.ts:301:15)
      at Object.<anonymous> (src/services/__tests__/pushNotificationService.test.ts:45:40)

  console.log
    [Preloading] ✅ /assessment-follow-up.json (70.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.error
    Failed to send kudos: Error: API Error
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\stores\sessionStore.test.ts:73:62)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at Object.sendKudos (src/stores/sessionStore.ts:77:15)
      at src/stores/sessionStore.test.ts:76:7

PASS src/stores/sessionStore.test.ts
  sessionStore
    √ fetchHelpSessions should update state on successful API call (12 ms)
    √ toggleFavorite should call the API and update the session in the store (1 ms)
    √ sendKudos should optimistically update and then call the API (1 ms)
    √ sendKudos should revert optimistic update on API failure (59 ms)

FAIL src/services/__tests__/culturalCrisisDetectionService.test.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

  console.error
    Failed to fetch dilemmas: TypeError: Cannot read properties of undefined (reading 'filter')
        at calculateDerivedState (C:\Users\damat\_REPOS\CoreV2\src\stores\dilemmaStore.ts:55:46)
        at C:\Users\damat\_REPOS\CoreV2\src\stores\dilemmaStore.ts:119:20
        at setState (C:\Users\damat\_REPOS\CoreV2\node_modules\zustand\vanilla.js:7:53)
        at Object.fetchDilemmas (C:\Users\damat\_REPOS\CoreV2\src\stores\dilemmaStore.ts:115:13)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

    [0m [90m 120 |[39m             }))[33m;[39m
     [90m 121 |[39m         } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 122 |[39m             console[33m.[39merror([32m"Failed to fetch dilemmas:"[39m[33m,[39m error)[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 123 |[39m             [90m// Provide sample community posts when API fails[39m
     [90m 124 |[39m             [36mconst[39m sampleCommunityPosts[33m:[39m [33mDilemma[39m[] [33m=[39m [
     [90m 125 |[39m                 {[0m

      at Object.fetchDilemmas (src/stores/dilemmaStore.ts:122:21)

PASS src/stores/chatStore.test.ts
  chatStore
    √ startChat should fetch messages and set the active chat (3 ms)
    √ sendMessage should add an optimistic message and call the API (2 ms)
    √ closeChat should clear active chat and trigger feedback modal

FAIL src/services/__tests__/accessibilityService.test.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /assessment (3000ms, seeking-help)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /help-resources.json (90.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /support-options.json (85.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /coping-strategies.json (80.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /helper-availability.json (80.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /assessment-follow-up.json (70.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /coping-strategies (2000ms, seeking-help)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /progress-insights.json (75.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /progress-goals.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /progress-tracking (1500ms, maintenance)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

FAIL src/services/__tests__/mobileNetworkService.test.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

  console.log
    [Preloading Engine] New session started: session_1755460725414_b634iz0sg (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Preloading Engine] New session started: session_1755460725415_gkn1kztuy (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Crisis Detection] Risk level: 0.6000000000000001, Keywords: help

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /help-resources.json (90.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /emergency-contacts.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /offline-crisis.html (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-hotlines.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /immediate-coping-strategies.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-chat-templates.json (60.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /support-options.json (85.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /coping-strategies.json (80.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.warn
    [useConnectionStatus] Failed to check crisis resources: TypeError: Cannot read properties of undefined (reading 'keys')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useConnectionStatus.ts:119:38

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at src/hooks/useConnectionStatus.ts:132:15

  console.log
    [Preloading] ✅ /helper-availability.json (80.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /get-help (1000ms, seeking-help)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.6000000000000001, Keywords: help

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading Engine] New session started: session_1755460725426_4ouwg362v (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Preloading Engine] New session started: session_1755460725428_3yncyy212 (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Preloading Engine] New session started: session_1755460725429_2ght6tuik (afternoon, sun)

      at IntelligentPreloadingEngine.startNewSession (src/services/intelligentPreloading.ts:153:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

  console.log
    [Preloading] ✅ /meditation (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /breathing-exercises (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /crisis-resources (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (50.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading] ✅ /mood-tracker (35.0% confidence)

      at IntelligentPreloadingEngine.executePreloading (src/services/intelligentPreloading.ts:448:17)

  console.log
    [Preloading Engine] Route tracked: /dashboard (2000ms, neutral)

      at IntelligentPreloadingEngine.trackRouteNavigation (src/services/intelligentPreloading.ts:194:13)

  console.log
    [Crisis Detection] Risk level: 0.2, Keywords:

      at IntelligentPreloadingEngine.predictCrisisResources (src/services/intelligentPreloading.ts:323:15)

FAIL src/services/__tests__/errorTracking.test.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/services/__tests__/intelligentPreloading.test.ts
  IntelligentPreloadingEngine
    Session Management
      √ should start a new session (12 ms)
      √ should handle multiple route navigations (107 ms)
    Route Prediction Model
      × should predict next routes based on navigation patterns (26 ms)
      √ should prioritize frequently visited routes (54 ms)
    Crisis Detection and Prioritization
      √ should generate crisis resource predictions (19 ms)
      √ should prioritize crisis resources over normal content (9 ms)
    Resource Usage Prediction
      × should predict resource needs based on patterns (10 ms)
    Time-Based Predictions
      √ should consider time of day for predictions (62 ms)
    Emotional Journey Tracking
      √ should predict resources based on emotional context (16 ms)
    Prediction Quality
      √ should generate predictions with confidence scores (10 ms)
      √ should filter low-confidence predictions (3 ms)
    Performance Characteristics
      √ should generate predictions efficiently (3 ms)
      √ should handle concurrent prediction requests (16 ms)
    Mental Health Optimization
      √ should optimize for mental health platform needs (94 ms)
      √ should prioritize help-seeking behavior resources (11 ms)
  Intelligent Preloading Integration
    √ should integrate with existing caching system (2 ms)
    √ should provide prediction analytics (9 ms)

  ● IntelligentPreloadingEngine › Route Prediction Model › should predict next routes based on navigation patterns

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 45 |[39m
     [90m 46 |[39m       expect(routePredictions[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 47 |[39m       expect(routePredictions[33m.[39msome(p [33m=>[39m p[33m.[39mconfidence [33m>[39m [35m0.5[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m    |[39m                                                              [31m[1m^[22m[39m
     [90m 48 |[39m     })[33m;[39m
     [90m 49 |[39m
     [90m 50 |[39m     it([32m'should prioritize frequently visited routes'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/intelligentPreloading.test.ts:47:62)

  ● IntelligentPreloadingEngine › Resource Usage Prediction › should predict resource needs based on patterns

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 102 |[39m       )[33m;[39m
     [90m 103 |[39m
    [31m[1m>[22m[39m[90m 104 |[39m       expect(resourcePredictions[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 105 |[39m     })[33m;[39m
     [90m 106 |[39m   })[33m;[39m
     [90m 107 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/intelligentPreloading.test.ts:104:42)

  console.log
    [Enhanced Offline Hook] Service initialized successfully

      at initializeOfflineService (src/hooks/useEnhancedOffline.ts:85:17)

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:367:19)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:367:19)

FAIL src/services/__tests__/cacheStrategyCoordinator.test.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

  console.warn
    [Push] Push notifications not supported

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at PushNotificationService.requestPermission (src/services/pushNotificationService.ts:301:15)
      at PushNotificationService.subscribe (src/services/pushNotificationService.ts:72:34)
      at Object.<anonymous> (src/services/__tests__/pushNotificationService.test.ts:64:42)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'join')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:72
        at Array.map (<anonymous>)
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:38
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

  console.warn
    [Push] Push notifications not supported

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at PushNotificationService.requestPermission (src/services/pushNotificationService.ts:301:15)
      at PushNotificationService.subscribe (src/services/pushNotificationService.ts:72:34)
      at PushNotificationService.subscribeToCrisisAlerts (src/services/pushNotificationService.ts:89:37)
      at Object.<anonymous> (src/services/__tests__/pushNotificationService.test.ts:70:36)

PASS src/test-env-check.test.tsx
  Test Environment Check
    √ should render a simple div (113 ms)
    √ should render a button (10 ms)
    √ should render inside root element (5 ms)

  console.info
    ✓ Running in demo mode on port 80

      at checkNetlifyFunctions (src/utils/ApiClient.ts:38:17)

  console.log
    [ScreenReader] Service initialized

      at ScreenReaderService.initialize (src/services/screenReaderService.ts:56:15)

  console.warn
    [Push] Push notifications not supported

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at PushNotificationService.requestPermission (src/services/pushNotificationService.ts:301:15)
      at Object.<anonymous> (src/services/__tests__/pushNotificationService.test.ts:145:40)

  console.warn
    [Push] Push notifications not supported in this browser

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at PushNotificationService.checkSupport (src/services/pushNotificationService.ts:260:15)
      at PushNotificationService.initialize (src/services/pushNotificationService.ts:53:10)
      at Object.<anonymous> (src/services/__tests__/pushNotificationService.test.ts:155:52)

  console.log
    Astral Core Analytics: User data export requested: {
      user: { userId: 'test-user-123' },
      events: [],
      journey: {
        sessionId: 'session_1755460725371_fotc5r5lh',
        startTime: 1755460725371,
        events: [
          [Object], [Object], [Object],
          [Object], [Object], [Object],
          [Object], [Object], [Object],
          [Object], [Object], [Object],
          [Object], [Object], [Object],
          [Object], [Object], [Object],
          [Object], [Object], [Object],
          [Object]
        ],
        pageViews: [ 'page_view', 'page_view', 'page_view' ],
        features: [ 'test_feature_click' ],
        errors: [ 'error' ],
        crisisInterventions: [ 'crisis_detected', 'crisis_action' ],
        wellnessActivities: [ 'meditation', 'mood_check' ],
        consentStatus: {
          analytics: false,
          performance: false,
          functionality: true,
          marketing: false,
          timestamp: 1234567890000,
          version: '1.0.0'
        }
      },
      consentStatus: {
        analytics: false,
        performance: false,
        functionality: true,
        marketing: false,
        timestamp: 1234567890000,
        version: '1.0.0'
      },
      exportRequest: {
        userId: 'test-user-123',
        requestDate: 1234567890000,
        includeAnalytics: true,
        includeJourneys: true,
        format: 'json',
        status: 'pending'
      }
    }

      at AnalyticsService.exportUserData (src/services/analyticsService.ts:669:15)

PASS src/hooks/useMobileForm.test.ts
  useMobileForm Hook
    √ should initialize with empty form state (4 ms)
    √ should initialize with initial values (2 ms)
    √ should update field value (3 ms)
    √ should set field validation state (2 ms)
    √ should mark field as touched (2 ms)
    √ should set field validating state (2 ms)
    √ should get field props with proper handlers (2 ms)
    √ should not show error for untouched fields (2 ms)
    √ should reset form to initial state (3 ms)
    √ should handle form submission (3 ms)
    √ should mark all fields as touched during submission (6 ms)
    √ should not submit invalid form (4 ms)
    √ should handle form submission errors (2 ms)
    √ should prevent multiple simultaneous submissions (3 ms)
    √ should handle form submit event (8 ms)
    √ should get all form values (2 ms)
    √ should get form errors (3 ms)
    √ should check if field has error (2 ms)
    √ should get field error message (2 ms)
    √ should recalculate form validity when fields change (2 ms)
  createMobileFormValidator
    √ should validate required fields (2 ms)
    √ should validate minimum length (7 ms)
    √ should validate maximum length (13 ms)
    √ should validate patterns (1 ms)
    √ should use default pattern message (1 ms)
    √ should run custom validation (2 ms)
    √ should handle custom validation returning boolean (1 ms)
    √ should skip validations for empty non-required fields (1 ms)
    √ should run all applicable validations (1 ms)
    √ should handle fields with no rules
  commonValidationRules
    √ should have email validation rules (1 ms)
    √ should have password validation rules (1 ms)
    √ should validate password complexity
    √ should have phone validation rules (1 ms)
    √ should have name validation rules (1 ms)
    √ should create confirm password rule (1 ms)

  console.info
    ✓ Running in demo mode on port 80

      at checkNetlifyFunctions (src/utils/ApiClient.ts:38:17)

  console.log
    [ScreenReader] Service destroyed

      at ScreenReaderService.destroy (src/services/screenReaderService.ts:1050:13)

  console.log
    [Enhanced Offline Hook] Service initialized successfully

      at initializeOfflineService (src/hooks/useEnhancedOffline.ts:85:17)

FAIL src/services/__tests__/pushNotificationService.test.ts
  PushNotificationService
    initialization
      √ should initialize successfully (46 ms)
      × should request notification permissions (9 ms)
    subscription management
      × should subscribe user to push notifications (165 ms)
      × should handle crisis notification subscriptions (9 ms)
    crisis notifications
      × should send immediate crisis notification (1 ms)
      × should send safety check notifications
    notification preferences
      √ should update user notification preferences
      √ should respect quiet hours (1 ms)
    error handling
      × should handle permission denied gracefully (96 ms)
      √ should handle service worker unavailability (8 ms)

  ● PushNotificationService › initialization › should request notification permissions

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 45 |[39m       [36mconst[39m permission [33m=[39m [36mawait[39m service[33m.[39mrequestPermission()[33m;[39m
     [90m 46 |[39m       
    [31m[1m>[22m[39m[90m 47 |[39m       expect([33mNotification[39m[33m.[39mrequestPermission)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m    |[39m                                              [31m[1m^[22m[39m
     [90m 48 |[39m       expect(permission)[33m.[39mtoBe([32m'granted'[39m)[33m;[39m
     [90m 49 |[39m     })[33m;[39m
     [90m 50 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/pushNotificationService.test.ts:47:46)

  ● PushNotificationService › subscription management › should subscribe user to push notifications

    expect(received).toEqual(expected) // deep equality

    Expected: {"endpoint": "https://fcm.googleapis.com/fcm/send/test", "keys": {"auth": "test-auth", "p256dh": "test-key"}}
    Received: null

    [0m [90m 64 |[39m       [36mconst[39m subscription [33m=[39m [36mawait[39m service[33m.[39msubscribe()[33m;[39m
     [90m 65 |[39m
    [31m[1m>[22m[39m[90m 66 |[39m       expect(subscription)[33m.[39mtoEqual(mockSubscription)[33m;[39m
     [90m    |[39m                            [31m[1m^[22m[39m
     [90m 67 |[39m     })[33m;[39m
     [90m 68 |[39m
     [90m 69 |[39m     it([32m'should handle crisis notification subscriptions'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/pushNotificationService.test.ts:66:28)

  ● PushNotificationService › subscription management › should handle crisis notification subscriptions

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 70 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m service[33m.[39msubscribeToCrisisAlerts([32m'user-123'[39m)[33m;[39m
     [90m 71 |[39m
    [31m[1m>[22m[39m[90m 72 |[39m       expect(result[33m.[39msubscribed)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 73 |[39m       expect(result[33m.[39malertTypes)[33m.[39mtoContain([32m'crisis_immediate'[39m)[33m;[39m
     [90m 74 |[39m     })[33m;[39m
     [90m 75 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/pushNotificationService.test.ts:72:33)

  ● PushNotificationService › crisis notifications › should send immediate crisis notification

    TypeError: navigator.serviceWorker.getRegistration is not a function

    [0m [90m 116 |[39m     }
     [90m 117 |[39m   )[33m:[39m [33mPromise[39m[33m<[39m[36mvoid[39m[33m>[39m {
    [31m[1m>[22m[39m[90m 118 |[39m     [36mconst[39m registration [33m=[39m [36mawait[39m navigator[33m.[39mserviceWorker[33m.[39mgetRegistration()[33m;[39m
     [90m     |[39m                                                        [31m[1m^[22m[39m
     [90m 119 |[39m     [36mif[39m ([33m![39mregistration) {
     [90m 120 |[39m       console[33m.[39mwarn([32m'[Push] No service worker registration for crisis notification'[39m)[33m;[39m
     [90m 121 |[39m       [36mreturn[39m[33m;[39m[0m

      at PushNotificationService.sendCrisisNotification (src/services/pushNotificationService.ts:118:56)
      at Object.<anonymous> (src/services/__tests__/pushNotificationService.test.ts:79:21)

  ● PushNotificationService › crisis notifications › should send safety check notifications

    TypeError: navigator.serviceWorker.getRegistration is not a function

    [0m [90m 147 |[39m     }
     [90m 148 |[39m   )[33m:[39m [33mPromise[39m[33m<[39m[36mvoid[39m[33m>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m     [36mconst[39m registration [33m=[39m [36mawait[39m navigator[33m.[39mserviceWorker[33m.[39mgetRegistration()[33m;[39m
     [90m     |[39m                                                        [31m[1m^[22m[39m
     [90m 150 |[39m     [36mif[39m ([33m![39mregistration) {
     [90m 151 |[39m       console[33m.[39mwarn([32m'[Push] No service worker registration for safety check'[39m)[33m;[39m
     [90m 152 |[39m       [36mreturn[39m[33m;[39m[0m

      at PushNotificationService.sendSafetyCheckNotification (src/services/pushNotificationService.ts:149:56)
      at Object.<anonymous> (src/services/__tests__/pushNotificationService.test.ts:96:21)

  ● PushNotificationService › error handling › should handle permission denied gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: "denied"
    Received: false

    [0m [90m 144 |[39m
     [90m 145 |[39m       [36mconst[39m permission [33m=[39m [36mawait[39m service[33m.[39mrequestPermission()[33m;[39m
    [31m[1m>[22m[39m[90m 146 |[39m       expect(permission)[33m.[39mtoBe([32m'denied'[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 147 |[39m
     [90m 148 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m service[33m.[39msubscribe()[33m;[39m
     [90m 149 |[39m       expect(result)[33m.[39mtoBeNull()[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/pushNotificationService.test.ts:146:26)

PASS src/services/__tests__/screenReaderService.test.ts
  ScreenReaderService
    initialization
      √ should initialize ARIA live regions (209 ms)
      √ should complete initialization (1 ms)
    announcements
      √ should announce crisis alerts with high priority (1 ms)
      √ should announce status updates
      √ should handle navigation announcements (1 ms)
    announcement history
      √ should track announcement history (1 ms)
      √ should clear announcement history
    crisis context
      √ should set crisis context (1 ms)
      √ should get crisis context (87 ms)
    cleanup
      √ should destroy service properly (11 ms)
      √ should handle multiple announcements (1 ms)

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:367:19)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:367:19)

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'join')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:72
        at Array.map (<anonymous>)
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:38
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

  console.info
    ✓ Running in demo mode on port 80

      at checkNetlifyFunctions (src/utils/ApiClient.ts:38:17)

PASS src/hooks/useLazyStyles.test.ts
  useLazyStyles Hook
    √ should initialize without errors (7 ms)
    √ should load immediate styles on mount (12 ms)
    √ should load route-specific styles when route changes (3 ms)
    √ should load emotional state styles (94 ms)
    √ should load crisis styles immediately (3 ms)
    √ should preload styles (2 ms)
    √ should handle responsive styles based on viewport (2 ms)
    √ should setup interaction-based loading (2 ms)
    √ should handle custom strategy (2 ms)
    √ should track loaded styles to prevent duplicates (3 ms)
  CSS Optimization Utilities
    √ should mark critical CSS as loaded (1 ms)
    √ should handle CSS performance monitoring
    √ should get CSS metrics when performance API is available (2 ms)
    √ should handle missing performance API gracefully
  CSS Loading Manager
    √ should handle CSS loading errors gracefully (2 ms)
    √ should prioritize crisis styles (71 ms)
    √ should handle mental health journey patterns (10 ms)
  Integration with Mental Health Platform
    √ should support crisis intervention workflow (3 ms)
    √ should support mood tracking journey (10 ms)
    √ should handle help-seeking behavior (3 ms)

PASS src/components/safety/__tests__/EmergencyContactsWidget.test.tsx
  EmergencyContactsWidget
    Component Import
      √ should import EmergencyContactsWidget successfully (45 ms)
    Component Props
      √ should accept all expected props (6 ms)
      √ should have correct default props
    Contact Sorting
      √ should sort contacts by priority (1 ms)
    Contact Actions
      √ should format phone URLs correctly
      √ should format SMS URLs correctly (1 ms)
    Time Formatting
      √ should format last contacted time correctly
    Display Logic
      √ should determine displayed contacts based on expansion state
    Reorder Logic
      √ should handle move up correctly (1 ms)
    Component Structure
      √ should have correct component structure
    Empty State
      √ should handle empty contacts array (1 ms)
    Loading State
      √ should handle loading state

  console.log
    [Enhanced Offline Hook] Service initialized successfully

      at initializeOfflineService (src/hooks/useEnhancedOffline.ts:85:17)

FAIL src/services/__tests__/analyticsService.test.ts
  AnalyticsService
    Initialization
      √ should initialize with default configuration (2 ms)
      √ should respect opt-out setting (1 ms)
    Event Tracking
      √ should track basic events (1 ms)
      √ should track page views (1 ms)
      √ should track feature usage
      √ should track errors (13 ms)
      √ should track user actions (1 ms)
      √ should track timing data (1 ms)
    Crisis Intervention Tracking
      √ should track crisis intervention events (1 ms)
      √ should prioritize crisis events for immediate flush (2 ms)
    Wellness Tracking
      √ should track wellness activities (1 ms)
      √ should handle wellness tracking with sensitive data (1 ms)
    Consent Management
      √ should update consent status (1 ms)
      √ should get current consent status
      √ should disable service when consent is revoked
    GDPR Compliance
      √ should export user data (215 ms)
      √ should delete user data (1 ms)
      √ should handle data deletion with crisis data retention
    Privacy Controls
      √ should opt out of analytics (1 ms)
      √ should opt in to analytics (1 ms)
    Data Sanitization
      √ should sanitize sensitive properties
      √ should handle sensitive strings in properties (1 ms)
    Session Management
      √ should set user ID when consent given
      √ should end session properly (1 ms)
      √ should get current journey data (1 ms)
    Performance Monitoring
      √ should setup performance monitoring
    Batch Processing
      √ should flush events when batch size reached (1 ms)
      √ should flush events manually
    Error Handling
      √ should handle localStorage errors gracefully (1 ms)
      × should handle malformed stored data
    Configuration
      × should update configuration
      × should check if service is enabled
    Data Management
      × should get stored events
      × should clear stored data
    Singleton Service
      × should return singleton instance (75 ms)
    Privacy Reporting
      × should generate privacy compliance report

  ● AnalyticsService › Error Handling › should handle malformed stored data

    Storage quota exceeded

    [0m [90m 362 |[39m     it([32m'should handle localStorage errors gracefully'[39m[33m,[39m () [33m=>[39m {
     [90m 363 |[39m       localStorage[33m.[39msetItem[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 364 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage quota exceeded'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 365 |[39m       })[33m;[39m
     [90m 366 |[39m       
     [90m 367 |[39m       expect(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/analyticsService.test.ts:364:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● AnalyticsService › Configuration › should update configuration

    Storage quota exceeded

    [0m [90m 362 |[39m     it([32m'should handle localStorage errors gracefully'[39m[33m,[39m () [33m=>[39m {
     [90m 363 |[39m       localStorage[33m.[39msetItem[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 364 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage quota exceeded'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 365 |[39m       })[33m;[39m
     [90m 366 |[39m       
     [90m 367 |[39m       expect(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/analyticsService.test.ts:364:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● AnalyticsService › Configuration › should check if service is enabled

    Storage quota exceeded

    [0m [90m 362 |[39m     it([32m'should handle localStorage errors gracefully'[39m[33m,[39m () [33m=>[39m {
     [90m 363 |[39m       localStorage[33m.[39msetItem[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 364 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage quota exceeded'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 365 |[39m       })[33m;[39m
     [90m 366 |[39m       
     [90m 367 |[39m       expect(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/analyticsService.test.ts:364:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● AnalyticsService › Data Management › should get stored events

    Storage quota exceeded

    [0m [90m 362 |[39m     it([32m'should handle localStorage errors gracefully'[39m[33m,[39m () [33m=>[39m {
     [90m 363 |[39m       localStorage[33m.[39msetItem[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 364 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage quota exceeded'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 365 |[39m       })[33m;[39m
     [90m 366 |[39m       
     [90m 367 |[39m       expect(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/analyticsService.test.ts:364:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● AnalyticsService › Data Management › should clear stored data

    Storage quota exceeded

    [0m [90m 362 |[39m     it([32m'should handle localStorage errors gracefully'[39m[33m,[39m () [33m=>[39m {
     [90m 363 |[39m       localStorage[33m.[39msetItem[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 364 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage quota exceeded'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 365 |[39m       })[33m;[39m
     [90m 366 |[39m       
     [90m 367 |[39m       expect(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/analyticsService.test.ts:364:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● AnalyticsService › Singleton Service › should return singleton instance

    Storage quota exceeded

    [0m [90m 362 |[39m     it([32m'should handle localStorage errors gracefully'[39m[33m,[39m () [33m=>[39m {
     [90m 363 |[39m       localStorage[33m.[39msetItem[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 364 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage quota exceeded'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 365 |[39m       })[33m;[39m
     [90m 366 |[39m       
     [90m 367 |[39m       expect(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/analyticsService.test.ts:364:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● AnalyticsService › Privacy Reporting › should generate privacy compliance report

    Storage quota exceeded

    [0m [90m 362 |[39m     it([32m'should handle localStorage errors gracefully'[39m[33m,[39m () [33m=>[39m {
     [90m 363 |[39m       localStorage[33m.[39msetItem[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 364 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage quota exceeded'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 365 |[39m       })[33m;[39m
     [90m 366 |[39m       
     [90m 367 |[39m       expect(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/analyticsService.test.ts:364:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:367:19)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:367:19)

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'join')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:72
        at Array.map (<anonymous>)
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:38
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

  console.error
    Failed to fetch matched dilemmas Error: Demo mode - API skipped
        at _callApi (C:\Users\damat\_REPOS\CoreV2\src\utils\ApiClient.ts:97:26)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at Object.getAiMatchedDilemmas (C:\Users\damat\_REPOS\CoreV2\src\utils\ApiClient.ts:560:26)
        at C:\Users\damat\_REPOS\CoreV2\src\views\HelperDashboardView.tsx:81:33 {
      isDevelopmentError: true
    }

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/views/HelperDashboardView.tsx:84:25

FAIL src/views/ShareView.test.tsx
  ShareView user flow
    × user can chat with AI, draft a post, and submit it (211 ms)

  ● ShareView user flow › user can chat with AI, draft a post, and submit it

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 46 |[39m
     [90m 47 |[39m     [90m// Assert AI was called and response is shown[39m
    [31m[1m>[22m[39m[90m 48 |[39m     expect(mockedApiClient[33m.[39mai[33m.[39mchat)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m    |[39m                                     [31m[1m^[22m[39m
     [90m 49 |[39m     expect([36mawait[39m screen[33m.[39mfindByText([35m/That sounds really tough/[39m))[33m.[39mtoBeTruthy()[33m;[39m
     [90m 50 |[39m
     [90m 51 |[39m     [90m// --- 2. User drafts a post from the chat ---[39m[0m

      at Object.<anonymous> (src/views/ShareView.test.tsx:48:37)

FAIL src/views/HelperDashboardView.test.tsx
  HelperDashboardView user flow
    × helper can view and accept an available dilemma (88 ms)

  ● HelperDashboardView user flow › helper can view and accept an available dilemma

    TestingLibraryElementError: Found multiple elements with the text: /Available/

    Here are the matching elements:

    Ignored nodes: comments, script, style
    [36m<span[39m
      [33mclass[39m=[32m"btn-text"[39m
    [36m>[39m
      [0mAvailable ([0m
      [0m1[0m
      [0m)[0m
    [36m</span>[39m

    Ignored nodes: comments, script, style
    [36m<p[39m
      [33mclass[39m=[32m"empty-state-message"[39m
    [36m>[39m
      [0mNo specific dilemmas match your expertise right now. Check the 'Available' tab for all posts.[0m
    [36m</p>[39m

    (If this is intentional, then use the `*AllBy*` variant of the query (like `queryAllByText`, `getAllByText`, or `findAllByText`)).

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"view-header"[39m
          [33mstyle[39m=[32m"display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;"[39m
        [36m>[39m
          [36m<div>[39m
            [36m<h1>[39m
              [0mHelper Dashboard[0m
            [36m</h1>[39m
            [36m<p[39m
              [33mclass[39m=[32m"view-subheader"[39m
            [36m>[39m
              [0mWelcome, [0m
              [0mTest Helper[0m
              [0m. Your current level is [0m
              [0m1[0m
              [0m.[0m
            [36m</p>[39m
          [36m</div>[39m
          [36m<button[39m
            [33mclass[39m=[32m"glass-button btn-primary-therapeutic ripple-button touch-optimized touch-feedback smooth-transition"[39m
            [33mstyle[39m=[32m"min-height: 44px; min-width: auto; display: inline-flex; align-items: center; justify-content: center;"[39m
            [33mtype[39m=[32m"button"[39m
          [36m>[39m
            [36m<span[39m
              [33mclass[39m=[32m"btn-text"[39m
            [36m>[39m
              [0mEdit Profile[0m
            [36m</span>[39m
          [36m</button>[39m
        [36m</div>[39m
        [36m<div>[39m
          [0mXPBar Mock[0m
        [36m</div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"card setting-item"[39m
          [33mstyle[39m=[32m"margin-bottom: 1.5rem;"[39m
        [36m>[39m
          [36m<label[39m
            [33mfor[39m=[32m"availability-toggle"[39m
            [33mstyle[39m=[32m"font-weight: 700; font-size: 1.1rem;"[39m
          [36m>[39m
            [0mYou are Online[0m
          [36m</label>[39m
          [36m<div[39m
            [33mclass[39m=[32m"theme-toggle"[39m
          [36m>[39m
            [36m<input[39m
              [33mchecked[39m=[32m""[39m
              [33mid[39m=[32m"availability-toggle"[39m
              [33mtype[39m=[32m"checkbox"[39m
            [36m/>[39m
            [36m<label[39m
              [33mclass[39m=[32m"slider"[39m
              [33mfor[39m=[32m"availability-toggle"[39m
            [36m/>[39m
          [36m</div>[39m
        [36m</div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"dashboard-tabs"[39m
        [36m>[39m
          [36m<button[39m
            [33mclass[39m=[32m"glass-button btn-primary-therapeutic ripple-button touch-optimized touch-feedback smooth-transition active"[39m
            [33mstyle[39m=[32m"min-height: 44px; min-width: auto; display: inline-flex; align-items: center; justify-content: center;"[39m
            [33mtype[39m=[32m"button"[39m
          [36m>[39m
            [36m<span[39m
              [33mclass[39m=[32m"btn-text"[39m
            [36m>[39m
              [0mFor You[0m
            [36m</span>[39m
          [36m</button>[39m
          [36m<button[39m
            [33mclass[39m=[32m"glass-button btn-primary-therapeutic ripple-button touch-optimized touch-feedback smooth-transition"[39m
            [33mstyle[39m=[32m"min-height: 44px; min-width: auto; display: inline-flex; align-items: center; justify-content: center;"[39m
            [33mtype[39m=[32m"button"[39m
          [36m>[39m
            [36m<span[39m
              [33mclass[39m=[32m"btn-text"[39m
            [36m>[39m
              [0mRequests ([0m
              [0m1[0m
              [0m)[0m
            [36m</span>[39m
          [36m</button>[39m
          [36m<button[39m
            [33mclass[39m=[32m"glass-button btn-primary-therapeutic ripple-button touch-optimized touch-feedback smooth-transition"[39m
            [33mstyle[39m=[32m"min-height: 44px; min-width: auto; display: inline-flex; align-items: center; justify-content: center;"[39m
            [33mtype[39m=[32m"button"[39m
          [36m>[39m
            [36m<span[39m
              [33mclass[39m=[32m"btn-text"[39m
            [36m>[39m
              [0mAvailable ([0m
              [0m1[0m
              [0m)[0m
            [36m</span>[39m
          [36m</button>[39m
          [36m<button[39m
            [33mclass[39m=[32m"glass-button btn-primary-therapeutic ripple-button touch-optimized touch-feedback smooth-transition"[39m
            [33mstyle[39m=[32m"min-height: 44px; min-width: auto; display: inline-flex; align-items: center; justify-content: center;"[39m
            [33mtype[39m=[32m"button"[39m
          [36m>[39m
            [36m<span[39m
              [33mclass[39m=[32m"btn-text"[39m
            [36m>[39m
              [0mMy Active ([0m
              [0m0[0m
              [0m)[0m
            [36m</span>[39m
          [36m</button>[39m
          [36m<button[39m
            [33mclass[39m=[32m"glass-button btn-primary-therapeutic ripple-button touch-optimized touch-feedback smooth-transition"[39m
            [33mstyle[39m=[32m"min-height: 44px; min-width: auto; display: inline-flex; align-items: center; justify-content: center;"[39m
            [33mtype[39m=[32m"button"[39m
          [36m>[39m
            [36m<span[39m
              [33mclass[39m=[32m"btn-text"[39m
            [36m>[39m
              [0mSession History[0m
            [36m</span>[39m
          [36m</button>[39m
          [36m<button[39m
            [33mclass[39m=[32m"glass-button btn-primary-therapeutic ripple-button touch-optimized touch-feedback smooth-transition"[39m
            [33mstyle[39m=[32m"min-height: 44px; min-width: auto; display: inline-flex; align-items: center; justify-content: center;"[39m
            [33mtype[39m=[32m"button"[39m
          [36m>[39m
            [36m<span[39m
              [33mclass[39m=[32m"btn-text"[39m
            [36m>[39m
              [0mMy Stats[0m
            [36m</span>[39m
          [36m</button>[39m
          [36m<button[39m
            [33mclass[39m=[32m"glass-button btn-primary-therapeutic ripple-button touch-optimized touch-feedback smooth-transition"[39m
            [33mstyle[39m=[32m"min-height: 44px; min-width: auto; display: inline-flex; align-items: center; justify-content: center;"[39m
            [33mtype[39m=[32m"button"[39m
          [36m>[39m
            [36m<span[39m
              [33mclass[39m=[32m"btn-text"[39m
            [36m>[39m
              [0mAchievements[0m
            [36m</span>[39m
          [36m</button>[39m
        [36m</div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"dashboard-content"[39m
        [36m>[39m
          [36m<ul[39m
            [33mclass[39m=[32m"posts-list"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"card"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"empty-state "[39m
              [36m>[39m
                [36m<h3[39m
                  [33mclass[39m=[32m"empty-state-title"[39m
                [36m>[39m
                  [0mNo Matches Found[0m
                [36m</h3>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"empty-state-message"[39m
                [36m>[39m
                  [0mNo specific dilemmas match your expertise right now. Check the 'Available' tab for all posts.[0m
                [36m</p>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</ul>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 53 |[39m
     [90m 54 |[39m     [90m// 1. User sees the dashboard and clicks on the "Available" tab[39m
    [31m[1m>[22m[39m[90m 55 |[39m     [36mconst[39m availableTab [33m=[39m screen[33m.[39mgetByText([35m/Available/[39m)[33m;[39m
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 56 |[39m     [36mawait[39m userEvent[33m.[39mclick(availableTab)[33m;[39m
     [90m 57 |[39m     
     [90m 58 |[39m     [90m// 2. The available dilemma is displayed[39m[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at getElementError (node_modules/@testing-library/dom/dist/query-helpers.js:20:35)
      at getMultipleElementsFoundError (node_modules/@testing-library/dom/dist/query-helpers.js:23:10)
      at node_modules/@testing-library/dom/dist/query-helpers.js:55:13
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/views/HelperDashboardView.test.tsx:55:33)

PASS src/components/safety/__tests__/SafeSpaceIndicator.test.tsx
  SafeSpaceIndicator
    Component Import
      √ should import SafeSpaceIndicator successfully (7 ms)
    Component Props
      √ should accept all expected props (2 ms)
      √ should have correct default props
    Session Type Logic
      √ should determine correct text for different session types (1 ms)
    Color Logic
      √ should determine correct colors for different session types
    Class Name Logic
      √ should build correct class names
    Breathing Phase Logic
      √ should cycle through breathing phases correctly (1 ms)
      √ should determine correct breathing dot color
    Component Structure
      √ should have correct component structure (1 ms)

PASS src/utils/roleAccess.test.ts
  roleAccess
    ROLE_PERMISSIONS constant
      √ should contain all required user roles (2 ms)
      √ should have consistent permission structure for all roles (15 ms)
      √ should have hierarchical permissions (Admin > Moderator > Certified/Community > Starkeeper) (2 ms)
      √ should have proper view segregation
    getRolePermissions
      √ should return correct permissions for each role (1 ms)
      √ should return immutable permissions object (1 ms)
    canAccessView
      √ should allow access to views in allowedViews array (1 ms)
      √ should deny access to views not in allowedViews array
      √ should handle undefined userRole by using Starkeeper permissions
      √ should handle common views accessible to multiple roles (48 ms)
      √ should be case-sensitive for view names
    isViewDenied
      √ should return true for views in deniedViews array (1 ms)
      √ should return false for views not in deniedViews array
      √ should handle undefined userRole by using Starkeeper permissions (1 ms)
      √ should work in conjunction with canAccessView
    getUserRole
      √ should return Starkeeper for null helper (1 ms)
      √ should return correct role from helper object
      √ should handle helper with undefined role
      √ should type-cast role correctly (1 ms)
    hasPermission
      √ should return correct permissions for each role (1 ms)
      √ should handle undefined userRole by using Starkeeper permissions
      √ should work with all available permission types (2 ms)
      √ should maintain permission hierarchy (1 ms)
    getDefaultViewForRole
      √ should return correct default views for each role (1 ms)
      √ should handle invalid role by returning feed
      √ should ensure default views are accessible to the role (1 ms)
    validateViewAccess
      √ should allow access to permitted views (1 ms)
      √ should deny access and provide redirect for forbidden views
      √ should handle undefined userRole (1 ms)
      √ should provide appropriate redirect views (1 ms)
      √ should include required role in reason message when possible
      √ should handle views that no role can access (1 ms)
      √ should work with edge cases
    Role-based feature access integration
      √ should maintain consistency between view access and feature permissions (1 ms)
      √ should maintain consistency between moderation dashboard and canModerate permission
    Boundary conditions and error handling
      √ should handle null and undefined inputs gracefully (1 ms)
      √ should handle malformed helper objects
      √ should handle case variations in role names defensively (1 ms)
    Performance considerations
      √ should handle rapid successive permission checks efficiently (1 ms)
      √ should not create memory leaks with repeated calls (13 ms)
    Real-world usage scenarios
      √ should handle navigation guard scenario (1 ms)
      √ should handle feature toggle scenario (3 ms)
      √ should handle user registration and role assignment flow (1 ms)

PASS src/hooks/useCrisisDetection.test.ts
  useCrisisDetection Hook
    √ should initialize with default state (9 ms)
    √ should analyze text for crisis indicators (119 ms)
    √ should return safe result for short text (7 ms)
    √ should handle analysis errors gracefully (3 ms)
    √ should show crisis alert for high severity (2 ms)
    √ should call onCrisisDetected callback (13 ms)
    √ should call onEscalationRequired callback (3 ms)
    √ should debounce text analysis (3 ms)
    √ should monitor text input when auto-analyze is enabled (74 ms)
    √ should not monitor when auto-analyze is disabled (3 ms)
    √ should dismiss crisis alert (3 ms)
    √ should maintain analysis history with size limit (3 ms)
    √ should get crisis status from recent analyses (2 ms)
    √ should clear analysis history (3 ms)
    √ should get crisis resources based on detected categories (3 ms)
    √ should get default resources when no crisis detected (2 ms)
    √ should handle self-harm category resources (4 ms)
    √ should handle substance abuse category resources (3 ms)
    √ should clean up debounce timer on unmount (1 ms)
    √ should handle emergency mode in crisis alert (3 ms)
    √ should respect minimum analysis length configuration (2 ms)

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

PASS src/hooks/usePerformanceMonitoring.test.tsx
  usePerformanceMetrics Hook
    √ should initialize and fetch metrics (6 ms)
    √ should handle metrics fetch errors (70 ms)
    √ should refresh metrics at specified interval (4 ms)
    √ should cleanup interval on unmount (2 ms)
  usePerformanceAlerts Hook
    √ should initialize with existing alerts (3 ms)
    √ should handle new alerts (3 ms)
    √ should update existing alerts (4 ms)
    √ should clear new alert count (3 ms)
    √ should dismiss alerts (3 ms)
    √ should cleanup subscription on unmount (23 ms)
  useOptimizationRecommendations Hook
    √ should load recommendations on mount (4 ms)
    √ should limit recommendations to specified maximum (2 ms)
    √ should handle recommendation errors (2 ms)
    √ should refresh recommendations periodically (4 ms)
  usePerformanceGrade Hook
    √ should extract grade from performance report (3 ms)
    √ should handle different grade levels (6 ms)
    √ should handle report generation errors (2 ms)
    √ should refresh grade periodically (3 ms)
  useCrisisPerformanceMonitoring Hook
    √ should monitor crisis performance metrics (42 ms)
    √ should detect unhealthy crisis performance (3 ms)
    √ should check crisis performance frequently (4 ms)
    √ should handle missing crisis metrics gracefully (11 ms)
  Utility Functions
    √ should generate performance summary (1 ms)
    √ should handle performance summary errors (1 ms)
    √ should export performance data (1 ms)
    √ should handle export errors
    √ should check performance monitoring health
    √ should detect stale performance monitoring (1 ms)
    √ should handle health check errors (1 ms)
  PerformanceProvider Component
    √ should monitor critical performance issues (15 ms)
    √ should not log when performance is healthy (4 ms)
  PerformanceDebugInfo Component
    √ should not render in production (3 ms)
    √ should render in development when metrics are available (7 ms)

  console.log
    [Enhanced Offline Hook] Service initialized successfully

      at initializeOfflineService (src/hooks/useEnhancedOffline.ts:85:17)

PASS src/utils/assessmentUtils.test.ts
  assessmentUtils
    PHQ-9 Questions
      √ should have exactly 9 questions for PHQ-9 (1 ms)
      √ should have proper structure for each PHQ-9 question (18 ms)
      √ should have consistent option structure for PHQ-9 (18 ms)
      √ should have valid PHQ-9 question content (1 ms)
      √ should have unique IDs for PHQ-9 questions
    GAD-7 Questions
      √ should have exactly 7 questions for GAD-7
      √ should have proper structure for each GAD-7 question (4 ms)
      √ should have consistent option structure for GAD-7 (7 ms)
      √ should have valid GAD-7 question content (1 ms)
      √ should have unique IDs for GAD-7 questions
    getPhq9Result
      √ should classify minimal depression (0-4) (1 ms)
      √ should classify mild depression (5-9) (1 ms)
      √ should classify moderate depression (10-14) (1 ms)
      √ should classify moderately severe depression (15-19) (1 ms)
      √ should classify severe depression (20+) (3 ms)
      √ should handle boundary cases correctly (1 ms)
      √ should handle edge cases and invalid inputs (1 ms)
      √ should return AssessmentResult with all required properties
    getGad7Result
      √ should classify minimal anxiety (0-4) (2 ms)
      √ should classify mild anxiety (5-9) (1 ms)
      √ should classify moderate anxiety (10-14) (1 ms)
      √ should classify severe anxiety (15+) (1 ms)
      √ should handle boundary cases correctly (1 ms)
      √ should handle edge cases and invalid inputs (1 ms)
      √ should return AssessmentResult with all required properties (1 ms)
    Assessment scoring calculation
      √ should have correct maximum possible scores
      √ should have valid score ranges for all categories (6 ms)
      √ should calculate actual assessment scores from answers
    Assessment question validation
      √ should have proper TypeScript interfaces (1 ms)
      √ should have proper AssessmentResult interface compliance (1 ms)
      √ should ensure all question options have ascending values (2 ms)
      √ should ensure all question options start with value 0 (2 ms)
    Clinical validity and guidelines
      √ should follow PHQ-9 clinical scoring guidelines (1 ms)
      √ should follow GAD-7 clinical scoring guidelines (1 ms)
      √ should provide appropriate clinical recommendations (1 ms)
    Integration and usage scenarios
      √ should handle typical assessment workflow
      √ should handle assessment comparison over time (1 ms)
      √ should support both assessment types in same system (1 ms)
    Performance and memory considerations
      √ should handle rapid assessment calculations efficiently (1 ms)
      √ should not mutate original question arrays (1 ms)
      √ should create new result objects each time

FAIL src/hooks/useIntelligentPreloading.test.ts (12.076 s)
  useIntelligentPreloading Hook
    × should initialize with default state (116 ms)
    √ should initialize with custom options (4 ms)
    √ should initialize preloading engine when enabled (7 ms)
    √ should not initialize engine when disabled (269 ms)
    √ should track route changes (17 ms)
    √ should not track routes when behavior tracking is disabled (15 ms)
    √ should not track routes when disabled (106 ms)
    √ should generate predictions successfully (78 ms)
    √ should filter predictions by confidence threshold (94 ms)
    √ should limit predictions by max count (75 ms)
    √ should handle prediction errors gracefully (83 ms)
    √ should force predictions manually (87 ms)
    √ should track user interactions (95 ms)
    √ should trigger predictions on significant interactions (307 ms)
    √ should not trigger predictions for non-significant interactions (342 ms)
    √ should not track interactions when disabled (3 ms)
    √ should not track interactions when behavior tracking is disabled (106 ms)
    √ should handle route changes correctly (280 ms)
    √ should not generate predictions when engine is not available (2 ms)
    √ should skip tracking for repeated same route (74 ms)
    √ should provide access to underlying engine (6 ms)
    √ should handle empty predictions array (16 ms)
    √ should accumulate total resources preloaded (301 ms)
  withIntelligentPreloading HOC
    √ should wrap component and add tracking functionality
    √ should call original onClick handler (3 ms)
    √ should disable click tracking when specified (1 ms)
    √ should handle components without onClick
    √ should forward all props to wrapped component (1 ms)

  ● useIntelligentPreloading Hook › should initialize with default state

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 78 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useIntelligentPreloading())[33m;[39m
     [90m 79 |[39m
    [31m[1m>[22m[39m[90m 80 |[39m     expect(result[33m.[39mcurrent[33m.[39mpreloadingState[33m.[39misActive)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                     [31m[1m^[22m[39m
     [90m 81 |[39m     expect(result[33m.[39mcurrent[33m.[39mpreloadingState[33m.[39mcurrentPredictions)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m 82 |[39m     expect(result[33m.[39mcurrent[33m.[39mpreloadingState[33m.[39mtotalResourcesPreloaded)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m 83 |[39m     expect(result[33m.[39mcurrent[33m.[39mpreloadingState[33m.[39mlastPredictionTime)[33m.[39mtoBeNull()[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useIntelligentPreloading.test.ts:80:53)

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:367:19)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:367:19)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'join')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:72
        at Array.map (<anonymous>)
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:38
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

PASS src/utils/networkDetection.test.ts
  networkDetection
    getConnectionType
      √ should return 2g for slow-2g effective type (1 ms)
      √ should return 2g for 2g effective type (1 ms)
      √ should return 3g for 3g effective type
      √ should return 4g for 4g effective type (1 ms)
      √ should default to 4g for unknown effective type
      √ should return unknown when navigator.connection is unavailable
      √ should handle missing effectiveType property (1 ms)
    getNetworkQuality
      √ should return poor for low downlink speed (52 ms)
      √ should return poor for high RTT (1 ms)
      √ should return excellent for high speed and low latency
      √ should return good for moderate conditions (1 ms)
      √ should default to good when navigator.connection is unavailable
      √ should use default values when connection properties are missing (1 ms)
      √ should handle edge case values correctly
    getAdaptiveLoadingConfig
      √ should return complete configuration object (1 ms)
      √ should recommend optimal settings for excellent connection (1 ms)
      √ should recommend conservative settings for poor connection (1 ms)
      √ should disable preloading when saveData is enabled
      √ should not preload videos on 2g even with good quality (1 ms)
      √ should handle missing connection gracefully
      √ should use default values for missing properties (1 ms)
    shouldEnableFeature
      √ should return false for unknown feature
      √ should use current config when none provided (7 ms)
      √ should handle undefined config gracefully (1 ms)
      auto-play feature
        √ should enable auto-play for good quality without data saver (1 ms)
        √ should disable auto-play for poor quality
        √ should disable auto-play when data saver is enabled
      high-res-images feature
        √ should enable for high image quality setting (1 ms)
        √ should disable for medium image quality setting
        √ should disable for low image quality setting
      video-preload feature
        √ should enable when shouldPreloadVideos is true
        √ should disable when shouldPreloadVideos is false (1 ms)
      background-sync feature
        √ should enable for good quality connection
        √ should enable for excellent quality connection (1 ms)
        √ should disable for poor quality connection
    logNetworkInfo
      √ should log comprehensive network information (2 ms)
      √ should handle missing connection gracefully (1 ms)
    type definitions
      √ should accept valid ConnectionType values
      √ should accept valid NetworkQuality values (1 ms)
      √ should validate AdaptiveLoadingConfig structure (1 ms)
    edge cases and error handling
      √ should handle connection object with null values
      √ should handle negative network values
      √ should handle extremely high network values (1 ms)
      √ should handle connection type case sensitivity
      √ should handle string numbers in connection properties (1 ms)
    performance considerations
      √ should be performant for repeated calls (2 ms)
      √ should not create memory leaks with repeated hook usage (59 ms)

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

PASS src/components/__tests__/AppButton.test.tsx
  AppButton
    Rendering
      √ should render button with children (26 ms)
      √ should render button with correct type attribute (12 ms)
      √ should render with icon when provided (4 ms)
      √ should render icon-only button correctly (4 ms)
      √ should not render children text in icon-only mode (5 ms)
    Button Variants
      √ should apply correct classes for primary variant when enhanced (3 ms)
      √ should apply correct classes for primary variant when not enhanced (4 ms)
      √ should apply correct classes for secondary variant when enhanced (4 ms)
      √ should apply correct classes for secondary variant when not enhanced (3 ms)
      √ should apply correct classes for danger variant when enhanced (3 ms)
      √ should apply correct classes for danger variant when not enhanced (4 ms)
      √ should apply correct classes for success variant when enhanced (2 ms)
      √ should apply correct classes for success variant when not enhanced (7 ms)
      √ should apply correct classes for ghost variant when enhanced (3 ms)
      √ should apply correct classes for ghost variant when not enhanced (2 ms)
    Button Sizes
      √ should apply correct size class for xs when enhanced (3 ms)
      √ should apply correct size class for xs when not enhanced (3 ms)
      √ should apply correct size class for sm when enhanced (2 ms)
      √ should apply correct size class for sm when not enhanced (3 ms)
      √ should apply correct size class for md when enhanced (2 ms)
      √ should apply correct size class for md when not enhanced (3 ms)
      √ should apply correct size class for lg when enhanced (5 ms)
      √ should apply correct size class for lg when not enhanced (2 ms)
      √ should apply correct size class for xl when enhanced (2 ms)
      √ should apply correct size class for xl when not enhanced (3 ms)
    Loading State
      √ should show loading spinner when isLoading is true (6 ms)
      √ should not show children when loading (3 ms)
      √ should show loading dots when loading (3 ms)
      √ should show loading dots for default size (2 ms)
    Disabled State
      √ should be disabled when disabled prop is true (2 ms)
      √ should be disabled when isLoading is true (3 ms)
      √ should be disabled when both disabled and isLoading are true (3 ms)
      √ should not call onClick when disabled (5 ms)
      √ should not call onClick when loading (3 ms)
    User Interactions
      √ should call onClick when button is clicked (5 ms)
      √ should call onClick multiple times when clicked multiple times (5 ms)
      √ should pass click event to onClick handler (4 ms)
    Accessibility
      √ should have proper touch target size (3 ms)
      √ should have minimum width for icon-only buttons (9 ms)
      √ should use aria-label for icon-only buttons with string children (3 ms)
      √ should use provided aria-label over children for icon-only buttons (3 ms)
      √ should use provided aria-label for regular buttons (3 ms)
      √ should not have aria-label when not icon-only and no explicit aria-label (2 ms)
    CSS Classes
      √ should apply enhanced classes when enhanced is true (2 ms)
      √ should apply legacy classes when enhanced is false (2 ms)
      √ should apply custom className (3 ms)
      √ should combine all appropriate classes (2 ms)
    Custom Styles
      √ should apply custom styles (33 ms)
      √ should merge custom styles with default touch target styles (3 ms)
    Edge Cases
      √ should handle undefined children gracefully (2 ms)
      √ should handle null children gracefully (3 ms)
      √ should handle complex children content (3 ms)
      √ should handle icon with complex children in icon-only mode (3 ms)
      √ should handle rapid state changes (42 ms)

PASS src/utils/mobileUtils.test.ts
  mobileUtils
    initMobileViewport
      √ should set initial viewport height CSS variables (3 ms)
      √ should calculate vh correctly (2 ms)
      √ should use visual viewport when available (1 ms)
      √ should add resize event listener (55 ms)
      √ should add visual viewport event listeners when available (1 ms)
      √ should add orientation change listener with delay (3 ms)
      √ should return cleanup function (1 ms)
      √ cleanup function should remove event listeners (2 ms)
      √ should handle missing visual viewport gracefully (2 ms)
    enhanceMobileFocus
      √ should set 16px font size for iOS inputs below 16px (3 ms)
      √ should not change font size for iOS inputs already 16px or larger (2 ms)
      √ should not modify fonts on non-iOS devices (1 ms)
      √ should add focus event listeners to inputs (1 ms)
      √ should add focus class and scroll into view on focus (3 ms)
      √ should remove focus class on blur (2 ms)
      √ should handle both inputs and textareas (2 ms)
      √ should handle iPad user agent (1 ms)
    isMobileDevice
      √ should detect mobile device by user agent (1 ms)
      √ should detect Android devices (1 ms)
      √ should detect by window width
      √ should detect by touch support (1 ms)
      √ should return false for desktop (1 ms)
      √ should detect various mobile user agents (12 ms)
    isVirtualKeyboardOpen
      √ should detect keyboard open with visual viewport (1 ms)
      √ should detect keyboard closed with visual viewport (1 ms)
      √ should fallback to screen height comparison (1 ms)
      √ should return false when height difference is small
      √ should handle edge case at 80% threshold
      √ should detect keyboard when visual viewport is just below 80% (1 ms)
    addTouchFeedback
      √ should add scale transform on touchstart (1 ms)
      √ should restore scale on touchend for quick taps (1 ms)
      √ should restore scale immediately for long taps (1 ms)
      √ should restore scale on touchcancel (1 ms)
      √ should record touch start time correctly
    initMobileEnhancements
      √ should return early for non-mobile devices (1 ms)
      √ should initialize viewport and enhance focus for mobile devices (2 ms)
      √ should add touch feedback to buttons (2 ms)
      √ should handle cleanup function (1 ms)
      √ should handle elements without addEventListener method (1 ms)
    Auto-initialization
      √ should auto-initialize when DOM is ready (2 ms)
      √ should initialize immediately when DOM is already ready (2 ms)
      √ should handle missing document gracefully (1 ms)
    Edge Cases and Error Handling
      √ should handle elements without style property (1 ms)
      √ should handle missing getComputedStyle (1 ms)
      √ should handle extreme viewport dimensions (1 ms)
      √ should handle missing visualViewport properties
      √ should handle missing screen property (1 ms)
    Performance Considerations
      √ should not create memory leaks with event listeners
      √ should handle rapid touch events (2 ms)
      √ should handle rapid focus/blur events (1 ms)

PASS src/components/__tests__/Card.test.tsx
  Card
    Rendering
      √ should render card with children (125 ms)
      √ should apply custom className (3 ms)
      √ should apply custom styles (5 ms)
      √ should render with enhanced classes by default (13 ms)
      √ should render with legacy classes when enhanced is false (46 ms)
    Variants
      √ should apply correct classes for default variant when enhanced (3 ms)
      √ should apply correct classes for interactive variant when enhanced (2 ms)
      √ should apply correct classes for glass variant when enhanced (2 ms)
      √ should apply correct classes for elevated variant when enhanced (2 ms)
      √ should not apply variant classes when not enhanced (2 ms)
    Interactive Cards
      √ should render as button role when onClick is provided (4 ms)
      √ should render as region role when no onClick provided (2 ms)
      √ should use custom role when provided (3 ms)
      √ should be focusable when interactive (3 ms)
      √ should use custom tabIndex when provided (2 ms)
      √ should not be focusable when not interactive (2 ms)
      √ should add touch classes for legacy interactive cards (2 ms)
      √ should not add touch classes for enhanced interactive cards (2 ms)
      √ should add aria-pressed attribute for interactive cards (2 ms)
    User Interactions
      √ should call onClick when clicked (6 ms)
      √ should call onClick when Enter key is pressed (4 ms)
      √ should call onClick when Space key is pressed (3 ms)
      √ should not call onClick for other keys (5 ms)
      √ should not handle keyDown events when not interactive (4 ms)
      √ should prevent default behavior on Enter and Space (3 ms)
    Accessibility
      √ should have aria-label when provided (3 ms)
      √ should not have aria-label when not provided (3 ms)
      √ should have proper role for interactive cards (35 ms)
      √ should have proper role for static cards (2 ms)
    Edge Cases
      √ should handle undefined className (2 ms)
      √ should handle empty className (1 ms)
      √ should handle complex children (4 ms)
      √ should handle null or undefined children gracefully (3 ms)
      √ should handle multiple className values (1 ms)
      √ should handle rapid click events (3 ms)
    Event Handling
      √ should pass correct event object to onClick (2 ms)
      √ should pass keyboard event to onClick when triggered by keyboard (2 ms)

  console.log
    [Enhanced Offline Hook] Service initialized successfully

      at initializeOfflineService (src/hooks/useEnhancedOffline.ts:85:17)

PASS src/utils/culturalAssessmentUtils.test.ts
  culturalAssessmentUtils
    getCulturalPhq9Questions
      √ should return cultural PHQ-9 questions with cultural context (3 ms)
      √ should fallback to Western adaptation when cultural context not found (1 ms)
      √ should use standard text when no cultural adaptations available
      √ should use default language code when not provided (1 ms)
      √ should fallback to standard questions on service failure (1 ms)
      √ should handle empty cultural questions response
    getCulturalGad7Questions
      √ should return cultural GAD-7 questions (1 ms)
      √ should fallback to standard GAD-7 questions on failure
    getCulturalPhq9Result
      √ should return cultural PHQ-9 assessment result (1 ms)
      √ should use score strings as textual answers when not provided
      √ should use default language when not provided
      √ should fallback to standard calculation on service failure (1 ms)
      √ should handle different severity levels and colors (6 ms)
    getCulturalGad7Result
      √ should return cultural GAD-7 assessment result (1 ms)
      √ should fallback to standard GAD-7 calculation on failure (1 ms)
    submitCulturalAssessment
      √ should submit cultural assessment with all parameters (1 ms)
      √ should use default values when optional parameters not provided (1 ms)
      √ should throw error on service failure (69 ms)
    formatAssessmentDate
      √ should format Date object correctly (1 ms)
      √ should format date string correctly
      √ should handle different date formats (1 ms)
      √ should handle invalid date strings (1 ms)
    getAssessmentDisplayName
      √ should return correct display name for PHQ-9
      √ should return correct display name for GAD-7
      √ should return unknown for unrecognized assessment type (1 ms)
      √ should handle empty string
      √ should handle case sensitivity
    standard fallback functions
      standard PHQ-9 scoring
        √ should classify minimal depression correctly (1 ms)
        √ should classify severe depression correctly (1 ms)
      standard GAD-7 scoring
        √ should classify minimal anxiety correctly
        √ should classify severe anxiety correctly (1 ms)
    interface compliance
      √ should match AssessmentQuestion interface (1 ms)
      √ should match AssessmentResult interface
      √ should match CulturalAssessmentResult interface (1 ms)
    error handling and edge cases
      √ should handle network timeout gracefully (125 ms)
      √ should handle malformed service responses (1 ms)
      √ should handle empty scores array (1 ms)
      √ should handle negative scores

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:367:19)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:367:19)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'join')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:72
        at Array.map (<anonymous>)
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:38
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

PASS tests/service-worker/crisis-scenarios.test.ts
  Crisis Scenario Testing
    Crisis Resource Availability
      √ should ensure 988 lifeline is always accessible offline (2 ms)
      √ should provide crisis text line access offline
      √ should ensure all critical resources are cached (1 ms)
    Emergency Response Speed
      √ should load crisis resources in under 100ms (1 ms)
      √ should prioritize crisis page loading (1 ms)
    Crisis Detection and Response
      √ should identify crisis keywords in content
      √ should provide immediate coping strategies for crisis (1 ms)
    Crisis Communication Features
      √ should enable crisis alert notifications (1 ms)
      √ should provide crisis chat templates
    Safety Plan Access
      √ should provide offline safety plan template (1 ms)
    Crisis Resource Reliability
      √ should verify all crisis resources are accessible (1 ms)
      √ should handle cache corruption gracefully (1 ms)
      √ should measure crisis resource load times

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

FAIL tests/views/GroupSessionView.test.tsx
  GroupSessionView - Anonymity Features
    √ renders anonymous group sessions interface (240 ms)
    √ displays privacy protection notice (46 ms)
    √ generates anonymous alias on load (110 ms)
    √ allows generating new anonymous alias (58 ms)
    √ displays session calendar without exposing user identity (53 ms)
    √ shows session types and facilitator aliases (not real names) (182 ms)
    × handles session joining with anonymous identity (45 ms)
    √ shows participant counts without revealing identities (49 ms)
    √ maintains anonymity in session interactions (106 ms)
    √ provides accessibility features for anonymous navigation (86 ms)
  GroupSessionView - Security Features
    √ does not expose user authentication details (34 ms)
    × uses secure anonymous session joining (69 ms)

  ● GroupSessionView - Anonymity Features › handles session joining with anonymous identity

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "Joining session anonymously:", ObjectContaining {"anonymousAlias": Any<String>, "sessionId": Any<String>}

    Number of calls: 0

    [0m [90m 100 |[39m     [90m// Should show success message (mocked alert)[39m
     [90m 101 |[39m     [90m// The actual implementation would show a success state[39m
    [31m[1m>[22m[39m[90m 102 |[39m     expect(console[33m.[39mlog)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 103 |[39m       [32m'Joining session anonymously:'[39m[33m,[39m
     [90m 104 |[39m       expect[33m.[39mobjectContaining({
     [90m 105 |[39m         sessionId[33m:[39m expect[33m.[39many([33mString[39m)[33m,[39m[0m

      at Object.<anonymous> (tests/views/GroupSessionView.test.tsx:102:25)

  ● GroupSessionView - Security Features › uses secure anonymous session joining

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "Joining session anonymously:", ObjectContaining {"anonymousAlias": Any<String>, "participantNotes": StringContaining "Joined as"}

    Number of calls: 0

    [0m [90m 176 |[39m     
     [90m 177 |[39m     [90m// Verify joining mechanism uses anonymous identifier[39m
    [31m[1m>[22m[39m[90m 178 |[39m     expect(console[33m.[39mlog)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 179 |[39m       [32m'Joining session anonymously:'[39m[33m,[39m
     [90m 180 |[39m       expect[33m.[39mobjectContaining({
     [90m 181 |[39m         anonymousAlias[33m:[39m expect[33m.[39many([33mString[39m)[33m,[39m[0m

      at Object.<anonymous> (tests/views/GroupSessionView.test.tsx:178:25)

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

PASS src/hooks/useKeyboardNavigation.test.ts
  useKeyboardNavigation Hook
    √ should initialize with default options (19 ms)
    √ should get focusable elements correctly (74 ms)
    √ should filter out disabled elements (8 ms)
    √ should focus first element (3 ms)
    √ should focus last element (4 ms)
    √ should focus next element with wrapping (2 ms)
    √ should wrap to first element when at end (2 ms)
    √ should not wrap when disabled (2 ms)
    √ should focus previous element (3 ms)
    √ should set up keyboard event listeners (3 ms)
    √ should clean up event listeners on unmount (3 ms)
    √ should handle arrow key navigation (2 ms)
    √ should handle home and end keys (3 ms)
    √ should handle Enter and Space key activation (6 ms)
    √ should handle Escape key (6 ms)
    √ should call navigation callback (2 ms)
    √ should call activation callback (3 ms)
    √ should auto-focus first element when enabled (3 ms)
    √ should respect orientation settings (3 ms)
    √ should ignore events outside container (2 ms)
    √ should handle empty container (2 ms)
  useFocusTrap Hook
    √ should initialize focus trap when active (7 ms)
    √ should not initialize when inactive (2 ms)
    √ should handle Tab key cycling (3 ms)
    √ should handle Shift+Tab key cycling (2 ms)
    √ should restore focus on unmount (3 ms)
    √ should not restore focus when disabled (2 ms)
    √ should handle fallback focus when no focusable elements (3 ms)
    √ should provide focus control functions (2 ms)
  useSkipNavigation Hook
    √ should skip to main content (4 ms)
    √ should skip to navigation (3 ms)
    √ should announce screen reader messages (2 ms)
  useRovingTabindex Hook
    √ should set initial tabindex values (2 ms)
    √ should provide setActiveIndex function (2 ms)
    √ should provide getCurrentIndex function (2 ms)
    √ should handle wrapping when enabled (2 ms)
    √ should not wrap when disabled (2 ms)
  useGlobalKeyboardShortcuts Hook
    √ should register keyboard shortcuts (2 ms)
    √ should execute shortcuts on key combination (2 ms)
    √ should handle multiple modifier keys (2 ms)
    √ should clean up event listeners on unmount (1 ms)
    √ should not execute non-matching shortcuts (2 ms)
  announceKeyboardShortcut utility
    √ should create screen reader announcement (2 ms)
    √ should clean up announcement after timeout (1 ms)

  console.log
    [Prefetch] Successfully prefetched: /api/test

      at Object.prefetchResource (src/hooks/useIntelligentCaching.tsx:152:15)

FAIL src/hooks/useErrorTracking.test.ts
  ● Test suite failed to run

    [96msrc/hooks/useErrorTracking.test.ts[0m:[93m398[0m:[93m9[0m - [91merror[0m[90m TS1005: [0m',' expected.

    [7m398[0m       } as TestProps
    [7m   [0m [91m        ~~[0m
    [96msrc/hooks/useErrorTracking.test.ts[0m:[93m398[0m:[93m12[0m - [91merror[0m[90m TS1005: [0m',' expected.

    [7m398[0m       } as TestProps
    [7m   [0m [91m           ~~~~~~~~~[0m
    [96msrc/hooks/useErrorTracking.test.ts[0m:[93m399[0m:[93m7[0m - [91merror[0m[90m TS1005: [0m',' expected.

    [7m399[0m       }
    [7m   [0m [91m      ~[0m
    [96msrc/hooks/useErrorTracking.test.ts[0m:[93m449[0m:[93m1[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m449[0m });
    [7m   [0m [91m~[0m
    [96msrc/hooks/useErrorTracking.test.ts[0m:[93m449[0m:[93m2[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m449[0m });
    [7m   [0m [91m ~[0m

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

  console.log
    [Prefetch] Successfully prefetched: /api/crisis

      at Object.prefetchResource (src/hooks/useIntelligentCaching.tsx:152:15)

  console.log
    Container innerHTML: <div class="quick-exit-wrapper position-top-left" data-testid="quick-exit-wrapper" style="position: fixed; z-index: 9999; top: 20px; left: 20px;"><button class="quick-exit-button size-medium" aria-label="Emergency exit - leaves site immediately" aria-describedby="quick-exit-instructions" style="position: relative; border-radius: var(--safe-radius-md); padding: 10px 16px; font-size: 14px; font-weight: 600; cursor: pointer; box-shadow: var(--safe-shadow-lg); transition: all 0.2s ease-out; transform: scale(1); display: flex; align-items: center; gap: 8px; min-width: 120px;"><svg data-testid="exit-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" style="animation: none;"><path d="M9 3l-6 6l6 6"></path><path d="M3 9h12"></path><path d="M21 3v18"></path></svg><span>Quick Exit</span><span style="margin-left: 8px; font-size: 11px; opacity: 0.9; font-weight: normal;">ESC x3</span></button><div id="quick-exit-instructions" style="display: none;">Press Escape 3 times quickly or click this button to immediately leave the site</div></div><style>
            @keyframes pulse {
              0%, 100% { opacity: 1; }
              50% { opacity: 0.6; }
            }
            
            @keyframes fadeIn {
              from { 
                opacity: 0;
                transform: translateY(-10px);
              }
              to { 
                opacity: 1;
                transform: translateY(0);
              }
            }
          </style>

      at Object.<anonymous> (src/components/safety/__tests__/QuickExitButton.working.test.tsx:123:15)

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

  console.log
    [Prefetch] Successfully prefetched: /api/crisis

      at Object.prefetchResource (src/hooks/useIntelligentCaching.tsx:152:15)

  console.log
    Container children: 2

      at Object.<anonymous> (src/components/safety/__tests__/QuickExitButton.working.test.tsx:124:15)

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

  console.log
    Found wrapper: <ref *1> HTMLDivElement {
      '__reactFiber$78zibo1ixmk': <ref *2> FiberNode {
        tag: 5,
        key: null,
        elementType: 'div',
        type: 'div',
        stateNode: [Circular *1],
        return: FiberNode {
          tag: 0,
          key: null,
          elementType: [Function: QuickExitButton],
          type: [Function: QuickExitButton],
          stateNode: null,
          return: [FiberNode],
          child: [Circular *2],
          sibling: null,
          index: 0,
          ref: null,
          pendingProps: {},
          memoizedProps: {},
          updateQueue: [Object],
          memoizedState: [Object],
          dependencies: null,
          mode: 1,
          flags: 8390657,
          subtreeFlags: 1048576,
          deletions: null,
          lanes: 0,
          childLanes: 0,
          alternate: null,
          actualDuration: 0,
          actualStartTime: -1,
          selfBaseDuration: 0,
          treeBaseDuration: 0,
          _debugSource: undefined,
          _debugOwner: null,
          _debugNeedsRemount: false,
          _debugHookTypes: [Array]
        },
        child: FiberNode {
          tag: 5,
          key: null,
          elementType: 'button',
          type: 'button',
          stateNode: [HTMLButtonElement],
          return: [Circular *2],
          child: [FiberNode],
          sibling: [FiberNode],
          index: 0,
          ref: null,
          pendingProps: [Object],
          memoizedProps: [Object],
          updateQueue: null,
          memoizedState: null,
          dependencies: null,
          mode: 1,
          flags: 1048576,
          subtreeFlags: 1048576,
          deletions: null,
          lanes: 0,
          childLanes: 0,
          alternate: null,
          actualDuration: 0,
          actualStartTime: -1,
          selfBaseDuration: 0,
          treeBaseDuration: 0,
          _debugSource: undefined,
          _debugOwner: [FiberNode],
          _debugNeedsRemount: false,
          _debugHookTypes: null
        },
        sibling: FiberNode {
          tag: 5,
          key: null,
          elementType: 'style',
          type: 'style',
          stateNode: [HTMLStyleElement],
          return: [FiberNode],
          child: null,
          sibling: null,
          index: 1,
          ref: null,
          pendingProps: [Object],
          memoizedProps: [Object],
          updateQueue: null,
          memoizedState: null,
          dependencies: null,
          mode: 1,
          flags: 1048576,
          subtreeFlags: 0,
          deletions: null,
          lanes: 0,
          childLanes: 0,
          alternate: null,
          actualDuration: 0,
          actualStartTime: -1,
          selfBaseDuration: 0,
          treeBaseDuration: 0,
          _debugSource: undefined,
          _debugOwner: [FiberNode],
          _debugNeedsRemount: false,
          _debugHookTypes: null
        },
        index: 0,
        ref: null,
        pendingProps: {
          className: 'quick-exit-wrapper position-top-left',
          'data-testid': 'quick-exit-wrapper',
          style: [Object],
          children: [Array]
        },
        memoizedProps: {
          className: 'quick-exit-wrapper position-top-left',
          'data-testid': 'quick-exit-wrapper',
          style: [Object],
          children: [Array]
        },
        updateQueue: null,
        memoizedState: null,
        dependencies: null,
        mode: 1,
        flags: 1048576,
        subtreeFlags: 1048576,
        deletions: null,
        lanes: 0,
        childLanes: 0,
        alternate: null,
        actualDuration: 0,
        actualStartTime: -1,
        selfBaseDuration: 0,
        treeBaseDuration: 0,
        _debugSource: undefined,
        _debugOwner: FiberNode {
          tag: 0,
          key: null,
          elementType: [Function: QuickExitButton],
          type: [Function: QuickExitButton],
          stateNode: null,
          return: [FiberNode],
          child: [Circular *2],
          sibling: null,
          index: 0,
          ref: null,
          pendingProps: {},
          memoizedProps: {},
          updateQueue: [Object],
          memoizedState: [Object],
          dependencies: null,
          mode: 1,
          flags: 8390657,
          subtreeFlags: 1048576,
          deletions: null,
          lanes: 0,
          childLanes: 0,
          alternate: null,
          actualDuration: 0,
          actualStartTime: -1,
          selfBaseDuration: 0,
          treeBaseDuration: 0,
          _debugSource: undefined,
          _debugOwner: null,
          _debugNeedsRemount: false,
          _debugHookTypes: [Array]
        },
        _debugNeedsRemount: false,
        _debugHookTypes: null
      },
      '__reactProps$78zibo1ixmk': {
        className: 'quick-exit-wrapper position-top-left',
        'data-testid': 'quick-exit-wrapper',
        style: { position: 'fixed', zIndex: 9999, top: '20px', left: '20px' },
        children: [ [Object], [Object], '', false ]
      },
      [Symbol(SameObject caches)]: [Object: null prototype] {
        style: CSSStyleDeclaration {
          '0': 'position',
          '1': 'z-index',
          '2': 'top',
          '3': 'left',
          _values: [Object],
          _importants: [Object],
          _length: 4,
          _onChange: [Function (anonymous)]
        }
      }
    }

      at Object.<anonymous> (src/components/safety/__tests__/QuickExitButton.working.test.tsx:131:15)

  console.log
    Found button by class: <ref *1> HTMLButtonElement {
      '__reactFiber$78zibo1ixmk': <ref *2> FiberNode {
        tag: 5,
        key: null,
        elementType: 'button',
        type: 'button',
        stateNode: [Circular *1],
        return: FiberNode {
          tag: 5,
          key: null,
          elementType: 'div',
          type: 'div',
          stateNode: [HTMLDivElement],
          return: [FiberNode],
          child: [Circular *2],
          sibling: [FiberNode],
          index: 0,
          ref: null,
          pendingProps: [Object],
          memoizedProps: [Object],
          updateQueue: null,
          memoizedState: null,
          dependencies: null,
          mode: 1,
          flags: 1048576,
          subtreeFlags: 1048576,
          deletions: null,
          lanes: 0,
          childLanes: 0,
          alternate: null,
          actualDuration: 0,
          actualStartTime: -1,
          selfBaseDuration: 0,
          treeBaseDuration: 0,
          _debugSource: undefined,
          _debugOwner: [FiberNode],
          _debugNeedsRemount: false,
          _debugHookTypes: null
        },
        child: FiberNode {
          tag: 5,
          key: null,
          elementType: 'svg',
          type: 'svg',
          stateNode: [SVGSVGElement],
          return: [Circular *2],
          child: [FiberNode],
          sibling: [FiberNode],
          index: 0,
          ref: null,
          pendingProps: [Object],
          memoizedProps: [Object],
          updateQueue: null,
          memoizedState: null,
          dependencies: null,
          mode: 1,
          flags: 1048576,
          subtreeFlags: 1048576,
          deletions: null,
          lanes: 0,
          childLanes: 0,
          alternate: null,
          actualDuration: 0,
          actualStartTime: -1,
          selfBaseDuration: 0,
          treeBaseDuration: 0,
          _debugSource: undefined,
          _debugOwner: [FiberNode],
          _debugNeedsRemount: false,
          _debugHookTypes: null
        },
        sibling: FiberNode {
          tag: 5,
          key: null,
          elementType: 'div',
          type: 'div',
          stateNode: [HTMLDivElement],
          return: [FiberNode],
          child: [FiberNode],
          sibling: null,
          index: 1,
          ref: null,
          pendingProps: [Object],
          memoizedProps: [Object],
          updateQueue: null,
          memoizedState: null,
          dependencies: null,
          mode: 1,
          flags: 1048576,
          subtreeFlags: 1048576,
          deletions: null,
          lanes: 0,
          childLanes: 0,
          alternate: null,
          actualDuration: 0,
          actualStartTime: -1,
          selfBaseDuration: 0,
          treeBaseDuration: 0,
          _debugSource: undefined,
          _debugOwner: [FiberNode],
          _debugNeedsRemount: false,
          _debugHookTypes: null
        },
        index: 0,
        ref: null,
        pendingProps: {
          className: 'quick-exit-button size-medium',
          onClick: [Function (anonymous)],
          onMouseEnter: [Function: onMouseEnter],
          onMouseLeave: [Function: onMouseLeave],
          onMouseDown: [Function: onMouseDown],
          onMouseUp: [Function: onMouseUp],
          onFocus: [Function: onFocus],
          onBlur: [Function: onBlur],
          onTouchStart: [Function: onTouchStart],
          onTouchEnd: [Function: onTouchEnd],
          onKeyDown: [Function: onKeyDown],
          'aria-label': 'Emergency exit - leaves site immediately',
          'aria-describedby': 'quick-exit-instructions',
          style: [Object],
          children: [Array]
        },
        memoizedProps: {
          className: 'quick-exit-button size-medium',
          onClick: [Function (anonymous)],
          onMouseEnter: [Function: onMouseEnter],
          onMouseLeave: [Function: onMouseLeave],
          onMouseDown: [Function: onMouseDown],
          onMouseUp: [Function: onMouseUp],
          onFocus: [Function: onFocus],
          onBlur: [Function: onBlur],
          onTouchStart: [Function: onTouchStart],
          onTouchEnd: [Function: onTouchEnd],
          onKeyDown: [Function: onKeyDown],
          'aria-label': 'Emergency exit - leaves site immediately',
          'aria-describedby': 'quick-exit-instructions',
          style: [Object],
          children: [Array]
        },
        updateQueue: null,
        memoizedState: null,
        dependencies: null,
        mode: 1,
        flags: 1048576,
        subtreeFlags: 1048576,
        deletions: null,
        lanes: 0,
        childLanes: 0,
        alternate: null,
        actualDuration: 0,
        actualStartTime: -1,
        selfBaseDuration: 0,
        treeBaseDuration: 0,
        _debugSource: undefined,
        _debugOwner: FiberNode {
          tag: 0,
          key: null,
          elementType: [Function: QuickExitButton],
          type: [Function: QuickExitButton],
          stateNode: null,
          return: [FiberNode],
          child: [FiberNode],
          sibling: null,
          index: 0,
          ref: null,
          pendingProps: {},
          memoizedProps: {},
          updateQueue: [Object],
          memoizedState: [Object],
          dependencies: null,
          mode: 1,
          flags: 8390657,
          subtreeFlags: 1048576,
          deletions: null,
          lanes: 0,
          childLanes: 0,
          alternate: null,
          actualDuration: 0,
          actualStartTime: -1,
          selfBaseDuration: 0,
          treeBaseDuration: 0,
          _debugSource: undefined,
          _debugOwner: null,
          _debugNeedsRemount: false,
          _debugHookTypes: [Array]
        },
        _debugNeedsRemount: false,
        _debugHookTypes: null
      },
      '__reactProps$78zibo1ixmk': {
        className: 'quick-exit-button size-medium',
        onClick: [Function (anonymous)],
        onMouseEnter: [Function: onMouseEnter],
        onMouseLeave: [Function: onMouseLeave],
        onMouseDown: [Function: onMouseDown],
        onMouseUp: [Function: onMouseUp],
        onFocus: [Function: onFocus],
        onBlur: [Function: onBlur],
        onTouchStart: [Function: onTouchStart],
        onTouchEnd: [Function: onTouchEnd],
        onKeyDown: [Function: onKeyDown],
        'aria-label': 'Emergency exit - leaves site immediately',
        'aria-describedby': 'quick-exit-instructions',
        style: {
          position: 'relative',
          background: 'var(--safe-gray-700)',
          color: 'var(--safe-white)',
          border: 'none',
          borderRadius: 'var(--safe-radius-md)',
          padding: '10px 16px',
          fontSize: '14px',
          fontWeight: '600',
          cursor: 'pointer',
          boxShadow: 'var(--safe-shadow-lg)',
          transition: 'all 0.2s ease-out',
          transform: 'scale(1)',
          display: 'flex',
          alignItems: 'center',
          gap: '8px',
          minWidth: '120px'
        },
        children: [ [Object], [Object], [Object] ]
      },
      [Symbol(SameObject caches)]: [Object: null prototype] {
        style: CSSStyleDeclaration {
          '0': 'position',
          '1': 'border-radius',
          '2': 'padding',
          '3': 'font-size',
          '4': 'font-weight',
          '5': 'cursor',
          '6': 'box-shadow',
          '7': 'transition',
          '8': 'transform',
          '9': 'display',
          '10': 'align-items',
          '11': 'gap',
          '12': 'min-width',
          _values: [Object],
          _importants: [Object],
          _length: 13,
          _onChange: [Function (anonymous)]
        }
      }
    }

      at Object.<anonymous> (src/components/safety/__tests__/QuickExitButton.working.test.tsx:132:15)

  console.log
    Found button by tag: <ref *1> HTMLButtonElement {
      '__reactFiber$78zibo1ixmk': <ref *2> FiberNode {
        tag: 5,
        key: null,
        elementType: 'button',
        type: 'button',
        stateNode: [Circular *1],
        return: FiberNode {
          tag: 5,
          key: null,
          elementType: 'div',
          type: 'div',
          stateNode: [HTMLDivElement],
          return: [FiberNode],
          child: [Circular *2],
          sibling: [FiberNode],
          index: 0,
          ref: null,
          pendingProps: [Object],
          memoizedProps: [Object],
          updateQueue: null,
          memoizedState: null,
          dependencies: null,
          mode: 1,
          flags: 1048576,
          subtreeFlags: 1048576,
          deletions: null,
          lanes: 0,
          childLanes: 0,
          alternate: null,
          actualDuration: 0,
          actualStartTime: -1,
          selfBaseDuration: 0,
          treeBaseDuration: 0,
          _debugSource: undefined,
          _debugOwner: [FiberNode],
          _debugNeedsRemount: false,
          _debugHookTypes: null
        },
        child: FiberNode {
          tag: 5,
          key: null,
          elementType: 'svg',
          type: 'svg',
          stateNode: [SVGSVGElement],
          return: [Circular *2],
          child: [FiberNode],
          sibling: [FiberNode],
          index: 0,
          ref: null,
          pendingProps: [Object],
          memoizedProps: [Object],
          updateQueue: null,
          memoizedState: null,
          dependencies: null,
          mode: 1,
          flags: 1048576,
          subtreeFlags: 1048576,
          deletions: null,
          lanes: 0,
          childLanes: 0,
          alternate: null,
          actualDuration: 0,
          actualStartTime: -1,
          selfBaseDuration: 0,
          treeBaseDuration: 0,
          _debugSource: undefined,
          _debugOwner: [FiberNode],
          _debugNeedsRemount: false,
          _debugHookTypes: null
        },
        sibling: FiberNode {
          tag: 5,
          key: null,
          elementType: 'div',
          type: 'div',
          stateNode: [HTMLDivElement],
          return: [FiberNode],
          child: [FiberNode],
          sibling: null,
          index: 1,
          ref: null,
          pendingProps: [Object],
          memoizedProps: [Object],
          updateQueue: null,
          memoizedState: null,
          dependencies: null,
          mode: 1,
          flags: 1048576,
          subtreeFlags: 1048576,
          deletions: null,
          lanes: 0,
          childLanes: 0,
          alternate: null,
          actualDuration: 0,
          actualStartTime: -1,
          selfBaseDuration: 0,
          treeBaseDuration: 0,
          _debugSource: undefined,
          _debugOwner: [FiberNode],
          _debugNeedsRemount: false,
          _debugHookTypes: null
        },
        index: 0,
        ref: null,
        pendingProps: {
          className: 'quick-exit-button size-medium',
          onClick: [Function (anonymous)],
          onMouseEnter: [Function: onMouseEnter],
          onMouseLeave: [Function: onMouseLeave],
          onMouseDown: [Function: onMouseDown],
          onMouseUp: [Function: onMouseUp],
          onFocus: [Function: onFocus],
          onBlur: [Function: onBlur],
          onTouchStart: [Function: onTouchStart],
          onTouchEnd: [Function: onTouchEnd],
          onKeyDown: [Function: onKeyDown],
          'aria-label': 'Emergency exit - leaves site immediately',
          'aria-describedby': 'quick-exit-instructions',
          style: [Object],
          children: [Array]
        },
        memoizedProps: {
          className: 'quick-exit-button size-medium',
          onClick: [Function (anonymous)],
          onMouseEnter: [Function: onMouseEnter],
          onMouseLeave: [Function: onMouseLeave],
          onMouseDown: [Function: onMouseDown],
          onMouseUp: [Function: onMouseUp],
          onFocus: [Function: onFocus],
          onBlur: [Function: onBlur],
          onTouchStart: [Function: onTouchStart],
          onTouchEnd: [Function: onTouchEnd],
          onKeyDown: [Function: onKeyDown],
          'aria-label': 'Emergency exit - leaves site immediately',
          'aria-describedby': 'quick-exit-instructions',
          style: [Object],
          children: [Array]
        },
        updateQueue: null,
        memoizedState: null,
        dependencies: null,
        mode: 1,
        flags: 1048576,
        subtreeFlags: 1048576,
        deletions: null,
        lanes: 0,
        childLanes: 0,
        alternate: null,
        actualDuration: 0,
        actualStartTime: -1,
        selfBaseDuration: 0,
        treeBaseDuration: 0,
        _debugSource: undefined,
        _debugOwner: FiberNode {
          tag: 0,
          key: null,
          elementType: [Function: QuickExitButton],
          type: [Function: QuickExitButton],
          stateNode: null,
          return: [FiberNode],
          child: [FiberNode],
          sibling: null,
          index: 0,
          ref: null,
          pendingProps: {},
          memoizedProps: {},
          updateQueue: [Object],
          memoizedState: [Object],
          dependencies: null,
          mode: 1,
          flags: 8390657,
          subtreeFlags: 1048576,
          deletions: null,
          lanes: 0,
          childLanes: 0,
          alternate: null,
          actualDuration: 0,
          actualStartTime: -1,
          selfBaseDuration: 0,
          treeBaseDuration: 0,
          _debugSource: undefined,
          _debugOwner: null,
          _debugNeedsRemount: false,
          _debugHookTypes: [Array]
        },
        _debugNeedsRemount: false,
        _debugHookTypes: null
      },
      '__reactProps$78zibo1ixmk': {
        className: 'quick-exit-button size-medium',
        onClick: [Function (anonymous)],
        onMouseEnter: [Function: onMouseEnter],
        onMouseLeave: [Function: onMouseLeave],
        onMouseDown: [Function: onMouseDown],
        onMouseUp: [Function: onMouseUp],
        onFocus: [Function: onFocus],
        onBlur: [Function: onBlur],
        onTouchStart: [Function: onTouchStart],
        onTouchEnd: [Function: onTouchEnd],
        onKeyDown: [Function: onKeyDown],
        'aria-label': 'Emergency exit - leaves site immediately',
        'aria-describedby': 'quick-exit-instructions',
        style: {
          position: 'relative',
          background: 'var(--safe-gray-700)',
          color: 'var(--safe-white)',
          border: 'none',
          borderRadius: 'var(--safe-radius-md)',
          padding: '10px 16px',
          fontSize: '14px',
          fontWeight: '600',
          cursor: 'pointer',
          boxShadow: 'var(--safe-shadow-lg)',
          transition: 'all 0.2s ease-out',
          transform: 'scale(1)',
          display: 'flex',
          alignItems: 'center',
          gap: '8px',
          minWidth: '120px'
        },
        children: [ [Object], [Object], [Object] ]
      },
      [Symbol(SameObject caches)]: [Object: null prototype] {
        style: CSSStyleDeclaration {
          '0': 'position',
          '1': 'border-radius',
          '2': 'padding',
          '3': 'font-size',
          '4': 'font-weight',
          '5': 'cursor',
          '6': 'box-shadow',
          '7': 'transition',
          '8': 'transform',
          '9': 'display',
          '10': 'align-items',
          '11': 'gap',
          '12': 'min-width',
          _values: [Object],
          _importants: [Object],
          _length: 13,
          _onChange: [Function (anonymous)]
        }
      }
    }

      at Object.<anonymous> (src/components/safety/__tests__/QuickExitButton.working.test.tsx:133:15)

PASS src/components/__tests__/ErrorState.test.tsx
  ErrorState
    Rendering
      √ should render with default props (80 ms)
      √ should render with custom title and message (16 ms)
      √ should render AlertTriangleIcon (4 ms)
      √ should apply custom className (4 ms)
      √ should render retry button by default when onRetry is provided (4 ms)
      √ should not render retry button when showRetry is false (41 ms)
      √ should not render retry button when onRetry is not provided (3 ms)
    Retry Button
      √ should call onRetry when retry button is clicked (14 ms)
      √ should show "Retrying..." text when isRetrying is true (5 ms)
      √ should disable retry button when isRetrying is true (11 ms)
      √ should not disable retry button when isRetrying is false (4 ms)
      √ should not call onRetry when button is disabled (4 ms)
    Accessibility
      √ should have role="alert" (3 ms)
      √ should have aria-live="polite" (3 ms)
      √ should have aria-hidden="true" on icon (3 ms)
      √ should have proper aria-label on retry button (5 ms)
      √ should maintain accessibility when retrying (3 ms)
    CSS Classes
      √ should apply correct CSS classes to elements (4 ms)
      √ should not render actions container when no retry button (2 ms)
    Icon Component
      √ should render AlertTriangleIcon with correct attributes (3 ms)
      √ should render correct paths for AlertTriangleIcon (3 ms)
    Edge Cases
      √ should handle empty title (5 ms)
      √ should handle empty message (12 ms)
      √ should handle undefined className (2 ms)
      √ should handle rapid retry clicks (5 ms)
      √ should handle transition from retrying to not retrying (10 ms)
      √ should handle long error messages (2 ms)
      √ should handle HTML-like content in title and message (3 ms)
    Component Structure
      √ should maintain correct DOM structure (3 ms)
      √ should have correct heading level for title (3 ms)
      √ should use paragraph element for message (3 ms)
    Default Export
      √ should export ErrorState as default (2 ms)

PASS src/components/__tests__/LoadingSkeleton.test.tsx
  LoadingSkeleton
    Rendering
      √ should render post skeleton by default (21 ms)
      √ should render single skeleton by default (6 ms)
      √ should render multiple skeletons when count is specified (7 ms)
      √ should apply custom className (4 ms)
    Variant: Post
      √ should render post skeleton variant (14 ms)
      √ should render post skeleton structure (5 ms)
      √ should have screen reader text for post (6 ms)
    Variant: Comment
      √ should render comment skeleton variant (3 ms)
      √ should render comment skeleton structure (4 ms)
      √ should have screen reader text for comment (5 ms)
    Variant: Profile
      √ should render profile skeleton variant (6 ms)
      √ should render profile skeleton structure (52 ms)
      √ should have screen reader text for profile (6 ms)
    Variant: Chat
      √ should render chat skeleton variant (3 ms)
      √ should render chat skeleton structure (18 ms)
      √ should have screen reader text for chat (3 ms)
    Multiple Skeletons
      √ should render correct number of skeletons (31 ms)
      √ should render multiple skeletons with different variants (75 ms)
      √ should generate unique keys for multiple skeletons (5 ms)
    Accessibility
      √ should use output element with aria-label (13 ms)
      √ should have appropriate aria-labels for each variant (19 ms)
      √ should have screen reader text for each variant (13 ms)
      √ should maintain accessibility with multiple skeletons (41 ms)
    CSS Classes
      √ should apply correct base classes (3 ms)
      √ should combine base classes with custom className (2 ms)
      √ should handle empty className (3 ms)
    Edge Cases
      √ should handle count of 0 (1 ms)
      √ should handle negative count (1 ms)
      √ should handle large count numbers (144 ms)
      √ should handle invalid variant and default to post (3 ms)
      √ should handle undefined props gracefully (3 ms)
    Component Structure
      √ should wrap each skeleton in a div with unique key (3 ms)
      √ should maintain consistent structure across variants (13 ms)
    Default Export
      √ should export LoadingSkeleton as default (1 ms)

FAIL src/hooks/useAccessibilityMonitoring.test.tsx
  ● Test suite failed to run

    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m48[0m:[93m4[0m - [91merror[0m[90m TS1005: [0m';' expected.

    [7m48[0m   });
    [7m  [0m [91m   ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m49[0m:[93m1[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m49[0m });
    [7m  [0m [91m~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m49[0m:[93m2[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m49[0m });
    [7m  [0m [91m ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m276[0m:[93m7[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m276[0m       ,
    [7m   [0m [91m      ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m279[0m:[93m5[0m - [91merror[0m[90m TS1005: [0m',' expected.

    [7m279[0m     )
    [7m   [0m [91m    ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m280[0m:[93m5[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m280[0m     );
    [7m   [0m [91m    ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m316[0m:[93m1[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m316[0m });
    [7m   [0m [91m~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m316[0m:[93m2[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m316[0m });
    [7m   [0m [91m ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m356[0m:[93m5[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m356[0m     );
    [7m   [0m [91m    ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m381[0m:[93m5[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m381[0m     );
    [7m   [0m [91m    ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m394[0m:[93m3[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m394[0m   });
    [7m   [0m [91m  ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m394[0m:[93m4[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m394[0m   });
    [7m   [0m [91m   ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m395[0m:[93m1[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m395[0m });
    [7m   [0m [91m~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m395[0m:[93m2[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m395[0m });
    [7m   [0m [91m ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m434[0m:[93m5[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m434[0m     );
    [7m   [0m [91m    ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m456[0m:[93m5[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m456[0m     );
    [7m   [0m [91m    ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m471[0m:[93m3[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m471[0m   });
    [7m   [0m [91m  ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m471[0m:[93m4[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m471[0m   });
    [7m   [0m [91m   ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m472[0m:[93m1[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m472[0m });
    [7m   [0m [91m~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m472[0m:[93m2[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m472[0m });
    [7m   [0m [91m ~[0m

  console.log
    Button found: true

      at Object.<anonymous> (src/components/safety/__tests__/QuickExitButton.working.test.tsx:184:15)

  console.log
    Button onclick: [Function: noop]

      at Object.<anonymous> (src/components/safety/__tests__/QuickExitButton.working.test.tsx:185:15)

PASS tests/integration/api-endpoints.test.ts
  API Endpoints Integration Tests
    Authentication API
      √ POST /api-auth - Register new user (1 ms)
      √ POST /api-auth - Login with valid credentials
      √ POST /api-auth - Login with invalid credentials
      √ POST /api-auth - Validate token (1 ms)
      √ POST /api-auth - Refresh token
    Wellness API
      √ POST /api-wellness - Create mood entry (1 ms)
      √ GET /api-wellness - Get mood history (1 ms)
      √ POST /api-wellness - Create journal entry
      √ POST /api-wellness - Track habit (1 ms)
      √ GET /api-wellness - Get wellness insights (1 ms)
    Safety API
      √ POST /api-safety - Create safety plan
      √ GET /api-safety - Get safety plan (1 ms)
      √ POST /api-safety - Report crisis (1 ms)
      √ GET /api-safety - Get emergency contacts
    AI Chat API
      √ POST /api-ai - Send message to AI (1 ms)
      √ POST /api-ai - Crisis detection in message (30 ms)
      √ GET /api-ai - Get conversation history (1 ms)
    Real-time API
      √ POST /api-realtime - Subscribe to notifications (3 ms)
      √ POST /api-realtime - Send mood update (2 ms)
      √ POST /api-realtime - Trigger crisis alert (1 ms)
    Security Tests
      √ Unauthorized access returns 401 (7 ms)
      √ Invalid token returns 401
      √ SQL injection attempt is blocked (1 ms)
      √ XSS attempt is sanitized
      √ Rate limiting is enforced (1 ms)
      √ CORS headers are properly set (1 ms)
    Error Handling
      √ Invalid endpoint returns 404 (1 ms)
      √ Invalid JSON returns 400
      √ Missing required fields returns 400
      √ Server error returns 500

PASS tests/service-worker/offline-functionality.test.ts
  Offline Functionality
    Network Detection
      √ should detect online state (1 ms)
      √ should detect offline state
      √ should handle online/offline events (2 ms)
    Crisis Resources Offline Access
      √ should serve crisis resources from cache when offline (1 ms)
      √ should provide coping strategies offline
      √ should provide emergency contacts offline (1 ms)
    Offline Navigation
      √ should serve offline fallback page for general routes (1 ms)
      √ should serve crisis-specific offline page for crisis routes (1 ms)
    Offline Data Synchronization
      √ should queue requests when offline (1 ms)
      √ should process queued requests when back online
    Offline Storage Management
      √ should store critical data locally (1 ms)
      √ should retrieve cached data when offline
    Performance in Offline Mode
      √ should load cached resources quickly
      √ should minimize battery usage in offline mode (1 ms)

FAIL src/hooks/usePeerSupport.test.ts
  ● Test suite failed to run

    [96msrc/hooks/usePeerSupport.test.ts[0m:[93m547[0m:[93m7[0m - [91merror[0m[90m TS1005: [0m',' expected.

    [7m547[0m       }
    [7m   [0m [91m      ~[0m
    [96msrc/hooks/usePeerSupport.test.ts[0m:[93m597[0m:[93m1[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m597[0m });
    [7m   [0m [91m~[0m
    [96msrc/hooks/usePeerSupport.test.ts[0m:[93m597[0m:[93m2[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m597[0m });
    [7m   [0m [91m ~[0m

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:367:19)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:367:19)

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'join')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:72
        at Array.map (<anonymous>)
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:38
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

PASS src/utils/videoThumbnailGenerator.test.ts
  VideoThumbnailGenerator
    constructor
      √ should create canvas and context on initialization (2 ms)
    generateThumbnails
      √ should generate thumbnails with default options (2 ms)
      √ should generate thumbnails with custom options (1 ms)
      √ should handle video loading errors (76 ms)
      √ should set correct video currentTime based on frameTime and duration (1 ms)
    generateThumbnailFromElement
      √ should generate thumbnail from ready video element (2 ms)
      √ should return null for unready video element
      √ should handle errors during thumbnail generation (1 ms)
    generateBatchThumbnails
      √ should generate thumbnails for multiple videos in batches (172 ms)
      √ should handle individual video failures gracefully (2 ms)
    cache operations
      saveThumbnailsToCache
        √ should save thumbnails to localStorage (1 ms)
        √ should handle localStorage errors
      loadThumbnailsFromCache
        √ should load valid cached thumbnails (1 ms)
        √ should return empty array for expired cache (1 ms)
        √ should handle malformed cache data (1 ms)
        √ should return empty array when no cache exists
      clearCache
        √ should remove cache from localStorage
    getThumbnailUrl
      √ should return URL for preferred size when available
      √ should fallback to medium when preferred size unavailable
      √ should fallback to small when medium unavailable
      √ should return first available size as last resort (1 ms)
      √ should return empty string when no sizes available
    generateFallbackThumbnail
      √ should generate fallback thumbnail with default parameters (1 ms)
      √ should generate fallback thumbnail with custom parameters (1 ms)
      √ should draw play icon overlay
    singleton instance
      √ should export a singleton instance (1 ms)
    edge cases and error handling
      √ should handle canvas context creation failure (2 ms)
      √ should handle very small thumbnail dimensions
      √ should handle empty text in fallback thumbnail
      √ should handle video with zero duration (1 ms)
    performance considerations
      √ should limit batch processing to prevent browser blocking (368 ms)
      √ should handle large number of thumbnails in cache efficiently (1 ms)

PASS src/components/__tests__/Modal.test.tsx
  Modal
    Rendering
      √ should render modal when isOpen is true (20 ms)
      √ should not render when isOpen is false (6 ms)
      √ should render with correct title (5 ms)
      √ should render description when provided (5 ms)
      √ should render close button when isDismissible is true (6 ms)
      √ should not render close button when isDismissible is false (3 ms)
      √ should render enhanced footer when enhanced and isDismissible (5 ms)
      √ should render swipe hint when allowSwipeToDismiss and not enhanced (4 ms)
      √ should not render swipe hint when enhanced (6 ms)
    Modal Sizes
      √ should apply correct classes for sm size when enhanced (4 ms)
      √ should apply correct classes for md size when enhanced (4 ms)
      √ should apply correct classes for lg size when enhanced (3 ms)
      √ should apply correct classes for xl size when enhanced (4 ms)
      √ should use legacy classes when not enhanced (15 ms)
    Accessibility
      √ should have correct ARIA attributes (4 ms)
      √ should set aria-describedby when description is provided (5 ms)
      √ should focus first focusable element when opened (154 ms)
      √ should focus modal element when no focusable elements found (116 ms)
      √ should restore focus when modal closes (264 ms)
      √ should trap focus within modal (12 ms)
    User Interactions
      √ should call onClose when close button is clicked (6 ms)
      √ should call onClose when footer close button is clicked (enhanced) (4 ms)
      √ should call onClose when backdrop is clicked (4 ms)
      √ should not render backdrop button when isDismissible is false (2 ms)
      √ should call onClose when Escape key is pressed (4 ms)
      √ should not call onClose on Escape when isDismissible is false (3 ms)
      √ should call onClose when dialog cancel event is triggered (5 ms)
      √ should prevent default cancel behavior (4 ms)
    Focus Management
      √ should handle Tab key for forward focus trapping (4 ms)
      √ should handle Shift+Tab key for backward focus trapping (4 ms)
      √ should clean up event listeners when modal closes (3 ms)
    Edge Cases
      √ should handle missing onClose handler gracefully (10 ms)
      √ should handle complex children content (6 ms)
      √ should handle rapid open/close cycles (10 ms)
      √ should handle when no focusable elements are present (85 ms)
    CSS Classes
      √ should apply enhanced overlay class when enhanced (4 ms)
      √ should apply legacy overlay class when not enhanced (4 ms)
      √ should apply enhanced header classes when enhanced (4 ms)
      √ should apply legacy classes when not enhanced (4 ms)

PASS src/components/safety/__tests__/QuickExitButton.working.test.tsx
  QuickExitButton - Working Tests
    Rendering
      √ should render the quick exit button (69 ms)
      √ should display exit icon (11 ms)
      √ should have proper positioning styles (7 ms)
    Exit Functionality
      √ should clear browsing data on click (15 ms)
      √ should redirect to safe site on click (29 ms)
      √ should use custom redirect URL if provided (10 ms)
    Keyboard Shortcuts
      √ should exit on triple ESC press (9 ms)
      √ should work with custom shortcut key (15 ms)
    Customization
      √ should accept custom button text (7 ms)
      √ should accept custom styles (7 ms)
      √ should support size variants (5 ms)
    Privacy Features
      √ should clear cookies if configured (9 ms)
    Error Handling
      √ should handle redirect failures gracefully (12 ms)

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:367:19)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:367:19)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'join')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:72
        at Array.map (<anonymous>)
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:38
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

PASS src/components/__tests__/CrisisAlertFixed.test.tsx
  CrisisAlert
    Rendering
      √ should render crisis alert when show is true (99 ms)
      √ should not render when show is false (3 ms)
      √ should render with correct severity classes (28 ms)
      √ should render emergency contacts for critical/high severity (12 ms)
      √ should not render emergency contacts for lower severity (4 ms)
      √ should render actions list when provided (14 ms)
      √ should render resources list when provided (16 ms)
      √ should render helper guidance for helper users (23 ms)
      √ should render close button when not in emergency mode (8 ms)
      √ should not render close button in emergency mode (6 ms)
    Accessibility
      √ should have proper ARIA attributes (5 ms)
      √ should focus the alert element when shown (7 ms)
      √ should have accessible emergency contact buttons (12 ms)
      √ should support keyboard navigation for backdrop dismissal (12 ms)
    User Interactions
      √ should call onDismiss when close button is clicked (11 ms)
      √ should call onDismiss when dismiss button is clicked (14 ms)
      √ should call onDismiss when backdrop is clicked (non-emergency mode) (7 ms)
      √ should not call onDismiss when backdrop is clicked in emergency mode (5 ms)
      √ should support keyboard dismissal with Enter key (12 ms)
      √ should support keyboard dismissal with Space key (11 ms)
      √ should call onCrisisChat when crisis chat button is clicked (8 ms)
      √ should open crisis chat website when no onCrisisChat handler provided (9 ms)
      √ should handle emergency contact calls (7 ms)
      √ should handle emergency text contacts (17 ms)
    Edge Cases
      √ should handle empty actions array (5 ms)
      √ should handle empty resources array (6 ms)
      √ should handle undefined severity gracefully (4 ms)
      √ should handle missing onEmergencyCall handler (9 ms)
      √ should display timestamp when alert is shown (10 ms)
    Animation and Timing
      √ should apply show class when show prop is true (5 ms)
      √ should apply hide class when show prop is false (9 ms)
      √ should handle rapid show/hide changes (21 ms)
    Severity Configurations
      √ should render correctly for critical severity (9 ms)
      √ should render correctly for high severity (9 ms)
      √ should render correctly for medium severity (6 ms)
      √ should render correctly for low severity (5 ms)
      √ should render correctly for none severity (7 ms)

PASS src/components/__tests__/FormInput.test.tsx
  FormInput
    Rendering
      √ should render input with label (84 ms)
      √ should render input without label (7 ms)
      √ should render with placeholder (6 ms)
      √ should render with current value (10 ms)
      √ should render floating label correctly (53 ms)
      √ should render help text when provided (6 ms)
      √ should render character count when enabled (6 ms)
      √ should render required indicator (3 ms)
    Input Types
      √ should render with correct type attribute: text (5 ms)
      √ should render with correct type attribute: email (4 ms)
      √ should render with correct type attribute: password (3 ms)
      √ should render with correct type attribute: tel (3 ms)
      √ should render with correct type attribute: url (3 ms)
      √ should render with correct type attribute: number (6 ms)
    User Interactions
      √ should call onChange when user types (14 ms)
      √ should call onBlur when input loses focus (7 ms)
      √ should handle rapid typing (12 ms)
    Validation
      √ should show required field error when empty and required (7 ms)
      √ should show minimum length error (11 ms)
      √ should show maximum length error (48 ms)
      √ should validate email format (10 ms)
      √ should validate against pattern (57 ms)
      √ should validate custom rules (21 ms)
      √ should show success state for valid input (15 ms)
      √ should validate in real-time when enabled (16 ms)
      √ should not validate until touched when realTimeValidation is false (14 ms)
    Character Count
      √ should show character count when enabled (7 ms)
      √ should apply near-limit class when approaching limit (4 ms)
      √ should apply over-limit class when exceeding limit (3 ms)
      √ should not show character count when disabled (3 ms)
    Accessibility
      √ should have correct ARIA attributes (4 ms)
      √ should associate label with input (3 ms)
      √ should mark input as invalid when validation fails (24 ms)
      √ should include all relevant IDs in aria-describedby (5 ms)
    States and Classes
      √ should apply form-group classes correctly (4 ms)
      √ should show success validation icon (19 ms)
      √ should show error validation icon (16 ms)
    Disabled State
      √ should render disabled input (11 ms)
      √ should not trigger validation when disabled (4 ms)
    Edge Cases
      √ should handle empty validation rules array (4 ms)
      √ should handle undefined validation rules (4 ms)
      √ should handle maxLength without showCharacterCount (6 ms)
      √ should handle floating label with empty placeholder (5 ms)
      √ should handle rapid value changes (8 ms)
      √ should handle complex validation rules (19 ms)

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:367:19)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:367:19)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'join')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:72
        at Array.map (<anonymous>)
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:38
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

  console.log
    [Intelligent Cache] Service worker integration ready

      at initializeServiceWorker (src/hooks/useIntelligentCaching.tsx:88:19)

PASS src/hooks/useIntelligentCaching.test.tsx
  useIntelligentCaching Hook
    √ should initialize with default state (130 ms)
    √ should initialize service worker integration successfully (171 ms)
    √ should handle service worker initialization failure (36 ms)
    √ should handle service worker messages (127 ms)
    √ should send messages to service worker (117 ms)
    √ should handle missing service worker controller (4 ms)
    √ should track route changes (102 ms)
    √ should detect network capabilities (8 ms)
    √ should handle missing navigator.connection (4 ms)
    √ should identify slow networks correctly (3 ms)
    √ should prefetch resources successfully (9 ms)
    √ should handle prefetch with custom options (3 ms)
    √ should skip prefetch on slow networks for non-crisis resources (3 ms)
    √ should prefetch crisis resources even on slow networks (4 ms)
    √ should handle prefetch failures (3 ms)
    √ should handle prefetch timeout (70 ms)
    √ should handle HTTP error responses (7 ms)
    √ should report crisis detection (77 ms)
    √ should update user preferences (79 ms)
    √ should get cache status via message channel (76 ms)
    √ should timeout cache status request (6 ms)
    √ should preload user resources (4 ms)
    √ should preload images with network awareness (3 ms)
    √ should skip image preload on slow networks (2 ms)
    √ should handle service worker unavailable for cache status (4 ms)
  useCrisisOptimization Hook
    √ should trigger crisis mode successfully (5 ms)
    √ should handle crisis mode failures (3 ms)
  CacheStatusMonitor Component
    √ should render cache status when available (6 ms)
    √ should handle null cache status (3 ms)
    √ should provide getCacheStatus function (4 ms)
    √ should handle component lifecycle (4 ms)

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:367:19)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:367:19)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'join')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:72
        at Array.map (<anonymous>)
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:38
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

PASS src/components/safety/__tests__/BreathingExerciseOverlay.test.tsx
  BreathingExerciseOverlay
    Rendering
      √ should render when isOpen is true (33 ms)
      √ should not render when isOpen is false (3 ms)
      √ should display all exercise options (19 ms)
    Exercise Selection
      √ should allow selecting different exercises (11 ms)
      √ should show exercise description on selection (10 ms)
      √ should highlight selected exercise (7 ms)
    Exercise Execution
      √ should start exercise on play button click (26 ms)
      √ should cycle through breathing phases (23 ms)
      √ should display countdown timer (28 ms)
      √ should complete full breathing cycle (43 ms)
    Controls
      √ should pause exercise on pause button click (25 ms)
      √ should resume exercise after pause (21 ms)
      √ should reset exercise on stop button click (25 ms)
    Visual Feedback
      √ should show breathing animation (16 ms)
      √ should change animation based on phase (27 ms)
      √ should display progress indicator (16 ms)
    Customization
      √ should allow custom cycle count (10 ms)
      √ should allow adjusting cycle count (12 ms)
      √ should support custom exercise durations (12 ms)
    Accessibility
      √ should have appropriate ARIA labels (10 ms)
      √ should be keyboard navigable (19 ms)
      √ should announce phase changes to screen readers (14 ms)
      √ should trap focus within overlay (9 ms)
    Completion and Feedback
      √ should show completion message after all cycles (28 ms)
      √ should track session statistics (27 ms)
      √ should offer to continue after completion (35 ms)
    Error Handling
      √ should handle timer errors gracefully (13 ms)
    Close Behavior
      √ should call onClose when X button clicked (13 ms)
      √ should call onClose when ESC key pressed (8 ms)
      √ should not close on overlay click when exercise is running (16 ms)

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:367:19)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:367:19)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'join')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:72
        at Array.map (<anonymous>)
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:38
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:367:19)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:367:19)

FAIL tests/accessibility/wcag-compliance.test.ts
  ● Test suite failed to run

    Cannot find module 'axe-playwright' from 'tests/accessibility/wcag-compliance.test.ts'

    [0m [90m 1 |[39m [36mimport[39m { test[33m,[39m expect[33m,[39m [33mPage[39m } [36mfrom[39m [32m'@playwright/test'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 2 |[39m [36mimport[39m { injectAxe[33m,[39m checkA11y[33m,[39m getViolations } [36mfrom[39m [32m'axe-playwright'[39m[33m;[39m
     [90m   |[39m [31m[1m^[22m[39m
     [90m 3 |[39m
     [90m 4 |[39m [90m/**[39m
     [90m 5 |[39m [90m * WCAG 2.1 AA Compliance Testing Suite[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (tests/accessibility/wcag-compliance.test.ts:2:1)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'join')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:72
        at Array.map (<anonymous>)
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:38
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:367:19)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:367:19)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'join')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:72
        at Array.map (<anonymous>)
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:38
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:367:19)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:367:19)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'join')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:72
        at Array.map (<anonymous>)
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:38
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:367:19)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:367:19)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'join')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:72
        at Array.map (<anonymous>)
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:38
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:445:13)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:445:13)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'join')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:72
        at Array.map (<anonymous>)
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:38
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

FAIL src/hooks/useConnectionStatus.test.ts (13.419 s)
  useConnectionStatus Hook
    √ should initialize with default connection status (286 ms)
    × should detect offline status (1055 ms)
    √ should determine connection quality from network information (100 ms)
    √ should handle poor connection quality (104 ms)
    √ should handle good connection quality (11 ms)
    √ should handle missing network information gracefully (12 ms)
    √ should register service worker when available (132 ms)
    √ should handle service worker state changes (235 ms)
    √ should check crisis resources availability (82 ms)
    √ should handle cache check errors gracefully (71 ms)
    √ should update offline capabilities based on service worker status (119 ms)
    √ should handle online/offline events (5 ms)
    √ should handle connection quality changes (3 ms)
    √ should send messages to service worker (193 ms)
    √ should handle service worker message sending errors (97 ms)
    √ should update crisis resources (126 ms)
    √ should force cache update (54 ms)
    × should handle service worker messages (1017 ms)
    √ should clean up event listeners on unmount (3 ms)
    × should handle when service worker is not supported (2 ms)
    × should warn when trying to send message without active service worker (1 ms)

  ● useConnectionStatus Hook › should detect offline status

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 78 |[39m     
     [90m 79 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 80 |[39m       expect(result[33m.[39mcurrent[33m.[39mconnectionStatus[33m.[39misOnline)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                        [31m[1m^[22m[39m
     [90m 81 |[39m       expect(result[33m.[39mcurrent[33m.[39mconnectionStatus[33m.[39mconnectionQuality)[33m.[39mtoBe([32m'offline'[39m)[33m;[39m
     [90m 82 |[39m     })[33m;[39m
     [90m 83 |[39m   })[33m;[39m[0m

      at src/hooks/useConnectionStatus.test.ts:80:56
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useConnectionStatus Hook › should handle service worker messages

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "message", Any<Function>

    Number of calls: 0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 403 |[39m     
     [90m 404 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 405 |[39m       expect(mockNavigator[33m.[39mserviceWorker[33m.[39maddEventListener)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                                            [31m[1m^[22m[39m
     [90m 406 |[39m         [32m'message'[39m[33m,[39m
     [90m 407 |[39m         expect[33m.[39many([33mFunction[39m)
     [90m 408 |[39m       )[33m;[39m[0m

      at src/hooks/useConnectionStatus.test.ts:405:60
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useConnectionStatus Hook › should handle when service worker is not supported

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 453 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useConnectionStatus())[33m;[39m
     [90m 454 |[39m     
    [31m[1m>[22m[39m[90m 455 |[39m     expect(result[33m.[39mcurrent[33m.[39mconnectionStatus[33m.[39misServiceWorkerSupported)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                                                                      [31m[1m^[22m[39m
     [90m 456 |[39m     
     [90m 457 |[39m     [90m// Restore service worker[39m
     [90m 458 |[39m     mockNavigator[33m.[39mserviceWorker [33m=[39m originalServiceWorker[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useConnectionStatus.test.ts:455:70)

  ● useConnectionStatus Hook › should warn when trying to send message without active service worker

    TypeError: Cannot read properties of undefined (reading 'getRegistration')

    [0m [90m 53 |[39m     jest[33m.[39mclearAllMocks()[33m;[39m
     [90m 54 |[39m     mockNavigator[33m.[39monLine [33m=[39m [36mtrue[39m[33m;[39m
    [31m[1m>[22m[39m[90m 55 |[39m     mockNavigator[33m.[39mserviceWorker[33m.[39mgetRegistration[33m.[39mmockResolvedValue([36mnull[39m)[33m;[39m
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 56 |[39m   })[33m;[39m
     [90m 57 |[39m
     [90m 58 |[39m   it([32m'should initialize with default connection status'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/hooks/useConnectionStatus.test.ts:55:33)

  console.warn
    ⚠️ Performance Alert: {
      id: 'budget_firstContentfulPaint_1755460727695',
      type: 'budget_violation',
      severity: 'critical',
      metric: 'firstContentfulPaint',
      currentValue: 5000,
      expectedValue: 1500,
      description: 'firstContentfulPaint (5000) exceeds critical threshold (3500)',
      recommendations: [
        'Optimize critical CSS delivery',
        'Minimize main thread work',
        'Use resource hints (preload, preconnect)',
        'Optimize font loading'
      ],
      timestamp: 1755460727695,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at src/services/comprehensivePerformanceMonitor.ts:642:14
          at Array.forEach (<anonymous>)
      at ComprehensivePerformanceMonitor.checkPerformanceBudgets (src/services/comprehensivePerformanceMonitor.ts:623:29)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:382:24)

  console.warn
    ⚠️ Performance Alert: {
      id: 'budget_memoryUsage_1755460727807',
      type: 'budget_violation',
      severity: 'medium',
      metric: 'memoryUsage',
      currentValue: 100,
      expectedValue: 50,
      description: 'memoryUsage (100) exceeds target (50)',
      recommendations: [
        'Implement virtual scrolling',
        'Clean up subscriptions and listeners',
        'Use React.memo for expensive components',
        'Optimize image memory usage'
      ],
      timestamp: 1755460727807,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at src/services/comprehensivePerformanceMonitor.ts:642:14
          at Array.forEach (<anonymous>)
      at ComprehensivePerformanceMonitor.checkPerformanceBudgets (src/services/comprehensivePerformanceMonitor.ts:623:29)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:382:24)

  console.warn
    ⚠️ Performance Alert: {
      id: 'budget_totalResourceSize_1755460727826',
      type: 'budget_violation',
      severity: 'medium',
      metric: 'totalResourceSize',
      currentValue: 2000000,
      expectedValue: 1500000,
      description: 'totalResourceSize (2000000) exceeds target (1500000)',
      recommendations: [ 'Monitor and optimize based on specific bottlenecks' ],
      timestamp: 1755460727826,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at src/services/comprehensivePerformanceMonitor.ts:642:14
          at Array.forEach (<anonymous>)
      at ComprehensivePerformanceMonitor.checkPerformanceBudgets (src/services/comprehensivePerformanceMonitor.ts:623:29)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:382:24)

  console.warn
    ⚠️ Performance Alert: {
      id: 'test-alert',
      type: 'budget_violation',
      severity: 'high',
      metric: 'firstContentfulPaint',
      currentValue: 3000,
      expectedValue: 1500,
      description: 'FCP exceeds target',
      recommendations: [ 'Optimize critical CSS' ],
      timestamp: 1755460727846,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:716:24)

  console.warn
    ⚠️ Performance Alert: {
      id: 'alert-1',
      type: 'budget_violation',
      severity: 'high',
      metric: 'firstContentfulPaint',
      currentValue: 3000,
      expectedValue: 1500,
      description: 'FCP exceeds target',
      recommendations: [ 'Optimize critical CSS' ],
      timestamp: 1755460727859,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:749:24)

  console.error
    🚨 CRITICAL PERFORMANCE ALERT (Crisis-Related): {
      id: 'callback-test',
      type: 'bottleneck_detected',
      severity: 'critical',
      metric: 'crisisDetectionResponseTime',
      currentValue: 600,
      expectedValue: 100,
      description: 'Crisis detection too slow',
      recommendations: [ 'Optimize AI model' ],
      timestamp: 1755460727869,
      isCrisisRelated: true
    }

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:789:15)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:774:24)

  console.warn
    ⚠️ Performance Alert: {
      id: 'resolved-alert',
      type: 'budget_violation',
      severity: 'high',
      metric: 'firstContentfulPaint',
      currentValue: 3000,
      expectedValue: 1500,
      description: 'FCP was too slow',
      recommendations: [ 'Optimize CSS' ],
      timestamp: 1755460727883,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:822:24)

C:\Users\damat\_REPOS\CoreV2\src\services\__tests__\comprehensivePerformanceMonitor.test.ts:996
            mockAnalyticsService.track.mockRejectedValue(new Error('Analytics error'));
                                                         ^

Error: Analytics error
    at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\services\__tests__\comprehensivePerformanceMonitor.test.ts:1125:52)
    at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
    at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
    at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
    at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
    at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
    at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
    at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
    at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
    at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
    at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
    at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
    at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

Node.js v22.17.0
PASS tests/service-worker/performance.test.ts (5.498 s)
  Service Worker Performance
    Cache Performance
      √ should measure cache hit performance (2 ms)
      √ should optimize cache miss scenarios (1 ms)
      √ should handle large cache operations efficiently (1 ms)
    Bundle Size Optimization
      √ should verify service worker size is under target
      √ should verify precached assets are under mobile target
      √ should count precached resources efficiently (1 ms)
    Memory Usage
      √ should manage cache memory efficiently (1 ms)
      √ should clean up unused cache entries (1 ms)
    Network Performance
      √ should implement efficient network timeouts
      √ should handle slow network connections gracefully (5005 ms)
      √ should prioritize critical resources (2 ms)
    Background Sync Performance
      √ should queue offline requests efficiently (1 ms)
      √ should process background sync efficiently (154 ms)
    Cache Strategy Performance
      √ should measure cache-first strategy performance (1 ms)
      √ should measure network-first strategy performance (2 ms)
      √ should measure stale-while-revalidate performance
    Error Handling Performance
      √ should handle cache errors without blocking (1 ms)
      √ should provide graceful degradation (1 ms)

FAIL src/hooks/useEnhancedOffline.test.ts (16.352 s)
  useEnhancedOffline Hook
    √ should initialize with loading state (224 ms)
    √ should initialize offline service successfully (243 ms)
    √ should handle initialization errors (146 ms)
    √ should set up status change monitoring (6 ms)
    √ should handle network status changes (221 ms)
    √ should update storage usage (201 ms)
    √ should get crisis resources successfully (123 ms)
    √ should handle crisis resources errors (211 ms)
    √ should detect crisis offline successfully (218 ms)
    √ should handle crisis detection errors with safe fallback (205 ms)
    √ should add items to sync queue (214 ms)
    √ should handle sync queue errors (183 ms)
    √ should clear offline data (185 ms)
    √ should handle clear data errors (137 ms)
    × should update offline resources (116 ms)
    × should handle update resources errors (1017 ms)
    × should determine offline support correctly (1008 ms)
    × should handle storage estimation errors gracefully (1021 ms)
    × should handle browsers without storage API (1007 ms)
    × should update storage usage periodically (5 ms)
    × should handle status change callbacks (4 ms)
    × should cleanup event listeners on unmount (2 ms)
    × should clear storage usage update interval on unmount (3 ms)

  ● useEnhancedOffline Hook › should update offline resources

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 425 |[39m
     [90m 426 |[39m     [90m// Should be updating during the call[39m
    [31m[1m>[22m[39m[90m 427 |[39m     expect(result[33m.[39mcurrent[33m.[39misUpdatingResources)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                [31m[1m^[22m[39m
     [90m 428 |[39m
     [90m 429 |[39m     [36mawait[39m updatePromise[33m;[39m
     [90m 430 |[39m[0m

      at Object.<anonymous> (src/hooks/useEnhancedOffline.test.ts:427:48)

  ● useEnhancedOffline Hook › should handle update resources errors

    TypeError: Cannot read properties of null (reading 'isInitializing')

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 446 |[39m
     [90m 447 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 448 |[39m       expect(result[33m.[39mcurrent[33m.[39misInitializing)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 449 |[39m     })[33m;[39m
     [90m 450 |[39m
     [90m 451 |[39m     [36mawait[39m act([36masync[39m () [33m=>[39m {[0m

      at src/hooks/useEnhancedOffline.test.ts:448:29
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useEnhancedOffline Hook › should determine offline support correctly

    TypeError: Cannot read properties of null (reading 'hasOfflineSupport')

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 465 |[39m
     [90m 466 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 467 |[39m       expect(result1[33m.[39mcurrent[33m.[39mhasOfflineSupport)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 468 |[39m     })[33m;[39m
     [90m 469 |[39m
     [90m 470 |[39m     [90m// Test with limited support[39m[0m

      at src/hooks/useEnhancedOffline.test.ts:467:30
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useEnhancedOffline Hook › should handle storage estimation errors gracefully

    TypeError: Cannot read properties of null (reading 'isInitializing')

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 492 |[39m
     [90m 493 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 494 |[39m       expect(result[33m.[39mcurrent[33m.[39misInitializing)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 495 |[39m     })[33m;[39m
     [90m 496 |[39m
     [90m 497 |[39m     expect(result[33m.[39mcurrent[33m.[39mstorageUsage[33m.[39mused)[33m.[39mtoBe([35m0[39m)[33m;[39m[0m

      at src/hooks/useEnhancedOffline.test.ts:494:29
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useEnhancedOffline Hook › should handle browsers without storage API

    TypeError: Cannot read properties of null (reading 'isInitializing')

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 514 |[39m
     [90m 515 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 516 |[39m       expect(result[33m.[39mcurrent[33m.[39misInitializing)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 517 |[39m     })[33m;[39m
     [90m 518 |[39m
     [90m 519 |[39m     expect(result[33m.[39mcurrent[33m.[39mstorageUsage[33m.[39mused)[33m.[39mtoBe([35m0[39m)[33m;[39m[0m

      at src/hooks/useEnhancedOffline.test.ts:516:29
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useEnhancedOffline Hook › should update storage usage periodically

    TypeError: Cannot read properties of null (reading 'isInitializing')

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 530 |[39m
     [90m 531 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 532 |[39m       expect(result[33m.[39mcurrent[33m.[39misInitializing)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 533 |[39m     })[33m;[39m
     [90m 534 |[39m
     [90m 535 |[39m     [90m// Clear the initial call[39m[0m

      at src/hooks/useEnhancedOffline.test.ts:532:29
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at node_modules/@testing-library/dom/dist/wait-for.js:82:9

  ● useEnhancedOffline Hook › should handle status change callbacks

    TypeError: Cannot read properties of null (reading 'isInitializing')

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 556 |[39m
     [90m 557 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 558 |[39m       expect(result[33m.[39mcurrent[33m.[39misInitializing)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 559 |[39m     })[33m;[39m
     [90m 560 |[39m
     [90m 561 |[39m     [36mconst[39m updatedStatus [33m=[39m {[0m

      at src/hooks/useEnhancedOffline.test.ts:558:29
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at node_modules/@testing-library/dom/dist/wait-for.js:82:9

  ● useEnhancedOffline Hook › should cleanup event listeners on unmount

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "online", Any<Function>

    Number of calls: 0

    [0m [90m 578 |[39m     [36mconst[39m { unmount } [33m=[39m renderHook(() [33m=>[39m useEnhancedOffline())[33m;[39m
     [90m 579 |[39m
    [31m[1m>[22m[39m[90m 580 |[39m     expect(addEventListenerSpy)[33m.[39mtoHaveBeenCalledWith([32m'online'[39m[33m,[39m expect[33m.[39many([33mFunction[39m))[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 581 |[39m     expect(addEventListenerSpy)[33m.[39mtoHaveBeenCalledWith([32m'offline'[39m[33m,[39m expect[33m.[39many([33mFunction[39m))[33m;[39m
     [90m 582 |[39m
     [90m 583 |[39m     unmount()[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useEnhancedOffline.test.ts:580:33)

  ● useEnhancedOffline Hook › should clear storage usage update interval on unmount

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 599 |[39m     unmount()[33m;[39m
     [90m 600 |[39m
    [31m[1m>[22m[39m[90m 601 |[39m     expect(clearIntervalSpy)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 602 |[39m
     [90m 603 |[39m     jest[33m.[39museRealTimers()[33m;[39m
     [90m 604 |[39m     clearIntervalSpy[33m.[39mmockRestore()[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useEnhancedOffline.test.ts:601:30)

  console.warn
    ⚠️ Performance Alert: {
      id: 'budget_firstContentfulPaint_1755460730897',
      type: 'budget_violation',
      severity: 'critical',
      metric: 'firstContentfulPaint',
      currentValue: 5000,
      expectedValue: 1500,
      description: 'firstContentfulPaint (5000) exceeds critical threshold (3500)',
      recommendations: [
        'Optimize critical CSS delivery',
        'Minimize main thread work',
        'Use resource hints (preload, preconnect)',
        'Optimize font loading'
      ],
      timestamp: 1755460730897,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at src/services/comprehensivePerformanceMonitor.ts:642:14
          at Array.forEach (<anonymous>)
      at ComprehensivePerformanceMonitor.checkPerformanceBudgets (src/services/comprehensivePerformanceMonitor.ts:623:29)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:382:24)

  console.warn
    ⚠️ Performance Alert: {
      id: 'budget_memoryUsage_1755460730982',
      type: 'budget_violation',
      severity: 'medium',
      metric: 'memoryUsage',
      currentValue: 100,
      expectedValue: 50,
      description: 'memoryUsage (100) exceeds target (50)',
      recommendations: [
        'Implement virtual scrolling',
        'Clean up subscriptions and listeners',
        'Use React.memo for expensive components',
        'Optimize image memory usage'
      ],
      timestamp: 1755460730982,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at src/services/comprehensivePerformanceMonitor.ts:642:14
          at Array.forEach (<anonymous>)
      at ComprehensivePerformanceMonitor.checkPerformanceBudgets (src/services/comprehensivePerformanceMonitor.ts:623:29)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:382:24)

  console.warn
    ⚠️ Performance Alert: {
      id: 'budget_totalResourceSize_1755460730996',
      type: 'budget_violation',
      severity: 'medium',
      metric: 'totalResourceSize',
      currentValue: 2000000,
      expectedValue: 1500000,
      description: 'totalResourceSize (2000000) exceeds target (1500000)',
      recommendations: [ 'Monitor and optimize based on specific bottlenecks' ],
      timestamp: 1755460730996,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at src/services/comprehensivePerformanceMonitor.ts:642:14
          at Array.forEach (<anonymous>)
      at ComprehensivePerformanceMonitor.checkPerformanceBudgets (src/services/comprehensivePerformanceMonitor.ts:623:29)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:382:24)

  console.warn
    ⚠️ Performance Alert: {
      id: 'test-alert',
      type: 'budget_violation',
      severity: 'high',
      metric: 'firstContentfulPaint',
      currentValue: 3000,
      expectedValue: 1500,
      description: 'FCP exceeds target',
      recommendations: [ 'Optimize critical CSS' ],
      timestamp: 1755460731021,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:716:24)

  console.warn
    ⚠️ Performance Alert: {
      id: 'alert-1',
      type: 'budget_violation',
      severity: 'high',
      metric: 'firstContentfulPaint',
      currentValue: 3000,
      expectedValue: 1500,
      description: 'FCP exceeds target',
      recommendations: [ 'Optimize critical CSS' ],
      timestamp: 1755460731031,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:749:24)

  console.error
    🚨 CRITICAL PERFORMANCE ALERT (Crisis-Related): {
      id: 'callback-test',
      type: 'bottleneck_detected',
      severity: 'critical',
      metric: 'crisisDetectionResponseTime',
      currentValue: 600,
      expectedValue: 100,
      description: 'Crisis detection too slow',
      recommendations: [ 'Optimize AI model' ],
      timestamp: 1755460731044,
      isCrisisRelated: true
    }

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:789:15)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:774:24)

  console.warn
    ⚠️ Performance Alert: {
      id: 'resolved-alert',
      type: 'budget_violation',
      severity: 'high',
      metric: 'firstContentfulPaint',
      currentValue: 3000,
      expectedValue: 1500,
      description: 'FCP was too slow',
      recommendations: [ 'Optimize CSS' ],
      timestamp: 1755460731052,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:822:24)

C:\Users\damat\_REPOS\CoreV2\src\services\__tests__\comprehensivePerformanceMonitor.test.ts:996
            mockAnalyticsService.track.mockRejectedValue(new Error('Analytics error'));
                                                         ^

Error: Analytics error
    at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\services\__tests__\comprehensivePerformanceMonitor.test.ts:1125:52)
    at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
    at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
    at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
    at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
    at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
    at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
    at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
    at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
    at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
    at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
    at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
    at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

Node.js v22.17.0
  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:482:13)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:482:13)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: Error: Service unavailable
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:479:28)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:500:13)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:500:13)

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at commitRootImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26974:5)
        at commitRoot (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26721:5)
        at performSyncWorkOnRoot (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26156:3)
        at flushSyncCallbacks (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:12042:22)
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at Object.eventWrapper (C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\pure.js:107:28)
        at fireEvent (C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\dom\dist\events.js:12:35)
        at Function.fireEvent.<computed> [as click] (C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\dom\dist\events.js:110:36)
        at Function.fireEvent.<computed> [as click] (C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\fire-event.js:15:52)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:510:17)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at commitRootImpl (node_modules/react-dom/cjs/react-dom.development.js:26974:5)
      at commitRoot (node_modules/react-dom/cjs/react-dom.development.js:26721:5)
      at performSyncWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:26156:3)
      at flushSyncCallbacks (node_modules/react-dom/cjs/react-dom.development.js:12042:22)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.eventWrapper (node_modules/@testing-library/react/dist/pure.js:107:28)
      at fireEvent (node_modules/@testing-library/dom/dist/events.js:12:35)
      at Function.fireEvent.<computed> [as click] (node_modules/@testing-library/dom/dist/events.js:110:36)
      at Function.fireEvent.<computed> [as click] (node_modules/@testing-library/react/dist/fire-event.js:15:52)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:510:17)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: Error: Cultural analysis failed
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:496:28)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:549:13)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:549:13)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'join')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:72
        at Array.map (<anonymous>)
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:38
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

  console.error
    [Cultural Crisis Detection] Failed to get metrics: TypeError: culturalCrisisDetectionService_1.culturalCrisisDetectionService.getCulturalMetrics is not a function
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:327:60
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:376:5
        at commitHookEffectListMount (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
        at commitPassiveMountOnFiber (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24970:11)
        at commitPassiveMountEffects_complete (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24930:9)
        at commitPassiveMountEffects_begin (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24917:7)
        at commitPassiveMountEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:24905:3)
        at flushPassiveEffectsImpl (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27078:3)
        at flushPassiveEffects (C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:27023:14)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\react-dom\cjs\react-dom.development.js:26808:9
        at flushActQueue (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2667:24)
        at act (C:\Users\damat\_REPOS\CoreV2\node_modules\react\cjs\react.development.js:2582:11)
        at C:\Users\damat\_REPOS\CoreV2\node_modules\@testing-library\react\dist\act-compat.js:47:25
        at customRender (C:\Users\damat\_REPOS\CoreV2\src\test-utils.tsx:64:6)
        at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\tests\culturalCrisisDetection.test.tsx:599:13)
        at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:338:15
      at src/hooks/useCulturalCrisisDetection.ts:376:5
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at customRender (src/test-utils.tsx:64:6)
      at Object.<anonymous> (src/tests/culturalCrisisDetection.test.tsx:599:13)

  console.error
    [Cultural Crisis Detection Hook] Analysis failed: TypeError: Cannot read properties of undefined (reading 'join')
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:72
        at Array.map (<anonymous>)
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:239:38
        at C:\Users\damat\_REPOS\CoreV2\src\hooks\useCulturalCrisisDetection.ts:162:7

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at src/hooks/useCulturalCrisisDetection.ts:181:15

FAIL src/tests/culturalCrisisDetection.test.tsx (10.344 s)
  Cultural Crisis Detection Integration
    MoodTracker Crisis Detection
      √ should detect crisis indicators from low mood values (232 ms)
      √ should detect crisis from concerning tags (360 ms)
      √ should detect crisis from concerning note content (240 ms)
    Cultural Crisis Alert Component
      √ should display culturally-appropriate interventions (199 ms)
      √ should show loading state during analysis (9 ms)
    Cross-Cultural Crisis Scenarios
      western cultural context
        √ should detect directSuicidalIdeation crisis appropriately (155 ms)
        × should detect indirectDistress crisis appropriately (381 ms)
        √ should detect familyConflict crisis appropriately (218 ms)
        √ should detect academicPressure crisis appropriately (196 ms)
      eastern cultural context
        √ should detect directSuicidalIdeation crisis appropriately (188 ms)
        √ should detect indirectDistress crisis appropriately (152 ms)
        √ should detect familyConflict crisis appropriately (144 ms)
        √ should detect academicPressure crisis appropriately (89 ms)
      latinAmerican cultural context
        √ should detect directSuicidalIdeation crisis appropriately (107 ms)
        √ should detect indirectDistress crisis appropriately (101 ms)
        √ should detect familyConflict crisis appropriately (95 ms)
        √ should detect academicPressure crisis appropriately (99 ms)
      middleEastern cultural context
        √ should detect directSuicidalIdeation crisis appropriately (93 ms)
        √ should detect indirectDistress crisis appropriately (97 ms)
        √ should detect familyConflict crisis appropriately (96 ms)
        √ should detect academicPressure crisis appropriately (90 ms)
    Bias Mitigation
      × should adjust risk scores based on cultural context (5063 ms)
    Error Handling
      √ should handle service failures gracefully (23 ms)
      √ should provide fallback behavior when cultural analysis fails (129 ms)
    Accessibility and User Experience
      √ should provide proper ARIA labels and announcements (96 ms)
      √ should support keyboard navigation (91 ms)

  ● Cultural Crisis Detection Integration › Cross-Cultural Crisis Scenarios › western cultural context › should detect indirectDistress crisis appropriately

    TypeError: Cannot read properties of undefined (reading 'culturallyAdjustedRisk')

    [0m [90m 148 |[39m           [33m...[39mprev[33m,[39m
     [90m 149 |[39m           lastAnalysis[33m:[39m analysis[33m,[39m
    [31m[1m>[22m[39m[90m 150 |[39m           culturallyAdjustedRisk[33m:[39m analysis[33m.[39mculturallyAdjustedRisk[33m?[39m[33m.[39madjustedRisk [33m||[39m [35m0[39m[33m,[39m
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 151 |[39m           biasAdjustments[33m:[39m analysis[33m.[39mculturalBiasAdjustments[33m?[39m[33m.[39mmap(adj [33m=>[39m adj[33m.[39mfactor) [33m||[39m [][33m,[39m
     [90m 152 |[39m           culturalInterventions[33m:[39m analysis[33m.[39mculturalInterventions [33m||[39m [36mnull[39m[33m,[39m
     [90m 153 |[39m           analysisHistory[33m:[39m newHistory[33m,[39m[0m

      at src/hooks/useCulturalCrisisDetection.ts:150:44
      at basicStateReducer (node_modules/react-dom/cjs/react-dom.development.js:15721:41)
      at updateReducer (node_modules/react-dom/cjs/react-dom.development.js:15845:22)
      at updateState (node_modules/react-dom/cjs/react-dom.development.js:16185:10)
      at Object.useState (node_modules/react-dom/cjs/react-dom.development.js:17096:16)
      at useState (node_modules/react/cjs/react.development.js:1622:21)
      at useCulturalCrisisDetection (src/hooks/useCulturalCrisisDetection.ts:79:37)
      at CulturalCrisisAlert (src/components/CulturalCrisisAlert.tsx:84:33)
      at renderWithHooks (node_modules/react-dom/cjs/react-dom.development.js:15486:18)
      at updateFunctionComponent (node_modules/react-dom/cjs/react-dom.development.js:19617:20)
      at beginWork (node_modules/react-dom/cjs/react-dom.development.js:21640:16)
      at beginWork$1 (node_modules/react-dom/cjs/react-dom.development.js:27465:14)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26599:12)
      at workLoopSync (node_modules/react-dom/cjs/react-dom.development.js:26505:5)
      at renderRootSync (node_modules/react-dom/cjs/react-dom.development.js:26473:7)
      at recoverFromConcurrentError (node_modules/react-dom/cjs/react-dom.development.js:25889:20)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25789:22)
      at workLoop (node_modules/scheduler/cjs/scheduler.development.js:266:34)
      at flushWork (node_modules/scheduler/cjs/scheduler.development.js:239:14)
      at performWorkUntilDeadline (node_modules/scheduler/cjs/scheduler.development.js:533:21)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● Cultural Crisis Detection Integration › Bias Mitigation › should adjust risk scores based on cultural context

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ArrayContaining [StringContaining "communication_style"]

    Number of calls: 0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div[39m
          [33mdata-testid[39m=[32m"test-container"[39m
        [36m>[39m
          [36m<div[39m
            [33maria-labelledby[39m=[32m"crisis-alert-title"[39m
            [33maria-live[39m=[32m"assertive"[39m
            [33mclass[39m=[32m"crisis-alert crisis-alert--medium crisis-alert--show"[39m
            [33mid[39m=[32m"crisis-alert"[39m
            [33mrole[39m=[32m"alert"[39m
            [33mtabindex[39m=[32m"-1"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert__backdrop"[39m
            [36m/>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert__container"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-alert__header"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"crisis-alert__icon-container"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33maria-hidden[39m=[32m"true"[39m
                    [33mclass[39m=[32m"crisis-alert__icon"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mheight[39m=[32m"24"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mstyle[39m=[32m"color: rgb(217, 119, 6);"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mwidth[39m=[32m"24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1Z"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"crisis-alert__title-container"[39m
                [36m>[39m
                  [36m<h2[39m
                    [33mclass[39m=[32m"crisis-alert__title"[39m
                    [33mid[39m=[32m"crisis-alert-title"[39m
                  [36m>[39m
                    [0mSupport Recommended[0m
                  [36m</h2>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"crisis-alert__timestamp"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33maria-hidden[39m=[32m"true"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"14"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"14"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.2L17,14.7L16.2,16.2Z"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                    [36m<span>[39m
                      [0m2:58:47 PM[0m
                    [36m</span>[39m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Close alert"[39m
                  [33mclass[39m=[32m"crisis-alert__close"[39m
                  [33mtype[39m=[32m"button"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33maria-hidden[39m=[32m"true"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mheight[39m=[32m"20"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mwidth[39m=[32m"20"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-alert__content"[39m
              [36m>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"crisis-alert__message"[39m
                [36m>[39m
                  [0mHelp is available. You are not alone.[0m
                [36m</p>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-alert__actions-section"[39m
              [36m>[39m
                [36m<h3[39m
                  [33mclass[39m=[32m"crisis-alert__section-title"[39m
                [36m>[39m
                  [0mRecommended Actions[0m
                [36m</h3>[39m
                [36m<ul[39m
                  [33mclass[39m=[32m"crisis-alert__actions-list"[39m
                [36m>[39m
                  [36m<li[39m
                    [33mclass[39m=[32m"crisis-alert__action-item"[39m
                  [36m>[39m
                    [0mcommunication_style[0m
                  [36m</li>[39m
                  [36m<li[39m
                    [33mclass[39m=[32m"crisis-alert__action-item"[39m
                  [36m>[39m
                    [0mFamily-centered crisis intervention approach recommended[0m
                  [36m</li>[39m
                  [36m<li[39m
                    [33mclass[39m=[32m"crisis-alert__action-item"[39m
                  [36m>[39m
                    [0mCommunity-based support systems available[0m
                  [36m</li>[39m
                  [36m<li[39m
                    [33mclass[39m=[32m"crisis-alert__action-item"[39m
                  [36m>[39m
                    [0meastern_counseling[0m
                  [36m</li>[39m
                  [36m<li[39m
                    [33mclass[39m=[32m"crisis-alert__action-item"[39m
                  [36m>[39m
                    [0mzh_crisis_line[0m
                  [36m</li>[39m
                [36m</ul>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-alert__chat-section"[39m
              [36m>[39m
                [36m<button[39m
                  [33mclass[39m=[32m"crisis-alert__chat-button"[39m
                  [33mtype[39m=[32m"button"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33maria-hidden[39m=[32m"true"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mheight[39m=[32m"20"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mwidth[39m=[32m"20"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                  [36m<span>[39m
                    [0mStart Crisis Chat[0m
                  [36m</span>[39m
                [36m</button>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-alert__resources-section"[39m
              [36m>[39m
                [36m<h3[39m
                  [33mclass[39m=[32m"crisis-alert__section-title"[39m
                [36m>[39m
                  [0mAdditional Resources[0m
                [36m</h3>[39m
                [36m<ul[39m
                  [33mclass[39m=[32m"crisis-alert__resources-list"[39m
                [36m>[39m
                  [36m<li[39m
                    [33mclass[39m=[32m"crisis-alert__resource-item"[39m
                  [36m>[39m
                    [0m988 Suicide & Crisis Lifeline[0m
                  [36m</li>[39m
                  [36m<li[39m
                    [33mclass[39m=[32m"crisis-alert__resource-item"[39m
                  [36m>[39m
                    [0mCrisis Text Line: Text HOME to 741741[0m
                  [36m</li>[39m
                [36m</ul>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-alert__footer"[39m
              [36m>[39m
                [36m<button[39m
                  [33mclass[39m=[32m"crisis-alert__dismiss-button"[39m
                  [33mtype[39m=[32m"button"[39m
                [36m>[39m
                  [0mI understand[0m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 465 |[39m       [90m// Give more time for the hook's useEffect to process and trigger callbacks[39m
     [90m 466 |[39m       [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 467 |[39m         expect(onBiasDetected)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 468 |[39m           expect[33m.[39marrayContaining([
     [90m 469 |[39m             expect[33m.[39mstringContaining([32m'communication_style'[39m)
     [90m 470 |[39m           ])[0m

      at timeout (src/tests/culturalCrisisDetection.test.tsx:467:32)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  console.warn
    ⚠️ Performance Alert: {
      id: 'budget_firstContentfulPaint_1755460734011',
      type: 'budget_violation',
      severity: 'critical',
      metric: 'firstContentfulPaint',
      currentValue: 5000,
      expectedValue: 1500,
      description: 'firstContentfulPaint (5000) exceeds critical threshold (3500)',
      recommendations: [
        'Optimize critical CSS delivery',
        'Minimize main thread work',
        'Use resource hints (preload, preconnect)',
        'Optimize font loading'
      ],
      timestamp: 1755460734011,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at src/services/comprehensivePerformanceMonitor.ts:642:14
          at Array.forEach (<anonymous>)
      at ComprehensivePerformanceMonitor.checkPerformanceBudgets (src/services/comprehensivePerformanceMonitor.ts:623:29)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:382:24)

  console.warn
    ⚠️ Performance Alert: {
      id: 'budget_memoryUsage_1755460734121',
      type: 'budget_violation',
      severity: 'medium',
      metric: 'memoryUsage',
      currentValue: 100,
      expectedValue: 50,
      description: 'memoryUsage (100) exceeds target (50)',
      recommendations: [
        'Implement virtual scrolling',
        'Clean up subscriptions and listeners',
        'Use React.memo for expensive components',
        'Optimize image memory usage'
      ],
      timestamp: 1755460734121,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at src/services/comprehensivePerformanceMonitor.ts:642:14
          at Array.forEach (<anonymous>)
      at ComprehensivePerformanceMonitor.checkPerformanceBudgets (src/services/comprehensivePerformanceMonitor.ts:623:29)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:382:24)

  console.warn
    ⚠️ Performance Alert: {
      id: 'budget_totalResourceSize_1755460734137',
      type: 'budget_violation',
      severity: 'medium',
      metric: 'totalResourceSize',
      currentValue: 2000000,
      expectedValue: 1500000,
      description: 'totalResourceSize (2000000) exceeds target (1500000)',
      recommendations: [ 'Monitor and optimize based on specific bottlenecks' ],
      timestamp: 1755460734137,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at src/services/comprehensivePerformanceMonitor.ts:642:14
          at Array.forEach (<anonymous>)
      at ComprehensivePerformanceMonitor.checkPerformanceBudgets (src/services/comprehensivePerformanceMonitor.ts:623:29)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:382:24)

  console.warn
    ⚠️ Performance Alert: {
      id: 'test-alert',
      type: 'budget_violation',
      severity: 'high',
      metric: 'firstContentfulPaint',
      currentValue: 3000,
      expectedValue: 1500,
      description: 'FCP exceeds target',
      recommendations: [ 'Optimize critical CSS' ],
      timestamp: 1755460734164,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:716:24)

  console.warn
    ⚠️ Performance Alert: {
      id: 'alert-1',
      type: 'budget_violation',
      severity: 'high',
      metric: 'firstContentfulPaint',
      currentValue: 3000,
      expectedValue: 1500,
      description: 'FCP exceeds target',
      recommendations: [ 'Optimize critical CSS' ],
      timestamp: 1755460734174,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:749:24)

  console.error
    🚨 CRITICAL PERFORMANCE ALERT (Crisis-Related): {
      id: 'callback-test',
      type: 'bottleneck_detected',
      severity: 'critical',
      metric: 'crisisDetectionResponseTime',
      currentValue: 600,
      expectedValue: 100,
      description: 'Crisis detection too slow',
      recommendations: [ 'Optimize AI model' ],
      timestamp: 1755460734189,
      isCrisisRelated: true
    }

    [0m [90m 1186 |[39m       [36mreturn[39m[33m;[39m
     [90m 1187 |[39m     }
    [31m[1m>[22m[39m[90m 1188 |[39m     originalError(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1189 |[39m   })[33m;[39m
     [90m 1190 |[39m
     [90m 1191 |[39m   console[33m.[39mwarn [33m=[39m jest[33m.[39mfn((message[33m,[39m [33m...[39margs) [33m=>[39m {[0m

      at console.<anonymous> (src/setupTests.ts:1188:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:789:15)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:774:24)

  console.warn
    ⚠️ Performance Alert: {
      id: 'resolved-alert',
      type: 'budget_violation',
      severity: 'high',
      metric: 'firstContentfulPaint',
      currentValue: 3000,
      expectedValue: 1500,
      description: 'FCP was too slow',
      recommendations: [ 'Optimize CSS' ],
      timestamp: 1755460734202,
      isCrisisRelated: false
    }

    [0m [90m 1198 |[39m       [36mreturn[39m[33m;[39m
     [90m 1199 |[39m     }
    [31m[1m>[22m[39m[90m 1200 |[39m     originalWarn(message[33m,[39m [33m...[39margs)[33m;[39m
     [90m      |[39m     [31m[1m^[22m[39m
     [90m 1201 |[39m   })[33m;[39m
     [90m 1202 |[39m })[33m;[39m
     [90m 1203 |[39m[0m

      at console.<anonymous> (src/setupTests.ts:1200:5)
      at ComprehensivePerformanceMonitor.createAlert (src/services/comprehensivePerformanceMonitor.ts:791:15)
      at Object.<anonymous> (src/services/__tests__/comprehensivePerformanceMonitor.test.ts:822:24)

C:\Users\damat\_REPOS\CoreV2\src\services\__tests__\comprehensivePerformanceMonitor.test.ts:996
            mockAnalyticsService.track.mockRejectedValue(new Error('Analytics error'));
                                                         ^

Error: Analytics error
    at Object.<anonymous> (C:\Users\damat\_REPOS\CoreV2\src\services\__tests__\comprehensivePerformanceMonitor.test.ts:1125:52)
    at Promise.then.completed (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:298:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\utils.js:231:10)
    at _callCircusTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:316:40)
    at _runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:252:3)
    at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:126:9)
    at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
    at _runTestsForDescribeBlock (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:121:9)
    at run (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\run.js:71:3)
    at runAndTransformResultsToJestFormat (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
    at jestAdapter (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
    at runTestInternal (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:367:16)
    at runTest (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\runTest.js:444:34)
    at Object.worker (C:\Users\damat\_REPOS\CoreV2\node_modules\jest-runner\build\testWorker.js:106:12)

Node.js v22.17.0
FAIL src/services/__tests__/comprehensivePerformanceMonitor.test.ts
  ● Test suite failed to run

    Jest worker encountered 4 child process exceptions, exceeding retry limit

      at ChildProcessWorker.initialize (node_modules/jest-worker/build/workers/ChildProcessWorker.js:181:21)

Summary of all failing tests
FAIL src/hooks/useSafeLocation.test.ts (7.395 s)
  ● useSafeLocation Hook › should return fallback location when context has no location

    ReferenceError: React is not defined

    [0m [90m 54 |[39m   it([32m'should return fallback location when context has no location'[39m[33m,[39m () [33m=>[39m {
     [90m 55 |[39m     [90m// Mock useContext to return context without location[39m
    [31m[1m>[22m[39m[90m 56 |[39m     jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockReturnValue({})[33m;[39m
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 57 |[39m
     [90m 58 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useSafeLocation())[33m;[39m
     [90m 59 |[39m[0m

      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:56:16)

  ● useSafeLocation Hook › should handle various location states

    ReferenceError: React is not defined

    [0m [90m 100 |[39m
     [90m 101 |[39m     locationStates[33m.[39mforEach((locationState) [33m=>[39m {
    [31m[1m>[22m[39m[90m 102 |[39m       jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockReturnValue({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 103 |[39m         location[33m:[39m locationState
     [90m 104 |[39m       })[33m;[39m
     [90m 105 |[39m[0m

      at src/hooks/useSafeLocation.test.ts:102:18
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:101:20)

  ● useSafeLocation Hook › should handle missing search parameter

    ReferenceError: React is not defined

    [0m [90m 111 |[39m
     [90m 112 |[39m   it([32m'should handle missing search parameter'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 113 |[39m     jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockReturnValue({
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 114 |[39m       location[33m:[39m {
     [90m 115 |[39m         pathname[33m:[39m [32m'/test'[39m[33m,[39m
     [90m 116 |[39m         hash[33m:[39m [32m'#section'[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:113:16)

  ● useSafeLocation Hook › should handle missing hash parameter

    ReferenceError: React is not defined

    [0m [90m 131 |[39m
     [90m 132 |[39m   it([32m'should handle missing hash parameter'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 133 |[39m     jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockReturnValue({
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 134 |[39m       location[33m:[39m {
     [90m 135 |[39m         pathname[33m:[39m [32m'/test'[39m[33m,[39m
     [90m 136 |[39m         search[33m:[39m [32m'?test=true'[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:133:16)

  ● useSafeLocation Hook › should handle missing state parameter

    ReferenceError: React is not defined

    [0m [90m 151 |[39m
     [90m 152 |[39m   it([32m'should handle missing state parameter'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 153 |[39m     jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockReturnValue({
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 154 |[39m       location[33m:[39m {
     [90m 155 |[39m         pathname[33m:[39m [32m'/test'[39m[33m,[39m
     [90m 156 |[39m         search[33m:[39m [32m'?test=true'[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:153:16)

  ● useSafeLocation Hook › should handle missing key parameter

    ReferenceError: React is not defined

    [0m [90m 171 |[39m
     [90m 172 |[39m   it([32m'should handle missing key parameter'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 173 |[39m     jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockReturnValue({
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 174 |[39m       location[33m:[39m {
     [90m 175 |[39m         pathname[33m:[39m [32m'/test'[39m[33m,[39m
     [90m 176 |[39m         search[33m:[39m [32m'?test=true'[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:173:16)

  ● useSafeLocation Hook › should handle context changes

    ReferenceError: React is not defined

    [0m [90m 214 |[39m     }[33m;[39m
     [90m 215 |[39m
    [31m[1m>[22m[39m[90m 216 |[39m     jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockImplementation(() [33m=>[39m contextValue)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 217 |[39m
     [90m 218 |[39m     [36mconst[39m { result[33m,[39m rerender } [33m=[39m renderHook(() [33m=>[39m useSafeLocation())[33m;[39m
     [90m 219 |[39m[0m

      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:216:16)

  ● useSafeLocation Hook › should handle edge case of undefined context

    ReferenceError: React is not defined

    [0m [90m 252 |[39m
     [90m 253 |[39m   it([32m'should handle edge case of undefined context'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 254 |[39m     jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockReturnValue(undefined)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 255 |[39m
     [90m 256 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useSafeLocation())[33m;[39m
     [90m 257 |[39m[0m

      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:254:16)

  ● useSafeLocation Hook › should handle complex state objects

    ReferenceError: React is not defined

    [0m [90m 273 |[39m     }[33m;[39m
     [90m 274 |[39m
    [31m[1m>[22m[39m[90m 275 |[39m     jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockReturnValue({
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 276 |[39m       location[33m:[39m {
     [90m 277 |[39m         pathname[33m:[39m [32m'/complex'[39m[33m,[39m
     [90m 278 |[39m         search[33m:[39m [32m'?complex=true&nested=value'[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:275:16)

  ● useSafeLocation Hook › should handle empty string values correctly

    ReferenceError: React is not defined

    [0m [90m 293 |[39m
     [90m 294 |[39m   it([32m'should handle empty string values correctly'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 295 |[39m     jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockReturnValue({
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 296 |[39m       location[33m:[39m {
     [90m 297 |[39m         pathname[33m:[39m [32m''[39m[33m,[39m
     [90m 298 |[39m         search[33m:[39m [32m''[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:295:16)

  ● useSafeLocation Hook › should be usable outside Router context without errors

    ReferenceError: React is not defined

    [0m [90m 314 |[39m   it([32m'should be usable outside Router context without errors'[39m[33m,[39m () [33m=>[39m {
     [90m 315 |[39m     [90m// This simulates usage outside of Router context entirely[39m
    [31m[1m>[22m[39m[90m 316 |[39m     jest[33m.[39mspyOn([33mReact[39m[33m,[39m [32m'useContext'[39m)[33m.[39mmockReturnValue([36mnull[39m)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 317 |[39m
     [90m 318 |[39m     expect(() [33m=>[39m {
     [90m 319 |[39m       [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useSafeLocation())[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useSafeLocation.test.ts:316:16)

FAIL src/services/__tests__/crisisDetection.integration.test.ts
  ● Crisis Detection Service - Integration Tests › Protective Factors Detection › should recognize protective factors that reduce risk

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 50 |[39m       )[33m;[39m
     [90m 51 |[39m       
    [31m[1m>[22m[39m[90m 52 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 53 |[39m       expect(result[33m.[39mprotectiveFactors[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m 54 |[39m       expect(result[33m.[39mprotectiveFactors)[33m.[39mtoContain([32m'life_responsibilities'[39m)[33m;[39m
     [90m 55 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetection.integration.test.ts:52:42)

  ● Crisis Detection Service - Integration Tests › Protective Factors Detection › should detect help-seeking behavior

    expect(received).toContain(expected) // indexOf

    Expected value: "professional_support"
    Received array: ["Provide suicide prevention resources", "Share safety planning tools", "Connect with crisis hotline", "Schedule follow-up check-in", "Provide comprehensive resource list", "Connect with peer support", "Facilitate connection to requested support resources"]

    [0m [90m 62 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 63 |[39m       expect(result[33m.[39mprotectiveFactors)[33m.[39mtoContain([32m'help_seeking'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 64 |[39m       expect(result[33m.[39mrecommendedActions)[33m.[39mtoContain([32m'professional_support'[39m)[33m;[39m
     [90m    |[39m                                         [31m[1m^[22m[39m
     [90m 65 |[39m     })[33m;[39m
     [90m 66 |[39m   })[33m;[39m
     [90m 67 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetection.integration.test.ts:64:41)

  ● Crisis Detection Service - Integration Tests › False Positive Prevention › should not flag past tense recovery stories

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 81 |[39m       )[33m;[39m
     [90m 82 |[39m       
    [31m[1m>[22m[39m[90m 83 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 84 |[39m       expect(result[33m.[39mseverityLevel)[33m.[39mtoBe([32m'none'[39m)[33m;[39m
     [90m 85 |[39m     })[33m;[39m
     [90m 86 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetection.integration.test.ts:83:42)

  ● Crisis Detection Service - Integration Tests › Multilingual Crisis Detection › should have support for multiple languages

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 90 |[39m       [90m// Test that the service has multilingual capabilities[39m
     [90m 91 |[39m       [36mconst[39m service [33m=[39m astralCoreCrisisDetection [36mas[39m any[33m;[39m
    [31m[1m>[22m[39m[90m 92 |[39m       expect(service[33m.[39msupportedLanguages)[33m.[39mtoBeDefined()[33m;[39m
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 93 |[39m       expect(service[33m.[39msupportedLanguages[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m1[39m)[33m;[39m
     [90m 94 |[39m     })[33m;[39m
     [90m 95 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetection.integration.test.ts:92:42)

  ● Crisis Detection Service - Integration Tests › Escalation Workflow › should trigger emergency escalation for critical threats

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 101 |[39m       )[33m;[39m
     [90m 102 |[39m       
    [31m[1m>[22m[39m[90m 103 |[39m       expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                         [31m[1m^[22m[39m
     [90m 104 |[39m       expect(result[33m.[39memergencyServices)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 105 |[39m       expect(result[33m.[39mrecommendedActions)[33m.[39mtoContain([32m'call_emergency'[39m)[33m;[39m
     [90m 106 |[39m       expect(result[33m.[39mrecommendedActions)[33m.[39mtoContain([32m'immediate_intervention'[39m)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetection.integration.test.ts:103:41)

  ● Crisis Detection Service - Integration Tests › Escalation Workflow › should recommend professional support for high-risk cases

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 112 |[39m       )[33m;[39m
     [90m 113 |[39m       
    [31m[1m>[22m[39m[90m 114 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 115 |[39m       expect(result[33m.[39mrecommendedActions)[33m.[39mtoContain([32m'professional_support'[39m)[33m;[39m
     [90m 116 |[39m       expect(result[33m.[39mrecommendedActions)[33m.[39mtoContain([32m'crisis_hotline'[39m)[33m;[39m
     [90m 117 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetection.integration.test.ts:114:42)

FAIL src/utils/enhancedRouting.test.ts (7.856 s)
  ● enhancedRouting › EnhancedRouteManager › initialize › should setup intersection observers for viewport preloading

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 116 |[39m         [33mEnhancedRouteManager[39m[33m.[39minitialize()[33m;[39m
     [90m 117 |[39m         
    [31m[1m>[22m[39m[90m 118 |[39m         expect(mockIntersectionObserver)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 119 |[39m       })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m       it([32m'should log initialization in development'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/enhancedRouting.test.ts:118:42)

  ● enhancedRouting › EnhancedRouteManager › preloading › should preload critical routes on initialization

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/", Any<Function>, "high"

    Number of calls: 0

    [0m [90m 251 |[39m         ([33mEnhancedRouteManager[39m [36mas[39m any)[33m.[39mpreloadCriticalRoutes()[33m;[39m
     [90m 252 |[39m
    [31m[1m>[22m[39m[90m 253 |[39m         expect([33mComponentPreloader[39m[33m.[39maddToQueue)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                               [31m[1m^[22m[39m
     [90m 254 |[39m           [32m'/'[39m[33m,[39m
     [90m 255 |[39m           expect[33m.[39many([33mFunction[39m)[33m,[39m
     [90m 256 |[39m           [32m'high'[39m[0m

      at Object.<anonymous> (src/utils/enhancedRouting.test.ts:253:47)

  ● enhancedRouting › EnhancedRouteManager › viewport-based preloading › should setup intersection observer for viewport preloading

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: Any<Function>, {"rootMargin": "100px"}

    Number of calls: 0

    [0m [90m 332 |[39m
     [90m 333 |[39m       it([32m'should setup intersection observer for viewport preloading'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 334 |[39m         expect(mockIntersectionObserver)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 335 |[39m           expect[33m.[39many([33mFunction[39m)[33m,[39m
     [90m 336 |[39m           { rootMargin[33m:[39m [32m'100px'[39m }
     [90m 337 |[39m         )[33m;[39m[0m

      at Object.<anonymous> (src/utils/enhancedRouting.test.ts:334:42)

  ● enhancedRouting › EnhancedRouteManager › hover-based preloading › should setup hover preloading for specified routes

    expect(received).toHaveBeenCalledWith(...expected)

    Matcher error: received value must be a mock or spy function

    Received has type:  function
    Received has value: [Function addEventListener]

    [0m [90m 377 |[39m
     [90m 378 |[39m         [36mconst[39m hoverListener [33m=[39m document[33m.[39maddEventListener [36mas[39m jest[33m.[39m[33mMock[39m[33m;[39m
    [31m[1m>[22m[39m[90m 379 |[39m         expect(hoverListener)[33m.[39mtoHaveBeenCalledWith([32m'mouseover'[39m[33m,[39m expect[33m.[39many([33mFunction[39m))[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 380 |[39m       })[33m;[39m
     [90m 381 |[39m     })[33m;[39m
     [90m 382 |[39m[0m

      at Object.<anonymous> (src/utils/enhancedRouting.test.ts:379:31)

  ● enhancedRouting › EnhancedRouteManager › interaction-based preloading › should setup interaction preloading for specified routes

    expect(received).toHaveBeenCalledWith(...expected)

    Matcher error: received value must be a mock or spy function

    Received has type:  function
    Received has value: [Function addEventListener]

    [0m [90m 396 |[39m
     [90m 397 |[39m         [90m// Should setup touch and mouse event listeners[39m
    [31m[1m>[22m[39m[90m 398 |[39m         expect(document[33m.[39maddEventListener)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 399 |[39m           [32m'touchstart'[39m[33m,[39m
     [90m 400 |[39m           expect[33m.[39many([33mFunction[39m)[33m,[39m
     [90m 401 |[39m           { passive[33m:[39m [36mtrue[39m }[0m

      at Object.<anonymous> (src/utils/enhancedRouting.test.ts:398:43)

  ● enhancedRouting › useEnhancedRouting hook › should provide access to route manager methods

    TypeError: Cannot read properties of undefined (reading 'length')

    [0m [90m 414 |[39m   [36mstatic[39m getNavigationStats() {
     [90m 415 |[39m     [36mreturn[39m {
    [31m[1m>[22m[39m[90m 416 |[39m       totalNavigations[33m:[39m [36mthis[39m[33m.[39mnavigationHistory[33m.[39mlength[33m,[39m
     [90m     |[39m                                                [31m[1m^[22m[39m
     [90m 417 |[39m       currentRoute[33m:[39m [36mthis[39m[33m.[39mcurrentRoute[33m,[39m
     [90m 418 |[39m       preloadedRoutes[33m:[39m [33mArray[39m[33m.[39m[36mfrom[39m([36mthis[39m[33m.[39mpreloadCache)[33m,[39m
     [90m 419 |[39m       registeredRoutes[33m:[39m [33mArray[39m[33m.[39m[36mfrom[39m([36mthis[39m[33m.[39mroutes[33m.[39mkeys())[33m,[39m[0m

      at Object.getNavigationStats (src/utils/enhancedRouting.ts:416:48)
      at Object.<anonymous> (src/utils/enhancedRouting.test.ts:456:36)

  ● enhancedRouting › error handling › should handle performance API unavailability

    expect(received).not.toThrow()

    Error name:    "TypeError"
    Error message: "performance.now is not a function"

        [0m [90m 453 |[39m   [36mconst[39m [33mTrackedComponent[39m[33m:[39m [33mReact[39m[33m.[39m[33mFC[39m[33m<[39m[33mP[39m[33m>[39m [33m=[39m (props) [33m=>[39m {
         [90m 454 |[39m     useEffect(() [33m=>[39m {
        [31m[1m>[22m[39m[90m 455 |[39m       [36mconst[39m startTime [33m=[39m performance[33m.[39mnow()[33m;[39m
         [90m     |[39m                                     [31m[1m^[22m[39m
         [90m 456 |[39m       
         [90m 457 |[39m       [36mreturn[39m () [33m=>[39m {
         [90m 458 |[39m         [36mconst[39m endTime [33m=[39m performance[33m.[39mnow()[33m;[39m[0m

      at src/utils/enhancedRouting.ts:455:37
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at src/utils/enhancedRouting.test.ts:601:15
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/utils/enhancedRouting.test.ts:602:14)
      at Object.<anonymous> (src/utils/enhancedRouting.test.ts:602:14)

FAIL src/utils/truncateText.test.ts (7.795 s)
  ● truncateText › basic functionality › should truncate text when longer than max length

    expect(received).toBe(expected) // Object.is equality

    Expected: 23
    Received: 22

    [0m [90m 18 |[39m       [36mconst[39m result [33m=[39m truncateText(text[33m,[39m [35m20[39m)[33m;[39m
     [90m 19 |[39m       expect(result)[33m.[39mtoBe([32m'This is a very long...'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 20 |[39m       expect(result[33m.[39mlength)[33m.[39mtoBe([35m23[39m)[33m;[39m [90m// 20 + 3 for '...'[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 21 |[39m     })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m     it([32m'should use custom suffix when provided'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/truncateText.test.ts:20:29)

  ● truncateText › edge cases › should handle empty suffix

    expect(received).toBe(expected) // Object.is equality

    Expected: "This is a "
    Received: "This is a"

    [0m [90m 71 |[39m       [36mconst[39m text [33m=[39m [32m'This is a long text that will be truncated'[39m[33m;[39m
     [90m 72 |[39m       [36mconst[39m result [33m=[39m truncateText(text[33m,[39m [35m10[39m[33m,[39m [32m''[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 73 |[39m       expect(result)[33m.[39mtoBe([32m'This is a '[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 74 |[39m       expect(result[33m.[39mlength)[33m.[39mtoBe([35m10[39m)[33m;[39m
     [90m 75 |[39m     })[33m;[39m
     [90m 76 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/utils/truncateText.test.ts:73:22)

  ● truncateText › unicode and special characters › should handle unicode characters correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: "Hello �� World ..."
    Received: "Hello �� World..."

    [0m [90m 80 |[39m       [36mconst[39m text [33m=[39m [32m'Hello �� World �� How are you? ��'[39m[33m;[39m
     [90m 81 |[39m       [36mconst[39m result [33m=[39m truncateText(text[33m,[39m [35m15[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 82 |[39m       expect(result)[33m.[39mtoBe([32m'Hello �� World ...'[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 83 |[39m     })[33m;[39m
     [90m 84 |[39m
     [90m 85 |[39m     it([32m'should handle accented characters'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/truncateText.test.ts:82:22)

  ● truncateText › default parameter behavior › should use default suffix when not provided

    expect(received).toBe(expected) // Object.is equality

    Expected: "This is a ..."
    Received: "This is a..."

    [0m [90m 140 |[39m       [36mconst[39m text [33m=[39m [32m'This is a long text'[39m[33m;[39m
     [90m 141 |[39m       [36mconst[39m result [33m=[39m truncateText(text[33m,[39m [35m10[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 142 |[39m       expect(result)[33m.[39mtoBe([32m'This is a ...'[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 143 |[39m       expect(result[33m.[39mendsWith([32m'...'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 144 |[39m     })[33m;[39m
     [90m 145 |[39m[0m

      at Object.<anonymous> (src/utils/truncateText.test.ts:142:22)

  ● truncateText › default parameter behavior › should handle default suffix with various lengths

    expect(received).toBe(expected) // Object.is equality

    Expected: "This ..."
    Received: "This..."

    [0m [90m 151 |[39m       [36mconst[39m result3 [33m=[39m truncateText(longText[33m,[39m [35m25[39m)[33m;[39m
     [90m 152 |[39m       
    [31m[1m>[22m[39m[90m 153 |[39m       expect(result1)[33m.[39mtoBe([32m'This ...'[39m)[33m;[39m
     [90m     |[39m                       [31m[1m^[22m[39m
     [90m 154 |[39m       expect(result2)[33m.[39mtoBe([32m'This is a very ...'[39m)[33m;[39m
     [90m 155 |[39m       expect(result3)[33m.[39mtoBe([32m'This is a very long text...'[39m)[33m;[39m
     [90m 156 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/utils/truncateText.test.ts:153:23)

  ● truncateText › real-world scenarios › should handle news headline truncation

    expect(received).toBe(expected) // Object.is equality

    Expected: "Breaking News: Major Technology Company Announces Revolut..."
    Received: "Breaking News: Major Technology Company Announces Revolution..."

    [0m [90m 207 |[39m       
     [90m 208 |[39m       expect(result[33m.[39mlength)[33m.[39mtoBe([35m63[39m)[33m;[39m [90m// 60 + 3[39m
    [31m[1m>[22m[39m[90m 209 |[39m       expect(result)[33m.[39mtoBe([32m'Breaking News: Major Technology Company Announces Revolut...'[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 210 |[39m     })[33m;[39m
     [90m 211 |[39m
     [90m 212 |[39m     it([32m'should handle email subject line truncation'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/truncateText.test.ts:209:22)

  ● truncateText › real-world scenarios › should handle email subject line truncation

    expect(received).toBe(expected) // Object.is equality

    Expected: "Urgent: Please review the quarterly budget propos..."
    Received: "Urgent: Please review the quarterly budget proposa..."

    [0m [90m 215 |[39m       
     [90m 216 |[39m       expect(result[33m.[39mlength)[33m.[39mtoBe([35m53[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 217 |[39m       expect(result)[33m.[39mtoBe([32m'Urgent: Please review the quarterly budget propos...'[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 218 |[39m     })[33m;[39m
     [90m 219 |[39m
     [90m 220 |[39m     it([32m'should handle product description truncation'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/truncateText.test.ts:217:22)

  ● truncateText › real-world scenarios › should handle product description truncation

    expect(received).toBe(expected) // Object.is equality

    Expected: "This premium organic cotton t-shirt features a comfortable relaxed fit, sustai... read more"
    Received: "This premium organic cotton t-shirt features a comfortable relaxed fit, sustaina... read more"

    [0m [90m 222 |[39m       [36mconst[39m result [33m=[39m truncateText(description[33m,[39m [35m80[39m[33m,[39m [32m'... read more'[39m)[33m;[39m
     [90m 223 |[39m       
    [31m[1m>[22m[39m[90m 224 |[39m       expect(result)[33m.[39mtoBe([32m'This premium organic cotton t-shirt features a comfortable relaxed fit, sustai... read more'[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 225 |[39m     })[33m;[39m
     [90m 226 |[39m
     [90m 227 |[39m     it([32m'should handle user bio truncation'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/truncateText.test.ts:224:22)

  ● truncateText › consistent behavior › should handle different data types gracefully

    expect(received).not.toThrow()

    Error name:    "TypeError"
    Error message: "text.slice is not a function"

        [0m [90m 19 |[39m   
         [90m 20 |[39m   [90m// Trim the text before adding suffix to avoid trailing spaces[39m
        [31m[1m>[22m[39m[90m 21 |[39m   [36mreturn[39m text[33m.[39mslice([35m0[39m[33m,[39m maxLength)[33m.[39mtrimEnd() [33m+[39m suffix[33m;[39m
         [90m    |[39m               [31m[1m^[22m[39m
         [90m 22 |[39m }[33m;[39m
         [90m 23 |[39m
         [90m 24 |[39m [36mexport[39m [36mdefault[39m truncateText[33m;[39m[0m

      at truncateText (src/utils/truncateText.ts:21:15)
      at src/utils/truncateText.test.ts:262:23
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at src/utils/truncateText.test.ts:263:16
                at Array.forEach (<anonymous>)
      at Object.<anonymous> (src/utils/truncateText.test.ts:260:14)
      at src/utils/truncateText.test.ts:263:16
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (src/utils/truncateText.test.ts:260:14)

FAIL src/utils/bundleOptimization.test.ts (7.922 s)
  ● bundleOptimization › BundleAnalyzer › analyzeBundlePerformance › should perform full analysis in development

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 139 |[39m         [36mconst[39m result [33m=[39m [36mawait[39m [33mBundleAnalyzer[39m[33m.[39manalyzeBundlePerformance()[33m;[39m
     [90m 140 |[39m
    [31m[1m>[22m[39m[90m 141 |[39m         expect(result[33m.[39mloadTime)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 142 |[39m         expect(result[33m.[39mmemoryImpact)[33m.[39mtoBe([35m0[39m)[33m;[39m [90m// No memory change in mock[39m
     [90m 143 |[39m         expect(result[33m.[39mchunkCount)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m 144 |[39m         expect(console[33m.[39mgroup)[33m.[39mtoHaveBeenCalledWith([32m'�� Bundle Analysis Results'[39m)[33m;[39m[0m

      at Object.<anonymous> (src/utils/bundleOptimization.test.ts:141:33)

  ● bundleOptimization › BundleAnalyzer › analyzeBundlePerformance › should handle analysis errors gracefully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "Bundle analysis failed:", Any<Error>

    Number of calls: 0

    [0m [90m 157 |[39m         [36mconst[39m result [33m=[39m [36mawait[39m [33mBundleAnalyzer[39m[33m.[39manalyzeBundlePerformance()[33m;[39m
     [90m 158 |[39m
    [31m[1m>[22m[39m[90m 159 |[39m         expect(console[33m.[39merror)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 160 |[39m           [32m'Bundle analysis failed:'[39m[33m,[39m
     [90m 161 |[39m           expect[33m.[39many([33mError[39m)
     [90m 162 |[39m         )[33m;[39m[0m

      at Object.<anonymous> (src/utils/bundleOptimization.test.ts:159:31)

  ● bundleOptimization › MobileMemoryOptimizer › memory cleanup › should perform cleanup when memory threshold exceeded

    TypeError: Cannot read properties of undefined (reading 'getCurrentMemoryUsage')

    [0m [90m 437 |[39m   [90m// Check memory usage and cleanup if necessary[39m
     [90m 438 |[39m   [36mprivate[39m [36mstatic[39m checkMemoryUsage()[33m:[39m [36mvoid[39m {
    [31m[1m>[22m[39m[90m 439 |[39m     [36mconst[39m memoryUsage [33m=[39m [36mthis[39m[33m.[39mgetCurrentMemoryUsage()[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 440 |[39m     
     [90m 441 |[39m     [36mif[39m (memoryUsage [33m>[39m [36mthis[39m[33m.[39mmemoryThreshold) {
     [90m 442 |[39m       [36mthis[39m[33m.[39mperformCleanup()[33m;[39m[0m

      at checkMemoryUsage (src/utils/bundleOptimization.ts:439:30)
      at Object.<anonymous> (src/utils/bundleOptimization.test.ts:580:9)

  ● bundleOptimization › MobileMemoryOptimizer › memory cleanup › should not cleanup when memory usage is normal

    TypeError: Cannot read properties of undefined (reading 'getCurrentMemoryUsage')

    [0m [90m 437 |[39m   [90m// Check memory usage and cleanup if necessary[39m
     [90m 438 |[39m   [36mprivate[39m [36mstatic[39m checkMemoryUsage()[33m:[39m [36mvoid[39m {
    [31m[1m>[22m[39m[90m 439 |[39m     [36mconst[39m memoryUsage [33m=[39m [36mthis[39m[33m.[39mgetCurrentMemoryUsage()[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 440 |[39m     
     [90m 441 |[39m     [36mif[39m (memoryUsage [33m>[39m [36mthis[39m[33m.[39mmemoryThreshold) {
     [90m 442 |[39m       [36mthis[39m[33m.[39mperformCleanup()[33m;[39m[0m

      at checkMemoryUsage (src/utils/bundleOptimization.ts:439:30)
      at Object.<anonymous> (src/utils/bundleOptimization.test.ts:601:9)

FAIL src/utils/crisisDetection.test.ts (7.995 s)
  ● crisisDetection › getCrisisResources › case sensitivity › should handle lowercase country codes

    expect(received).toBe(expected) // Object.is equality

    Expected: "International Crisis Lines"
    Received: "988 Suicide & Crisis Lifeline"

    [0m [90m 344 |[39m       it([32m'should handle lowercase country codes'[39m[33m,[39m () [33m=>[39m {
     [90m 345 |[39m         [36mconst[39m resources [33m=[39m getCrisisResources([32m'us'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 346 |[39m         expect(resources[33m.[39mname)[33m.[39mtoBe([32m'International Crisis Lines'[39m)[33m;[39m [90m// Should fallback for lowercase[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 347 |[39m       })[33m;[39m
     [90m 348 |[39m
     [90m 349 |[39m       it([32m'should handle mixed case country codes'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/crisisDetection.test.ts:346:32)

  ● crisisDetection › getCrisisResources › case sensitivity › should handle mixed case country codes

    expect(received).toBe(expected) // Object.is equality

    Expected: "International Crisis Lines"
    Received: "988 Suicide & Crisis Lifeline"

    [0m [90m 349 |[39m       it([32m'should handle mixed case country codes'[39m[33m,[39m () [33m=>[39m {
     [90m 350 |[39m         [36mconst[39m resources [33m=[39m getCrisisResources([32m'Us'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 351 |[39m         expect(resources[33m.[39mname)[33m.[39mtoBe([32m'International Crisis Lines'[39m)[33m;[39m [90m// Should fallback for mixed case[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 352 |[39m       })[33m;[39m
     [90m 353 |[39m     })[33m;[39m
     [90m 354 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/utils/crisisDetection.test.ts:351:32)

FAIL src/utils/sanitizeHtml.test.ts (8.085 s)
  ● sanitizeHtml › safeMarkdownToHtml › should handle nested markdown correctly

    expect(received).toContain(expected) // indexOf

    Expected substring: "<strong><em>bold and italic</em></strong>"
    Received string:    "This is <strong><em>bold and italic</strong></em> text"

    [0m [90m 213 |[39m       [36mconst[39m result [33m=[39m safeMarkdownToHtml(markdown)[33m;[39m
     [90m 214 |[39m       [90m// Should handle the outer ** first, then inner *[39m
    [31m[1m>[22m[39m[90m 215 |[39m       expect(result)[33m.[39mtoContain([32m'<strong><em>bold and italic</em></strong>'[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 216 |[39m     })[33m;[39m
     [90m 217 |[39m
     [90m 218 |[39m     it([32m'should handle edge cases with empty markdown patterns'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/sanitizeHtml.test.ts:215:22)

  ● sanitizeHtml › safeMarkdownToHtml › should handle edge cases with empty markdown patterns

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "<em></em>"
    Received string:        "Empty <em></em> and * patterns []() too"

    [0m [90m 223 |[39m       [90m// Should not create empty tags[39m
     [90m 224 |[39m       expect(result)[33m.[39mnot[33m.[39mtoContain([32m'<strong></strong>'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 225 |[39m       expect(result)[33m.[39mnot[33m.[39mtoContain([32m'<em></em>'[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 226 |[39m       expect(result)[33m.[39mnot[33m.[39mtoContain([32m'<a href="">'[39m)[33m;[39m
     [90m 227 |[39m     })[33m;[39m
     [90m 228 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/utils/sanitizeHtml.test.ts:225:26)

  ● sanitizeHtml › security considerations › should prevent XSS through various vectors

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "onerror="
    Received string:        "&lt;img src=x onerror=alert(1)&gt;"

    [0m [90m 379 |[39m         expect(result)[33m.[39mnot[33m.[39mtoContain([32m'<script>'[39m)[33m;[39m
     [90m 380 |[39m         expect(result)[33m.[39mnot[33m.[39mtoContain([32m'javascript:'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 381 |[39m         expect(result)[33m.[39mnot[33m.[39mtoContain([32m'onerror='[39m)[33m;[39m
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 382 |[39m         expect(result)[33m.[39mnot[33m.[39mtoContain([32m'onload='[39m)[33m;[39m
     [90m 383 |[39m       })[33m;[39m
     [90m 384 |[39m     })[33m;[39m[0m

      at src/utils/sanitizeHtml.test.ts:381:28
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (src/utils/sanitizeHtml.test.ts:375:19)

FAIL src/hooks/useSwipeGesture.test.ts (8.48 s)
  ● usePullToRefresh Hook › should start pulling when swiping down from top

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 470 |[39m     })[33m;[39m
     [90m 471 |[39m
    [31m[1m>[22m[39m[90m 472 |[39m     expect(result[33m.[39mcurrent[33m.[39misPulling)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 473 |[39m     expect(result[33m.[39mcurrent[33m.[39mpullDistance)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m 474 |[39m     expect(result[33m.[39mcurrent[33m.[39mpullProgress)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m 475 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useSwipeGesture.test.ts:472:38)

  ● usePullToRefresh Hook › should trigger refresh when threshold is exceeded

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 529 |[39m     })[33m;[39m
     [90m 530 |[39m
    [31m[1m>[22m[39m[90m 531 |[39m     expect(mockOnRefresh)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 532 |[39m   })[33m;[39m
     [90m 533 |[39m
     [90m 534 |[39m   it([32m'should not trigger refresh when below threshold'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/hooks/useSwipeGesture.test.ts:531:27)

  ● usePullToRefresh Hook › should handle refresh errors gracefully

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 598 |[39m     })[33m;[39m
     [90m 599 |[39m
    [31m[1m>[22m[39m[90m 600 |[39m     expect(mockOnRefresh)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 601 |[39m     expect(result[33m.[39mcurrent[33m.[39misRefreshing)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 602 |[39m     expect(result[33m.[39mcurrent[33m.[39misPulling)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 603 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useSwipeGesture.test.ts:600:27)

  ● usePullToRefresh Hook › should apply resistance to pull distance

    expect(received).toBe(expected) // Object.is equality

    Expected: 50
    Received: 0

    [0m [90m 652 |[39m
     [90m 653 |[39m     [90m// With 0.5 resistance, 100px pull should result in 50px distance[39m
    [31m[1m>[22m[39m[90m 654 |[39m     expect(result[33m.[39mcurrent[33m.[39mpullDistance)[33m.[39mtoBe([35m50[39m)[33m;[39m
     [90m     |[39m                                         [31m[1m^[22m[39m
     [90m 655 |[39m   })[33m;[39m
     [90m 656 |[39m })[33m;[39m
     [90m 657 |[39m[0m

      at Object.<anonymous> (src/hooks/useSwipeGesture.test.ts:654:41)

FAIL src/services/__tests__/culturalFamilySupportService.test.ts
  ● CulturalFamilySupportService › Initialization › should load family support data on initialization

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[Family Support] Loading family support data..."

    Number of calls: 0

    [0m [90m 61 |[39m
     [90m 62 |[39m     test([32m'should load family support data on initialization'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 63 |[39m       expect(console[33m.[39mlog)[33m.[39mtoHaveBeenCalledWith([32m'[Family Support] Loading family support data...'[39m)[33m;[39m
     [90m    |[39m                           [31m[1m^[22m[39m
     [90m 64 |[39m     })[33m;[39m
     [90m 65 |[39m   })[33m;[39m
     [90m 66 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/culturalFamilySupportService.test.ts:63:27)

  ● CulturalFamilySupportService › Family Support Analytics › should calculate family support analytics

    expect(received).toBe(expected) // Object.is equality

    Expected: 24
    Received: 0

    [0m [90m 1009 |[39m       expect(analytics[33m.[39msupportEngagement)[33m.[39mtoBe([35m0.5[39m)[33m;[39m [90m// 1 consenting out of 2 total[39m
     [90m 1010 |[39m       expect(analytics[33m.[39mfamilyResponseRate)[33m.[39mtoBe([35m0[39m)[33m;[39m [90m// No responses yet[39m
    [31m[1m>[22m[39m[90m 1011 |[39m       expect(analytics[33m.[39mcrisisResolutionTime)[33m.[39mtoBe([35m24[39m)[33m;[39m [90m// Default placeholder[39m
     [90m      |[39m                                              [31m[1m^[22m[39m
     [90m 1012 |[39m       expect(analytics[33m.[39mculturalProtocolsUsed)[33m.[39mtoEqual([])[33m;[39m [90m// No notifications sent yet[39m
     [90m 1013 |[39m     })[33m;[39m
     [90m 1014 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/culturalFamilySupportService.test.ts:1011:46)

  ● CulturalFamilySupportService › Data Persistence › should log data loading on initialization

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[Family Support] Loading family support data..."

    Number of calls: 0

    [0m [90m 1124 |[39m   describe([32m'Data Persistence'[39m[33m,[39m () [33m=>[39m {
     [90m 1125 |[39m     test([32m'should log data loading on initialization'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 1126 |[39m       expect(console[33m.[39mlog)[33m.[39mtoHaveBeenCalledWith([32m'[Family Support] Loading family support data...'[39m)[33m;[39m
     [90m      |[39m                           [31m[1m^[22m[39m
     [90m 1127 |[39m     })[33m;[39m
     [90m 1128 |[39m
     [90m 1129 |[39m     test([32m'should log data saving when creating family support'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/culturalFamilySupportService.test.ts:1126:27)

FAIL src/utils/formatTimeAgo.test.ts (8.123 s)
  ● formatTimeAgo › formatChatTimestamp › should respect browser locale settings

    TypeError: Cannot redefine property: language
        at Function.defineProperty (<anonymous>)

    [0m [90m 216 |[39m     it([32m'should respect browser locale settings'[39m[33m,[39m () [33m=>[39m {
     [90m 217 |[39m       [90m// Change navigator.language[39m
    [31m[1m>[22m[39m[90m 218 |[39m       [33mObject[39m[33m.[39mdefineProperty(navigator[33m,[39m [32m'language'[39m[33m,[39m {
     [90m     |[39m              [31m[1m^[22m[39m
     [90m 219 |[39m         value[33m:[39m [32m'fr-FR'[39m[33m,[39m
     [90m 220 |[39m         configurable[33m:[39m [36mtrue[39m
     [90m 221 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (src/utils/formatTimeAgo.test.ts:218:14)

  ● formatTimeAgo › formatChatTimestamp › should handle timezone differences correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: "12:00 PM"
    Received: "Yesterday at 12:00 PM"

    [0m [90m 243 |[39m       
     [90m 244 |[39m       [90m// Both should be treated as "today" since they're the same date[39m
    [31m[1m>[22m[39m[90m 245 |[39m       expect(resultUTC)[33m.[39mtoBe([32m'12:00 PM'[39m)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 246 |[39m       expect(resultLocal)[33m.[39mtoBe([32m'12:00 PM'[39m)[33m;[39m
     [90m 247 |[39m     })[33m;[39m
     [90m 248 |[39m[0m

      at Object.<anonymous> (src/utils/formatTimeAgo.test.ts:245:25)

  ● formatTimeAgo › localization compatibility › should work with different locale settings

    TypeError: Cannot redefine property: language
        at Function.defineProperty (<anonymous>)

    [0m [90m 322 |[39m       
     [90m 323 |[39m       locales[33m.[39mforEach(locale [33m=>[39m {
    [31m[1m>[22m[39m[90m 324 |[39m         [33mObject[39m[33m.[39mdefineProperty(navigator[33m,[39m [32m'language'[39m[33m,[39m {
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 325 |[39m           value[33m:[39m locale[33m,[39m
     [90m 326 |[39m           configurable[33m:[39m [36mtrue[39m
     [90m 327 |[39m         })[33m;[39m[0m

      at src/utils/formatTimeAgo.test.ts:324:16
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (src/utils/formatTimeAgo.test.ts:323:15)

FAIL src/utils/logger.test.ts (8.3 s)
  ● Logger › development environment › should log debug messages in development

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[TestComponent] Debug message", {"key": "value"}

    Number of calls: 0

    [0m [90m 63 |[39m       logger[33m.[39mdebug([32m'Debug message'[39m[33m,[39m { key[33m:[39m [32m'value'[39m }[33m,[39m [32m'TestComponent'[39m)[33m;[39m
     [90m 64 |[39m
    [31m[1m>[22m[39m[90m 65 |[39m       expect(console[33m.[39mlog)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                           [31m[1m^[22m[39m
     [90m 66 |[39m         [32m'[TestComponent] Debug message'[39m[33m,[39m
     [90m 67 |[39m         { key[33m:[39m [32m'value'[39m }
     [90m 68 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:65:27)

  ● Logger › development environment › should log info messages in development

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: " Info message", {"data": 123}

    Number of calls: 0

    [0m [90m 72 |[39m       logger[33m.[39minfo([32m'Info message'[39m[33m,[39m { data[33m:[39m [35m123[39m })[33m;[39m
     [90m 73 |[39m
    [31m[1m>[22m[39m[90m 74 |[39m       expect(console[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                            [31m[1m^[22m[39m
     [90m 75 |[39m         [32m' Info message'[39m[33m,[39m
     [90m 76 |[39m         { data[33m:[39m [35m123[39m }
     [90m 77 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:74:28)

  ● Logger › development environment › should log warn messages in development

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[Component] Warning message", ""

    Number of calls: 0

    [0m [90m 81 |[39m       logger[33m.[39mwarn([32m'Warning message'[39m[33m,[39m [36mnull[39m[33m,[39m [32m'Component'[39m)[33m;[39m
     [90m 82 |[39m
    [31m[1m>[22m[39m[90m 83 |[39m       expect(console[33m.[39mwarn)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                            [31m[1m^[22m[39m
     [90m 84 |[39m         [32m'[Component] Warning message'[39m[33m,[39m
     [90m 85 |[39m         [32m''[39m
     [90m 86 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:83:28)

  ● Logger › development environment › should log error messages in development

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[ErrorComponent] Error occurred", [Error: Test error]

    Number of calls: 0

    [0m [90m 91 |[39m       logger[33m.[39merror([32m'Error occurred'[39m[33m,[39m error[33m,[39m [32m'ErrorComponent'[39m)[33m;[39m
     [90m 92 |[39m
    [31m[1m>[22m[39m[90m 93 |[39m       expect(console[33m.[39merror)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 94 |[39m         [32m'[ErrorComponent] Error occurred'[39m[33m,[39m
     [90m 95 |[39m         error
     [90m 96 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:93:29)

  ● Logger › development environment › should format messages correctly without source

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: " Message without source", ""

    Number of calls: 0

    [0m [90m 100 |[39m       logger[33m.[39mdebug([32m'Message without source'[39m)[33m;[39m
     [90m 101 |[39m
    [31m[1m>[22m[39m[90m 102 |[39m       expect(console[33m.[39mlog)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 103 |[39m         [32m' Message without source'[39m[33m,[39m
     [90m 104 |[39m         [32m''[39m
     [90m 105 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:102:27)

  ● Logger › development environment › should handle empty data parameter

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[Test] Message with no data", ""

    Number of calls: 0

    [0m [90m 109 |[39m       logger[33m.[39minfo([32m'Message with no data'[39m[33m,[39m undefined[33m,[39m [32m'Test'[39m)[33m;[39m
     [90m 110 |[39m
    [31m[1m>[22m[39m[90m 111 |[39m       expect(console[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 112 |[39m         [32m'[Test] Message with no data'[39m[33m,[39m
     [90m 113 |[39m         [32m''[39m
     [90m 114 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:111:28)

  ● Logger › production environment › should log warning messages in production

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 136 |[39m       logger[33m.[39mwarn([32m'Warning message'[39m)[33m;[39m
     [90m 137 |[39m
    [31m[1m>[22m[39m[90m 138 |[39m       expect(console[33m.[39mwarn)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 139 |[39m     })[33m;[39m
     [90m 140 |[39m
     [90m 141 |[39m     it([32m'should log error messages in production'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/logger.test.ts:138:28)

  ● Logger › production environment › should log error messages in production

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 142 |[39m       logger[33m.[39merror([32m'Error message'[39m)[33m;[39m
     [90m 143 |[39m
    [31m[1m>[22m[39m[90m 144 |[39m       expect(console[33m.[39merror)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 145 |[39m     })[33m;[39m
     [90m 146 |[39m
     [90m 147 |[39m     it([32m'should send errors to Sentry in production'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/logger.test.ts:144:29)

  ● Logger › production environment › should send errors to Sentry in production

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: [Error: Production error], {"level": "error", "tags": {"source": "Component"}}

    Number of calls: 0

    [0m [90m 149 |[39m       logger[33m.[39merror([32m'Error occurred'[39m[33m,[39m error[33m,[39m [32m'Component'[39m)[33m;[39m
     [90m 150 |[39m
    [31m[1m>[22m[39m[90m 151 |[39m       expect(mockSentry[33m.[39mcaptureException)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 152 |[39m         error[33m,[39m
     [90m 153 |[39m         {
     [90m 154 |[39m           tags[33m:[39m { source[33m:[39m [32m'Component'[39m }[33m,[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:151:43)

  ● Logger › production environment › should send error message to Sentry when no error object provided

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: Any<Error>, {"level": "error", "tags": {"source": "Component"}}

    Number of calls: 0

    [0m [90m 161 |[39m       logger[33m.[39merror([32m'Error message'[39m[33m,[39m [36mnull[39m[33m,[39m [32m'Component'[39m)[33m;[39m
     [90m 162 |[39m
    [31m[1m>[22m[39m[90m 163 |[39m       expect(mockSentry[33m.[39mcaptureException)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 164 |[39m         expect[33m.[39many([33mError[39m)[33m,[39m
     [90m 165 |[39m         {
     [90m 166 |[39m           tags[33m:[39m { source[33m:[39m [32m'Component'[39m }[33m,[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:163:43)

  ● Logger › log buffer management › should add entries to log buffer

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 0
    Received array:  []

    [0m [90m 190 |[39m       [36mconst[39m logs [33m=[39m logger[33m.[39mgetRecentLogs()[33m;[39m
     [90m 191 |[39m       
    [31m[1m>[22m[39m[90m 192 |[39m       expect(logs)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 193 |[39m       expect(logs[[35m0[39m])[33m.[39mtoMatchObject({
     [90m 194 |[39m         level[33m:[39m [32m'debug'[39m[33m,[39m
     [90m 195 |[39m         message[33m:[39m [32m'Debug message'[39m[33m,[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:192:20)

  ● Logger › log buffer management › should limit buffer size to maxBufferSize

    expect(received).toHaveLength(expected)

    Expected length: 100
    Received length: 0
    Received array:  []

    [0m [90m 208 |[39m       [36mconst[39m logs [33m=[39m logger[33m.[39mgetRecentLogs()[33m;[39m
     [90m 209 |[39m       
    [31m[1m>[22m[39m[90m 210 |[39m       expect(logs)[33m.[39mtoHaveLength([35m100[39m)[33m;[39m
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 211 |[39m       [90m// Should keep most recent entries[39m
     [90m 212 |[39m       expect(logs[[35m99[39m][33m.[39mmessage)[33m.[39mtoBe([32m'Message 149'[39m)[33m;[39m
     [90m 213 |[39m       expect(logs[[35m0[39m][33m.[39mmessage)[33m.[39mtoBe([32m'Message 50'[39m)[33m;[39m [90m// Oldest kept entry[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:210:20)

  ● Logger › log buffer management › should clear log buffer

    expect(received).toHaveLength(expected)

    Expected length: 3
    Received length: 0
    Received array:  []

    [0m [90m 219 |[39m       logger[33m.[39mwarn([32m'Message 3'[39m)[33m;[39m
     [90m 220 |[39m       
    [31m[1m>[22m[39m[90m 221 |[39m       expect(logger[33m.[39mgetRecentLogs())[33m.[39mtoHaveLength([35m3[39m)[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 222 |[39m       
     [90m 223 |[39m       logger[33m.[39mclearLogs()[33m;[39m
     [90m 224 |[39m       [0m

      at Object.<anonymous> (src/utils/logger.test.ts:221:38)

  ● Logger › log buffer management › should store all log levels in buffer

    expect(received).toHaveLength(expected)

    Expected length: 4
    Received length: 0
    Received array:  []

    [0m [90m 244 |[39m       [36mconst[39m logs [33m=[39m logger[33m.[39mgetRecentLogs()[33m;[39m
     [90m 245 |[39m       
    [31m[1m>[22m[39m[90m 246 |[39m       expect(logs)[33m.[39mtoHaveLength([35m4[39m)[33m;[39m
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 247 |[39m       expect(logs[33m.[39mmap(log [33m=>[39m log[33m.[39mlevel))[33m.[39mtoEqual([[32m'debug'[39m[33m,[39m [32m'info'[39m[33m,[39m [32m'warn'[39m[33m,[39m [32m'error'[39m])[33m;[39m
     [90m 248 |[39m     })[33m;[39m
     [90m 249 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:246:20)

  ● Logger › helper functions › should provide log helper function

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[Helper] Test message", {"data": "test"}

    Number of calls: 0

    [0m [90m 257 |[39m       log([32m'Test message'[39m[33m,[39m { data[33m:[39m [32m'test'[39m }[33m,[39m [32m'Helper'[39m)[33m;[39m
     [90m 258 |[39m
    [31m[1m>[22m[39m[90m 259 |[39m       expect(console[33m.[39mlog)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 260 |[39m         [32m'[Helper] Test message'[39m[33m,[39m
     [90m 261 |[39m         { data[33m:[39m [32m'test'[39m }
     [90m 262 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:259:27)

  ● Logger › helper functions › should provide logInfo helper function

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: " Info message", {"info": true}

    Number of calls: 0

    [0m [90m 266 |[39m       logInfo([32m'Info message'[39m[33m,[39m { info[33m:[39m [36mtrue[39m })[33m;[39m
     [90m 267 |[39m
    [31m[1m>[22m[39m[90m 268 |[39m       expect(console[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 269 |[39m         [32m' Info message'[39m[33m,[39m
     [90m 270 |[39m         { info[33m:[39m [36mtrue[39m }
     [90m 271 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:268:28)

  ● Logger › helper functions › should provide logWarn helper function

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[WarnComponent] Warning message", {"warn": true}

    Number of calls: 0

    [0m [90m 275 |[39m       logWarn([32m'Warning message'[39m[33m,[39m { warn[33m:[39m [36mtrue[39m }[33m,[39m [32m'WarnComponent'[39m)[33m;[39m
     [90m 276 |[39m
    [31m[1m>[22m[39m[90m 277 |[39m       expect(console[33m.[39mwarn)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 278 |[39m         [32m'[WarnComponent] Warning message'[39m[33m,[39m
     [90m 279 |[39m         { warn[33m:[39m [36mtrue[39m }
     [90m 280 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:277:28)

  ● Logger › helper functions › should provide logError helper function

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[ErrorHelper] Error message", [Error: Helper error]

    Number of calls: 0

    [0m [90m 285 |[39m       logError([32m'Error message'[39m[33m,[39m error[33m,[39m [32m'ErrorHelper'[39m)[33m;[39m
     [90m 286 |[39m
    [31m[1m>[22m[39m[90m 287 |[39m       expect(console[33m.[39merror)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 288 |[39m         [32m'[ErrorHelper] Error message'[39m[33m,[39m
     [90m 289 |[39m         error
     [90m 290 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:287:29)

  ● Logger › timestamp handling › should add ISO timestamp to log entries

    TypeError: Cannot read properties of undefined (reading 'timestamp')

    [0m [90m 300 |[39m       [36mconst[39m logs [33m=[39m logger[33m.[39mgetRecentLogs()[33m;[39m
     [90m 301 |[39m       
    [31m[1m>[22m[39m[90m 302 |[39m       expect(logs[[35m0[39m][33m.[39mtimestamp)[33m.[39mtoBeDefined()[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 303 |[39m       expect(logs[[35m0[39m][33m.[39mtimestamp)[33m.[39mtoMatch([35m/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z$/[39m)[33m;[39m
     [90m 304 |[39m       expect(logs[[35m0[39m][33m.[39mtimestamp [33m>=[39m beforeTime)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 305 |[39m       expect(logs[[35m0[39m][33m.[39mtimestamp [33m<=[39m afterTime)[33m.[39mtoBe([36mtrue[39m)[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:302:22)

  ● Logger › data serialization › should handle various data types

    expect(received).toHaveLength(expected)

    Expected length: 7
    Received length: 0
    Received array:  []

    [0m [90m 329 |[39m       [36mconst[39m logs [33m=[39m logger[33m.[39mgetRecentLogs()[33m;[39m
     [90m 330 |[39m       
    [31m[1m>[22m[39m[90m 331 |[39m       expect(logs)[33m.[39mtoHaveLength(testData[33m.[39mlength)[33m;[39m
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 332 |[39m       logs[33m.[39mforEach((log[33m,[39m index) [33m=>[39m {
     [90m 333 |[39m         expect(log[33m.[39mdata)[33m.[39mtoEqual(testData[index])[33m;[39m
     [90m 334 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:331:20)

  ● Logger › error handling edge cases › should handle special characters in messages

    TypeError: Cannot read properties of undefined (reading 'message')

    [0m [90m 406 |[39m       
     [90m 407 |[39m       [36mconst[39m logs [33m=[39m logger[33m.[39mgetRecentLogs()[33m;[39m
    [31m[1m>[22m[39m[90m 408 |[39m       expect(logs[[35m0[39m][33m.[39mmessage)[33m.[39mtoBe(specialMessage)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 409 |[39m     })[33m;[39m
     [90m 410 |[39m
     [90m 411 |[39m     it([32m'should handle console method unavailability'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/logger.test.ts:408:22)

  ● Logger › integration scenarios › should work in typical component logging scenario

    expect(received).toHaveLength(expected)

    Expected length: 4
    Received length: 0
    Received array:  []

    [0m [90m 436 |[39m       [36mconst[39m logs [33m=[39m logger[33m.[39mgetRecentLogs()[33m;[39m
     [90m 437 |[39m       
    [31m[1m>[22m[39m[90m 438 |[39m       expect(logs)[33m.[39mtoHaveLength([35m4[39m)[33m;[39m
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 439 |[39m       expect(logs[33m.[39mevery(log [33m=>[39m log[33m.[39msource [33m===[39m componentName))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 440 |[39m       expect(console[33m.[39minfo)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m 441 |[39m       expect(console[33m.[39mlog)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:438:20)

  ● Logger › integration scenarios › should work in production error tracking scenario

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: [Error: Payment processing failed], {"level": "error", "tags": {"source": "PaymentForm"}}

    Number of calls: 0

    [0m [90m 454 |[39m       logger[33m.[39mwarn([32m'Retrying payment'[39m[33m,[39m context[33m,[39m component)[33m;[39m
     [90m 455 |[39m       
    [31m[1m>[22m[39m[90m 456 |[39m       expect(mockSentry[33m.[39mcaptureException)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 457 |[39m         error[33m,[39m
     [90m 458 |[39m         {
     [90m 459 |[39m           tags[33m:[39m { source[33m:[39m component }[33m,[39m[0m

      at Object.<anonymous> (src/utils/logger.test.ts:456:43)

  ● Logger › configuration and environment detection › should detect development environment correctly

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 473 |[39m       
     [90m 474 |[39m       logger[33m.[39mdebug([32m'Dev test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 475 |[39m       expect(console[33m.[39mlog)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 476 |[39m     })[33m;[39m
     [90m 477 |[39m
     [90m 478 |[39m     it([32m'should detect production environment correctly'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/logger.test.ts:475:27)


  ● Test suite failed to run

    The error below may be caused by using the wrong test environment, see https://jestjs.io/docs/configuration#testenvironment-string.
    Consider using the "jsdom" test environment.

    ReferenceError: window is not defined

    [0m [90m 253 |[39m [36mexport[39m [36mconst[39m cleanupPerformanceMocks [33m=[39m () [33m=>[39m {
     [90m 254 |[39m   [90m// Restore original values if needed[39m
    [31m[1m>[22m[39m[90m 255 |[39m   [36mif[39m ([32m'performance'[39m [36min[39m window) {
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 256 |[39m     [36mdelete[39m (window [36mas[39m any)[33m.[39mperformance[33m;[39m
     [90m 257 |[39m   }
     [90m 258 |[39m   [0m

      at cleanupPerformanceMocks (src/test-utils/performanceMocks.ts:255:24)
      at Object.<anonymous> (src/setupTests.ts:1207:26)

FAIL src/utils/imageOptimization.test.ts (8.324 s)
  ● imageOptimization › ImageOptimizer Class › Connection Detection › should update connection type on change

    expect(received).toBe(expected) // Object.is equality

    Expected: "fast"
    Received: "slow"

    [0m [90m 224 |[39m         
     [90m 225 |[39m         [90m// Verify connection type was updated[39m
    [31m[1m>[22m[39m[90m 226 |[39m         expect((optimizer [36mas[39m any)[33m.[39mconnectionType)[33m.[39mtoBe([32m'fast'[39m)[33m;[39m
     [90m     |[39m                                                   [31m[1m^[22m[39m
     [90m 227 |[39m       })[33m;[39m
     [90m 228 |[39m     })[33m;[39m
     [90m 229 |[39m[0m

      at Object.<anonymous> (src/utils/imageOptimization.test.ts:226:51)

  ● imageOptimization › ImageOptimizer Class › generateOptimizedImages › should generate unique IDs for different images

    expect(received).not.toBe(expected) // Object.is equality

    Expected: not "aHR0cHM6Ly9leGFt"

    [0m [90m 309 |[39m         })[33m;[39m
     [90m 310 |[39m
    [31m[1m>[22m[39m[90m 311 |[39m         expect(result1[33m.[39mid)[33m.[39mnot[33m.[39mtoBe(result2[33m.[39mid)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 312 |[39m       })[33m;[39m
     [90m 313 |[39m     })[33m;[39m
     [90m 314 |[39m[0m

      at Object.<anonymous> (src/utils/imageOptimization.test.ts:311:32)

  ● imageOptimization › ImageOptimizer Class › preloadCriticalImages › should preload high priority images

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 2
    Received number of calls: 3

    [0m [90m 405 |[39m         optimizer[33m.[39mpreloadCriticalImages(images)[33m;[39m
     [90m 406 |[39m
    [31m[1m>[22m[39m[90m 407 |[39m         expect(mockAppendChild)[33m.[39mtoHaveBeenCalledTimes([35m2[39m)[33m;[39m [90m// Only high priority (>=8) and eager loading[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 408 |[39m       })[33m;[39m
     [90m 409 |[39m
     [90m 410 |[39m       test([32m'should limit preloads to first 3 critical images'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/imageOptimization.test.ts:407:33)

  ● imageOptimization › ImageOptimizer Class › setupLazyLoading › should fallback without IntersectionObserver

    TypeError: Cannot set properties of undefined (setting 'imageId')

    [0m [90m 447 |[39m         
     [90m 448 |[39m         [36mconst[39m mockImg [33m=[39m document[33m.[39mcreateElement([32m'img'[39m) [36mas[39m [33mHTMLImageElement[39m[33m;[39m
    [31m[1m>[22m[39m[90m 449 |[39m         mockImg[33m.[39mdataset[33m.[39mimageId [33m=[39m [32m'test-id'[39m[33m;[39m [90m// Add imageId to prevent error[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 450 |[39m         [36mconst[39m loadOptimizedImageSpy [33m=[39m jest[33m.[39mspyOn(
     [90m 451 |[39m           optimizer[33m,[39m
     [90m 452 |[39m           [32m'loadOptimizedImage'[39m [36mas[39m any[0m

      at Object.<anonymous> (src/utils/imageOptimization.test.ts:449:32)

FAIL src/stores/tetherStore.test.ts
  ● tetherStore › declineTether action › should handle API errors gracefully

    expect(received).toHaveLength(expected)

    Expected length: 0
    Received length: 1
    Received array:  [{"from": "requester-1", "fromName": "Requester", "id": "error-decline", "message": "Please help", "timestamp": 2025-08-17T19:58:42.103Z}]

    [0m [90m 442 |[39m       [90m// Should still remove from pending requests on error[39m
     [90m 443 |[39m       [36mconst[39m state [33m=[39m useTetherStore[33m.[39mgetState()[33m;[39m
    [31m[1m>[22m[39m[90m 444 |[39m       expect(state[33m.[39mpendingRequests)[33m.[39mtoHaveLength([35m0[39m)[33m;[39m
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 445 |[39m     })[33m;[39m
     [90m 446 |[39m   })[33m;[39m
     [90m 447 |[39m[0m

      at Object.<anonymous> (src/stores/tetherStore.test.ts:444:37)

  ● tetherStore › edge cases and error handling › should handle malformed WebSocket messages

    SyntaxError: Unexpected token 'i', "invalid-json" is not valid JSON
        at JSON.parse (<anonymous>)

    [0m [90m 133 |[39m         
     [90m 134 |[39m         ws[33m.[39monmessage [33m=[39m (event) [33m=>[39m {
    [31m[1m>[22m[39m[90m 135 |[39m           [36mconst[39m message [33m=[39m [33mJSON[39m[33m.[39mparse(event[33m.[39mdata)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 136 |[39m           [36mif[39m (message[33m.[39mtype [33m===[39m [32m'strength_update'[39m) {
     [90m 137 |[39m             [36mget[39m()[33m.[39mupdateConnectionStrength(message[33m.[39mstrength)[33m;[39m
     [90m 138 |[39m           } [36melse[39m [36mif[39m (message[33m.[39mtype [33m===[39m [32m'haptic'[39m) {[0m

      at Object.ws.onmessage (src/stores/tetherStore.ts:135:32)
      at src/stores/tetherStore.test.ts:1113:34
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at Object.<anonymous> (src/stores/tetherStore.test.ts:1112:10)

  ● tetherStore › edge cases and error handling › should handle extreme connection strength values

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 5e-324

    [0m [90m 1135 |[39m
     [90m 1136 |[39m       state [33m=[39m useTetherStore[33m.[39mgetState()[33m;[39m
    [31m[1m>[22m[39m[90m 1137 |[39m       expect(state[33m.[39mactiveTether[33m?[39m[33m.[39mconnectionStrength)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m      |[39m                                                      [31m[1m^[22m[39m
     [90m 1138 |[39m     })[33m;[39m
     [90m 1139 |[39m
     [90m 1140 |[39m     test([32m'should handle missing session token gracefully'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/stores/tetherStore.test.ts:1137:54)

FAIL src/services/__tests__/astralTetherService.test.ts
  ● Test suite failed to run

    ReferenceError: Cannot access 'mockNotificationService' before initialization

    [0m [90m 33 |[39m
     [90m 34 |[39m jest[33m.[39mmock([32m'../notificationService'[39m[33m,[39m () [33m=>[39m ({
    [31m[1m>[22m[39m[90m 35 |[39m   notificationService[33m:[39m mockNotificationService[33m,[39m
     [90m    |[39m                        [31m[1m^[22m[39m
     [90m 36 |[39m }))[33m;[39m
     [90m 37 |[39m
     [90m 38 |[39m jest[33m.[39mmock([32m'../secureStorageService'[39m[33m,[39m () [33m=>[39m ({[0m

      at src/services/__tests__/astralTetherService.test.ts:35:24
      at Object.<anonymous> (src/services/astralTetherService.ts:10:1)
      at Object.<anonymous> (src/services/__tests__/astralTetherService.test.ts:5:1)

FAIL src/utils/chartUtils.test.ts (8.195 s)
  ● chartUtils › groupCheckInsByDay › should filter out check-ins older than the specified days

    expect(received).toBe(expected) // Object.is equality

    Expected: 7
    Received: 0

    [0m [90m 117 |[39m       })[33m;[39m
     [90m 118 |[39m       
    [31m[1m>[22m[39m[90m 119 |[39m       expect(yesterdayData[33m?[39m[33m.[39mvalue)[33m.[39mtoBe([35m7[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 120 |[39m       
     [90m 121 |[39m       [90m// Old check-in should not be included[39m
     [90m 122 |[39m       [36mconst[39m oldData [33m=[39m result[33m.[39mfind(point [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/chartUtils.test.ts:119:36)

  ● chartUtils › groupCheckInsByDay › should return 0 for days with no check-ins

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 9

    [0m [90m 146 |[39m       [36mconst[39m yesterday [33m=[39m [36mnew[39m [33mDate[39m([32m'2024-01-14'[39m)[33m;[39m
     [90m 147 |[39m       [36mconst[39m yesterdayData [33m=[39m result[33m.[39mfind(point [33m=>[39m point[33m.[39mdate[33m.[39mtoDateString() [33m===[39m yesterday[33m.[39mtoDateString())[33m;[39m
    [31m[1m>[22m[39m[90m 148 |[39m       expect(yesterdayData[33m?[39m[33m.[39mvalue)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 149 |[39m     })[33m;[39m
     [90m 150 |[39m
     [90m 151 |[39m     it([32m'should generate correct date labels'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/chartUtils.test.ts:148:36)

  ● chartUtils › groupCheckInsByDay › should handle daylight saving time transitions

    expect(received).toBe(expected) // Object.is equality

    Expected: 6
    Received: undefined

    [0m [90m 332 |[39m       [90m// Should handle DST without errors[39m
     [90m 333 |[39m       [36mconst[39m todayData [33m=[39m result[33m.[39mfind(point [33m=>[39m point[33m.[39mdate[33m.[39mtoDateString() [33m===[39m dstDate[33m.[39mtoDateString())[33m;[39m
    [31m[1m>[22m[39m[90m 334 |[39m       expect(todayData[33m?[39m[33m.[39mvalue)[33m.[39mtoBe([35m6[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 335 |[39m     })[33m;[39m
     [90m 336 |[39m
     [90m 337 |[39m     it([32m'should handle empty mood scores array'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/chartUtils.test.ts:334:32)

FAIL src/components/__tests__/LoadingSpinner.test.tsx (8.823 s)
  ● LoadingSpinner › Message Display › should handle empty string message

    expect(received).toBeInTheDocument()

    received value must be an HTMLElement or an SVGElement.
    Received has value: null

    [0m [90m 144 |[39m       
     [90m 145 |[39m       [36mconst[39m messageElement [33m=[39m container[33m.[39mquerySelector([32m'.loading-message'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 146 |[39m       expect(messageElement)[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 147 |[39m       expect(messageElement[33m.[39mtextContent)[33m.[39mtoContain([32m'Loading:'[39m)[33m;[39m
     [90m 148 |[39m     })[33m;[39m
     [90m 149 |[39m[0m

      at __EXTERNAL_MATCHER_TRAP__ (node_modules/expect/build/index.js:325:30)
      at Object.throwingMatcher [as toBeInTheDocument] (node_modules/expect/build/index.js:326:15)
      at Object.<anonymous> (src/components/__tests__/LoadingSpinner.test.tsx:146:30)

FAIL src/utils/accessibilityUtils.test.ts (8.557 s)
  ● AccessibilityUtils › findComplexText › should handle multiple sentences in one element

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 0
    Received array:  []

    [0m [90m 616 |[39m       [36mconst[39m result [33m=[39m [33mAccessibilityUtils[39m[33m.[39mfindComplexText()[33m;[39m
     [90m 617 |[39m
    [31m[1m>[22m[39m[90m 618 |[39m       expect(result)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 619 |[39m       expect(result[[35m0[39m])[33m.[39mtoContain([32m'This is another very long sentence'[39m)[33m;[39m
     [90m 620 |[39m     })[33m;[39m
     [90m 621 |[39m[0m

      at Object.<anonymous> (src/utils/accessibilityUtils.test.ts:618:22)

  ● AccessibilityUtils › findComplexText › should handle different sentence terminators

    expect(received).toHaveLength(expected)

    Expected length: 2
    Received length: 0
    Received array:  []

    [0m [90m 629 |[39m       [36mconst[39m result [33m=[39m [33mAccessibilityUtils[39m[33m.[39mfindComplexText()[33m;[39m
     [90m 630 |[39m
    [31m[1m>[22m[39m[90m 631 |[39m       expect(result)[33m.[39mtoHaveLength([35m2[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 632 |[39m     })[33m;[39m
     [90m 633 |[39m
     [90m 634 |[39m     it([32m'should query the correct text elements'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/accessibilityUtils.test.ts:631:22)

FAIL src/hooks/useAutoSave.test.ts (9.166 s)
  ● useAutoSave Hook › should load draft from storage

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should delete draft from storage

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should get all drafts from storage

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should clear all drafts

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should enable/disable auto-save

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should create new draft

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should debounce content updates before auto-saving

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should auto-save at regular intervals

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should not save when content is not dirty

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should handle storage quota exceeded error

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should call callbacks on save events

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should respect maxDrafts limit

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● useAutoSave Hook › should update save countdown timer

    Storage error

    [0m [90m 147 |[39m     [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 148 |[39m     (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m
     [90m 152 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useAutoSave([32m'test-draft'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAutoSave.test.ts:149:13)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

FAIL src/services/__tests__/culturalAssessmentService.test.ts
  ● CulturalAssessmentService › Assessment Questions Adaptation › should get culturally adapted PHQ-9 questions

    expect(received).toHaveProperty(path)

    Expected path: "Hispanic/Latino"
    Received path: []

    Received value: {}

    [0m [90m 89 |[39m       
     [90m 90 |[39m       expect(questions)[33m.[39mtoHaveLength([35m9[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 91 |[39m       expect(questions[[35m0[39m][33m.[39mculturalAdaptations)[33m.[39mtoHaveProperty([32m'Hispanic/Latino'[39m)[33m;[39m
     [90m    |[39m                                                [31m[1m^[22m[39m
     [90m 92 |[39m       expect(questions[[35m0[39m][33m.[39msensitivityLevel)[33m.[39mtoBeDefined()[33m;[39m
     [90m 93 |[39m       expect(questions[[35m0[39m][33m.[39mstigmaConsiderations)[33m.[39mtoBeInstanceOf([33mArray[39m)[33m;[39m
     [90m 94 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/culturalAssessmentService.test.ts:91:48)

  ● CulturalAssessmentService › Cultural Assessment Calculation › should calculate culturally-adjusted PHQ-9 results

    expect(received).toBeGreaterThan(expected)

    Matcher error: received value must be a number or bigint

    Received has type:  string
    Received has value: "high"

    [0m [90m 175 |[39m       expect(result[33m.[39mculturalFactors)[33m.[39mtoBeDefined()[33m;[39m
     [90m 176 |[39m       expect(result[33m.[39mculturalFactors[33m.[39mexpressionStyle)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 177 |[39m       expect(result[33m.[39mculturalFactors[33m.[39mstigmaLevel)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                                  [31m[1m^[22m[39m
     [90m 178 |[39m       expect(result[33m.[39mculturalFactors[33m.[39mfamilyInvolvement)[33m.[39mtoBe([32m'family-centered'[39m)[33m;[39m
     [90m 179 |[39m       expect(result[33m.[39mrecommendations)[33m.[39mtoBeDefined()[33m;[39m
     [90m 180 |[39m       expect(result[33m.[39mrecommendations[33m.[39mprimary)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/culturalAssessmentService.test.ts:177:50)

FAIL src/services/__tests__/securityService.test.ts
  ● SecurityService › constructor › should initialize with default config

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › constructor › should initialize with custom config

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › constructor › should setup CSP when enabled

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validateInput › should validate required fields

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validateInput › should validate minimum length

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validateInput › should validate maximum length

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validateInput › should validate pattern

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validateInput › should validate custom rules

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validateInput › should skip validation when disabled

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › sanitizeInput › should sanitize HTML entities

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › sanitizeInput › should skip sanitization when disabled

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › containsXSS › should detect script tags

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › containsXSS › should detect javascript: protocol

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › containsXSS › should detect event handlers

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › containsXSS › should detect eval

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › containsXSS › should detect vbscript

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › containsXSS › should detect data URLs

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › containsXSS › should not detect safe content

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › sanitizeHTML › should remove script tags

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › sanitizeHTML › should remove event handlers

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › sanitizeHTML › should remove javascript: protocol

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › checkRateLimit › should allow requests within limit

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › checkRateLimit › should block requests exceeding limit

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › checkRateLimit › should use different limits for different keys

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › checkRateLimit › should track different identifiers separately

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › checkRateLimit › should skip rate limiting when disabled

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › IP blocking › should block and unblock IPs

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › IP blocking › should auto-unblock after duration

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validatePassword › should validate password length

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validatePassword › should check for lowercase letters

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validatePassword › should check for uppercase letters

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validatePassword › should check for numbers

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validatePassword › should check for special characters

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validatePassword › should detect common passwords

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validatePassword › should validate strong passwords

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › hashPassword › should hash passwords

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › hashPassword › should produce consistent hashes

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › hashPassword › should produce different hashes for different passwords

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › generateSecureToken › should generate tokens of specified length

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › generateSecureToken › should generate different tokens

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › generateSecureToken › should use default length

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validateSession › should validate hex tokens

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validateSession › should reject short tokens

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validateSession › should reject non-hex tokens

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › validateSession › should reject empty tokens

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › CSRF protection › should generate and validate CSRF tokens

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › CSRF protection › should reject invalid CSRF tokens

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › CSRF protection › should store token in sessionStorage

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › content filtering › should detect profanity

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › content filtering › should filter content

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › logSecurityEvent › should log security events

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › logSecurityEvent › should limit logs to 100 entries

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › addFormProtection › should add CSRF token to form

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › addFormProtection › should add input validation listeners

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › clearRateLimitStore › should clear expired rate limits

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › security logs management › should get security logs

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● SecurityService › security logs management › should clear security logs

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● useSecurity hook › should return security methods

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● useSecurity hook › should clear rate limits periodically

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● ValidationRules › should provide email validation rules

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● ValidationRules › should provide password validation rules

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● ValidationRules › should provide username validation rules

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● getSecurityService › should return singleton instance

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● edge cases and error handling › should handle null values in validation

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● edge cases and error handling › should handle undefined values in validation

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● edge cases and error handling › should handle empty profanity list

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● edge cases and error handling › should handle form without inputs

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

  ● edge cases and error handling › should handle crypto API errors gracefully

    Document.documentElement is not defined

    [0m [90m 12 |[39m   [90m// Ensure documentElement exists[39m
     [90m 13 |[39m   [36mif[39m ([33m![39mdocument[33m.[39mdocumentElement) {
    [31m[1m>[22m[39m[90m 14 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Document.documentElement is not defined'[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m   }
     [90m 16 |[39m
     [90m 17 |[39m   [90m// Create body if it doesn't exist[39m[0m

      at setupDOM (src/test-utils/setupDom.ts:14:11)
      at Object.<anonymous> (src/setupTests.ts:1225:11)

FAIL src/utils/accessibilityAuditor.test.ts (9.047 s)
  ● accessibilityAuditor › auditPage › should run all audit checks

    SyntaxError: 'h1 with text ,,Test Heading,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:161:30)

  ● accessibilityAuditor › Image Alternatives (WCAG 1.1.1) › should detect missing alt attributes

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 173 |[39m       )[33m;[39m
     [90m 174 |[39m
    [31m[1m>[22m[39m[90m 175 |[39m       expect(imageIssues[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 176 |[39m       expect(imageIssues[[35m0[39m][33m.[39mwcagCriterion)[33m.[39mtoBe([32m'1.1.1'[39m)[33m;[39m
     [90m 177 |[39m       expect(imageIssues[[35m0[39m][33m.[39mseverity)[33m.[39mtoBe([32m'high'[39m)[33m;[39m
     [90m 178 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:175:34)

  ● accessibilityAuditor › Form Labels (WCAG 1.3.1, 3.3.2) › should accept various labeling methods

    SyntaxError: 'label with text ,,Email,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:263:30)

  ● accessibilityAuditor › Heading Structure (WCAG 1.3.1) › should detect missing headings

    SyntaxError: 'p with text ,,Content without any headings,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:288:30)

  ● accessibilityAuditor › Heading Structure (WCAG 1.3.1) › should detect missing H1

    SyntaxError: 'h2 with text ,,Section Title,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:302:30)

  ● accessibilityAuditor › Heading Structure (WCAG 1.3.1) › should detect multiple H1s

    SyntaxError: 'h1 with text ,,First Title,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:316:30)

  ● accessibilityAuditor › Heading Structure (WCAG 1.3.1) › should detect heading level jumps

    SyntaxError: 'h1 with text ,,Main Title,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:330:30)

  ● accessibilityAuditor › Heading Structure (WCAG 1.3.1) › should accept proper heading hierarchy

    SyntaxError: 'h1 with text ,,Main Title,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:358:30)

  ● accessibilityAuditor › Color Contrast (WCAG 1.4.3, 1.4.6) › should detect insufficient color contrast

    SyntaxError: 'p with text ,,Low contrast text,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:399:30)

  ● accessibilityAuditor › Focus Indicators (WCAG 2.4.7) › should detect missing global focus styles

    SyntaxError: 'button with text ,,Test Button,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:438:30)

  ● accessibilityAuditor › Keyboard Navigation (WCAG 2.1.1) › should detect positive tabindex values

    SyntaxError: 'div with text ,,Positive tabindex,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:468:30)

  ● accessibilityAuditor › Keyboard Navigation (WCAG 2.1.1) › should detect click handlers without keyboard support

    SyntaxError: 'div with text ,,Clickable div,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:480:30)

  ● accessibilityAuditor › Keyboard Navigation (WCAG 2.1.1) › should accept proper interactive elements

    SyntaxError: 'button with text ,,Button,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:496:30)

  ● accessibilityAuditor › Touch Targets (WCAG 2.5.5) - Mobile Specific › should not check touch targets when mobile optimization disabled

    SyntaxError: 'button with text ,,Small Button,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:542:37)

  ● accessibilityAuditor › Landmarks (WCAG 1.3.1) › should detect missing main landmark

    SyntaxError: 'div with text ,,Content without main landmark,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:585:30)

  ● accessibilityAuditor › ARIA Usage (WCAG 4.1.2) › should detect empty aria-label

    SyntaxError: 'button with text ,,Button,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:642:30)

  ● accessibilityAuditor › ARIA Usage (WCAG 4.1.2) › should detect invalid aria-labelledby references

    SyntaxError: 'button with text ,,Button,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:653:30)

  ● accessibilityAuditor › ARIA Usage (WCAG 4.1.2) › should detect invalid aria-describedby references

    SyntaxError: 'button with text ,,Button,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:665:30)

  ● accessibilityAuditor › ARIA Usage (WCAG 4.1.2) › should accept valid ARIA references

    SyntaxError: 'span with text ,,Button Label,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:680:30)

  ● accessibilityAuditor › Mobile-Specific Checks › should detect viewport that prevents zooming

    RangeError: Maximum call stack size exceeded
        at WeakMap.get (<anonymous>)

    [0m [90m 86 |[39m         [36mreturn[39m mockCanvas[33m;[39m
     [90m 87 |[39m       }
    [31m[1m>[22m[39m[90m 88 |[39m       [36mreturn[39m originalCreateElement(tagName)[33m;[39m
     [90m    |[39m              [31m[1m^[22m[39m
     [90m 89 |[39m     })[33m;[39m
     [90m 90 |[39m
     [90m 91 |[39m     [90m// Default auditor configuration[39m[0m

      at ModuleMocker._ensureMockState (node_modules/jest-mock/build/index.js:287:33)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:396:39)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)

  ● accessibilityAuditor › Mobile-Specific Checks › should accept proper viewport configuration

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

    [0m [90m 86 |[39m         [36mreturn[39m mockCanvas[33m;[39m
     [90m 87 |[39m       }
    [31m[1m>[22m[39m[90m 88 |[39m       [36mreturn[39m originalCreateElement(tagName)[33m;[39m
     [90m    |[39m              [31m[1m^[22m[39m
     [90m 89 |[39m     })[33m;[39m
     [90m 90 |[39m
     [90m 91 |[39m     [90m// Default auditor configuration[39m[0m

      at node_modules/jest-mock/build/index.js:367:22
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:396:39)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)
      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:88:14)

  ● accessibilityAuditor › Custom Rules › should execute custom rules

    SyntaxError: 'div with text ,,Test content,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:836:36)

  ● accessibilityAuditor › Configuration Options › should skip elements with aria-hidden when configured

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 8

    [0m [90m 867 |[39m       [36mconst[39m result [33m=[39m skipHiddenAuditor[33m.[39mauditPage()[33m;[39m
     [90m 868 |[39m       [90m// Should not have issues for hidden elements[39m
    [31m[1m>[22m[39m[90m 869 |[39m       expect(result[33m.[39missues[33m.[39mlength)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 870 |[39m     })[33m;[39m
     [90m 871 |[39m
     [90m 872 |[39m     test([32m'should use AAA level when configured'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:869:36)

  ● accessibilityAuditor › Score Calculation › should calculate lower score with more issues

    SyntaxError: 'div with text ,,Clickable div,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:893:30)

  ● accessibilityAuditor › Score Calculation › should identify compliant areas

    SyntaxError: 'h1 with text ,,Page Title,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:917:30)

  ● accessibilityAuditor › Static Methods › should provide quickAudit method

    SyntaxError: 'h1 with text ,,Test Page,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Function.quickAudit (src/utils/accessibilityAuditor.ts:865:20)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:929:49)

  ● accessibilityAuditor › Static Methods › should provide comprehensiveAudit method

    SyntaxError: 'h1 with text ,,Test Page,,,,' is not a valid selector

    [0m [90m 798 |[39m     
     [90m 799 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39mskipElementsWithAriaHidden [33m&&[39m issue[33m.[39melement) {
    [31m[1m>[22m[39m[90m 800 |[39m       [36mconst[39m element [33m=[39m document[33m.[39mquerySelector(issue[33m.[39melement)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 801 |[39m       [36mif[39m (element[33m?[39m[33m.[39mgetAttribute([32m'aria-hidden'[39m) [33m===[39m [32m'true'[39m) {
     [90m 802 |[39m         [36mreturn[39m[33m;[39m
     [90m 803 |[39m       }[0m

      at emit (node_modules/nwsapi/src/nwsapi.js:656:17)
      at parse (node_modules/nwsapi/src/nwsapi.js:1580:9)
      at _querySelectorAll (node_modules/nwsapi/src/nwsapi.js:1661:44)
      at Object._querySelector [as first] (node_modules/nwsapi/src/nwsapi.js:1603:14)
      at DocumentImpl.querySelector (node_modules/jsdom/lib/jsdom/living/nodes/ParentNode-impl.js:69:44)
      at Document.querySelector (node_modules/jsdom/lib/jsdom/living/generated/Document.js:1026:58)
      at MobileAccessibilityAuditor.addIssue (src/utils/accessibilityAuditor.ts:800:32)
      at src/utils/accessibilityAuditor.ts:283:18
          at Proxy.forEach (<anonymous>)
      at MobileAccessibilityAuditor.checkColorContrast (src/utils/accessibilityAuditor.ts:268:18)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:81:10)
      at Function.comprehensiveAudit (src/utils/accessibilityAuditor.ts:871:20)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:940:49)

  ● accessibilityAuditor › Error Handling › should handle malformed DOM gracefully

    expect(received).not.toThrow()

    Error name:    "Error"
    Error message: "DOM error"

        [0m [90m 953 |[39m       [36mconst[39m originalQuerySelector [33m=[39m document[33m.[39mquerySelector[33m;[39m
         [90m 954 |[39m       document[33m.[39mquerySelector [33m=[39m jest[33m.[39mfn(() [33m=>[39m {
        [31m[1m>[22m[39m[90m 955 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'DOM error'[39m)[33m;[39m
         [90m     |[39m               [31m[1m^[22m[39m
         [90m 956 |[39m       })[33m;[39m
         [90m 957 |[39m
         [90m 958 |[39m       expect(() [33m=>[39m {[0m

      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:955:15)
      at MobileAccessibilityAuditor.checkMobileSpecificChecks (src/utils/accessibilityAuditor.ts:736:35)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:92:10)
      at src/utils/accessibilityAuditor.test.ts:959:17
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:960:14)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:960:14)

  ● accessibilityAuditor › Error Handling › should handle missing elements gracefully

    DOM error

    [0m [90m 953 |[39m       [36mconst[39m originalQuerySelector [33m=[39m document[33m.[39mquerySelector[33m;[39m
     [90m 954 |[39m       document[33m.[39mquerySelector [33m=[39m jest[33m.[39mfn(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 955 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'DOM error'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 956 |[39m       })[33m;[39m
     [90m 957 |[39m
     [90m 958 |[39m       expect(() [33m=>[39m {[0m

      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:955:15)
      at MobileAccessibilityAuditor.checkMobileSpecificChecks (src/utils/accessibilityAuditor.ts:736:35)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:92:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:969:30)

  ● accessibilityAuditor › Error Handling › should handle getBoundingClientRect errors

    DOM error

    [0m [90m 953 |[39m       [36mconst[39m originalQuerySelector [33m=[39m document[33m.[39mquerySelector[33m;[39m
     [90m 954 |[39m       document[33m.[39mquerySelector [33m=[39m jest[33m.[39mfn(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 955 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'DOM error'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 956 |[39m       })[33m;[39m
     [90m 957 |[39m
     [90m 958 |[39m       expect(() [33m=>[39m {[0m

      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:955:15)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:976:35)

  ● accessibilityAuditor › Error Handling › should handle color parsing errors

    expect(received).not.toThrow()

    Error name:    "Error"
    Error message: "DOM error"

        [0m [90m 953 |[39m       [36mconst[39m originalQuerySelector [33m=[39m document[33m.[39mquerySelector[33m;[39m
         [90m 954 |[39m       document[33m.[39mquerySelector [33m=[39m jest[33m.[39mfn(() [33m=>[39m {
        [31m[1m>[22m[39m[90m 955 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'DOM error'[39m)[33m;[39m
         [90m     |[39m               [31m[1m^[22m[39m
         [90m 956 |[39m       })[33m;[39m
         [90m 957 |[39m
         [90m 958 |[39m       expect(() [33m=>[39m {[0m

      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:955:15)
      at MobileAccessibilityAuditor.checkMobileSpecificChecks (src/utils/accessibilityAuditor.ts:736:35)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:92:10)
      at src/utils/accessibilityAuditor.test.ts:1002:17
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:1003:14)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:1003:14)

  ● accessibilityAuditor › Performance › should complete audit in reasonable time

    DOM error

    [0m [90m 953 |[39m       [36mconst[39m originalQuerySelector [33m=[39m document[33m.[39mquerySelector[33m;[39m
     [90m 954 |[39m       document[33m.[39mquerySelector [33m=[39m jest[33m.[39mfn(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 955 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'DOM error'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 956 |[39m       })[33m;[39m
     [90m 957 |[39m
     [90m 958 |[39m       expect(() [33m=>[39m {[0m

      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:955:15)
      at MobileAccessibilityAuditor.checkMobileSpecificChecks (src/utils/accessibilityAuditor.ts:736:35)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:92:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:1022:30)

  ● accessibilityAuditor › Performance › should not cause memory leaks with repeated audits

    DOM error

    [0m [90m 953 |[39m       [36mconst[39m originalQuerySelector [33m=[39m document[33m.[39mquerySelector[33m;[39m
     [90m 954 |[39m       document[33m.[39mquerySelector [33m=[39m jest[33m.[39mfn(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 955 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'DOM error'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 956 |[39m       })[33m;[39m
     [90m 957 |[39m
     [90m 958 |[39m       expect(() [33m=>[39m {[0m

      at Document.<anonymous> (src/utils/accessibilityAuditor.test.ts:955:15)
      at MobileAccessibilityAuditor.checkMobileSpecificChecks (src/utils/accessibilityAuditor.ts:736:35)
      at MobileAccessibilityAuditor.auditPage (src/utils/accessibilityAuditor.ts:92:10)
      at Object.<anonymous> (src/utils/accessibilityAuditor.test.ts:1035:17)

FAIL src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts
  ● EnhancedCrisisKeywordDetectionService › analyzeEnhancedCrisisKeywords › should reduce confidence for negative flag words

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 146 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m service[33m.[39manalyzeEnhancedCrisisKeywords(text)[33m;[39m
     [90m 147 |[39m
    [31m[1m>[22m[39m[90m 148 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 149 |[39m       expect(result[33m.[39moverallSeverity)[33m.[39mtoBe([32m'none'[39m)[33m;[39m
     [90m 150 |[39m     })[33m;[39m
     [90m 151 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts:148:42)

  ● EnhancedCrisisKeywordDetectionService › analyzeEnhancedCrisisKeywords › should handle timeline urgency indicators

    expect(received).toBeGreaterThan(expected)

    Expected: > 80
    Received:   70

    [0m [90m 158 |[39m       expect(result[33m.[39mriskAssessment[33m.[39mtimelineAnalysis[33m.[39mhasTemporalUrgency)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 159 |[39m       expect(result[33m.[39mriskAssessment[33m.[39mtimelineAnalysis[33m.[39mtimeframe)[33m.[39mtoContain([32m'immediate'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 160 |[39m       expect(result[33m.[39mriskAssessment[33m.[39mimmediateRisk)[33m.[39mtoBeGreaterThan([35m80[39m)[33m;[39m
     [90m     |[39m                                                   [31m[1m^[22m[39m
     [90m 161 |[39m     })[33m;[39m
     [90m 162 |[39m
     [90m 163 |[39m     it([32m'should detect emotional crisis patterns'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts:160:51)

  ● EnhancedCrisisKeywordDetectionService › analyzeEnhancedCrisisKeywords › should detect emotional crisis patterns

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 166 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m service[33m.[39manalyzeEnhancedCrisisKeywords(text)[33m;[39m
     [90m 167 |[39m
    [31m[1m>[22m[39m[90m 168 |[39m       expect(result[33m.[39memotionalIndicators[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                                 [31m[1m^[22m[39m
     [90m 169 |[39m       expect(result[33m.[39memotionalIndicators[33m.[39msome(indicator [33m=>[39m 
     [90m 170 |[39m         indicator[33m.[39memotionalState [33m===[39m [32m'hopelessness'[39m
     [90m 171 |[39m       ))[33m.[39mtoBe([36mtrue[39m)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts:168:49)

  ● EnhancedCrisisKeywordDetectionService › analyzeEnhancedCrisisKeywords › should detect multiple crisis categories

    expect(received).toContain(expected) // indexOf

    Expected value: "violence-threat"
    Received array: ["suicidal-ideation"]

    [0m [90m 229 |[39m       [36mconst[39m categories [33m=[39m result[33m.[39mkeywordMatches[33m.[39mmap(match [33m=>[39m match[33m.[39mcategory)[33m;[39m
     [90m 230 |[39m       expect(categories)[33m.[39mtoContain([32m'suicidal-ideation'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 231 |[39m       expect(categories)[33m.[39mtoContain([32m'violence-threat'[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 232 |[39m       expect(categories)[33m.[39mtoContain([32m'psychotic-episode'[39m)[33m;[39m
     [90m 233 |[39m     })[33m;[39m
     [90m 234 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts:231:26)

  ● EnhancedCrisisKeywordDetectionService › analyzeEnhancedCrisisKeywords › should provide analysis metadata

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 250 |[39m       expect(result[33m.[39manalysisMetadata)[33m.[39mtoHaveProperty([32m'confidence'[39m)[33m;[39m
     [90m 251 |[39m       expect(result[33m.[39manalysisMetadata)[33m.[39mtoHaveProperty([32m'processingTime'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 252 |[39m       expect(result[33m.[39manalysisMetadata[33m.[39mprocessingTime)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 253 |[39m     })[33m;[39m
     [90m 254 |[39m
     [90m 255 |[39m     it([32m'should handle errors gracefully'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts:252:54)

  ● EnhancedCrisisKeywordDetectionService › Edge cases and validation › should be case-insensitive

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 310 |[39m
     [90m 311 |[39m       expect(lowerCase[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 312 |[39m       expect(upperCase[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                             [31m[1m^[22m[39m
     [90m 313 |[39m       expect(mixedCase[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 314 |[39m       
     [90m 315 |[39m       expect(lowerCase[33m.[39moverallSeverity)[33m.[39mtoBe(upperCase[33m.[39moverallSeverity)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts:312:45)

  ● EnhancedCrisisKeywordDetectionService › Performance and reliability › should process text within reasonable time limits

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 345 |[39m
     [90m 346 |[39m       expect(processingTime)[33m.[39mtoBeLessThan([35m5000[39m)[33m;[39m [90m// Should complete within 5 seconds[39m
    [31m[1m>[22m[39m[90m 347 |[39m       expect(result[33m.[39manalysisMetadata[33m.[39mprocessingTime)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 348 |[39m     })[33m;[39m
     [90m 349 |[39m
     [90m 350 |[39m     it([32m'should handle moderately long text efficiently'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts:347:54)

  ● EnhancedCrisisKeywordDetectionService › Performance and reliability › should maintain consistent results for identical input

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 364 |[39m       [36mconst[39m result2 [33m=[39m [36mawait[39m service[33m.[39manalyzeEnhancedCrisisKeywords(text)[33m;[39m
     [90m 365 |[39m
    [31m[1m>[22m[39m[90m 366 |[39m       expect(result1[33m.[39mhasCrisisIndicators)[33m.[39mtoBe(result2[33m.[39mhasCrisisIndicators)[33m;[39m
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 367 |[39m       expect(result1[33m.[39moverallSeverity)[33m.[39mtoBe(result2[33m.[39moverallSeverity)[33m;[39m
     [90m 368 |[39m       expect(result1[33m.[39mescalationRequired)[33m.[39mtoBe(result2[33m.[39mescalationRequired)[33m;[39m
     [90m 369 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts:366:43)

  ● EnhancedCrisisKeywordDetectionService › Intervention recommendation logic › should prioritize recommendations correctly

    TypeError: Cannot read properties of undefined (reading 'type')

    [0m [90m 403 |[39m
     [90m 404 |[39m       [36mconst[39m sortedRecommendations [33m=[39m result[33m.[39minterventionRecommendations[33m.[39msort((a[33m,[39m b) [33m=>[39m a[33m.[39mpriority [33m-[39m b[33m.[39mpriority)[33m;[39m
    [31m[1m>[22m[39m[90m 405 |[39m       expect(sortedRecommendations[[35m0[39m][33m.[39mtype)[33m.[39mtoBe([32m'immediate'[39m)[33m;[39m
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 406 |[39m       expect(sortedRecommendations[[35m0[39m][33m.[39mpriority)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m 407 |[39m     })[33m;[39m
     [90m 408 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts:405:39)

  ● EnhancedCrisisKeywordDetectionService › Emotional analysis › should detect hopelessness emotional patterns

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 444 |[39m       expect(result[33m.[39memotionalIndicators[33m.[39msome(indicator [33m=>[39m 
     [90m 445 |[39m         indicator[33m.[39memotionalState [33m===[39m [32m'hopelessness'[39m
    [31m[1m>[22m[39m[90m 446 |[39m       ))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 447 |[39m     })[33m;[39m
     [90m 448 |[39m
     [90m 449 |[39m     it([32m'should detect rage crisis patterns'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/enhancedCrisisKeywordDetectionService.test.ts:446:10)

FAIL src/services/__tests__/advancedThemingSystem.test.ts
  ● Test suite failed to run

    ReferenceError: Cannot access 'mockCreateContext' before initialization

    [0m [90m 20 |[39m jest[33m.[39mmock([32m'react'[39m[33m,[39m () [33m=>[39m ({
     [90m 21 |[39m   [33m...[39mjest[33m.[39mrequireActual([32m'react'[39m)[33m,[39m
    [31m[1m>[22m[39m[90m 22 |[39m   createContext[33m:[39m mockCreateContext[33m,[39m
     [90m    |[39m                  [31m[1m^[22m[39m
     [90m 23 |[39m   useContext[33m:[39m mockUseContext[33m,[39m
     [90m 24 |[39m }))[33m;[39m
     [90m 25 |[39m[0m

      at src/services/__tests__/advancedThemingSystem.test.ts:22:18
      at Object.<anonymous> (src/services/advancedThemingSystem.ts:9:1)
      at Object.<anonymous> (src/services/__tests__/advancedThemingSystem.test.ts:5:1)

FAIL tests/services/enhancedCrisisKeywordDetection.test.ts
  ● EnhancedCrisisKeywordDetectionService › High Level Crisis Detection › should detect self-harm escalation

    expect(received).toBe(expected) // Object.is equality

    Expected: "high"
    Received: "medium"

    [0m [90m 117 |[39m       expect(result[33m.[39moverallSeverity)[33m.[39mtoBe([32m'high'[39m)[33m;[39m
     [90m 118 |[39m       expect(result[33m.[39mkeywordMatches[33m.[39msome(m [33m=>[39m m[33m.[39mcategory [33m===[39m [32m'self-harm'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 119 |[39m       expect(result[33m.[39mriskAssessment[33m.[39minterventionUrgency)[33m.[39mtoBe([32m'high'[39m)[33m;[39m
     [90m     |[39m                                                         [31m[1m^[22m[39m
     [90m 120 |[39m     })[33m;[39m
     [90m 121 |[39m
     [90m 122 |[39m     test([32m'should detect severe psychological distress'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:119:57)

  ● EnhancedCrisisKeywordDetectionService › Contextual Analysis › should reduce crisis level when negative modifiers are present

    expect(received).toBeLessThan(expected)

    Expected: < 70
    Received:   70

    [0m [90m 150 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 151 |[39m       expect(result[33m.[39moverallSeverity)[33m.[39mnot[33m.[39mtoBe([32m'emergency'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 152 |[39m       expect(result[33m.[39mriskAssessment[33m.[39mimmediateRisk)[33m.[39mtoBeLessThan([35m70[39m)[33m;[39m
     [90m     |[39m                                                   [31m[1m^[22m[39m
     [90m 153 |[39m     })[33m;[39m
     [90m 154 |[39m
     [90m 155 |[39m     test([32m'should increase crisis level with positive amplifiers'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:152:51)

  ● EnhancedCrisisKeywordDetectionService › Emotional Pattern Recognition › should detect hopelessness emotional pattern

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.7
    Received:   0.3

    [0m [90m 183 |[39m       expect(result[33m.[39memotionalIndicators[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m 184 |[39m       expect(result[33m.[39memotionalIndicators[33m.[39msome(e [33m=>[39m e[33m.[39memotionalState [33m===[39m [32m'hopelessness'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 185 |[39m       expect(result[33m.[39mriskAssessment[33m.[39memotionalProfile[33m.[39mcrisisAlignment)[33m.[39mtoBeGreaterThan([35m0.7[39m)[33m;[39m
     [90m     |[39m                                                                      [31m[1m^[22m[39m
     [90m 186 |[39m     })[33m;[39m
     [90m 187 |[39m
     [90m 188 |[39m     test([32m'should detect desperation emotional pattern'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:185:70)

  ● EnhancedCrisisKeywordDetectionService › Emotional Pattern Recognition › should detect desperation emotional pattern

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.6
    Received:   0

    [0m [90m 192 |[39m       
     [90m 193 |[39m       expect(result[33m.[39memotionalIndicators[33m.[39msome(e [33m=>[39m e[33m.[39memotionalState [33m===[39m [32m'desperation'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 194 |[39m       expect(result[33m.[39mriskAssessment[33m.[39memotionalProfile[33m.[39mintensity)[33m.[39mtoBeGreaterThan([35m0.6[39m)[33m;[39m
     [90m     |[39m                                                                [31m[1m^[22m[39m
     [90m 195 |[39m     })[33m;[39m
     [90m 196 |[39m
     [90m 197 |[39m     test([32m'should detect emotional numbness pattern'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:194:64)

  ● EnhancedCrisisKeywordDetectionService › Risk Assessment Scoring › should calculate accurate immediate risk scores

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 224 |[39m       
     [90m 225 |[39m       expect(highResult[33m.[39mriskAssessment[33m.[39mimmediateRisk)[33m.[39mtoBeGreaterThan(mediumResult[33m.[39mriskAssessment[33m.[39mimmediateRisk)[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m       expect(mediumResult[33m.[39mriskAssessment[33m.[39mimmediateRisk)[33m.[39mtoBeGreaterThan(lowResult[33m.[39mriskAssessment[33m.[39mimmediateRisk)[33m;[39m
     [90m     |[39m                                                         [31m[1m^[22m[39m
     [90m 227 |[39m     })[33m;[39m
     [90m 228 |[39m
     [90m 229 |[39m     test([32m'should provide appropriate intervention urgency levels'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:226:57)

  ● EnhancedCrisisKeywordDetectionService › Risk Assessment Scoring › should provide appropriate intervention urgency levels

    expect(received).toBe(expected) // Object.is equality

    Expected: "immediate"
    Received: "none"

    [0m [90m 238 |[39m       [36mconst[39m lowResult [33m=[39m [36mawait[39m enhancedCrisisKeywordDetectionService[33m.[39manalyzeEnhancedCrisisKeywords(lowText)[33m;[39m
     [90m 239 |[39m       
    [31m[1m>[22m[39m[90m 240 |[39m       expect(immediateResult[33m.[39mriskAssessment[33m.[39minterventionUrgency)[33m.[39mtoBe([32m'immediate'[39m)[33m;[39m
     [90m     |[39m                                                                  [31m[1m^[22m[39m
     [90m 241 |[39m       expect(highResult[33m.[39mriskAssessment[33m.[39minterventionUrgency)[33m.[39mtoBe([32m'high'[39m)[33m;[39m
     [90m 242 |[39m       expect(mediumResult[33m.[39mriskAssessment[33m.[39minterventionUrgency)[33m.[39mtoBe([32m'medium'[39m)[33m;[39m
     [90m 243 |[39m       expect(lowResult[33m.[39mriskAssessment[33m.[39minterventionUrgency)[33m.[39mtoBe([32m'low'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:240:66)

  ● EnhancedCrisisKeywordDetectionService › Intervention Recommendations › should provide immediate intervention for emergency cases

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 251 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedCrisisKeywordDetectionService[33m.[39manalyzeEnhancedCrisisKeywords(text)[33m;[39m
     [90m 252 |[39m       
    [31m[1m>[22m[39m[90m 253 |[39m       expect(result[33m.[39minterventionRecommendations[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                                         [31m[1m^[22m[39m
     [90m 254 |[39m       expect(result[33m.[39minterventionRecommendations[[35m0[39m][33m.[39mtype)[33m.[39mtoBe([32m'immediate'[39m)[33m;[39m
     [90m 255 |[39m       expect(result[33m.[39minterventionRecommendations[[35m0[39m][33m.[39mactionItems)[33m.[39mtoContain([32m'Contact emergency services (911)'[39m)[33m;[39m
     [90m 256 |[39m       expect(result[33m.[39minterventionRecommendations[[35m0[39m][33m.[39mtimeframe)[33m.[39mtoBe([32m'Immediate'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:253:57)

  ● EnhancedCrisisKeywordDetectionService › Intervention Recommendations › should provide urgent intervention for high-risk cases

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 262 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedCrisisKeywordDetectionService[33m.[39manalyzeEnhancedCrisisKeywords(text)[33m;[39m
     [90m 263 |[39m       
    [31m[1m>[22m[39m[90m 264 |[39m       expect(result[33m.[39minterventionRecommendations[33m.[39msome(r [33m=>[39m r[33m.[39mtype [33m===[39m [32m'urgent'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                                                 [31m[1m^[22m[39m
     [90m 265 |[39m       expect(result[33m.[39minterventionRecommendations[33m.[39msome(r [33m=>[39m r[33m.[39mtimeframe [33m===[39m [32m'Within 2-4 hours'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 266 |[39m     })[33m;[39m
     [90m 267 |[39m[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:264:81)

  ● EnhancedCrisisKeywordDetectionService › Intervention Recommendations › should provide supportive intervention for medium-risk cases

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 271 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedCrisisKeywordDetectionService[33m.[39manalyzeEnhancedCrisisKeywords(text)[33m;[39m
     [90m 272 |[39m       
    [31m[1m>[22m[39m[90m 273 |[39m       expect(result[33m.[39minterventionRecommendations[33m.[39msome(r [33m=>[39m r[33m.[39mtype [33m===[39m [32m'supportive'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                                                     [31m[1m^[22m[39m
     [90m 274 |[39m       expect(result[33m.[39minterventionRecommendations[33m.[39msome(r [33m=>[39m r[33m.[39mtimeframe [33m===[39m [32m'Within 24 hours'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 275 |[39m     })[33m;[39m
     [90m 276 |[39m[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:273:85)

  ● EnhancedCrisisKeywordDetectionService › Intervention Recommendations › should provide monitoring recommendations for ongoing support

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 280 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedCrisisKeywordDetectionService[33m.[39manalyzeEnhancedCrisisKeywords(text)[33m;[39m
     [90m 281 |[39m       
    [31m[1m>[22m[39m[90m 282 |[39m       expect(result[33m.[39minterventionRecommendations[33m.[39msome(r [33m=>[39m r[33m.[39mtype [33m===[39m [32m'monitoring'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                                                     [31m[1m^[22m[39m
     [90m 283 |[39m       expect(result[33m.[39minterventionRecommendations[33m.[39msome(r [33m=>[39m r[33m.[39mtimeframe [33m===[39m [32m'Ongoing'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 284 |[39m     })[33m;[39m
     [90m 285 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:282:85)

  ● EnhancedCrisisKeywordDetectionService › False Positive Prevention › should not trigger crisis for hypothetical or past scenarios

    expect(received).not.toBe(expected) // Object.is equality

    Expected: not "emergency"

    [0m [90m 295 |[39m       [36mconst[39m academicResult [33m=[39m [36mawait[39m enhancedCrisisKeywordDetectionService[33m.[39manalyzeEnhancedCrisisKeywords(academicText)[33m;[39m
     [90m 296 |[39m       
    [31m[1m>[22m[39m[90m 297 |[39m       expect(hypotheticalResult[33m.[39moverallSeverity)[33m.[39mnot[33m.[39mtoBe([32m'emergency'[39m)[33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 298 |[39m       expect(pastResult[33m.[39mriskAssessment[33m.[39mimmediateRisk)[33m.[39mtoBeLessThan([35m50[39m)[33m;[39m
     [90m 299 |[39m       expect(academicResult[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 300 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:297:54)

  ● EnhancedCrisisKeywordDetectionService › Analysis Metadata › should provide accurate analysis metadata

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 318 |[39m       expect(result[33m.[39manalysisMetadata[33m.[39manalysisMethod)[33m.[39mtoBe([32m'contextual'[39m)[33m;[39m
     [90m 319 |[39m       expect(result[33m.[39manalysisMetadata[33m.[39mconfidence)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 320 |[39m       expect(result[33m.[39manalysisMetadata[33m.[39mprocessingTime)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 321 |[39m       expect([33mArray[39m[33m.[39misArray(result[33m.[39manalysisMetadata[33m.[39mflaggedConcerns))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 322 |[39m     })[33m;[39m
     [90m 323 |[39m[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:320:54)

  ● EnhancedCrisisKeywordDetectionService › Analysis Metadata › should flag appropriate concerns

    expect(received).toContain(expected) // indexOf

    Expected value: "Suicide planning indicators present"
    Received array: []

    [0m [90m 332 |[39m       
     [90m 333 |[39m       expect(emergencyResult[33m.[39manalysisMetadata[33m.[39mflaggedConcerns)[33m.[39mtoContain([32m'Emergency-level crisis indicators detected'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 334 |[39m       expect(planningResult[33m.[39manalysisMetadata[33m.[39mflaggedConcerns)[33m.[39mtoContain([32m'Suicide planning indicators present'[39m)[33m;[39m
     [90m     |[39m                                                               [31m[1m^[22m[39m
     [90m 335 |[39m       expect(violenceResult[33m.[39manalysisMetadata[33m.[39mflaggedConcerns)[33m.[39mtoContain([32m'Violence threat indicators detected'[39m)[33m;[39m
     [90m 336 |[39m     })[33m;[39m
     [90m 337 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:334:63)

  ● EnhancedCrisisKeywordDetectionService › Integration Testing › should handle complex multi-indicator scenarios

    expect(received).toBe(expected) // Object.is equality

    Expected: "emergency"
    Received: "critical"

    [0m [90m 371 |[39m       
     [90m 372 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 373 |[39m       expect(result[33m.[39moverallSeverity)[33m.[39mtoBe([32m'emergency'[39m)[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 374 |[39m       expect(result[33m.[39memergencyServicesRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 375 |[39m       expect(result[33m.[39mkeywordMatches[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m3[39m)[33m;[39m
     [90m 376 |[39m       expect(result[33m.[39memotionalIndicators[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m1[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:373:38)

  ● EnhancedCrisisKeywordDetectionService › Integration Testing › should handle mixed signals appropriately

    expect(received).not.toBe(expected) // Object.is equality

    Expected: not "emergency"

    [0m [90m 386 |[39m       
     [90m 387 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 388 |[39m       expect(result[33m.[39moverallSeverity)[33m.[39mnot[33m.[39mtoBe([32m'emergency'[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 389 |[39m       expect(result[33m.[39mriskAssessment[33m.[39mprotectiveFactors[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m 390 |[39m       expect(result[33m.[39mriskAssessment[33m.[39mimmediateRisk)[33m.[39mtoBeLessThan([35m70[39m)[33m;[39m
     [90m 391 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/services/enhancedCrisisKeywordDetection.test.ts:388:42)

FAIL src/hooks/useEnhancedCrisisDetection.test.ts (9.565 s)
  ● useEnhancedCrisisDetection Hook › should call intervention recommended callback

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 290 |[39m     [90m// Check if callback was called - the hook only calls it when there are recommendations[39m
     [90m 291 |[39m     [90m// and it needs to have a proper realTimeRisk object[39m
    [31m[1m>[22m[39m[90m 292 |[39m     expect(onInterventionRecommended)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 293 |[39m     expect(onInterventionRecommended)[33m.[39mtoHaveBeenCalledWith(
     [90m 294 |[39m       expect[33m.[39marrayContaining([
     [90m 295 |[39m         [32m'Immediate professional intervention recommended'[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useEnhancedCrisisDetection.test.ts:292:39)

  ● useEnhancedCrisisDetection Hook › should provide debounced analysis

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 377 |[39m     [90m// Wait for the debounced function to execute[39m
     [90m 378 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 379 |[39m       expect(enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                                                    [31m[1m^[22m[39m
     [90m 380 |[39m     }[33m,[39m { timeout[33m:[39m [35m1000[39m })[33m;[39m
     [90m 381 |[39m
     [90m 382 |[39m     [90m// Should use the last text[39m[0m

      at timeout (src/hooks/useEnhancedCrisisDetection.test.ts:379:68)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at node_modules/@testing-library/dom/dist/wait-for.js:82:9

  ● useEnhancedCrisisDetection Hook › should get risk prediction

    expect(received).toBe(expected) // Object.is equality

    Expected: 65
    Received: undefined

    [0m [90m 483 |[39m
     [90m 484 |[39m     expect(prediction)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 485 |[39m     expect(prediction[33m.[39mcurrentRisk)[33m.[39mtoBe([35m65[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 486 |[39m     expect(prediction[33m.[39mpredictedRisk)[33m.[39mtoBeGreaterThanOrEqual([35m0[39m)[33m;[39m
     [90m 487 |[39m     expect(prediction[33m.[39mpredictedRisk)[33m.[39mtoBeLessThanOrEqual([35m100[39m)[33m;[39m
     [90m 488 |[39m     expect(prediction[33m.[39mconfidence)[33m.[39mtoBeGreaterThanOrEqual([35m0[39m)[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useEnhancedCrisisDetection.test.ts:485:36)

  ● useEnhancedCrisisDetection Hook › should get personalized intervention recommendations

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 504 |[39m     [90m// Check that interventions are returned with expected structure[39m
     [90m 505 |[39m     expect([33mArray[39m[33m.[39misArray(interventions))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 506 |[39m     expect(interventions[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 507 |[39m     
     [90m 508 |[39m     [90m// Verify the structure of returned interventions if any exist[39m
     [90m 509 |[39m     [36mif[39m (interventions[33m.[39mlength [33m>[39m [35m0[39m) {[0m

      at Object.<anonymous> (src/hooks/useEnhancedCrisisDetection.test.ts:506:34)

  ● useEnhancedCrisisDetection Hook › should clear analysis history

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 538 |[39m     [90m// Wait for state to be updated[39m
     [90m 539 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 540 |[39m       expect(result[33m.[39mcurrent[33m.[39manalysisHistory[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 541 |[39m     })[33m;[39m
     [90m 542 |[39m
     [90m 543 |[39m     expect(result[33m.[39mcurrent[33m.[39manalysisHistory)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m[0m

      at src/hooks/useEnhancedCrisisDetection.test.ts:540:53
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at node_modules/@testing-library/dom/dist/wait-for.js:82:9

  ● useEnhancedCrisisDetection Hook › should handle analysis without tracking history

    expect(received).toEqual(expected) // deep equality

    Expected: {"biasAdjustments": [{"confidence": 0.9, "factor": "Language bias adjustment"}], "culturalContext": "Western", "emotionalState": {"arousal": 0.6, "dominance": -0.3, "primaryEmotion": "despair", "timestamp": 1755460723000, "valence": -0.7}, "hasCrisisIndicators": true, "mlConfidence": 0.85, "realTimeRisk": {"immediateRisk": 75, "interventionUrgency": 8, "recommendedInterventions": [{"description": "Immediate professional intervention recommended", "priority": 8}, {"description": "Contact emergency mental health services", "priority": 6}]}}
    Received: null

    [0m [90m 580 |[39m     [36mawait[39m act([36masync[39m () [33m=>[39m {
     [90m 581 |[39m       [36mconst[39m analysisResult [33m=[39m [36mawait[39m result[33m.[39mcurrent[33m.[39manalyzeText([32m'Test text'[39m[33m,[39m { trackHistory[33m:[39m [36mfalse[39m })[33m;[39m
    [31m[1m>[22m[39m[90m 582 |[39m       expect(analysisResult)[33m.[39mtoEqual(mockMLAnalysisResult)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 583 |[39m     })[33m;[39m
     [90m 584 |[39m
     [90m 585 |[39m     [90m// When trackHistory is false, history arrays should remain empty[39m[0m

      at src/hooks/useEnhancedCrisisDetection.test.ts:582:30

FAIL src/services/__tests__/dataExportService.test.ts
  ● useDataExport hook › should export data successfully

    createRoot(...): Target container is not a DOM element.

    [0m [90m 528 |[39m   it([32m'should export data successfully'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 529 |[39m     [90m// Create a wrapper div for the hook[39m
    [31m[1m>[22m[39m[90m 530 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useDataExport())[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 531 |[39m
     [90m 532 |[39m     expect(result[33m.[39mcurrent[33m.[39misExporting)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 533 |[39m[0m

      at createRoot (node_modules/react-dom/cjs/react-dom.development.js:29384:11)
      at Object.createRoot$1 [as createRoot] (node_modules/react-dom/cjs/react-dom.development.js:29855:10)
      at Object.<anonymous>.exports.createRoot (node_modules/react-dom/client.js:12:16)
      at createConcurrentRoot (node_modules/@testing-library/react/dist/pure.js:147:27)
      at render (node_modules/@testing-library/react/dist/pure.js:266:12)
      at renderHook (node_modules/@testing-library/react/dist/pure.js:340:7)
      at Object.<anonymous> (src/services/__tests__/dataExportService.test.ts:530:34)

  ● useDataExport hook › should handle export errors

    createRoot(...): Target container is not a DOM element.

    [0m [90m 553 |[39m
     [90m 554 |[39m   it([32m'should handle export errors'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 555 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useDataExport())[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 556 |[39m
     [90m 557 |[39m     [36mconst[39m mockOptions[33m:[39m [33mExportOptions[39m [33m=[39m {
     [90m 558 |[39m       format[33m:[39m [32m'invalid'[39m [36mas[39m any[33m,[39m[0m

      at createRoot (node_modules/react-dom/cjs/react-dom.development.js:29384:11)
      at Object.createRoot$1 [as createRoot] (node_modules/react-dom/cjs/react-dom.development.js:29855:10)
      at Object.<anonymous>.exports.createRoot (node_modules/react-dom/client.js:12:16)
      at createConcurrentRoot (node_modules/@testing-library/react/dist/pure.js:147:27)
      at render (node_modules/@testing-library/react/dist/pure.js:266:12)
      at renderHook (node_modules/@testing-library/react/dist/pure.js:340:7)
      at Object.<anonymous> (src/services/__tests__/dataExportService.test.ts:555:34)

  ● useDataExport hook › should delete all data

    createRoot(...): Target container is not a DOM element.

    [0m [90m 575 |[39m
     [90m 576 |[39m   it([32m'should delete all data'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 577 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useDataExport())[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 578 |[39m
     [90m 579 |[39m     [36mawait[39m act([36masync[39m () [33m=>[39m {
     [90m 580 |[39m       [36mawait[39m result[33m.[39mcurrent[33m.[39mdeleteAllData()[33m;[39m[0m

      at createRoot (node_modules/react-dom/cjs/react-dom.development.js:29384:11)
      at Object.createRoot$1 [as createRoot] (node_modules/react-dom/cjs/react-dom.development.js:29855:10)
      at Object.<anonymous>.exports.createRoot (node_modules/react-dom/client.js:12:16)
      at createConcurrentRoot (node_modules/@testing-library/react/dist/pure.js:147:27)
      at render (node_modules/@testing-library/react/dist/pure.js:266:12)
      at renderHook (node_modules/@testing-library/react/dist/pure.js:340:7)
      at Object.<anonymous> (src/services/__tests__/dataExportService.test.ts:577:34)

  ● useDataExport hook › should delete specific data type

    createRoot(...): Target container is not a DOM element.

    [0m [90m 586 |[39m
     [90m 587 |[39m   it([32m'should delete specific data type'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 588 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useDataExport())[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 589 |[39m
     [90m 590 |[39m     [36mawait[39m act([36masync[39m () [33m=>[39m {
     [90m 591 |[39m       [36mawait[39m result[33m.[39mcurrent[33m.[39mdeleteDataType([32m'mood'[39m)[33m;[39m[0m

      at createRoot (node_modules/react-dom/cjs/react-dom.development.js:29384:11)
      at Object.createRoot$1 [as createRoot] (node_modules/react-dom/cjs/react-dom.development.js:29855:10)
      at Object.<anonymous>.exports.createRoot (node_modules/react-dom/client.js:12:16)
      at createConcurrentRoot (node_modules/@testing-library/react/dist/pure.js:147:27)
      at render (node_modules/@testing-library/react/dist/pure.js:266:12)
      at renderHook (node_modules/@testing-library/react/dist/pure.js:340:7)
      at Object.<anonymous> (src/services/__tests__/dataExportService.test.ts:588:34)

  ● useDataExport hook › should get data inventory

    createRoot(...): Target container is not a DOM element.

    [0m [90m 601 |[39m     })[33m;[39m
     [90m 602 |[39m
    [31m[1m>[22m[39m[90m 603 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useDataExport())[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 604 |[39m
     [90m 605 |[39m     [36mconst[39m inventory [33m=[39m result[33m.[39mcurrent[33m.[39mgetDataInventory()[33m;[39m
     [90m 606 |[39m[0m

      at createRoot (node_modules/react-dom/cjs/react-dom.development.js:29384:11)
      at Object.createRoot$1 [as createRoot] (node_modules/react-dom/cjs/react-dom.development.js:29855:10)
      at Object.<anonymous>.exports.createRoot (node_modules/react-dom/client.js:12:16)
      at createConcurrentRoot (node_modules/@testing-library/react/dist/pure.js:147:27)
      at render (node_modules/@testing-library/react/dist/pure.js:266:12)
      at renderHook (node_modules/@testing-library/react/dist/pure.js:340:7)
      at Object.<anonymous> (src/services/__tests__/dataExportService.test.ts:603:34)

  ● useDataExport hook › should get data retention info

    createRoot(...): Target container is not a DOM element.

    [0m [90m 609 |[39m
     [90m 610 |[39m   it([32m'should get data retention info'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 611 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useDataExport())[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 612 |[39m
     [90m 613 |[39m     [36mconst[39m retentionInfo [33m=[39m result[33m.[39mcurrent[33m.[39mgetDataRetentionInfo()[33m;[39m
     [90m 614 |[39m[0m

      at createRoot (node_modules/react-dom/cjs/react-dom.development.js:29384:11)
      at Object.createRoot$1 [as createRoot] (node_modules/react-dom/cjs/react-dom.development.js:29855:10)
      at Object.<anonymous>.exports.createRoot (node_modules/react-dom/client.js:12:16)
      at createConcurrentRoot (node_modules/@testing-library/react/dist/pure.js:147:27)
      at render (node_modules/@testing-library/react/dist/pure.js:266:12)
      at renderHook (node_modules/@testing-library/react/dist/pure.js:340:7)
      at Object.<anonymous> (src/services/__tests__/dataExportService.test.ts:611:34)

FAIL src/services/__tests__/culturalContextService.test.ts
  ● CulturalContextService › Performance and Immutability › should not modify internal data when returning contexts

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 2

    @@ -1,8 +1,8 @@
      Object {
        "ar": Object {
    -     "communicationStyle": "indirect",
    +     "communicationStyle": "direct",
          "crisisEscalation": "authority-based",
          "familyInvolvement": "family-centered",
          "mentalHealthStigma": "high",
          "region": "Arabic",
        },
    @@ -15,11 +15,11 @@
        },
        "es": Object {
          "communicationStyle": "contextual",
          "crisisEscalation": "gradual",
          "familyInvolvement": "family-centered",
    -     "mentalHealthStigma": "high",
    +     "mentalHealthStigma": "low",
          "region": "Hispanic/Latino",
        },
        "pt": Object {
          "communicationStyle": "contextual",
          "crisisEscalation": "gradual",

    [0m [90m 464 |[39m       [90m// Internal data should remain unchanged[39m
     [90m 465 |[39m       [36mconst[39m currentContexts [33m=[39m (service [36mas[39m any)[33m.[39mculturalContexts[33m;[39m
    [31m[1m>[22m[39m[90m 466 |[39m       expect(currentContexts)[33m.[39mtoEqual(originalContexts)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 467 |[39m     })[33m;[39m
     [90m 468 |[39m
     [90m 469 |[39m     test([32m'should handle rapid successive calls efficiently'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/culturalContextService.test.ts:466:31)

FAIL src/services/__tests__/crisisEscalationWorkflowService.test.ts
  ● CrisisEscalationWorkflowService › Workflow Management › should auto-escalate if no response

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 197 |[39m       expect(escalation)[33m.[39mtoBeDefined()[33m;[39m
     [90m 198 |[39m       expect(escalation[33m.[39mtier)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 199 |[39m       expect(escalation[33m.[39mescalatedTo)[33m.[39mtoBeDefined()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 200 |[39m     })[33m;[39m
     [90m 201 |[39m   })[33m;[39m
     [90m 202 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisEscalationWorkflowService.test.ts:199:38)

FAIL src/hooks/useAnimations.test.ts (9.779 s)
  ● useScrollAnimation Hook › should set up IntersectionObserver with correct threshold

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: Any<Function>, {"threshold": 0.5}

    Number of calls: 0

    [0m [90m 61 |[39m     renderHook(() [33m=>[39m useScrollAnimation(threshold))[33m;[39m
     [90m 62 |[39m     
    [31m[1m>[22m[39m[90m 63 |[39m     expect(mockIntersectionObserver)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                                      [31m[1m^[22m[39m
     [90m 64 |[39m       expect[33m.[39many([33mFunction[39m)[33m,[39m
     [90m 65 |[39m       { threshold }
     [90m 66 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useAnimations.test.ts:63:38)

  ● useScrollAnimation Hook › should update visibility when intersection changes

    TypeError: callback is not a function

    [0m [90m 85 |[39m     [90m// Simulate intersection[39m
     [90m 86 |[39m     act(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 87 |[39m       callback([{ isIntersecting[33m:[39m [36mtrue[39m }])[33m;[39m
     [90m    |[39m       [31m[1m^[22m[39m
     [90m 88 |[39m     })[33m;[39m
     [90m 89 |[39m
     [90m 90 |[39m     expect(result[33m.[39mcurrent[33m.[39misVisible)[33m.[39mtoBe([36mtrue[39m)[33m;[39m[0m

      at src/hooks/useAnimations.test.ts:87:7
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.<anonymous> (src/hooks/useAnimations.test.ts:86:8)

  ● useScrollAnimation Hook › should clean up observer on unmount

    ReferenceError: mockDisconnect is not defined

    [0m [90m 103 |[39m     unmount()[33m;[39m
     [90m 104 |[39m     
    [31m[1m>[22m[39m[90m 105 |[39m     expect(mockDisconnect)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 106 |[39m   })[33m;[39m
     [90m 107 |[39m })[33m;[39m
     [90m 108 |[39m[0m

      at Object.<anonymous> (src/hooks/useAnimations.test.ts:105:12)

  ● useStaggeredAnimation Hook › should trigger staggered animations with correct delays

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 141 |[39m     })[33m;[39m
     [90m 142 |[39m     expect(result[33m.[39mcurrent[33m.[39misItemAnimated([35m0[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 143 |[39m     expect(result[33m.[39mcurrent[33m.[39misItemAnimated([35m1[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 144 |[39m
     [90m 145 |[39m     [90m// Advance time and check second item[39m
     [90m 146 |[39m     act(() [33m=>[39m {[0m

      at Object.<anonymous> (src/hooks/useAnimations.test.ts:143:46)

  ● useLoadingState Hook › should stop loading immediately if minimum duration exceeded

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 421 |[39m
     [90m 422 |[39m     expect(result[33m.[39mcurrent[33m.[39misLoading)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 423 |[39m     expect(result[33m.[39mcurrent[33m.[39mshowLoading)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                                        [31m[1m^[22m[39m
     [90m 424 |[39m   })[33m;[39m
     [90m 425 |[39m })[33m;[39m
     [90m 426 |[39m[0m

      at Object.<anonymous> (src/hooks/useAnimations.test.ts:423:40)

  ● useAnimationSequence Hook › should execute animation sequence with delays

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 459 |[39m
     [90m 460 |[39m     [90m// Execute first step immediately[39m
    [31m[1m>[22m[39m[90m 461 |[39m     expect(step1)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 462 |[39m     expect(result[33m.[39mcurrent[33m.[39mcurrentStep)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m 463 |[39m
     [90m 464 |[39m     [90m// Execute second step after delay[39m[0m

      at Object.<anonymous> (src/hooks/useAnimations.test.ts:461:19)

  ● useAnimationSequence Hook › should not start sequence if already playing

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 495 |[39m     })[33m;[39m
     [90m 496 |[39m
    [31m[1m>[22m[39m[90m 497 |[39m     expect(step1)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 498 |[39m   })[33m;[39m
     [90m 499 |[39m
     [90m 500 |[39m   it([32m'should reset sequence'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/hooks/useAnimations.test.ts:497:19)

FAIL src/utils/ApiClient.test.ts (9.708 s)
  ● ApiClient › Initialization › should detect Netlify Dev environment

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "✓ Running through Netlify Dev - API functions available"

    Number of calls: 0

    [0m [90m 141 |[39m       [36mawait[39m [33mApiClient[39m[33m.[39minitialize()[33m;[39m
     [90m 142 |[39m       
    [31m[1m>[22m[39m[90m 143 |[39m       expect(consoleSpy)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 144 |[39m         [32m'✓ Running through Netlify Dev - API functions available'[39m
     [90m 145 |[39m       )[33m;[39m
     [90m 146 |[39m       [0m

      at Object.<anonymous> (src/utils/ApiClient.test.ts:143:26)

  ● ApiClient › Resources API › should fetch resources

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:161:22)

  ● ApiClient › Assessments API › should submit PHQ-9 result

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:185:22)

  ● ApiClient › Assessments API › should submit GAD-7 result

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:215:22)

  ● ApiClient › Assessments API › should get assessment history

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:248:22)

  ● ApiClient › Habits API › should get predefined habits

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:267:22)

  ● ApiClient › Habits API › should track habit

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:282:7)

  ● ApiClient › Habits API › should log habit completion

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:309:22)

  ● ApiClient › Mood API › should post mood check-in

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:354:22)

  ● ApiClient › Mood API › should get mood history

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:378:22)

  ● ApiClient › Journal API › should get journal entries with demo data fallback

    SyntaxError: Unexpected token 'd', "demo-token" is not valid JSON
        at JSON.parse (<anonymous>)

    [0m [90m 57 |[39m     [36mif[39m ([33m![39mdemoUser) [36mreturn[39m [36mnull[39m[33m;[39m
     [90m 58 |[39m     
    [31m[1m>[22m[39m[90m 59 |[39m     [36mconst[39m user [33m=[39m [33mJSON[39m[33m.[39mparse(demoUser)[33m;[39m
     [90m    |[39m                       [31m[1m^[22m[39m
     [90m 60 |[39m     [36mif[39m (user[33m.[39muserType [33m===[39m [32m'seeker'[39m) [36mreturn[39m [32m'user'[39m[33m;[39m
     [90m 61 |[39m     [36mif[39m (user[33m.[39muserType [33m===[39m [32m'helper'[39m) [36mreturn[39m [32m'helper'[39m[33m;[39m
     [90m 62 |[39m     [36mif[39m (user[33m.[39muserType [33m===[39m [32m'admin'[39m) [36mreturn[39m [32m'admin'[39m[33m;[39m[0m

      at getDemoUserType (src/utils/ApiClient.ts:59:23)
      at getDemoDataOrCallApi (src/utils/ApiClient.ts:71:26)
      at Object.getEntries (src/utils/ApiClient.ts:222:20)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:392:46)

  ● ApiClient › Journal API › should post journal entry

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:412:22)

  ● ApiClient › Videos API › should get wellness videos

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:444:22)

  ● ApiClient › Videos API › should like video

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:461:22)

  ● ApiClient › Videos API › should upload video

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)

  ● ApiClient › Safety Plan API › should get safety plan

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:519:22)

  ● ApiClient › Safety Plan API › should save safety plan

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:539:7)

  ● ApiClient › Legal API › should check consent

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:567:22)

  ● ApiClient › Legal API › should record consent

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:582:7)

  ● ApiClient › Error Handling › should handle 401 unauthorized responses

    expect(received).rejects.toThrow(expected)

    Expected substring: "Unauthorized"
    Received message:   "Demo mode - API skipped"

        [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
         [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
        [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
         [90m     |[39m                          [31m[1m^[22m[39m
         [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
         [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
         [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:676:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:676:64)

  ● ApiClient › Error Handling › should handle network errors

    expect(received).rejects.toThrow(expected)

    Expected substring: "Network error"
    Received message:   "Demo mode - API skipped"

        [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
         [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
        [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
         [90m     |[39m                          [31m[1m^[22m[39m
         [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
         [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
         [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:690:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:690:64)

  ● ApiClient › Error Handling › should handle non-JSON error responses

    expect(received).rejects.toThrow(expected)

    Expected substring: "Request failed with status 500"
    Received message:   "Demo mode - API skipped"

        [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
         [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
        [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
         [90m     |[39m                          [31m[1m^[22m[39m
         [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
         [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
         [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:703:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:703:64)

  ● ApiClient › Error Handling › should handle HTML responses in development

    expect(received).rejects.toThrow(expected)

    Expected substring: "API endpoint not available in development mode"
    Received message:   "Demo mode - API skipped"

        [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
         [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
        [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
         [90m     |[39m                          [31m[1m^[22m[39m
         [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
         [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
         [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:716:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:716:64)

  ● ApiClient › Error Handling › should handle successful HTML responses in development

    expect(received).rejects.toThrow(expected)

    Expected substring: "API endpoint not available in development mode"
    Received message:   "Demo mode - API skipped"

        [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
         [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
        [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
         [90m     |[39m                          [31m[1m^[22m[39m
         [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
         [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
         [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:729:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:729:64)

  ● ApiClient › Authentication › should include authorization header when token is present

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:745:7)

  ● ApiClient › Authentication › should not include authorization header when token is not present

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:766:7)

  ● ApiClient › Demo Mode › should detect demo mode with demo_token

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "demo_token"

    Number of calls: 0

    [0m [90m 778 |[39m
     [90m 779 |[39m       [90m// This is tested indirectly through the journal API which uses demo data[39m
    [31m[1m>[22m[39m[90m 780 |[39m       expect(localStorage[33m.[39mgetItem)[33m.[39mtoHaveBeenCalledWith([32m'demo_token'[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 781 |[39m     })[33m;[39m
     [90m 782 |[39m
     [90m 783 |[39m     test([32m'should detect demo mode with environment variable'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/utils/ApiClient.test.ts:780:36)

  ● ApiClient › Dilemmas API › should post dilemma

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:826:22)

  ● ApiClient › Helpers API › should get online helper count

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/.netlify/functions/helpers/online-count", ObjectContaining {"headers": ObjectContaining {"Authorization": ""}}

    Number of calls: 0

    [0m [90m 863 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m [33mApiClient[39m[33m.[39mhelpers[33m.[39mgetOnlineHelperCount()[33m;[39m
     [90m 864 |[39m
    [31m[1m>[22m[39m[90m 865 |[39m       expect(mockFetch)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 866 |[39m         [32m'/.netlify/functions/helpers/online-count'[39m[33m,[39m
     [90m 867 |[39m         expect[33m.[39mobjectContaining({
     [90m 868 |[39m           headers[33m:[39m expect[33m.[39mobjectContaining({[0m

      at Object.<anonymous> (src/utils/ApiClient.test.ts:865:25)

  ● ApiClient › AI API › should handle chat request

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/.netlify/functions/ai", ObjectContaining {"body": "{\"messages\":[{\"id\":\"1\",\"sender\":\"user\",\"text\":\"Hello\",\"timestamp\":\"2023-01-01T00:00:00Z\"},{\"id\":\"2\",\"sender\":\"ai\",\"text\":\"Hi there!\",\"timestamp\":\"2023-01-01T00:00:01Z\"}],\"systemInstruction\":\"Be helpful\"}", "method": "POST"}

    Number of calls: 0

    [0m [90m 903 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m [33mApiClient[39m[33m.[39mai[33m.[39mchat(messages[33m,[39m systemInstruction)[33m;[39m
     [90m 904 |[39m
    [31m[1m>[22m[39m[90m 905 |[39m       expect(mockFetch)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 906 |[39m         [32m'/.netlify/functions/ai'[39m[33m,[39m
     [90m 907 |[39m         expect[33m.[39mobjectContaining({
     [90m 908 |[39m           method[33m:[39m [32m'POST'[39m[33m,[39m[0m

      at Object.<anonymous> (src/utils/ApiClient.test.ts:905:25)

  ● ApiClient › AI API › should throw error on invalid AI response

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"metadata": {"error": true}, "response": "I'm having trouble connecting right now. Please try again in a moment."}

    [0m [90m 921 |[39m       } [36mas[39m any)[33m;[39m
     [90m 922 |[39m
    [31m[1m>[22m[39m[90m 923 |[39m       [36mawait[39m expect(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 924 |[39m         [33mApiClient[39m[33m.[39mai[33m.[39mchat([][33m,[39m [32m'Be helpful'[39m)
     [90m 925 |[39m       )[33m.[39mrejects[33m.[39mtoThrow([32m'Received an invalid response from the AI service'[39m)[33m;[39m
     [90m 926 |[39m     })[33m;[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:923:13)

  ● ApiClient › Configuration › should use custom API URL when provided

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:949:7)

  ● ApiClient › Configuration › should use default Netlify Functions URL

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:966:7)

  ● ApiClient › Response Handling › should handle 204 No Content responses

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:983:22)

  ● ApiClient › Response Handling › should handle responses without content-type header

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:996:22)

  ● ApiClient › Performance › should handle concurrent API requests

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
          at async Promise.all (index 0)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:1022:23)

  ● ApiClient › Performance › should not interfere with parallel requests on error

    Demo mode - API skipped

    [0m [90m  95 |[39m     [90m// If in development and Netlify Functions aren't available, skip the API call entirely[39m
     [90m  96 |[39m     [36mif[39m (isDevelopment [33m&&[39m netlifyFunctionsAvailable [33m===[39m [36mfalse[39m) {
    [31m[1m>[22m[39m[90m  97 |[39m         [36mconst[39m devError [33m=[39m [36mnew[39m [33mError[39m([32m'Demo mode - API skipped'[39m) [36mas[39m [33mError[39m [33m&[39m { isDevelopmentError[33m?[39m[33m:[39m boolean }[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m  98 |[39m         devError[33m.[39misDevelopmentError [33m=[39m [36mtrue[39m[33m;[39m
     [90m  99 |[39m         [36mthrow[39m devError[33m;[39m
     [90m 100 |[39m     }[0m

      at _callApi (src/utils/ApiClient.ts:97:26)
          at async Promise.all (index 1)
      at Object.<anonymous> (src/utils/ApiClient.test.ts:1044:23)

FAIL tests/service-worker/cross-browser.test.ts
  ● Cross-Browser Compatibility › Mobile Browser Compatibility › should handle iOS Safari mobile

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Mobile Browser Compatibility › should handle Android Chrome mobile

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Mobile Browser Compatibility › should handle mobile-specific service worker features

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Progressive Enhancement › should provide fallbacks when service worker is not supported

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Progressive Enhancement › should provide cache fallbacks

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Progressive Enhancement › should handle offline detection across browsers

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Feature Detection › should detect IndexedDB support

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Feature Detection › should detect Web Workers support

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Feature Detection › should detect Fetch API support

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Feature Detection › should detect Promise support

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Feature Detection › should create feature detection utility

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Error Handling Across Browsers › should handle registration failures gracefully

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Error Handling Across Browsers › should handle cache operation failures

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● Cross-Browser Compatibility › Error Handling Across Browsers › should handle network failures consistently

    QuotaExceededError

    [0m [90m 283 |[39m       [90m// In private browsing, localStorage might throw[39m
     [90m 284 |[39m       (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 285 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'QuotaExceededError'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 286 |[39m       })[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [36mtry[39m {[0m

      at Object.<anonymous> (tests/service-worker/cross-browser.test.ts:285:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

FAIL src/hooks/useServiceWorker.test.ts (10.327 s)
  ● useServiceWorker Hook › should update online status when going offline

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 109 |[39m     })[33m;[39m
     [90m 110 |[39m
    [31m[1m>[22m[39m[90m 111 |[39m     expect(result[33m.[39mcurrent[33m.[39misOnline)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 112 |[39m   })[33m;[39m
     [90m 113 |[39m
     [90m 114 |[39m   it([32m'should update when service worker update is available'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/hooks/useServiceWorker.test.ts:111:37)

FAIL src/components/__tests__/Toast.test.tsx (9.956 s)
  ● Toast › ToastContainer Component › should render single toast

    TestingLibraryElementError: Unable to find an element with the text: Test toast message. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"toast-container"[39m
        [36m/>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 233 |[39m       render([33m<[39m[33mToastContainer[39m [33m/[39m[33m>[39m)[33m;[39m
     [90m 234 |[39m       
    [31m[1m>[22m[39m[90m 235 |[39m       expect(screen[33m.[39mgetByText(toast[33m.[39mmessage))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 236 |[39m     })[33m;[39m
     [90m 237 |[39m
     [90m 238 |[39m     it([32m'should render multiple toasts'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/__tests__/Toast.test.tsx:235:21)

  ● Toast › ToastContainer Component › should render multiple toasts

    TestingLibraryElementError: Unable to find an element with the text: First toast. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"toast-container"[39m
        [36m/>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 245 |[39m       render([33m<[39m[33mToastContainer[39m [33m/[39m[33m>[39m)[33m;[39m
     [90m 246 |[39m       
    [31m[1m>[22m[39m[90m 247 |[39m       expect(screen[33m.[39mgetByText([32m'First toast'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 248 |[39m       expect(screen[33m.[39mgetByText([32m'Second toast'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m 249 |[39m       expect(screen[33m.[39mgetByText([32m'Third toast'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m 250 |[39m     })[33m;[39m[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/__tests__/Toast.test.tsx:247:21)

  ● Toast › ToastContainer Component › should pass correct props to Toast components

    expect(received).toHaveLength(expected)

    Expected length: 2
    Received length: 0
    Received object: []

    [0m [90m 259 |[39m       
     [90m 260 |[39m       [36mconst[39m toasts [33m=[39m container[33m.[39mquerySelectorAll([32m'.toast'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 261 |[39m       expect(toasts)[33m.[39mtoHaveLength([35m2[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 262 |[39m       expect(toasts[[35m0[39m])[33m.[39mtoHaveClass([32m'toast-success'[39m)[33m;[39m
     [90m 263 |[39m       expect(toasts[[35m1[39m])[33m.[39mtoHaveClass([32m'toast-error'[39m)[33m;[39m
     [90m 264 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/components/__tests__/Toast.test.tsx:261:22)

  ● Toast › ToastContainer Component › should call removeToast when toast is dismissed

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "test-toast-1"

    Number of calls: 0

    [0m [90m 275 |[39m       })[33m;[39m
     [90m 276 |[39m       
    [31m[1m>[22m[39m[90m 277 |[39m       expect(mockRemoveToast)[33m.[39mtoHaveBeenCalledWith(toast[33m.[39mid)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 278 |[39m     })[33m;[39m
     [90m 279 |[39m
     [90m 280 |[39m     it([32m'should handle toasts with same message but different IDs'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/components/__tests__/Toast.test.tsx:277:31)

  ● Toast › ToastContainer Component › should handle toasts with same message but different IDs

    expect(received).toHaveLength(expected)

    Expected length: 2
    Received length: 0
    Received object: []

    [0m [90m 287 |[39m       
     [90m 288 |[39m       [36mconst[39m toasts [33m=[39m container[33m.[39mquerySelectorAll([32m'.toast'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 289 |[39m       expect(toasts)[33m.[39mtoHaveLength([35m2[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 290 |[39m       
     [90m 291 |[39m       [36mconst[39m messages [33m=[39m screen[33m.[39mgetAllByText([32m'Same message'[39m)[33m;[39m
     [90m 292 |[39m       expect(messages)[33m.[39mtoHaveLength([35m2[39m)[33m;[39m[0m

      at Object.<anonymous> (src/components/__tests__/Toast.test.tsx:289:22)

  ● Toast › ToastContainer Component › should maintain correct order of toasts

    expect(received).toHaveTextContent()

    received value must be a Node.
    Received has value: undefined

    [0m [90m 303 |[39m       
     [90m 304 |[39m       [36mconst[39m toastElements [33m=[39m container[33m.[39mquerySelectorAll([32m'.toast-message'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 305 |[39m       expect(toastElements[[35m0[39m])[33m.[39mtoHaveTextContent([32m'First'[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 306 |[39m       expect(toastElements[[35m1[39m])[33m.[39mtoHaveTextContent([32m'Second'[39m)[33m;[39m
     [90m 307 |[39m       expect(toastElements[[35m2[39m])[33m.[39mtoHaveTextContent([32m'Third'[39m)[33m;[39m
     [90m 308 |[39m     })[33m;[39m[0m

      at __EXTERNAL_MATCHER_TRAP__ (node_modules/expect/build/index.js:325:30)
      at Object.throwingMatcher [as toHaveTextContent] (node_modules/expect/build/index.js:326:15)
      at Object.<anonymous> (src/components/__tests__/Toast.test.tsx:305:32)

  ● Toast › Integration Tests › should handle rapid toast additions and removals

    TestingLibraryElementError: Unable to find an element with the text: First toast. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"toast-container"[39m
        [36m/>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 318 |[39m       [36mconst[39m { rerender } [33m=[39m render([33m<[39m[33mToastContainer[39m [33m/[39m[33m>[39m)[33m;[39m
     [90m 319 |[39m       
    [31m[1m>[22m[39m[90m 320 |[39m       expect(screen[33m.[39mgetByText(toast1[33m.[39mmessage))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 321 |[39m       
     [90m 322 |[39m       [90m// Add another toast[39m
     [90m 323 |[39m       mockToasts[33m.[39mpush(toast2)[33m;[39m[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/__tests__/Toast.test.tsx:320:21)

FAIL src/hooks/useCulturalCrisisDetection.test.ts (9.907 s)
  ● useCulturalCrisisDetection Hook › should handle analysis errors gracefully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[Cultural Crisis Detection Hook] Analysis failed:", [Error: Cultural analysis service unavailable]

    Number of calls: 0

    [0m [90m 165 |[39m     expect(analysisResult)[33m.[39mtoBeNull()[33m;[39m
     [90m 166 |[39m     expect(result[33m.[39mcurrent[33m.[39misAnalyzing)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 167 |[39m     expect(consoleSpy)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 168 |[39m       [32m'[Cultural Crisis Detection Hook] Analysis failed:'[39m[33m,[39m
     [90m 169 |[39m       analysisError
     [90m 170 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCulturalCrisisDetection.test.ts:167:24)

  ● useCulturalCrisisDetection Hook › should avoid analyzing same text repeatedly

    expect(received).toEqual(expected) // deep equality

    Expected: {"culturalBiasAdjustments": [{"adjustedValue": 25, "confidence": 0.85, "factor": "Western individualistic bias", "originalValue": 30}], "culturalContext": "Western", "culturalIndicators": [{"culturalRegions": ["Western", "English-speaking"], "culturalRelevance": 0.8, "phrase": "feeling isolated"}], "culturalInterventions": {"communityApproach": false, "culturalResources": ["Western counseling approaches"], "familyInvolvement": "medium", "languageSpecificResources": ["English mental health resources"], "religiousConsideration": false}, "culturallyAdjustedRisk": {"adjustedRisk": 25, "culturalFactors": ["western-individualistic-adjustment"], "originalRisk": 30}, "hasCrisisIndicators": false, "realTimeRisk": {"immediateRisk": 25, "recommendedInterventions": [{"description": "Connect with culturally appropriate counselor", "priority": 3}]}}
    Received: null

    [0m [90m 207 |[39m
     [90m 208 |[39m     expect(culturalCrisisDetectionService[33m.[39manalyzeCrisisWithCulturalContext)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 209 |[39m     expect(secondResult)[33m.[39mtoEqual(mockAnalysisResult)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 210 |[39m   })[33m;[39m
     [90m 211 |[39m
     [90m 212 |[39m   it([32m'should track analysis history when enabled'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/hooks/useCulturalCrisisDetection.test.ts:209:26)

  ● useCulturalCrisisDetection Hook › should call cultural bias detected callback

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ["Western individualistic bias"]

    Number of calls: 0

    [0m [90m 274 |[39m     })[33m;[39m
     [90m 275 |[39m
    [31m[1m>[22m[39m[90m 276 |[39m     expect(onCulturalBiasDetected)[33m.[39mtoHaveBeenCalledWith([[32m'Western individualistic bias'[39m])[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 277 |[39m   })[33m;[39m
     [90m 278 |[39m
     [90m 279 |[39m   it([32m'should call cultural intervention recommended callback'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/hooks/useCulturalCrisisDetection.test.ts:276:36)

  ● useCulturalCrisisDetection Hook › should call cultural intervention recommended callback

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 288 |[39m     })[33m;[39m
     [90m 289 |[39m
    [31m[1m>[22m[39m[90m 290 |[39m     expect(onCulturalInterventionRecommended)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                               [31m[1m^[22m[39m
     [90m 291 |[39m     expect(onCulturalInterventionRecommended)[33m.[39mtoHaveBeenCalledWith(
     [90m 292 |[39m       expect[33m.[39mobjectContaining({
     [90m 293 |[39m         familyInvolvement[33m:[39m [32m'medium'[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useCulturalCrisisDetection.test.ts:290:47)

  ● useCulturalCrisisDetection Hook › should provide debounced analysis

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 348 |[39m
     [90m 349 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 350 |[39m       expect(culturalCrisisDetectionService[33m.[39manalyzeCrisisWithCulturalContext)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                                                               [31m[1m^[22m[39m
     [90m 351 |[39m     }[33m,[39m { timeout[33m:[39m [35m1000[39m })[33m;[39m
     [90m 352 |[39m
     [90m 353 |[39m     expect(culturalCrisisDetectionService[33m.[39manalyzeCrisisWithCulturalContext)[33m.[39mtoHaveBeenCalledWith([0m

      at timeout (src/hooks/useCulturalCrisisDetection.test.ts:350:79)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at node_modules/@testing-library/dom/dist/wait-for.js:82:9

  ● useCulturalCrisisDetection Hook › should get cultural interventions

    expect(received).toContain(expected) // indexOf

    Expected value: "Family-centered crisis intervention approach recommended"
    Received array: []

    [0m [90m 374 |[39m     [36mconst[39m interventions [33m=[39m result[33m.[39mcurrent[33m.[39mgetCulturalInterventions()[33m;[39m
     [90m 375 |[39m
    [31m[1m>[22m[39m[90m 376 |[39m     expect(interventions)[33m.[39mtoContain([32m'Family-centered crisis intervention approach recommended'[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 377 |[39m     expect(interventions)[33m.[39mtoContain([32m'Western counseling approaches'[39m)[33m;[39m
     [90m 378 |[39m     expect(interventions)[33m.[39mtoContain([32m'English mental health resources'[39m)[33m;[39m
     [90m 379 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCulturalCrisisDetection.test.ts:376:27)

  ● useCulturalCrisisDetection Hook › should provide cultural feedback

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"actualRisk": 30, "culturalRegion": "Western", "culturallyAppropriate": true, "predictedRisk": 25, "text": "Test text"}

    Number of calls: 0

    [0m [90m 394 |[39m     })[33m;[39m
     [90m 395 |[39m
    [31m[1m>[22m[39m[90m 396 |[39m     expect(culturalCrisisDetectionService[33m.[39mupdateCulturalPatterns)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                                                   [31m[1m^[22m[39m
     [90m 397 |[39m       text[33m:[39m [32m'Test text'[39m[33m,[39m
     [90m 398 |[39m       culturalRegion[33m:[39m [32m'Western'[39m[33m,[39m
     [90m 399 |[39m       actualRisk[33m:[39m [35m30[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useCulturalCrisisDetection.test.ts:396:67)

  ● useCulturalCrisisDetection Hook › should clear analysis history

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 440 |[39m     [90m// Wait for state to be updated[39m
     [90m 441 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 442 |[39m       expect(result[33m.[39mcurrent[33m.[39manalysisHistory[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 443 |[39m     })[33m;[39m
     [90m 444 |[39m
     [90m 445 |[39m     expect(result[33m.[39mcurrent[33m.[39manalysisHistory)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m[0m

      at src/hooks/useCulturalCrisisDetection.test.ts:442:53
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at node_modules/@testing-library/dom/dist/wait-for.js:82:9

  ● useCulturalCrisisDetection Hook › should compute derived state correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 478 |[39m     })[33m;[39m
     [90m 479 |[39m
    [31m[1m>[22m[39m[90m 480 |[39m     expect(result[33m.[39mcurrent[33m.[39mrequiresFamilyInvolvement)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 481 |[39m     expect(result[33m.[39mcurrent[33m.[39mneedsCommunitySupport)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 482 |[39m     expect(result[33m.[39mcurrent[33m.[39mincludesReligiousSupport)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 483 |[39m     expect(result[33m.[39mcurrent[33m.[39mcurrentCulturalContext)[33m.[39mtoBe([32m'Western'[39m)[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCulturalCrisisDetection.test.ts:480:54)

  ● useCulturalCrisisDetection Hook › should handle cultural override in analysis

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "Test text", undefined, "en", "Asian"

    Number of calls: 0

    [0m [90m 494 |[39m     })[33m;[39m
     [90m 495 |[39m
    [31m[1m>[22m[39m[90m 496 |[39m     expect(culturalCrisisDetectionService[33m.[39manalyzeCrisisWithCulturalContext)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                                                             [31m[1m^[22m[39m
     [90m 497 |[39m       [32m'Test text'[39m[33m,[39m
     [90m 498 |[39m       undefined[33m,[39m
     [90m 499 |[39m       [32m'en'[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useCulturalCrisisDetection.test.ts:496:77)

FAIL src/hooks/useAIChat.test.ts (10.271 s)
  ● useAIChat Hook › should set typing indicator when sending message

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 224 |[39m     
     [90m 225 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 226 |[39m       expect(result[33m.[39mcurrent[33m.[39msession[33m.[39misTyping)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                               [31m[1m^[22m[39m
     [90m 227 |[39m     })[33m;[39m
     [90m 228 |[39m     
     [90m 229 |[39m     [36mawait[39m sendPromise[33m;[39m[0m

      at src/hooks/useAIChat.test.ts:226:47
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useAIChat Hook › should maintain message history across sends

    TypeError: Cannot read properties of null (reading 'sendMessage')

    [0m [90m 244 |[39m     
     [90m 245 |[39m     [36mawait[39m act([36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 246 |[39m       [36mawait[39m result[33m.[39mcurrent[33m.[39msendMessage([32m'First message'[39m)[33m;[39m
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 247 |[39m     })[33m;[39m
     [90m 248 |[39m     
     [90m 249 |[39m     [36mawait[39m act([36masync[39m () [33m=>[39m {[0m

      at src/hooks/useAIChat.test.ts:246:28
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.<anonymous> (src/hooks/useAIChat.test.ts:245:14)

FAIL src/components/safety/__tests__/CrisisAlertBanner.test.tsx (10.129 s)
  ● CrisisAlertBanner › Crisis Resources › should display crisis hotline number

    TestingLibraryElementError: Unable to find an element with the text: 988. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"crisis-alert-banner crisis-alert-banner--urgent"[39m
          [33mdata-testid[39m=[32m"crisis-alert-banner"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"crisis-alert-content"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-header"[39m
            [36m>[39m
              [36m<h3>[39m
                [0mYou're Not Alone - Help is Available 24/7[0m
              [36m</h3>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Close crisis alert"[39m
                [33mclass[39m=[32m"crisis-alert-close"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-resources"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
                [33mhref[39m=[32m"tel:findahelpline.com"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mCall [0m
                    [0mInternational Crisis Lines[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mfindahelpline.com[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</a>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mText Support[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mVisit website for local resources[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<p[39m
              [33mclass[39m=[32m"crisis-alert-message"[39m
            [36m>[39m
              [0mIf you're thinking about suicide, are worried about a friend or loved one, or would like emotional support, help is available.[0m
            [36m</p>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-actions"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-action-primary"[39m
                [33mhref[39m=[32m"https://findahelpline.com"[39m
                [33mrel[39m=[32m"noopener noreferrer"[39m
                [33mtarget[39m=[32m"_blank"[39m
              [36m>[39m
                [0mGet Help Now[0m
              [36m</a>[39m
              [36m<button[39m
                [33mclass[39m=[32m"crisis-action-secondary"[39m
              [36m>[39m
                [0mView All Resources[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 90 |[39m       )[33m;[39m
     [90m 91 |[39m
    [31m[1m>[22m[39m[90m 92 |[39m       expect(screen[33m.[39mgetByText([32m'988'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 93 |[39m       expect(screen[33m.[39mgetByText([35m/988 Suicide & Crisis Lifeline/i[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m 94 |[39m     })[33m;[39m
     [90m 95 |[39m[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:92:21)

  ● CrisisAlertBanner › Crisis Resources › should display text support option

    TestingLibraryElementError: Unable to find an element with the text: Text HOME to 741741. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"crisis-alert-banner crisis-alert-banner--urgent"[39m
          [33mdata-testid[39m=[32m"crisis-alert-banner"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"crisis-alert-content"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-header"[39m
            [36m>[39m
              [36m<h3>[39m
                [0mYou're Not Alone - Help is Available 24/7[0m
              [36m</h3>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Close crisis alert"[39m
                [33mclass[39m=[32m"crisis-alert-close"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-resources"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
                [33mhref[39m=[32m"tel:findahelpline.com"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mCall [0m
                    [0mInternational Crisis Lines[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mfindahelpline.com[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</a>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mText Support[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mVisit website for local resources[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<p[39m
              [33mclass[39m=[32m"crisis-alert-message"[39m
            [36m>[39m
              [0mIf you're thinking about suicide, are worried about a friend or loved one, or would like emotional support, help is available.[0m
            [36m</p>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-actions"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-action-primary"[39m
                [33mhref[39m=[32m"https://findahelpline.com"[39m
                [33mrel[39m=[32m"noopener noreferrer"[39m
                [33mtarget[39m=[32m"_blank"[39m
              [36m>[39m
                [0mGet Help Now[0m
              [36m</a>[39m
              [36m<button[39m
                [33mclass[39m=[32m"crisis-action-secondary"[39m
              [36m>[39m
                [0mView All Resources[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 105 |[39m       )[33m;[39m
     [90m 106 |[39m
    [31m[1m>[22m[39m[90m 107 |[39m       expect(screen[33m.[39mgetByText([32m'Text HOME to 741741'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 108 |[39m     })[33m;[39m
     [90m 109 |[39m
     [90m 110 |[39m     it([32m'should show emergency services for critical severity'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:107:21)

  ● CrisisAlertBanner › Crisis Resources › should show emergency services for critical severity

    expect(received).toBeInTheDocument()

    received value must be an HTMLElement or an SVGElement.
    Received has value: null

    [0m [90m 121 |[39m       [90m// The component shows 988 as the main crisis line[39m
     [90m 122 |[39m       [36mconst[39m phoneLink [33m=[39m container[33m.[39mquerySelector([32m'a[href="tel:988"]'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 123 |[39m       expect(phoneLink)[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 124 |[39m     })[33m;[39m
     [90m 125 |[39m
     [90m 126 |[39m     it([32m'should display location-specific resources when provided'[39m[33m,[39m () [33m=>[39m {[0m

      at __EXTERNAL_MATCHER_TRAP__ (node_modules/expect/build/index.js:325:30)
      at Object.throwingMatcher [as toBeInTheDocument] (node_modules/expect/build/index.js:326:15)
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:123:25)

  ● CrisisAlertBanner › Crisis Resources › should display location-specific resources when provided

    TestingLibraryElementError: Unable to find an element with the text: 988. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"crisis-alert-banner crisis-alert-banner--urgent"[39m
          [33mdata-testid[39m=[32m"crisis-alert-banner"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"crisis-alert-content"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-header"[39m
            [36m>[39m
              [36m<h3>[39m
                [0mYou're Not Alone - Help is Available 24/7[0m
              [36m</h3>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Close crisis alert"[39m
                [33mclass[39m=[32m"crisis-alert-close"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-resources"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
                [33mhref[39m=[32m"tel:findahelpline.com"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mCall [0m
                    [0mInternational Crisis Lines[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mfindahelpline.com[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</a>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mText Support[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mVisit website for local resources[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<p[39m
              [33mclass[39m=[32m"crisis-alert-message"[39m
            [36m>[39m
              [0mIf you're thinking about suicide, are worried about a friend or loved one, or would like emotional support, help is available.[0m
            [36m</p>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-actions"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-action-primary"[39m
                [33mhref[39m=[32m"https://findahelpline.com"[39m
                [33mrel[39m=[32m"noopener noreferrer"[39m
                [33mtarget[39m=[32m"_blank"[39m
              [36m>[39m
                [0mGet Help Now[0m
              [36m</a>[39m
              [36m<button[39m
                [33mclass[39m=[32m"crisis-action-secondary"[39m
              [36m>[39m
                [0mView All Resources[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 136 |[39m
     [90m 137 |[39m       [90m// Default resources should be US-based[39m
    [31m[1m>[22m[39m[90m 138 |[39m       expect(screen[33m.[39mgetByText([32m'988'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 139 |[39m     })[33m;[39m
     [90m 140 |[39m   })[33m;[39m
     [90m 141 |[39m[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:138:21)

  ● CrisisAlertBanner › Interactive Elements › should have clickable phone numbers

    expect(received).toBeInTheDocument()

    received value must be an HTMLElement or an SVGElement.
    Received has value: null

    [0m [90m 153 |[39m
     [90m 154 |[39m       [36mconst[39m phoneLink [33m=[39m container[33m.[39mquerySelector([32m'a[href="tel:988"]'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 155 |[39m       expect(phoneLink)[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 156 |[39m     })[33m;[39m
     [90m 157 |[39m
     [90m 158 |[39m     it([32m'should open chat support in new window'[39m[33m,[39m () [33m=>[39m {[0m

      at __EXTERNAL_MATCHER_TRAP__ (node_modules/expect/build/index.js:325:30)
      at Object.throwingMatcher [as toBeInTheDocument] (node_modules/expect/build/index.js:326:15)
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:155:25)

  ● CrisisAlertBanner › Accessibility › should be keyboard navigable

    expect(received).toBeInTheDocument()

    received value must be an HTMLElement or an SVGElement.
    Received has value: null

    [0m [90m 348 |[39m       [36mconst[39m helpLink [33m=[39m screen[33m.[39mgetByText([32m'Get Help Now'[39m)[33m;[39m
     [90m 349 |[39m
    [31m[1m>[22m[39m[90m 350 |[39m       expect(phoneLink)[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 351 |[39m       expect(helpLink)[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m 352 |[39m     })[33m;[39m
     [90m 353 |[39m[0m

      at __EXTERNAL_MATCHER_TRAP__ (node_modules/expect/build/index.js:325:30)
      at Object.throwingMatcher [as toBeInTheDocument] (node_modules/expect/build/index.js:326:15)
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:350:25)

  ● CrisisAlertBanner › Quick Actions › should show breathing exercise button

    TestingLibraryElementError: Unable to find an accessible element with the role "button" and name `/Breathing Exercise/i`

    Here are the accessible roles:

      heading:

      Name "You're Not Alone - Help is Available 24/7":
      [36m<h3 />[39m

      --------------------------------------------------
      button:

      Name "Close crisis alert":
      [36m<button[39m
        [33maria-label[39m=[32m"Close crisis alert"[39m
        [33mclass[39m=[32m"crisis-alert-close"[39m
      [36m/>[39m

      Name "View All Resources":
      [36m<button[39m
        [33mclass[39m=[32m"crisis-action-secondary"[39m
      [36m/>[39m

      --------------------------------------------------
      link:

      Name "Call International Crisis Lines findahelpline.com":
      [36m<a[39m
        [33mclass[39m=[32m"crisis-resource-item"[39m
        [33mhref[39m=[32m"tel:findahelpline.com"[39m
      [36m/>[39m

      Name "Get Help Now":
      [36m<a[39m
        [33mclass[39m=[32m"crisis-action-primary"[39m
        [33mhref[39m=[32m"https://findahelpline.com"[39m
        [33mrel[39m=[32m"noopener noreferrer"[39m
        [33mtarget[39m=[32m"_blank"[39m
      [36m/>[39m

      --------------------------------------------------
      strong:

      Name "":
      [36m<strong />[39m

      Name "":
      [36m<strong />[39m

      --------------------------------------------------
      paragraph:

      Name "":
      [36m<p[39m
        [33mclass[39m=[32m"crisis-alert-message"[39m
      [36m/>[39m

      --------------------------------------------------

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"crisis-alert-banner crisis-alert-banner--urgent"[39m
          [33mdata-testid[39m=[32m"crisis-alert-banner"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"crisis-alert-content"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-header"[39m
            [36m>[39m
              [36m<h3>[39m
                [0mYou're Not Alone - Help is Available 24/7[0m
              [36m</h3>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Close crisis alert"[39m
                [33mclass[39m=[32m"crisis-alert-close"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-resources"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
                [33mhref[39m=[32m"tel:findahelpline.com"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mCall [0m
                    [0mInternational Crisis Lines[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mfindahelpline.com[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</a>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mText Support[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mVisit website for local resources[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<p[39m
              [33mclass[39m=[32m"crisis-alert-message"[39m
            [36m>[39m
              [0mIf you're thinking about suicide, are worried about a friend or loved one, or would like emotional support, help is available.[0m
            [36m</p>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-actions"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-action-primary"[39m
                [33mhref[39m=[32m"https://findahelpline.com"[39m
                [33mrel[39m=[32m"noopener noreferrer"[39m
                [33mtarget[39m=[32m"_blank"[39m
              [36m>[39m
                [0mGet Help Now[0m
              [36m</a>[39m
              [36m<button[39m
                [33mclass[39m=[32m"crisis-action-secondary"[39m
              [36m>[39m
                [0mView All Resources[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 381 |[39m       )[33m;[39m
     [90m 382 |[39m
    [31m[1m>[22m[39m[90m 383 |[39m       expect(screen[33m.[39mgetByRole([32m'button'[39m[33m,[39m { name[33m:[39m [35m/Breathing Exercise/i[39m }))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 384 |[39m     })[33m;[39m
     [90m 385 |[39m
     [90m 386 |[39m     it([32m'should trigger breathing exercise overlay'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:383:21)

  ● CrisisAlertBanner › Quick Actions › should trigger breathing exercise overlay

    TestingLibraryElementError: Unable to find an accessible element with the role "button" and name `/Breathing Exercise/i`

    Here are the accessible roles:

      heading:

      Name "You're Not Alone - Help is Available 24/7":
      [36m<h3 />[39m

      --------------------------------------------------
      button:

      Name "Close crisis alert":
      [36m<button[39m
        [33maria-label[39m=[32m"Close crisis alert"[39m
        [33mclass[39m=[32m"crisis-alert-close"[39m
      [36m/>[39m

      Name "View All Resources":
      [36m<button[39m
        [33mclass[39m=[32m"crisis-action-secondary"[39m
      [36m/>[39m

      --------------------------------------------------
      link:

      Name "Call International Crisis Lines findahelpline.com":
      [36m<a[39m
        [33mclass[39m=[32m"crisis-resource-item"[39m
        [33mhref[39m=[32m"tel:findahelpline.com"[39m
      [36m/>[39m

      Name "Get Help Now":
      [36m<a[39m
        [33mclass[39m=[32m"crisis-action-primary"[39m
        [33mhref[39m=[32m"https://findahelpline.com"[39m
        [33mrel[39m=[32m"noopener noreferrer"[39m
        [33mtarget[39m=[32m"_blank"[39m
      [36m/>[39m

      --------------------------------------------------
      strong:

      Name "":
      [36m<strong />[39m

      Name "":
      [36m<strong />[39m

      --------------------------------------------------
      paragraph:

      Name "":
      [36m<p[39m
        [33mclass[39m=[32m"crisis-alert-message"[39m
      [36m/>[39m

      --------------------------------------------------

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"crisis-alert-banner crisis-alert-banner--urgent"[39m
          [33mdata-testid[39m=[32m"crisis-alert-banner"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"crisis-alert-content"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-header"[39m
            [36m>[39m
              [36m<h3>[39m
                [0mYou're Not Alone - Help is Available 24/7[0m
              [36m</h3>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Close crisis alert"[39m
                [33mclass[39m=[32m"crisis-alert-close"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-resources"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
                [33mhref[39m=[32m"tel:findahelpline.com"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mCall [0m
                    [0mInternational Crisis Lines[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mfindahelpline.com[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</a>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mText Support[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mVisit website for local resources[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<p[39m
              [33mclass[39m=[32m"crisis-alert-message"[39m
            [36m>[39m
              [0mIf you're thinking about suicide, are worried about a friend or loved one, or would like emotional support, help is available.[0m
            [36m</p>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-actions"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-action-primary"[39m
                [33mhref[39m=[32m"https://findahelpline.com"[39m
                [33mrel[39m=[32m"noopener noreferrer"[39m
                [33mtarget[39m=[32m"_blank"[39m
              [36m>[39m
                [0mGet Help Now[0m
              [36m</a>[39m
              [36m<button[39m
                [33mclass[39m=[32m"crisis-action-secondary"[39m
              [36m>[39m
                [0mView All Resources[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 398 |[39m       )[33m;[39m
     [90m 399 |[39m
    [31m[1m>[22m[39m[90m 400 |[39m       [36mconst[39m breathingButton [33m=[39m screen[33m.[39mgetByRole([32m'button'[39m[33m,[39m { name[33m:[39m [35m/Breathing Exercise/i[39m })[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 401 |[39m       fireEvent[33m.[39mclick(breathingButton)[33m;[39m
     [90m 402 |[39m
     [90m 403 |[39m       expect(onBreathingExercise)[33m.[39mtoHaveBeenCalled()[33m;[39m[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:400:38)

  ● CrisisAlertBanner › Responsive Design › should use icons only on very small screens

    TestingLibraryElementError: Unable to find an element with the text: 988. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"crisis-alert-banner crisis-alert-banner--urgent"[39m
          [33mdata-testid[39m=[32m"crisis-alert-banner"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"crisis-alert-content"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-header"[39m
            [36m>[39m
              [36m<h3>[39m
                [0mYou're Not Alone - Help is Available 24/7[0m
              [36m</h3>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Close crisis alert"[39m
                [33mclass[39m=[32m"crisis-alert-close"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-resources"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
                [33mhref[39m=[32m"tel:findahelpline.com"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mCall [0m
                    [0mInternational Crisis Lines[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mfindahelpline.com[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</a>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mText Support[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mVisit website for local resources[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<p[39m
              [33mclass[39m=[32m"crisis-alert-message"[39m
            [36m>[39m
              [0mIf you're thinking about suicide, are worried about a friend or loved one, or would like emotional support, help is available.[0m
            [36m</p>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-actions"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-action-primary"[39m
                [33mhref[39m=[32m"https://findahelpline.com"[39m
                [33mrel[39m=[32m"noopener noreferrer"[39m
                [33mtarget[39m=[32m"_blank"[39m
              [36m>[39m
                [0mGet Help Now[0m
              [36m</a>[39m
              [36m<button[39m
                [33mclass[39m=[32m"crisis-action-secondary"[39m
              [36m>[39m
                [0mView All Resources[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 536 |[39m
     [90m 537 |[39m       [90m// Check that the component still displays key information[39m
    [31m[1m>[22m[39m[90m 538 |[39m       expect(screen[33m.[39mgetByText([32m'988'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 539 |[39m       [90m// Icons should be present[39m
     [90m 540 |[39m       expect(container[33m.[39mquerySelector([32m'svg'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m 541 |[39m     })[33m;[39m[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:538:21)

  ● CrisisAlertBanner › Error Handling › should handle missing resources gracefully

    TestingLibraryElementError: Unable to find an element with the text: 988. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"crisis-alert-banner crisis-alert-banner--urgent"[39m
          [33mdata-testid[39m=[32m"crisis-alert-banner"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"crisis-alert-content"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-header"[39m
            [36m>[39m
              [36m<h3>[39m
                [0mYou're Not Alone - Help is Available 24/7[0m
              [36m</h3>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Close crisis alert"[39m
                [33mclass[39m=[32m"crisis-alert-close"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-resources"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
                [33mhref[39m=[32m"tel:findahelpline.com"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mCall [0m
                    [0mInternational Crisis Lines[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mfindahelpline.com[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</a>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-resource-item"[39m
              [36m>[39m
                [36m<svg[39m
                  [33maria-hidden[39m=[32m"true"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mheight[39m=[32m"24"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mstroke-linecap[39m=[32m"round"[39m
                  [33mstroke-linejoin[39m=[32m"round"[39m
                  [33mstroke-width[39m=[32m"2"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [33mwidth[39m=[32m"24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<div>[39m
                  [36m<strong>[39m
                    [0mText Support[0m
                  [36m</strong>[39m
                  [36m<span>[39m
                    [0mVisit website for local resources[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<p[39m
              [33mclass[39m=[32m"crisis-alert-message"[39m
            [36m>[39m
              [0mIf you're thinking about suicide, are worried about a friend or loved one, or would like emotional support, help is available.[0m
            [36m</p>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert-actions"[39m
            [36m>[39m
              [36m<a[39m
                [33mclass[39m=[32m"crisis-action-primary"[39m
                [33mhref[39m=[32m"https://findahelpline.com"[39m
                [33mrel[39m=[32m"noopener noreferrer"[39m
                [33mtarget[39m=[32m"_blank"[39m
              [36m>[39m
                [0mGet Help Now[0m
              [36m</a>[39m
              [36m<button[39m
                [33mclass[39m=[32m"crisis-action-secondary"[39m
              [36m>[39m
                [0mView All Resources[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 555 |[39m
     [90m 556 |[39m       [90m// Should still show default resources[39m
    [31m[1m>[22m[39m[90m 557 |[39m       expect(screen[33m.[39mgetByText([32m'988'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 558 |[39m     })[33m;[39m
     [90m 559 |[39m
     [90m 560 |[39m     it([32m'should handle click errors gracefully'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:557:21)

  ● CrisisAlertBanner › Error Handling › should handle click errors gracefully

    Dismiss error

    [0m [90m 561 |[39m       [36mconst[39m consoleSpy [33m=[39m jest[33m.[39mspyOn(console[33m,[39m [32m'error'[39m)[33m.[39mmockImplementation()[33m;[39m
     [90m 562 |[39m       [36mconst[39m onDismiss [33m=[39m jest[33m.[39mfn(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 563 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Dismiss error'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 564 |[39m       })[33m;[39m
     [90m 565 |[39m
     [90m 566 |[39m       render([0m

      at src/components/safety/__tests__/CrisisAlertBanner.test.tsx:563:15
      at handleClose (src/components/CrisisAlertBanner.tsx:19:14)
      at HTMLUnknownElement.callCallback (node_modules/react-dom/cjs/react-dom.development.js:4164:14)
      at HTMLUnknownElement.callTheUserObjectsOperation (node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
      at innerInvokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
      at invokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
      at HTMLUnknownElementImpl._dispatch (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
      at HTMLUnknownElementImpl.dispatchEvent (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
      at HTMLUnknownElement.dispatchEvent (node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
      at Object.invokeGuardedCallbackDev (node_modules/react-dom/cjs/react-dom.development.js:4213:16)
      at invokeGuardedCallback (node_modules/react-dom/cjs/react-dom.development.js:4277:31)
      at invokeGuardedCallbackAndCatchFirstError (node_modules/react-dom/cjs/react-dom.development.js:4291:25)
      at executeDispatch (node_modules/react-dom/cjs/react-dom.development.js:9041:3)
      at processDispatchQueueItemsInOrder (node_modules/react-dom/cjs/react-dom.development.js:9073:7)
      at processDispatchQueue (node_modules/react-dom/cjs/react-dom.development.js:9086:5)
      at dispatchEventsForPlugins (node_modules/react-dom/cjs/react-dom.development.js:9097:3)
      at node_modules/react-dom/cjs/react-dom.development.js:9288:12
      at batchedUpdates$1 (node_modules/react-dom/cjs/react-dom.development.js:26179:12)
      at batchedUpdates (node_modules/react-dom/cjs/react-dom.development.js:3991:12)
      at dispatchEventForPluginEventSystem (node_modules/react-dom/cjs/react-dom.development.js:9287:3)
      at dispatchEventWithEnableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay (node_modules/react-dom/cjs/react-dom.development.js:6465:5)
      at dispatchEvent (node_modules/react-dom/cjs/react-dom.development.js:6457:5)
      at dispatchDiscreteEvent (node_modules/react-dom/cjs/react-dom.development.js:6430:5)
      at HTMLDivElement.callTheUserObjectsOperation (node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
      at innerInvokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
      at invokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
      at HTMLButtonElementImpl._dispatch (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
      at HTMLButtonElementImpl.dispatchEvent (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
      at HTMLButtonElement.dispatchEvent (node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
      at node_modules/@testing-library/dom/dist/events.js:19:20
      at node_modules/@testing-library/react/dist/pure.js:108:16
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.eventWrapper (node_modules/@testing-library/react/dist/pure.js:107:28)
      at fireEvent (node_modules/@testing-library/dom/dist/events.js:12:35)
      at Function.fireEvent.<computed> [as click] (node_modules/@testing-library/dom/dist/events.js:110:36)
      at Function.fireEvent.<computed> [as click] (node_modules/@testing-library/react/dist/fire-event.js:15:52)
      at src/components/safety/__tests__/CrisisAlertBanner.test.tsx:579:30
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/components/safety/__tests__/CrisisAlertBanner.test.tsx:579:56)

FAIL src/services/__tests__/dataMigrationService.test.ts
  ● DataMigrationService › performMigration › should perform complete migration successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: 5
    Received: 3

    [0m [90m 87 |[39m       [36mconst[39m report [33m=[39m [36mawait[39m service[33m.[39mperformMigration(options)[33m;[39m
     [90m 88 |[39m
    [31m[1m>[22m[39m[90m 89 |[39m       expect(report[33m.[39mtotalKeys)[33m.[39mtoBe([35m5[39m)[33m;[39m [90m// Based on mocked keys[39m
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 90 |[39m       expect(report[33m.[39mmigratedKeys)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m 91 |[39m       expect(report[33m.[39mmigrationTime)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m 92 |[39m       expect(mockSecureStorage[33m.[39mexportData)[33m.[39mtoHaveBeenCalledWith([36mtrue[39m)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/dataMigrationService.test.ts:89:32)

  ● DataMigrationService › performMigration › should handle dry run without making changes

    expect(received).toBe(expected) // Object.is equality

    Expected: 5
    Received: 2

    [0m [90m 109 |[39m       [36mconst[39m report [33m=[39m [36mawait[39m service[33m.[39mperformMigration(options)[33m;[39m
     [90m 110 |[39m
    [31m[1m>[22m[39m[90m 111 |[39m       expect(report[33m.[39mtotalKeys)[33m.[39mtoBe([35m5[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 112 |[39m       expect(mockSecureStorage[33m.[39msetItem)[33m.[39mnot[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m 113 |[39m       expect(mockEncryptionService[33m.[39mmigrateExistingData)[33m.[39mnot[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m 114 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/dataMigrationService.test.ts:111:32)

  ● DataMigrationService › performMigration › should handle migration errors gracefully

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 124 |[39m       [36mconst[39m report [33m=[39m [36mawait[39m service[33m.[39mperformMigration()[33m;[39m
     [90m 125 |[39m
    [31m[1m>[22m[39m[90m 126 |[39m       expect(report[33m.[39mfailedKeys)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 127 |[39m       expect(report[33m.[39merrors)[33m.[39mtoContain(expect[33m.[39mstringContaining([32m'Storage error'[39m))[33m;[39m
     [90m 128 |[39m     })[33m;[39m
     [90m 129 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/dataMigrationService.test.ts:126:33)

  ● DataMigrationService › validateMigration › should validate successful migration

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 184 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m service[33m.[39mvalidateMigration()[33m;[39m
     [90m 185 |[39m
    [31m[1m>[22m[39m[90m 186 |[39m       expect(result[33m.[39misValid)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 187 |[39m       expect(result[33m.[39missues)[33m.[39mtoHaveLength([35m0[39m)[33m;[39m
     [90m 188 |[39m     })[33m;[39m
     [90m 189 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/dataMigrationService.test.ts:186:30)

  ● DataMigrationService › setupDataProtection › should use secure storage for sensitive keys

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● DataMigrationService › setupDataProtection › should use regular localStorage for non-sensitive keys

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● DataMigrationService › private methods › isSystemKey › should identify system keys correctly

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● DataMigrationService › private methods › isAlreadyEncrypted › should detect encrypted data correctly

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● DataMigrationService › private methods › shouldEncryptKey › should identify keys that need encryption

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● DataMigrationService › private methods › getAllLocalStorageKeys › should retrieve all localStorage keys

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● DataMigrationService › private methods › getAllLocalStorageKeys › should handle empty localStorage

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● DataMigrationService › private methods › createBackup › should create and store backup

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● DataMigrationService › private methods › logMigrationReport › should log migration report details

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● getDataMigrationService › should return singleton instance

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● useDataMigration hook › should provide migration methods

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● useDataMigration hook › should perform migration through hook

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● useDataMigration hook › should validate migration through hook

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● useDataMigration hook › should get migration status through hook

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

  ● useDataMigration hook › should setup data protection through hook

    TypeError: localStorage.getItem.mockClear is not a function

    [0m [90m 1229 |[39m   
     [90m 1230 |[39m   [90m// Reset all localStorage mocks[39m
    [31m[1m>[22m[39m[90m 1231 |[39m   (localStorage[33m.[39mgetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m      |[39m                                       [31m[1m^[22m[39m
     [90m 1232 |[39m   (localStorage[33m.[39msetItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1233 |[39m   (localStorage[33m.[39mremoveItem [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m
     [90m 1234 |[39m   (localStorage[33m.[39mclear [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockClear()[33m;[39m[0m

      at Object.<anonymous> (src/setupTests.ts:1231:39)

FAIL src/hooks/useCrisisStressTesting.test.tsx (10.484 s)
  ● useCrisisStressTesting Hook › should initialize with default state

    expect(received).toHaveLength(expected)

    Expected length: 2
    Received length: 0
    Received array:  []

    [0m [90m 40 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39mfailoverResults)[33m.[39mtoEqual([])[33m;[39m
     [90m 41 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39memergencyStatus[33m.[39mactive)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 42 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39mselectedScenarios)[33m.[39mtoHaveLength([35m2[39m)[33m;[39m [90m// All scenarios selected by default[39m
     [90m    |[39m                                                    [31m[1m^[22m[39m
     [90m 43 |[39m     expect(result[33m.[39mcurrent[33m.[39mstats)[33m.[39mtoBeNull()[33m;[39m
     [90m 44 |[39m     expect(result[33m.[39mcurrent[33m.[39misEmergency)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 45 |[39m     expect(result[33m.[39mcurrent[33m.[39mhasResults)[33m.[39mtoBe([36mfalse[39m)[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:42:52)

  ● useCrisisStressTesting Hook › should run crisis stress tests successfully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"maxConcurrentUsers": 1000, "scenarios": Any<Array>, "testDuration": 300}

    Number of calls: 0

    [0m [90m 80 |[39m     })[33m;[39m
     [90m 81 |[39m
    [31m[1m>[22m[39m[90m 82 |[39m     expect(crisisStressTestingSystem[33m.[39mrunCrisisStressTests)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                                                            [31m[1m^[22m[39m
     [90m 83 |[39m       expect[33m.[39mobjectContaining({
     [90m 84 |[39m         scenarios[33m:[39m expect[33m.[39many([33mArray[39m)[33m,[39m
     [90m 85 |[39m         maxConcurrentUsers[33m:[39m [35m1000[39m[33m,[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:82:60)

  ● useCrisisStressTesting Hook › should handle stress test failures

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 105 |[39m     })[33m;[39m
     [90m 106 |[39m
    [31m[1m>[22m[39m[90m 107 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39memergencyStatus[33m.[39mactive)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                         [31m[1m^[22m[39m
     [90m 108 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39memergencyStatus[33m.[39mreason)[33m.[39mtoContain([32m'Testing system failure'[39m)[33m;[39m
     [90m 109 |[39m     expect(result[33m.[39mcurrent[33m.[39misEmergency)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 110 |[39m     expect(onEmergencyBreak)[33m.[39mtoHaveBeenCalledWith(expect[33m.[39mstringContaining([32m'Testing system failure'[39m))[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:107:57)

  ● useCrisisStressTesting Hook › should detect critical safety failures and trigger emergency

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 136 |[39m
     [90m 137 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 138 |[39m       expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39memergencyStatus[33m.[39mactive)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                           [31m[1m^[22m[39m
     [90m 139 |[39m       expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39memergencyStatus[33m.[39mreason)[33m.[39mtoContain([32m'critical safety failures detected'[39m)[33m;[39m
     [90m 140 |[39m       expect(onEmergencyBreak)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m 141 |[39m     })[33m;[39m[0m

      at src/hooks/useCrisisStressTesting.test.tsx:138:59
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useCrisisStressTesting Hook › should run failover tests successfully

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 161 |[39m     })[33m;[39m
     [90m 162 |[39m
    [31m[1m>[22m[39m[90m 163 |[39m     expect(crisisStressTestingSystem[33m.[39mrunEmergencyFailoverTests)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                                                 [31m[1m^[22m[39m
     [90m 164 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39mfailoverResults)[33m.[39mtoEqual(mockFailoverResults)[33m;[39m
     [90m 165 |[39m     expect(result[33m.[39mcurrent[33m.[39mhasResults)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 166 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:163:65)

  ● useCrisisStressTesting Hook › should handle failover test errors

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 177 |[39m     })[33m;[39m
     [90m 178 |[39m
    [31m[1m>[22m[39m[90m 179 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39memergencyStatus[33m.[39mactive)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                         [31m[1m^[22m[39m
     [90m 180 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39memergencyStatus[33m.[39mreason)[33m.[39mtoContain([32m'Failover testing failure'[39m)[33m;[39m
     [90m 181 |[39m     expect(onEmergencyBreak)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m 182 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:179:57)

  ● useCrisisStressTesting Hook › should execute emergency stop

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 191 |[39m
     [90m 192 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39misTestingActive)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 193 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39memergencyStatus[33m.[39mactive)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                         [31m[1m^[22m[39m
     [90m 194 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39memergencyStatus[33m.[39mreason)[33m.[39mtoBe([32m'Manual emergency stop'[39m)[33m;[39m
     [90m 195 |[39m     expect(onEmergencyBreak)[33m.[39mtoHaveBeenCalledWith([32m'Manual emergency stop activated'[39m)[33m;[39m
     [90m 196 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:193:57)

  ● useCrisisStressTesting Hook › should clear emergency status

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 204 |[39m     })[33m;[39m
     [90m 205 |[39m
    [31m[1m>[22m[39m[90m 206 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39memergencyStatus[33m.[39mactive)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                         [31m[1m^[22m[39m
     [90m 207 |[39m
     [90m 208 |[39m     [90m// Then clear it[39m
     [90m 209 |[39m     act(() [33m=>[39m {[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:206:57)

  ● useCrisisStressTesting Hook › should update test configuration

    expect(received).toBe(expected) // Object.is equality

    Expected: 2000
    Received: 10

    [0m [90m 227 |[39m     })[33m;[39m
     [90m 228 |[39m
    [31m[1m>[22m[39m[90m 229 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39mtestConfig[33m.[39mmaxConcurrentUsers)[33m.[39mtoBe([35m2000[39m)[33m;[39m
     [90m     |[39m                                                                [31m[1m^[22m[39m
     [90m 230 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39mtestConfig[33m.[39mtestDuration)[33m.[39mtoBe([35m600[39m)[33m;[39m
     [90m 231 |[39m     [90m// Other config values should remain unchanged[39m
     [90m 232 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39mtestConfig[33m.[39mrampUpTime)[33m.[39mtoBe([35m30[39m)[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:229:64)

  ● useCrisisStressTesting Hook › should toggle scenario selection

    expect(received).toContain(expected) // indexOf

    Expected value: "scenario-1"
    Received array: []

    [0m [90m 237 |[39m
     [90m 238 |[39m     [90m// Initially all scenarios are selected[39m
    [31m[1m>[22m[39m[90m 239 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39mselectedScenarios)[33m.[39mtoContain([32m'scenario-1'[39m)[33m;[39m
     [90m     |[39m                                                    [31m[1m^[22m[39m
     [90m 240 |[39m
     [90m 241 |[39m     act(() [33m=>[39m {
     [90m 242 |[39m       result[33m.[39mcurrent[33m.[39mactions[33m.[39mtoggleScenario([32m'scenario-1'[39m)[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:239:52)

  ● useCrisisStressTesting Hook › should clear results

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 0
    Received array:  []

    [0m [90m 278 |[39m     })[33m;[39m
     [90m 279 |[39m
    [31m[1m>[22m[39m[90m 280 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39mtestResults)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 281 |[39m
     [90m 282 |[39m     [90m// Then clear results[39m
     [90m 283 |[39m     act(() [33m=>[39m {[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:280:46)

  ● useCrisisStressTesting Hook › should export results as JSON

    expect(received).toHaveProperty(path)

    Expected path: "timestamp"
    Received path: []

    Received value: {}

    [0m [90m 297 |[39m     [36mconst[39m parsedData [33m=[39m [33mJSON[39m[33m.[39mparse(exportedData)[33m;[39m
     [90m 298 |[39m
    [31m[1m>[22m[39m[90m 299 |[39m     expect(parsedData)[33m.[39mtoHaveProperty([32m'timestamp'[39m)[33m;[39m
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 300 |[39m     expect(parsedData)[33m.[39mtoHaveProperty([32m'testConfig'[39m)[33m;[39m
     [90m 301 |[39m     expect(parsedData)[33m.[39mtoHaveProperty([32m'selectedScenarios'[39m)[33m;[39m
     [90m 302 |[39m     expect(parsedData)[33m.[39mtoHaveProperty([32m'testResults'[39m)[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:299:24)

  ● useCrisisStressTesting Hook › should calculate test statistics correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 2
    Received: 0

    [0m [90m 342 |[39m     [36mconst[39m stats [33m=[39m result[33m.[39mcurrent[33m.[39mstats[33m;[39m
     [90m 343 |[39m     expect(stats)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 344 |[39m     expect(stats[33m![39m[33m.[39mtotal)[33m.[39mtoBe([35m2[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 345 |[39m     expect(stats[33m![39m[33m.[39msuccessful)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m 346 |[39m     expect(stats[33m![39m[33m.[39mfailed)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m 347 |[39m     expect(stats[33m![39m[33m.[39mcritical)[33m.[39mtoBe([35m1[39m)[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:344:26)

  ● useCrisisStressTesting Hook › should prevent concurrent test execution

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 368 |[39m     })[33m;[39m
     [90m 369 |[39m
    [31m[1m>[22m[39m[90m 370 |[39m     expect(result[33m.[39mcurrent[33m.[39mstate[33m.[39misTestingActive)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                  [31m[1m^[22m[39m
     [90m 371 |[39m     
     [90m 372 |[39m     [90m// Wait for first test to complete[39m
     [90m 373 |[39m     [36mawait[39m firstTest[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:370:50)

  ● useCrisisStressTesting Hook › should call onTestComplete callback when tests finish

    TypeError: Cannot read properties of null (reading 'actions')

    [0m [90m 398 |[39m
     [90m 399 |[39m     [36mawait[39m act([36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 400 |[39m       [36mawait[39m result[33m.[39mcurrent[33m.[39mactions[33m.[39mrunStressTests()[33m;[39m
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 401 |[39m     })[33m;[39m
     [90m 402 |[39m
     [90m 403 |[39m     expect(onTestComplete)[33m.[39mtoHaveBeenCalledWith(mockResults)[33m;[39m[0m

      at src/hooks/useCrisisStressTesting.test.tsx:400:28
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:399:14)

  ● useCrisisStressTesting Hook › should filter scenarios based on selection when running tests

    TypeError: Cannot read properties of null (reading 'actions')

    [0m [90m 409 |[39m     [90m// Deselect scenario-2[39m
     [90m 410 |[39m     act(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 411 |[39m       result[33m.[39mcurrent[33m.[39mactions[33m.[39mtoggleScenario([32m'scenario-2'[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 412 |[39m     })[33m;[39m
     [90m 413 |[39m
     [90m 414 |[39m     [36mconst[39m mockResults[33m:[39m unknown[] [33m=[39m [][33m;[39m[0m

      at src/hooks/useCrisisStressTesting.test.tsx:411:22
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:410:8)

  ● useCrisisStressTesting Hook › should set testing status during test execution

    TypeError: Cannot read properties of null (reading 'actions')

    [0m [90m 444 |[39m     [90m// Start test[39m
     [90m 445 |[39m     [36mawait[39m act([36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 446 |[39m       result[33m.[39mcurrent[33m.[39mactions[33m.[39mrunStressTests()[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 447 |[39m     })[33m;[39m
     [90m 448 |[39m
     [90m 449 |[39m     [90m// Should be in testing state[39m[0m

      at src/hooks/useCrisisStressTesting.test.tsx:446:22
      at node_modules/@testing-library/react/dist/act-compat.js:48:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at Object.<anonymous> (src/hooks/useCrisisStressTesting.test.tsx:445:14)

FAIL src/services/__tests__/notificationService.test.ts
  ● notificationService › setToastFunction › should set the toast function correctly

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › setToastFunction › should replace the previous toast function

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › setToastFunction › should accept undefined to clear the toast function

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is set › should call the toast function with message and default type

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is set › should call the toast function with message and specified type - success

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is set › should call the toast function with message and specified type - error

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is set › should call the toast function with message and specified type - info

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is set › should call the toast function with message and specified type - warning

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is set › should handle empty message strings

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is set › should handle long message strings

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is set › should handle special characters in messages

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is set › should handle multiple consecutive calls

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is not set › should warn and fall back to alert

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is not set › should fall back to alert with different message types

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is not set › should handle multiple fallback calls

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function is not set › should handle empty message in fallback

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › addToast › when toast function throws an error › should not handle errors from the toast function

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › integration scenarios › should work correctly after multiple function changes

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › integration scenarios › should maintain correct behavior with rapid successive calls

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › integration scenarios › should handle real-world usage pattern

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › type safety and edge cases › should handle null message gracefully

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › type safety and edge cases › should handle undefined message gracefully

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › type safety and edge cases › should work with numeric message converted to string

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › type safety and edge cases › should preserve message with whitespace

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

  ● notificationService › type safety and edge cases › should handle newlines in messages

    TypeError: notificationService_1.notificationService.setToastFunction is not a function

    [0m [90m 18 |[39m     
     [90m 19 |[39m     [90m// Reset the internal state by setting a new function[39m
    [31m[1m>[22m[39m[90m 20 |[39m     notificationService[33m.[39msetToastFunction(mockAddToast)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 21 |[39m   })[33m;[39m
     [90m 22 |[39m
     [90m 23 |[39m   afterEach(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/notificationService.test.ts:20:25)

FAIL src/stores/preferenceStore.test.ts
  ● preferenceStore › loadFilters action › should handle empty string in localStorage

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 161 |[39m       [36mconst[39m state [33m=[39m usePreferenceStore[33m.[39mgetState()[33m;[39m
     [90m 162 |[39m       expect(state[33m.[39mcontentFilters)[33m.[39mtoEqual([])[33m;[39m
    [31m[1m>[22m[39m[90m 163 |[39m       expect(console[33m.[39merror)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 164 |[39m       expect(localStorageMock[33m.[39mremoveItem)[33m.[39mtoHaveBeenCalledWith([32m'contentFilters'[39m)[33m;[39m
     [90m 165 |[39m     })[33m;[39m
     [90m 166 |[39m[0m

      at Object.<anonymous> (src/stores/preferenceStore.test.ts:163:29)

FAIL src/services/__tests__/enhancedOfflineService.test.ts
  ● EnhancedOfflineService › Offline Capabilities › should get offline capabilities

    expect(received).toHaveProperty(path)

    Expected path: "hasStorage"
    Received path: []

    Received value: {"canCache": true, "canSync": true}

    [0m [90m 72 |[39m       expect(capabilities)[33m.[39mtoBeDefined()[33m;[39m
     [90m 73 |[39m       [36mif[39m (capabilities) {
    [31m[1m>[22m[39m[90m 74 |[39m         expect(capabilities)[33m.[39mtoHaveProperty([32m'hasStorage'[39m)[33m;[39m
     [90m    |[39m                              [31m[1m^[22m[39m
     [90m 75 |[39m         expect(capabilities)[33m.[39mtoHaveProperty([32m'isOnline'[39m)[33m;[39m
     [90m 76 |[39m       }
     [90m 77 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:74:30)

  ● EnhancedOfflineService › Offline Capabilities › should handle status change listeners

    expect(received).toBe(expected) // Object.is equality

    Expected: "function"
    Received: "undefined"

    [0m [90m 82 |[39m       [36mconst[39m unsubscribe [33m=[39m enhancedOfflineService[33m.[39monStatusChange(mockCallback)[33m;[39m
     [90m 83 |[39m       
    [31m[1m>[22m[39m[90m 84 |[39m       expect([36mtypeof[39m unsubscribe)[33m.[39mtoBe([32m'function'[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 85 |[39m       unsubscribe()[33m;[39m
     [90m 86 |[39m     })[33m;[39m
     [90m 87 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:84:34)

  ● EnhancedOfflineService › Crisis Detection › should detect crisis offline

    TypeError: enhancedOfflineService_1.enhancedOfflineService.detectCrisisOffline is not a function

    [0m [90m 115 |[39m   describe([32m'Crisis Detection'[39m[33m,[39m () [33m=>[39m {
     [90m 116 |[39m     it([32m'should detect crisis offline'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 117 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedOfflineService[33m.[39mdetectCrisisOffline(
     [90m     |[39m                                                   [31m[1m^[22m[39m
     [90m 118 |[39m         [32m'I am feeling very stressed'[39m[33m,[39m
     [90m 119 |[39m         [32m'en'[39m[33m,[39m
     [90m 120 |[39m         [32m'western'[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:117:51)

  ● EnhancedOfflineService › Crisis Detection › should handle different languages in crisis detection

    TypeError: enhancedOfflineService_1.enhancedOfflineService.detectCrisisOffline is not a function

    [0m [90m 128 |[39m
     [90m 129 |[39m     it([32m'should handle different languages in crisis detection'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 130 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedOfflineService[33m.[39mdetectCrisisOffline(
     [90m     |[39m                                                   [31m[1m^[22m[39m
     [90m 131 |[39m         [32m'Me siento muy mal'[39m[33m,[39m
     [90m 132 |[39m         [32m'es'[39m[33m,[39m
     [90m 133 |[39m         [32m'hispanic'[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:130:51)

  ● EnhancedOfflineService › Crisis Detection › should provide appropriate recommendations

    TypeError: enhancedOfflineService_1.enhancedOfflineService.detectCrisisOffline is not a function

    [0m [90m 139 |[39m
     [90m 140 |[39m     it([32m'should provide appropriate recommendations'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 141 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedOfflineService[33m.[39mdetectCrisisOffline(
     [90m     |[39m                                                   [31m[1m^[22m[39m
     [90m 142 |[39m         [32m'I need help urgently'[39m[33m,[39m
     [90m 143 |[39m         [32m'en'[39m[33m,[39m
     [90m 144 |[39m         [32m'western'[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:141:51)

  ● EnhancedOfflineService › Sync Queue Management › should add items to sync queue

    expect(received).resolves.not.toThrow()

    Matcher error: received value must be a promise

    Received has value: undefined

    [0m [90m 162 |[39m       }[33m;[39m
     [90m 163 |[39m
    [31m[1m>[22m[39m[90m 164 |[39m       [36mawait[39m expect(enhancedOfflineService[33m.[39maddToSyncQueue(syncItem))[33m.[39mresolves[33m.[39mnot[33m.[39mtoThrow()[33m;[39m
     [90m     |[39m                                                                                  [31m[1m^[22m[39m
     [90m 165 |[39m     })[33m;[39m
     [90m 166 |[39m
     [90m 167 |[39m     it([32m'should handle different sync item types'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toThrow (node_modules/expect/build/index.js:162:13)
      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:164:82)

  ● EnhancedOfflineService › Sync Queue Management › should handle different sync item types

    expect(received).resolves.not.toThrow()

    Matcher error: received value must be a promise

    Received has value: undefined

    [0m [90m 186 |[39m
     [90m 187 |[39m       [36mfor[39m ([36mconst[39m item [36mof[39m syncItems) {
    [31m[1m>[22m[39m[90m 188 |[39m         [36mawait[39m expect(enhancedOfflineService[33m.[39maddToSyncQueue(item))[33m.[39mresolves[33m.[39mnot[33m.[39mtoThrow()[33m;[39m
     [90m     |[39m                                                                                [31m[1m^[22m[39m
     [90m 189 |[39m       }
     [90m 190 |[39m     })[33m;[39m
     [90m 191 |[39m   })[33m;[39m[0m

      at Object.toThrow (node_modules/expect/build/index.js:162:13)
      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:188:80)

  ● EnhancedOfflineService › Data Management › should update offline resources

    TypeError: enhancedOfflineService_1.enhancedOfflineService.updateOfflineResources is not a function

    [0m [90m 197 |[39m
     [90m 198 |[39m     it([32m'should update offline resources'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 199 |[39m       [36mawait[39m expect(enhancedOfflineService[33m.[39mupdateOfflineResources())[33m.[39mresolves[33m.[39mnot[33m.[39mtoThrow()[33m;[39m
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 200 |[39m     })[33m;[39m
     [90m 201 |[39m   })[33m;[39m
     [90m 202 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:199:43)

  ● EnhancedOfflineService › Error Handling › should handle crisis detection errors

    TypeError: enhancedOfflineService_1.enhancedOfflineService.detectCrisisOffline is not a function

    [0m [90m 221 |[39m     it([32m'should handle crisis detection errors'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 222 |[39m       [36mawait[39m expect(
    [31m[1m>[22m[39m[90m 223 |[39m         enhancedOfflineService[33m.[39mdetectCrisisOffline([32m''[39m[33m,[39m [32m''[39m[33m,[39m [32m''[39m)
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 224 |[39m       )[33m.[39mresolves[33m.[39mnot[33m.[39mtoThrow()[33m;[39m
     [90m 225 |[39m     })[33m;[39m
     [90m 226 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:223:32)

  ● EnhancedOfflineService › Error Handling › should handle sync queue errors

    expect(received).resolves.not.toThrow()

    Matcher error: received value must be a promise

    Received has value: undefined

    [0m [90m 235 |[39m       }[33m;[39m
     [90m 236 |[39m
    [31m[1m>[22m[39m[90m 237 |[39m       [36mawait[39m expect(enhancedOfflineService[33m.[39maddToSyncQueue(invalidSyncItem))[33m.[39mresolves[33m.[39mnot[33m.[39mtoThrow()[33m;[39m
     [90m     |[39m                                                                                         [31m[1m^[22m[39m
     [90m 238 |[39m     })[33m;[39m
     [90m 239 |[39m   })[33m;[39m
     [90m 240 |[39m[0m

      at Object.toThrow (node_modules/expect/build/index.js:162:13)
      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:237:89)

  ● EnhancedOfflineService › Service Lifecycle › should handle complete workflow

    TypeError: enhancedOfflineService_1.enhancedOfflineService.detectCrisisOffline is not a function

    [0m [90m 269 |[39m       expect([33mArray[39m[33m.[39misArray(resources))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 270 |[39m       
    [31m[1m>[22m[39m[90m 271 |[39m       [36mconst[39m detection [33m=[39m [36mawait[39m enhancedOfflineService[33m.[39mdetectCrisisOffline(
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 272 |[39m         [32m'test message'[39m[33m,[39m
     [90m 273 |[39m         [32m'en'[39m[33m,[39m
     [90m 274 |[39m         [32m'western'[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedOfflineService.test.ts:271:54)

FAIL src/hooks/usePerformanceMonitor.test.ts (10.342 s)
  ● usePerformanceMonitor Hook › should handle localStorage errors gracefully

    ReferenceError: setImmediate is not defined

    [0m [90m 288 |[39m     [36mawait[39m [33mPromise[39m[33m.[39mresolve()[33m;[39m
     [90m 289 |[39m     [90m// Flush any pending promises[39m
    [31m[1m>[22m[39m[90m 290 |[39m     [36mawait[39m [36mnew[39m [33mPromise[39m(resolve [33m=>[39m setImmediate(resolve))[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 291 |[39m   }[33m;[39m
     [90m 292 |[39m   
     [90m 293 |[39m   [90m// Helper to run all timers and flush promises[39m[0m

      at src/test-utils/performanceMocks.ts:290:34
      at advanceTimersAndFlushPromises (src/test-utils/performanceMocks.ts:290:11)
      at src/hooks/usePerformanceMonitor.test.ts:475:7

FAIL src/components/safety/__tests__/QuickExitButton.test.tsx
  ● Test suite failed to run

    TypeError: Converting circular structure to JSON
        --> starting at object with constructor 'HTMLButtonElement'
        |     property '__reactFiber$7q4cqzoj0mx' -> object with constructor 'FiberNode'
        --- property 'stateNode' closes the circle
        at stringify (<anonymous>)

      at messageParent (node_modules/jest-worker/build/workers/messageParent.js:29:19)

FAIL tests/unit/crisisEscalationIntegration.test.ts
  ● Crisis Escalation Integration Unit Tests › Crisis Escalation Workflow Integration › should integrate crisis escalation workflow for emergency cases

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 192 |[39m
     [90m 193 |[39m       [90m// Should detect crisis indicators[39m
    [31m[1m>[22m[39m[90m 194 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 195 |[39m       expect(result[33m.[39moverallSeverity)[33m.[39mtoBe([32m'emergency'[39m)[33m;[39m
     [90m 196 |[39m       expect(result[33m.[39memergencyServicesRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 197 |[39m       expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/unit/crisisEscalationIntegration.test.ts:194:42)

  ● Crisis Escalation Integration Unit Tests › Crisis Escalation Workflow Integration › should provide escalation recommendations without initiating when no userId

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 213 |[39m
     [90m 214 |[39m       [90m// Should detect crisis but not initiate escalation[39m
    [31m[1m>[22m[39m[90m 215 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 216 |[39m       expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 217 |[39m       
     [90m 218 |[39m       [90m// Should have escalation recommendations but not initiate[39m[0m

      at Object.<anonymous> (tests/unit/crisisEscalationIntegration.test.ts:215:42)

  ● Crisis Escalation Integration Unit Tests › Escalation Error Handling › should handle escalation service errors gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 283 |[39m
     [90m 284 |[39m       [90m// Should still provide crisis analysis[39m
    [31m[1m>[22m[39m[90m 285 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 286 |[39m       expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 287 |[39m
     [90m 288 |[39m       [90m// Should handle escalation error gracefully[39m[0m

      at Object.<anonymous> (tests/unit/crisisEscalationIntegration.test.ts:285:42)

  ● Crisis Escalation Integration Unit Tests › Performance and Timing › should complete analysis and escalation quickly

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 310 |[39m       expect(processingTime)[33m.[39mtoBeLessThan([35m1000[39m)[33m;[39m
     [90m 311 |[39m       expect(result[33m.[39manalysisMetadata[33m.[39mprocessingTime)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 312 |[39m       expect(result[33m.[39mescalationWorkflow[33m?[39m[33m.[39mescalationInitiated)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                              [31m[1m^[22m[39m
     [90m 313 |[39m     })[33m;[39m
     [90m 314 |[39m   })[33m;[39m
     [90m 315 |[39m })[33m;[39m[0m

      at Object.<anonymous> (tests/unit/crisisEscalationIntegration.test.ts:312:62)

FAIL src/services/__tests__/enhancedAiCrisisDetectionService.test.ts
  ● enhancedAICrisisDetectionService › AI Model Detection › should detect high-risk suicidal ideation

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.8
    Received:   0

    [0m [90m 30 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text)[33m;[39m
     [90m 31 |[39m       
    [31m[1m>[22m[39m[90m 32 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeGreaterThan([35m0.8[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 33 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 34 |[39m       expect(result[33m.[39mconfidence)[33m.[39mtoBeGreaterThan([35m0.8[39m)[33m;[39m
     [90m 35 |[39m       expect(result[33m.[39mriskFactors)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:32:34)

  ● enhancedAICrisisDetectionService › AI Model Detection › should identify self-harm indicators

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.5
    Received:   0.4

    [0m [90m 42 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text)[33m;[39m
     [90m 43 |[39m       
    [31m[1m>[22m[39m[90m 44 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeGreaterThan([35m0.5[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 45 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBeDefined()[33m;[39m
     [90m 46 |[39m       expect(result[33m.[39mriskFactors)[33m.[39mtoBeDefined()[33m;[39m
     [90m 47 |[39m       expect(result[33m.[39mriskFactors[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:44:34)

  ● enhancedAICrisisDetectionService › AI Model Detection › should detect substance abuse crisis

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.7
    Received:   0.4

    [0m [90m 53 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text)[33m;[39m
     [90m 54 |[39m       
    [31m[1m>[22m[39m[90m 55 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeGreaterThan([35m0.7[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 56 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 57 |[39m       expect(result[33m.[39mriskFactors)[33m.[39mtoBeDefined()[33m;[39m
     [90m 58 |[39m       expect(result[33m.[39mrecommendations)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:55:34)

  ● enhancedAICrisisDetectionService › Natural Language Understanding › should understand context and nuance

    expect(received).toBeLessThan(expected)

    Expected: < 0.3
    Received:   0.4

    [0m [90m 66 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text)[33m;[39m
     [90m 67 |[39m       
    [31m[1m>[22m[39m[90m 68 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeLessThan([35m0.3[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 69 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 70 |[39m       expect(result[33m.[39mconfidence)[33m.[39mtoBeDefined()[33m;[39m
     [90m 71 |[39m       expect(result[33m.[39mrecommendations)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:68:34)

  ● enhancedAICrisisDetectionService › Natural Language Understanding › should detect implied crisis without explicit keywords

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.5
    Received:   0

    [0m [90m 77 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text)[33m;[39m
     [90m 78 |[39m       
    [31m[1m>[22m[39m[90m 79 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeGreaterThan([35m0.5[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 80 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBeDefined()[33m;[39m
     [90m 81 |[39m       expect(result[33m.[39memotionalState)[33m.[39mtoBeDefined()[33m;[39m
     [90m 82 |[39m       expect(result[33m.[39mriskFactors[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:79:34)

  ● enhancedAICrisisDetectionService › Temporal Analysis › should detect urgency markers

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.8
    Received:   0

    [0m [90m 125 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text)[33m;[39m
     [90m 126 |[39m       
    [31m[1m>[22m[39m[90m 127 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeGreaterThan([35m0.8[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 128 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 129 |[39m       expect(result[33m.[39mriskFactors)[33m.[39mtoBeDefined()[33m;[39m
     [90m 130 |[39m       expect(result[33m.[39mrecommendations[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:127:34)

  ● enhancedAICrisisDetectionService › Multi-language Support › should detect crisis in Spanish

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.7
    Received:   0

    [0m [90m 150 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text[33m,[39m { language[33m:[39m [32m'es'[39m })[33m;[39m
     [90m 151 |[39m       
    [31m[1m>[22m[39m[90m 152 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeGreaterThan([35m0.7[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 153 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 154 |[39m       expect(result[33m.[39mriskFactors)[33m.[39mtoBeDefined()[33m;[39m
     [90m 155 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:152:34)

  ● enhancedAICrisisDetectionService › Multi-language Support › should handle code-switching

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.5
    Received:   0.4

    [0m [90m 160 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text)[33m;[39m
     [90m 161 |[39m       
    [31m[1m>[22m[39m[90m 162 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeGreaterThan([35m0.5[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 163 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBeDefined()[33m;[39m
     [90m 164 |[39m       expect(result[33m.[39mconfidence)[33m.[39mtoBeDefined()[33m;[39m
     [90m 165 |[39m       expect(result[33m.[39mrecommendations)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:162:34)

  ● enhancedAICrisisDetectionService › Pattern Recognition › should identify escalation patterns

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.7
    Received:   0

    [0m [90m 178 |[39m       [36mconst[39m results [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(messages[33m.[39mjoin([32m' '[39m))[33m;[39m
     [90m 179 |[39m       
    [31m[1m>[22m[39m[90m 180 |[39m       expect(results[33m.[39mcrisisLevel)[33m.[39mtoBeGreaterThan([35m0.7[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 181 |[39m       expect(results[33m.[39mimmediateAction)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 182 |[39m       expect(results[33m.[39mriskFactors)[33m.[39mtoBeDefined()[33m;[39m
     [90m 183 |[39m       expect(results[33m.[39mrecommendations[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:180:35)

  ● enhancedAICrisisDetectionService › Contextual Factors › should consider user history

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.7
    Received:   0

    [0m [90m 211 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text[33m,[39m userContext)[33m;[39m
     [90m 212 |[39m       
    [31m[1m>[22m[39m[90m 213 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeGreaterThan([35m0.7[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 214 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 215 |[39m       expect(result[33m.[39mriskFactors)[33m.[39mtoBeDefined()[33m;[39m
     [90m 216 |[39m       expect(result[33m.[39mrecommendations)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:213:34)

  ● enhancedAICrisisDetectionService › Contextual Factors › should factor in protective factors

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.3
    Received:   0

    [0m [90m 225 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text[33m,[39m userContext)[33m;[39m
     [90m 226 |[39m       
    [31m[1m>[22m[39m[90m 227 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeGreaterThan([35m0.3[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 228 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeLessThan([35m0.7[39m)[33m;[39m
     [90m 229 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBeDefined()[33m;[39m
     [90m 230 |[39m       expect(result[33m.[39mrecommendations)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:227:34)

  ● enhancedAICrisisDetectionService › Model Performance › should provide confidence scores

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.7
    Received:   0.3

    [0m [90m 239 |[39m       
     [90m 240 |[39m       expect(result[33m.[39mconfidence)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 241 |[39m       expect(result[33m.[39mconfidence)[33m.[39mtoBeGreaterThan([35m0.7[39m)[33m;[39m [90m// High confidence for clear crisis[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 242 |[39m       expect(result[33m.[39mriskFactors)[33m.[39mtoBeDefined()[33m;[39m
     [90m 243 |[39m       expect(result[33m.[39mrecommendations)[33m.[39mtoBeDefined()[33m;[39m
     [90m 244 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:241:33)

  ● enhancedAICrisisDetectionService › Explainability › should provide reasoning for detection

    expect(received).toBeGreaterThan(expected)

    Expected: > 0.8
    Received:   0.8

    [0m [90m 274 |[39m       expect(result[33m.[39mriskFactors[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m 275 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 276 |[39m       expect(result[33m.[39mconfidence)[33m.[39mtoBeGreaterThan([35m0.8[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 277 |[39m     })[33m;[39m
     [90m 278 |[39m
     [90m 279 |[39m     it([32m'should explain false positives'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:276:33)

  ● enhancedAICrisisDetectionService › Explainability › should explain false positives

    expect(received).toBeLessThan(expected)

    Expected: < 0.3
    Received:   0.4

    [0m [90m 282 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m enhancedAICrisisDetectionService[33m.[39manalyzeCrisisWithML(text)[33m;[39m
     [90m 283 |[39m       
    [31m[1m>[22m[39m[90m 284 |[39m       expect(result[33m.[39mcrisisLevel)[33m.[39mtoBeLessThan([35m0.3[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 285 |[39m       expect(result[33m.[39mimmediateAction)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 286 |[39m       expect(result[33m.[39mconfidence)[33m.[39mtoBeDefined()[33m;[39m
     [90m 287 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/enhancedAiCrisisDetectionService.test.ts:284:34)

FAIL src/hooks/usePrivacyAnalytics.test.ts (10.59 s)
  ● usePrivacyAnalytics Hook › should initialize with default state

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 122 |[39m       retentionCompliant[33m:[39m [36mtrue[39m
     [90m 123 |[39m     })[33m;[39m
    [31m[1m>[22m[39m[90m 124 |[39m     expect(result[33m.[39mcurrent[33m.[39misLoading)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 125 |[39m     expect(result[33m.[39mcurrent[33m.[39merror)[33m.[39mtoBeNull()[33m;[39m
     [90m 126 |[39m     expect([36mtypeof[39m result[33m.[39mcurrent[33m.[39mrecordIntervention)[33m.[39mtoBe([32m'function'[39m)[33m;[39m
     [90m 127 |[39m     expect([36mtypeof[39m result[33m.[39mcurrent[33m.[39mrecordFollowUp)[33m.[39mtoBe([32m'function'[39m)[33m;[39m[0m

      at Object.<anonymous> (src/hooks/usePrivacyAnalytics.test.ts:124:38)

  ● usePrivacyAnalytics Hook › should maintain HIPAA compliance indicators

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 445 |[39m     [90m// Verify HIPAA compliance indicators[39m
     [90m 446 |[39m     expect(result[33m.[39mcurrent[33m.[39mprivacyBudget[33m.[39mretentionCompliant)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 447 |[39m     expect(result[33m.[39mcurrent[33m.[39minsights[33m?[39m[33m.[39mprivacyMetrics[33m.[39mdataRetentionCompliance)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                                             [31m[1m^[22m[39m
     [90m 448 |[39m     expect(result[33m.[39mcurrent[33m.[39minsights[33m?[39m[33m.[39mglobalMetrics[33m.[39mtotalInterventions)[33m.[39mtoBeGreaterThanOrEqual([35m0[39m)[33m;[39m
     [90m 449 |[39m   })[33m;[39m
     [90m 450 |[39m[0m

      at Object.<anonymous> (src/hooks/usePrivacyAnalytics.test.ts:447:77)

  ● usePrivacyAnalytics Hook › should handle differential privacy budget tracking

    expect(received).toBeLessThan(expected)

    Matcher error: received value must be a number or bigint

    Received has value: undefined

    [0m [90m 457 |[39m
     [90m 458 |[39m     [90m// Verify differential privacy is being tracked[39m
    [31m[1m>[22m[39m[90m 459 |[39m     expect(result[33m.[39mcurrent[33m.[39minsights[33m?[39m[33m.[39mprivacyMetrics[33m.[39mtotalBudgetConsumed)[33m.[39mtoBeLessThan([35m1.0[39m)[33m;[39m
     [90m     |[39m                                                                         [31m[1m^[22m[39m
     [90m 460 |[39m     expect(result[33m.[39mcurrent[33m.[39mprivacyBudget[33m.[39mused)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m 461 |[39m   })[33m;[39m
     [90m 462 |[39m[0m

      at Object.<anonymous> (src/hooks/usePrivacyAnalytics.test.ts:459:73)

  ● usePrivacyAnalytics Hook › should provide cultural metrics for analysis

    expect(received).toBe(expected) // Object.is equality

    Expected: "Western"
    Received: undefined

    [0m [90m 468 |[39m     })[33m;[39m
     [90m 469 |[39m
    [31m[1m>[22m[39m[90m 470 |[39m     expect(result[33m.[39mcurrent[33m.[39mculturalMetrics[[35m0[39m][33m.[39mculturalGroup)[33m.[39mtoBe([32m'Western'[39m)[33m;[39m
     [90m     |[39m                                                             [31m[1m^[22m[39m
     [90m 471 |[39m     expect(result[33m.[39mcurrent[33m.[39mculturalMetrics[[35m1[39m][33m.[39mculturalGroup)[33m.[39mtoBe([32m'Eastern'[39m)[33m;[39m
     [90m 472 |[39m     expect(result[33m.[39mcurrent[33m.[39mculturalMetrics[[35m0[39m][33m.[39msuccessRate)[33m.[39mtoBeGreaterThan([35m0.5[39m)[33m;[39m
     [90m 473 |[39m     expect(result[33m.[39mcurrent[33m.[39mculturalMetrics[[35m1[39m][33m.[39msuccessRate)[33m.[39mtoBeGreaterThan([35m0.5[39m)[33m;[39m[0m

      at Object.<anonymous> (src/hooks/usePrivacyAnalytics.test.ts:470:61)

FAIL src/components/privacy/__tests__/ConsentBanner.test.tsx (10.418 s)
  ● ConsentBanner › Content and Messaging › should display mental health data protection notice in modal

    TestingLibraryElementError: Unable to find an element with the text: Customize Privacy Preferences. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"fixed bottom-0 left-0 right-0 z-50 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"max-w-6xl mx-auto p-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex flex-col md:flex-row md:items-center md:justify-between gap-4"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex-1"[39m
              [36m>[39m
                [36m<h3[39m
                  [33mclass[39m=[32m"text-lg font-semibold text-gray-900 dark:text-white mb-2"[39m
                [36m>[39m
                  [0mPrivacy & Mental Health Data Protection[0m
                [36m</h3>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"text-sm text-gray-600 dark:text-gray-300 mb-2"[39m
                [36m>[39m
                  [0mWe use privacy-compliant analytics to improve our mental health platform while protecting your sensitive information. All data is anonymized after 7 days, and crisis intervention data is handled with the highest security standards.[0m
                [36m</p>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"text-xs text-gray-500 dark:text-gray-400"[39m
                [36m>[39m
                  [0mGDPR & HIPAA-adjacent compliant • Data retention: 30 days • Automatic anonymization: 7 days[0m
                [36m</p>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col sm:flex-row gap-2 min-w-max"[39m
              [36m>[39m
                [36m<button[39m
                  [33mclass[39m=[32m"text-xs"[39m
                  [33mdata-testid[39m=[32m"button-customize-preferences"[39m
                  [33mvariant[39m=[32m"secondary"[39m
                [36m>[39m
                  [0mCustomize Preferences[0m
                [36m</button>[39m
                [36m<button[39m
                  [33mclass[39m=[32m"text-xs"[39m
                  [33mdata-testid[39m=[32m"button-essential-only"[39m
                  [33mvariant[39m=[32m"secondary"[39m
                [36m>[39m
                  [0mEssential Only[0m
                [36m</button>[39m
                [36m<button[39m
                  [33mclass[39m=[32m"text-xs"[39m
                  [33mdata-testid[39m=[32m"button-accept-all"[39m
                  [33mvariant[39m=[32m"primary"[39m
                [36m>[39m
                  [0mAccept All[0m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
        [36m<div[39m
          [33mdata-testid[39m=[32m"modal"[39m
          [33mrole[39m=[32m"dialog"[39m
        [36m>[39m
          [36m<h2>[39m
            [0mPrivacy Preferences[0m
          [36m</h2>[39m
          [36m<button[39m
            [33mdata-testid[39m=[32m"modal-close"[39m
          [36m>[39m
            [0mClose[0m
          [36m</button>[39m
          [36m<div[39m
            [33mclass[39m=[32m"space-y-6"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"text-sm text-gray-600 dark:text-gray-300"[39m
            [36m>[39m
              [36m<p[39m
                [33mclass[39m=[32m"mb-4"[39m
              [36m>[39m
                [0mYour privacy is our priority. Customize how we collect and use data to improve your mental health platform experience.[0m
              [36m</p>[39m
              [36m<div[39m
                [33mclass[39m=[32m"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg mb-4"[39m
              [36m>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"text-xs font-medium text-blue-800 dark:text-blue-200"[39m
                [36m>[39m
                  [0m�� Mental Health Data Protection: Crisis intervention data is encrypted, anonymized after use, and retained only for safety analysis.[0m
                [36m</p>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"space-y-4"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-start space-x-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"[39m
              [36m>[39m
                [36m<input[39m
                  [33mchecked[39m=[32m""[39m
                  [33mclass[39m=[32m"mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 opacity-50"[39m
                  [33mdisabled[39m=[32m""[39m
                  [33mid[39m=[32m"functionality"[39m
                  [33mtype[39m=[32m"checkbox"[39m
                [36m/>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex-1"[39m
                [36m>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"text-sm font-medium text-gray-900 dark:text-white"[39m
                    [33mfor[39m=[32m"functionality"[39m
                  [36m>[39m
                    [0mEssential Functionality[0m
                    [36m<span[39m
                      [33mclass[39m=[32m"ml-2 text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded"[39m
                    [36m>[39m
                      [0mRequired[0m
                    [36m</span>[39m
                  [36m</label>[39m
                  [36m<p[39m
                    [33mclass[39m=[32m"text-xs text-gray-600 dark:text-gray-300 mt-1"[39m
                  [36m>[39m
                    [0mCore platform features, user sessions, and security. Cannot be disabled.[0m
                  [36m</p>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-start space-x-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"[39m
              [36m>[39m
                [36m<input[39m
                  [33mchecked[39m=[32m""[39m
                  [33mclass[39m=[32m"mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 opacity-50"[39m
                  [33mdisabled[39m=[32m""[39m
                  [33mid[39m=[32m"performance"[39m
                  [33mtype[39m=[32m"checkbox"[39m
                [36m/>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex-1"[39m
                [36m>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"text-sm font-medium text-gray-900 dark:text-white"[39m
                    [33mfor[39m=[32m"performance"[39m
                  [36m>[39m
                    [0mPerformance Monitoring[0m
                    [36m<span[39m
                      [33mclass[39m=[32m"ml-2 text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded"[39m
                    [36m>[39m
                      [0mRequired[0m
                    [36m</span>[39m
                  [36m</label>[39m
                  [36m<p[39m
                    [33mclass[39m=[32m"text-xs text-gray-600 dark:text-gray-300 mt-1"[39m
                  [36m>[39m
                    [0mLoad times, error tracking, and platform optimization. Essential for mental health platform reliability.[0m
                  [36m</p>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-start space-x-3 p-3 border border-gray-200 dark:border-gray-600 rounded-lg"[39m
              [36m>[39m
                [36m<input[39m
                  [33mclass[39m=[32m"mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"[39m
                  [33mid[39m=[32m"analytics"[39m
                  [33mtype[39m=[32m"checkbox"[39m
                [36m/>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex-1"[39m
                [36m>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"text-sm font-medium text-gray-900 dark:text-white"[39m
                    [33mfor[39m=[32m"analytics"[39m
                  [36m>[39m
                    [0mUsage Analytics[0m
                    [36m<span[39m
                      [33mclass[39m=[32m"ml-2 text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-1 rounded"[39m
                    [36m>[39m
                      [0mOptional[0m
                    [36m</span>[39m
                  [36m</label>[39m
                  [36m<p[39m
                    [33mclass[39m=[32m"text-xs text-gray-600 dark:text-gray-300 mt-1"[39m
                  [36m>[39m
                    [0mAnonymous usage patterns to improve mental health features. Data anonymized after 7 days.[0m
                  [36m</p>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-start space-x-3 p-3 border border-gray-200 dark:border-gray-600 rounded-lg"[39m
              [36m>[39m
                [36m<input[39m
                  [33mclass[39m=[32m"mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"[39m
                  [33mid[39m=[32m"marketing"[39m
                  [33mtype[39m=[32m"checkbox"[39m
                [36m/>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex-1"[39m
                [36m>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"text-sm font-medium text-gray-900 dark:text-white"[39m
                    [33mfor[39m=[32m"marketing"[39m
                  [36m>[39m
                    [0mMarketing Communications[0m
                    [36m<span[39m
                      [33mclass[39m=[32m"ml-2 text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-1 rounded"[39m
                    [36m>[39m
                      [0mOptional[0m
                    [36m</span>[39m
                  [36m</label>[39m
                  [36m<p[39m
                    [33mclass[39m=[32m"text-xs text-gray-600 dark:text-gray-300 mt-1"[39m
                  [36m>[39m
                    [0mPersonalized wellness tips and platform updates. No sensitive health data used.[0m
                  [36m</p>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"border-t border-gray-200 dark:border-gray-600 pt-4"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"text-xs text-gray-500 dark:text-gray-400 space-y-1"[39m
              [36m>[39m
                [36m<p>[39m
                  [0m• All data is processed according to GDPR and mental health privacy standards[0m
                [36m</p>[39m
                [36m<p>[39m
                  [0m• Crisis intervention data is encrypted and anonymized immediately after use[0m
                [36m</p>[39m
                [36m<p>[39m
                  [0m• You can change these preferences anytime in your privacy settings[0m
                [36m</p>[39m
                [36m<p>[39m
                  [0m• Data is automatically purged after 90 days maximum[0m
                [36m</p>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex justify-end space-x-3"[39m
            [36m>[39m
              [36m<button[39m
                [33mdata-testid[39m=[32m"button-cancel"[39m
                [33mvariant[39m=[32m"secondary"[39m
              [36m>[39m
                [0mCancel[0m
              [36m</button>[39m
              [36m<button[39m
                [33mdata-testid[39m=[32m"button-save-preferences"[39m
                [33mvariant[39m=[32m"primary"[39m
              [36m>[39m
                [0mSave Preferences[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 463 |[39m       
     [90m 464 |[39m       [90m// Check for the modal title and content that exists[39m
    [31m[1m>[22m[39m[90m 465 |[39m       expect(screen[33m.[39mgetByText([32m'Customize Privacy Preferences'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 466 |[39m       [90m// Check for actual content in the preferences modal[39m
     [90m 467 |[39m       expect(screen[33m.[39mgetByLabelText([35m/Essential Functionality/[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m 468 |[39m     })[33m;[39m[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/components/privacy/__tests__/ConsentBanner.test.tsx:465:21)

FAIL tests/integration/crisis-detection-validation.test.ts
  ● Crisis Detection and Escalation System › Basic Crisis Detection › detects explicit crisis keywords

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Basic Crisis Detection › detects implicit crisis signals

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Basic Crisis Detection › handles euphemisms and indirect language

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Multilingual Crisis Detection › detects crisis in Spanish

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Multilingual Crisis Detection › detects crisis in French

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Multilingual Crisis Detection › detects crisis in Mandarin

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Context-Aware Analysis › analyzes conversation context

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Context-Aware Analysis › detects rapid mood deterioration

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Context-Aware Analysis › identifies crisis patterns in journal entries

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Crisis Escalation Workflow › escalates to emergency services for critical risk

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Crisis Escalation Workflow › notifies support network for high risk

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Crisis Escalation Workflow › provides immediate resources for medium risk

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Crisis Escalation Workflow › tracks intervention effectiveness

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › False Positive Prevention › does not flag normal negative emotions

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › False Positive Prevention › distinguishes crisis from creative writing

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › False Positive Prevention › handles sarcasm and humor appropriately

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Privacy and Consent › anonymizes data before analysis

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Privacy and Consent › respects user consent preferences

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Privacy and Consent › maintains audit trail for interventions

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Performance and Reliability › responds within acceptable time limits

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Performance and Reliability › handles high volume of concurrent requests

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Performance and Reliability › gracefully handles service failures

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Performance and Reliability › maintains accuracy under edge cases

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Integration with Support Systems › integrates with AI counseling service

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Integration with Support Systems › coordinates with human support team

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

  ● Crisis Detection and Escalation System › Integration with Support Systems › provides culturally appropriate resources

    TypeError: crisisDetectionService_1.CrisisDetectionService is not a constructor

    [0m [90m 15 |[39m
     [90m 16 |[39m   beforeEach(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 17 |[39m     crisisService [33m=[39m [36mnew[39m [33mCrisisDetectionService[39m()[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 18 |[39m     enhancedService [33m=[39m [36mnew[39m [33mEnhancedCrisisDetectionIntegrationService[39m()[33m;[39m
     [90m 19 |[39m     escalationService [33m=[39m [36mnew[39m [33mCrisisEscalationWorkflowService[39m()[33m;[39m
     [90m 20 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisis-detection-validation.test.ts:17:21)

FAIL src/services/__tests__/errorTrackingService.test.ts
  ● Error Tracking Service (Vite Version) › Environment detection › should detect production environment correctly

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"tracesSampleRate": 0.1}

    Number of calls: 0

    [0m [90m 53 |[39m       initializeSentry()[33m;[39m
     [90m 54 |[39m
    [31m[1m>[22m[39m[90m 55 |[39m       expect([33mSentry[39m[33m.[39minit)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                           [31m[1m^[22m[39m
     [90m 56 |[39m         expect[33m.[39mobjectContaining({
     [90m 57 |[39m           tracesSampleRate[33m:[39m [35m0.1[39m
     [90m 58 |[39m         })[0m

      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:55:27)

  ● Error Tracking Service (Vite Version) › Environment detection › should detect development environment correctly

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"tracesSampleRate": 1}

    Number of calls: 0

    [0m [90m 66 |[39m       initializeSentry()[33m;[39m
     [90m 67 |[39m
    [31m[1m>[22m[39m[90m 68 |[39m       expect([33mSentry[39m[33m.[39minit)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                           [31m[1m^[22m[39m
     [90m 69 |[39m         expect[33m.[39mobjectContaining({
     [90m 70 |[39m           tracesSampleRate[33m:[39m [35m1.0[39m
     [90m 71 |[39m         })[0m

      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:68:27)

  ● Error Tracking Service (Vite Version) › Environment detection › should use environment DSN when available

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"dsn": "https://env-dsn@sentry.io/789"}

    Number of calls: 0

    [0m [90m 79 |[39m       initializeSentry()[33m;[39m
     [90m 80 |[39m
    [31m[1m>[22m[39m[90m 81 |[39m       expect([33mSentry[39m[33m.[39minit)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                           [31m[1m^[22m[39m
     [90m 82 |[39m         expect[33m.[39mobjectContaining({
     [90m 83 |[39m           dsn[33m:[39m envDsn
     [90m 84 |[39m         })[0m

      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:81:27)

  ● Error Tracking Service (Vite Version) › Vite-specific configuration › should default to development behavior when env is unclear

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 119 |[39m
     [90m 120 |[39m       [90m// Should default to development-like behavior[39m
    [31m[1m>[22m[39m[90m 121 |[39m       expect([33mSentry[39m[33m.[39minit)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 122 |[39m     })[33m;[39m
     [90m 123 |[39m   })[33m;[39m
     [90m 124 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:121:27)

  ● Error Tracking Service (Vite Version) › Error sanitization (Vite version) › should work identically to non-Vite version

    TypeError: Cannot read properties of undefined (reading '0')

    [0m [90m 127 |[39m       initializeSentry()[33m;[39m
     [90m 128 |[39m       
    [31m[1m>[22m[39m[90m 129 |[39m       [36mconst[39m beforeSendFn [33m=[39m ([33mSentry[39m[33m.[39minit [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmock[33m.[39mcalls[[35m0[39m][[35m0[39m][33m.[39mbeforeSend[33m;[39m
     [90m     |[39m                                                                    [31m[1m^[22m[39m
     [90m 130 |[39m       
     [90m 131 |[39m       [36mconst[39m error [33m=[39m [36mnew[39m [33mError[39m([32m'Authentication failed with token: abc123'[39m)[33m;[39m
     [90m 132 |[39m       [36mconst[39m event [33m=[39m {[0m

      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:129:68)

  ● Error Tracking Service (Vite Version) › Error sanitization (Vite version) › should sanitize Vite-specific error patterns

    TypeError: Cannot read properties of undefined (reading '0')

    [0m [90m 146 |[39m       initializeSentry()[33m;[39m
     [90m 147 |[39m       
    [31m[1m>[22m[39m[90m 148 |[39m       [36mconst[39m beforeSendFn [33m=[39m ([33mSentry[39m[33m.[39minit [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmock[33m.[39mcalls[[35m0[39m][[35m0[39m][33m.[39mbeforeSend[33m;[39m
     [90m     |[39m                                                                    [31m[1m^[22m[39m
     [90m 149 |[39m       
     [90m 150 |[39m       [36mconst[39m error [33m=[39m [36mnew[39m [33mError[39m([32m'Vite HMR failed to update module with session data'[39m)[33m;[39m
     [90m 151 |[39m       [36mconst[39m event [33m=[39m {[0m

      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:148:68)

  ● Error Tracking Service (Vite Version) › Mental health specific error tracking › should track crisis-related errors with appropriate sensitivity

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:174:28)

  ● Error Tracking Service (Vite Version) › Mental health specific error tracking › should handle therapy session errors sensitively

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at Function.captureCrisisError (src/services/errorTrackingService.ts:212:10)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:183:28)

  ● Error Tracking Service (Vite Version) › Mental health specific error tracking › should track mood tracking errors

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:205:28)

  ● Error Tracking Service (Vite Version) › Mental health specific error tracking › should track safety plan errors with high priority

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:220:28)

  ● Error Tracking Service (Vite Version) › Mental health specific error tracking › should track community moderation errors

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:235:28)

  ● Error Tracking Service (Vite Version) › User action tracking › should track emergency resource access

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at Function.captureUserActionError (src/services/errorTrackingService.ts:235:10)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:243:28)

  ● Error Tracking Service (Vite Version) › User action tracking › should track helper response actions

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at Function.captureUserActionError (src/services/errorTrackingService.ts:235:10)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:252:28)

  ● Error Tracking Service (Vite Version) › User action tracking › should track safety plan activations

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at Function.captureUserActionError (src/services/errorTrackingService.ts:235:10)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:261:28)

  ● Error Tracking Service (Vite Version) › Context and breadcrumb management › should set appropriate user context for seekers

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"id": "seeker-123", "userType": "seeker"}
    Received: {"id": "[USER_ID]"}

    Number of calls: 1

    [0m [90m 276 |[39m       })[33m;[39m
     [90m 277 |[39m
    [31m[1m>[22m[39m[90m 278 |[39m       expect([33mSentry[39m[33m.[39msetUser)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 279 |[39m         expect[33m.[39mobjectContaining({
     [90m 280 |[39m           id[33m:[39m [32m'seeker-123'[39m[33m,[39m
     [90m 281 |[39m           userType[33m:[39m [32m'seeker'[39m[0m

      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:278:30)

  ● Error Tracking Service (Vite Version) › Context and breadcrumb management › should set appropriate user context for helpers

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"id": "helper-789", "userType": "helper"}
    Received: {"id": "[USER_ID]"}

    Number of calls: 1

    [0m [90m 292 |[39m       })[33m;[39m
     [90m 293 |[39m
    [31m[1m>[22m[39m[90m 294 |[39m       expect([33mSentry[39m[33m.[39msetUser)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 295 |[39m         expect[33m.[39mobjectContaining({
     [90m 296 |[39m           id[33m:[39m [32m'helper-789'[39m[33m,[39m
     [90m 297 |[39m           userType[33m:[39m [32m'helper'[39m[0m

      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:294:30)

  ● Error Tracking Service (Vite Version) › Context and breadcrumb management › should add crisis-related breadcrumbs

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

    @@ -7,6 +7,7 @@
          ],
          "model_version": "v2.1",
        },
        "level": "warning",
        "message": "Crisis keywords detected in user input",
    +   "timestamp": 1755460724.295,
      },

    Number of calls: 1

    [0m [90m 312 |[39m       )[33m;[39m
     [90m 313 |[39m
    [31m[1m>[22m[39m[90m 314 |[39m       expect([33mSentry[39m[33m.[39maddBreadcrumb)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 315 |[39m         message[33m:[39m [32m'Crisis keywords detected in user input'[39m[33m,[39m
     [90m 316 |[39m         category[33m:[39m [32m'crisis-detection'[39m[33m,[39m
     [90m 317 |[39m         level[33m:[39m [32m'warning'[39m[33m,[39m[0m

      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:314:36)

  ● Error Tracking Service (Vite Version) › Performance and reliability › should handle high volume of error tracking

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at src/services/__tests__/errorTrackingService.test.ts:356:30
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:355:14)

  ● Error Tracking Service (Vite Version) › Performance and reliability › should handle malformed error objects

    expect(received).not.toThrow()

    Error name:    "TypeError"
    Error message: "scope.setExtra is not a function"

        [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
         [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
        [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
         [90m     |[39m               [31m[1m^[22m[39m
         [90m 194 |[39m       }
         [90m 195 |[39m
         [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at src/services/__tests__/errorTrackingService.test.ts:374:30
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:379:14)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:379:14)

  ● Error Tracking Service (Vite Version) › Performance and reliability › should handle circular references in context

    expect(received).not.toThrow()

    Error name:    "TypeError"
    Error message: "scope.setExtra is not a function"

        [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
         [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
        [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
         [90m     |[39m               [31m[1m^[22m[39m
         [90m 194 |[39m       }
         [90m 195 |[39m
         [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at src/services/__tests__/errorTrackingService.test.ts:387:30
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:392:14)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:392:14)

  ● Error Tracking Service (Vite Version) › Privacy compliance edge cases › should handle deeply nested sensitive data

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:412:28)

  ● Error Tracking Service (Vite Version) › Privacy compliance edge cases › should handle URLs with sensitive query parameters

    TypeError: Cannot read properties of undefined (reading '0')

    [0m [90m 423 |[39m       
     [90m 424 |[39m       initializeSentry()[33m;[39m
    [31m[1m>[22m[39m[90m 425 |[39m       [36mconst[39m beforeSendFn [33m=[39m ([33mSentry[39m[33m.[39minit [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmock[33m.[39mcalls[[35m0[39m][[35m0[39m][33m.[39mbeforeSend[33m;[39m
     [90m     |[39m                                                                    [31m[1m^[22m[39m
     [90m 426 |[39m       
     [90m 427 |[39m       [36mconst[39m event [33m=[39m {
     [90m 428 |[39m         message[33m:[39m error[33m.[39mmessage[33m,[39m[0m

      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:425:68)

  ● Error Tracking Service (Vite Version) › Privacy compliance edge cases › should maintain error context while protecting privacy

    TypeError: scope.setExtra is not a function

    [0m [90m 191 |[39m       [90m// Add extra data (sanitized)[39m
     [90m 192 |[39m       [36mif[39m (sanitized[33m.[39mcontext) {
    [31m[1m>[22m[39m[90m 193 |[39m         scope[33m.[39msetExtra([32m'additional_context'[39m[33m,[39m sanitized[33m.[39mcontext)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 194 |[39m       }
     [90m 195 |[39m
     [90m 196 |[39m       [33mSentry[39m[33m.[39mcaptureException(error)[33m;[39m[0m

      at src/services/errorTrackingService.ts:193:15
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:22:5)
      at Function.captureError (src/services/errorTrackingService.ts:166:12)
      at Object.<anonymous> (src/services/__tests__/errorTrackingService.test.ts:449:28)

FAIL src/contexts/__tests__/NotificationContext.test.tsx
  ● NotificationContext › NotificationProvider › should add toast notifications

    expect(element).toHaveTextContent()

    Expected element to have text content:
      Test message - success
    Received:

    [0m [90m 70 |[39m       })[33m;[39m
     [90m 71 |[39m
    [31m[1m>[22m[39m[90m 72 |[39m       expect(screen[33m.[39mgetByTestId([32m'toasts'[39m))[33m.[39mtoHaveTextContent([32m'Test message - success'[39m)[33m;[39m
     [90m    |[39m                                            [31m[1m^[22m[39m
     [90m 73 |[39m     })[33m;[39m
     [90m 74 |[39m
     [90m 75 |[39m     it([32m'should remove toast notifications'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/contexts/__tests__/NotificationContext.test.tsx:72:44)

  ● NotificationContext › NotificationProvider › should remove toast notifications

    TestingLibraryElementError: Unable to find an element with the text: Test message. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div>[39m
          [36m<button>[39m
            [0mAdd Toast[0m
          [36m</button>[39m
          [36m<div[39m
            [33mdata-testid[39m=[32m"toasts"[39m
          [36m/>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 104 |[39m       })[33m;[39m
     [90m 105 |[39m
    [31m[1m>[22m[39m[90m 106 |[39m       expect(screen[33m.[39mgetByText([32m'Test message'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 107 |[39m
     [90m 108 |[39m       [90m// Remove the toast[39m
     [90m 109 |[39m       act(() [33m=>[39m {[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/contexts/__tests__/NotificationContext.test.tsx:106:21)

  ● NotificationContext › NotificationProvider › should handle multiple toasts

    expect(element).toHaveTextContent()

    Expected element to have text content:
      1
    Received:
      0

    [0m [90m 140 |[39m         screen[33m.[39mgetByText([32m'Add First'[39m)[33m.[39mclick()[33m;[39m
     [90m 141 |[39m       })[33m;[39m
    [31m[1m>[22m[39m[90m 142 |[39m       expect(screen[33m.[39mgetByTestId([32m'toast-count'[39m))[33m.[39mtoHaveTextContent([32m'1'[39m)[33m;[39m
     [90m     |[39m                                                 [31m[1m^[22m[39m
     [90m 143 |[39m
     [90m 144 |[39m       act(() [33m=>[39m {
     [90m 145 |[39m         screen[33m.[39mgetByText([32m'Add Second'[39m)[33m.[39mclick()[33m;[39m[0m

      at Object.<anonymous> (src/contexts/__tests__/NotificationContext.test.tsx:142:49)

  ● NotificationContext › NotificationProvider › should show confirmation modal

    TestingLibraryElementError: Unable to find an element by: [data-testid="modal"]

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div>[39m
          [36m<button>[39m
            [0mShow Modal[0m
          [36m</button>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 190 |[39m       })[33m;[39m
     [90m 191 |[39m
    [31m[1m>[22m[39m[90m 192 |[39m       expect(screen[33m.[39mgetByTestId([32m'modal'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 193 |[39m       expect(screen[33m.[39mgetByText([32m'Confirm Action'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m 194 |[39m       expect(screen[33m.[39mgetByText([32m'Are you sure?'[39m))[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m 195 |[39m     })[33m;[39m[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/contexts/__tests__/NotificationContext.test.tsx:192:21)

  ● NotificationContext › NotificationProvider › should hide confirmation modal

    expect(element).toHaveTextContent()

    Expected element to have text content:
      Visible
    Received:
      Hidden

    [0m [90m 231 |[39m         screen[33m.[39mgetByText([32m'Show'[39m)[33m.[39mclick()[33m;[39m
     [90m 232 |[39m       })[33m;[39m
    [31m[1m>[22m[39m[90m 233 |[39m       expect(screen[33m.[39mgetByTestId([32m'modal-status'[39m))[33m.[39mtoHaveTextContent([32m'Visible'[39m)[33m;[39m
     [90m     |[39m                                                  [31m[1m^[22m[39m
     [90m 234 |[39m
     [90m 235 |[39m       [90m// Hide modal[39m
     [90m 236 |[39m       act(() [33m=>[39m {[0m

      at Object.<anonymous> (src/contexts/__tests__/NotificationContext.test.tsx:233:50)

  ● NotificationContext › NotificationProvider › should use default toast type when not specified

    TestingLibraryElementError: Unable to find an element by: [data-testid="toast-type"]

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div>[39m
          [36m<button>[39m
            [0mAdd Default[0m
          [36m</button>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 302 |[39m       })[33m;[39m
     [90m 303 |[39m
    [31m[1m>[22m[39m[90m 304 |[39m       expect(screen[33m.[39mgetByTestId([32m'toast-type'[39m))[33m.[39mtoHaveTextContent([32m'info'[39m)[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 305 |[39m     })[33m;[39m
     [90m 306 |[39m   })[33m;[39m
     [90m 307 |[39m[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/contexts/__tests__/NotificationContext.test.tsx:304:21)

FAIL src/services/__tests__/crisisDetectionIntegrationService.test.ts
  ● CrisisDetectionIntegrationService › Integrated Crisis Analysis › should detect crisis from multiple sources

    expect(received).toBe(expected) // Object.is equality

    Expected: "critical"
    Received: "emergency"

    [0m [90m 38 |[39m       
     [90m 39 |[39m       expect(result[33m.[39misCrisis)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 40 |[39m       expect(result[33m.[39mseverity)[33m.[39mtoBe([32m'critical'[39m)[33m;[39m
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 41 |[39m       expect(result[33m.[39mscore)[33m.[39mtoBeGreaterThan([35m0.8[39m)[33m;[39m
     [90m 42 |[39m       expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 43 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetectionIntegrationService.test.ts:40:31)

  ● CrisisDetectionIntegrationService › Integrated Crisis Analysis › should provide consensus-based severity

    expect(received).toContain(expected) // indexOf

    Expected value: "low"
    Received array: ["high", "critical"]

    [0m [90m 64 |[39m       
     [90m 65 |[39m       expect(result[33m.[39mseverity)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 66 |[39m       expect([[32m'high'[39m[33m,[39m [32m'critical'[39m])[33m.[39mtoContain(result[33m.[39mseverity)[33m;[39m
     [90m    |[39m                                    [31m[1m^[22m[39m
     [90m 67 |[39m     })[33m;[39m
     [90m 68 |[39m   })[33m;[39m
     [90m 69 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetectionIntegrationService.test.ts:66:36)

  ● CrisisDetectionIntegrationService › Escalation Decisions › should recommend escalation for high-risk cases

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 77 |[39m       )[33m;[39m
     [90m 78 |[39m       
    [31m[1m>[22m[39m[90m 79 |[39m       expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m    |[39m                                         [31m[1m^[22m[39m
     [90m 80 |[39m       expect(result[33m.[39memergencyServicesRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 81 |[39m       expect(result[33m.[39minterventionRecommendations)[33m.[39mtoBeDefined()[33m;[39m
     [90m 82 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetectionIntegrationService.test.ts:79:41)

  ● CrisisDetectionIntegrationService › Response Generation › should generate appropriate crisis response

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 134 |[39m       
     [90m 135 |[39m       expect(result[33m.[39minterventionRecommendations)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 136 |[39m       expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                         [31m[1m^[22m[39m
     [90m 137 |[39m       expect([[32m'high'[39m[33m,[39m [32m'critical'[39m])[33m.[39mtoContain(result[33m.[39mseverity)[33m;[39m
     [90m 138 |[39m       expect(result[33m.[39misCrisis)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 139 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetectionIntegrationService.test.ts:136:41)

  ● CrisisDetectionIntegrationService › Response Generation › should include safety plan in response

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 149 |[39m       expect(result[33m.[39minterventionRecommendations)[33m.[39mtoBeDefined()[33m;[39m
     [90m 150 |[39m       expect(result[33m.[39mescalationResponse)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 151 |[39m       expect(result[33m.[39misCrisis)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 152 |[39m     })[33m;[39m
     [90m 153 |[39m   })[33m;[39m
     [90m 154 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/crisisDetectionIntegrationService.test.ts:151:31)

FAIL src/services/__tests__/websocketService.test.ts
  ● WebSocketService › connection management › should establish WebSocket connection

    TypeError: Cannot read properties of undefined (reading 'connected')

    [0m [90m 61 |[39m       [36mconst[39m connection [33m=[39m [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/crisis-support'[39m)[33m;[39m
     [90m 62 |[39m
    [31m[1m>[22m[39m[90m 63 |[39m       expect(connection[33m.[39mconnected)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 64 |[39m       expect(connection[33m.[39murl)[33m.[39mtoBe([32m'ws://localhost:8080/crisis-support'[39m)[33m;[39m
     [90m 65 |[39m     })[33m;[39m
     [90m 66 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:63:25)

  ● WebSocketService › connection management › should handle connection with authentication

    TypeError: service.connectWithAuth is not a function

    [0m [90m 68 |[39m       [36mconst[39m authToken [33m=[39m [32m'bearer-token-123'[39m[33m;[39m
     [90m 69 |[39m       
    [31m[1m>[22m[39m[90m 70 |[39m       [36mconst[39m connection [33m=[39m [36mawait[39m service[33m.[39mconnectWithAuth([32m'ws://localhost:8080/secure'[39m[33m,[39m authToken)[33m;[39m
     [90m    |[39m                                        [31m[1m^[22m[39m
     [90m 71 |[39m
     [90m 72 |[39m       expect(connection[33m.[39mauthenticated)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 73 |[39m       expect(connection[33m.[39mconnected)[33m.[39mtoBe([36mtrue[39m)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:70:40)

  ● WebSocketService › connection management › should reconnect automatically on disconnection

    Property `reconnect` does not exist in the provided object

    [0m [90m 77 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
     [90m 78 |[39m       
    [31m[1m>[22m[39m[90m 79 |[39m       [36mconst[39m reconnectSpy [33m=[39m jest[33m.[39mspyOn(service[33m,[39m [32m'reconnect'[39m)[33m;[39m
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 80 |[39m       
     [90m 81 |[39m       [90m// Simulate connection loss[39m
     [90m 82 |[39m       service[33m.[39msimulateDisconnection()[33m;[39m[0m

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:731:13)
      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:79:33)

  ● WebSocketService › connection management › should handle connection failures gracefully

    TypeError: Cannot read properties of undefined (reading 'connected')

    [0m [90m 102 |[39m       [36mconst[39m connection [33m=[39m [36mawait[39m service[33m.[39mconnect([32m'ws://invalid-url'[39m)[33m;[39m
     [90m 103 |[39m
    [31m[1m>[22m[39m[90m 104 |[39m       expect(connection[33m.[39mconnected)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 105 |[39m       expect(connection[33m.[39merror)[33m.[39mtoBeDefined()[33m;[39m
     [90m 106 |[39m     })[33m;[39m
     [90m 107 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:104:25)

  ● WebSocketService › message handling › should send crisis alert messages

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 110 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 111 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 113 |[39m     })[33m;[39m
     [90m 114 |[39m
     [90m 115 |[39m     it([32m'should send crisis alert messages'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:112:54)

  ● WebSocketService › message handling › should send chat messages in real-time

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 110 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 111 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 113 |[39m     })[33m;[39m
     [90m 114 |[39m
     [90m 115 |[39m     it([32m'should send crisis alert messages'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:112:54)

  ● WebSocketService › message handling › should handle incoming messages

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 110 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 111 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 113 |[39m     })[33m;[39m
     [90m 114 |[39m
     [90m 115 |[39m     it([32m'should send crisis alert messages'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:112:54)

  ● WebSocketService › message handling › should handle presence updates

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 110 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 111 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 113 |[39m     })[33m;[39m
     [90m 114 |[39m
     [90m 115 |[39m     it([32m'should send crisis alert messages'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:112:54)

  ● WebSocketService › room and channel management › should join crisis support room

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 201 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 202 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 203 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 204 |[39m     })[33m;[39m
     [90m 205 |[39m
     [90m 206 |[39m     it([32m'should join crisis support room'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:203:54)

  ● WebSocketService › room and channel management › should leave room gracefully

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 201 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 202 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 203 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 204 |[39m     })[33m;[39m
     [90m 205 |[39m
     [90m 206 |[39m     it([32m'should join crisis support room'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:203:54)

  ● WebSocketService › room and channel management › should handle room events

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 201 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 202 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 203 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 204 |[39m     })[33m;[39m
     [90m 205 |[39m
     [90m 206 |[39m     it([32m'should join crisis support room'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:203:54)

  ● WebSocketService › crisis-specific features › should escalate crisis with high priority

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 262 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 263 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/crisis-ws'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 264 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 265 |[39m     })[33m;[39m
     [90m 266 |[39m
     [90m 267 |[39m     it([32m'should escalate crisis with high priority'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:264:54)

  ● WebSocketService › crisis-specific features › should handle emergency interventions

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 262 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 263 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/crisis-ws'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 264 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 265 |[39m     })[33m;[39m
     [90m 266 |[39m
     [90m 267 |[39m     it([32m'should escalate crisis with high priority'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:264:54)

  ● WebSocketService › crisis-specific features › should send safety check requests

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 262 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 263 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/crisis-ws'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 264 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 265 |[39m     })[33m;[39m
     [90m 266 |[39m
     [90m 267 |[39m     it([32m'should escalate crisis with high priority'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:264:54)

  ● WebSocketService › connection health and monitoring › should implement heartbeat mechanism

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 331 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 332 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 333 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 334 |[39m     })[33m;[39m
     [90m 335 |[39m
     [90m 336 |[39m     it([32m'should implement heartbeat mechanism'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:333:54)

  ● WebSocketService › connection health and monitoring › should monitor connection health

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 331 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 332 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 333 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 334 |[39m     })[33m;[39m
     [90m 335 |[39m
     [90m 336 |[39m     it([32m'should implement heartbeat mechanism'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:333:54)

  ● WebSocketService › connection health and monitoring › should detect and report connection issues

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 331 |[39m     beforeEach([36masync[39m () [33m=>[39m {
     [90m 332 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 333 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 334 |[39m     })[33m;[39m
     [90m 335 |[39m
     [90m 336 |[39m     it([32m'should implement heartbeat mechanism'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:333:54)

  ● WebSocketService › message queuing and offline support › should queue messages when disconnected

    TypeError: service.getQueuedMessages is not a function

    [0m [90m 381 |[39m       [36mawait[39m service[33m.[39msendMessage(message)[33m;[39m
     [90m 382 |[39m
    [31m[1m>[22m[39m[90m 383 |[39m       [36mconst[39m queuedMessages [33m=[39m service[33m.[39mgetQueuedMessages()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 384 |[39m       expect(queuedMessages)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
     [90m 385 |[39m       expect(queuedMessages[[35m0[39m])[33m.[39mtoEqual(expect[33m.[39mobjectContaining(message))[33m;[39m
     [90m 386 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:383:38)

  ● WebSocketService › message queuing and offline support › should send queued messages when reconnected

    TypeError: service.getQueuedMessages is not a function

    [0m [90m 391 |[39m       [36mawait[39m service[33m.[39msendMessage({ type[33m:[39m [32m'test'[39m[33m,[39m payload[33m:[39m { data[33m:[39m [32m'2'[39m } })[33m;[39m
     [90m 392 |[39m
    [31m[1m>[22m[39m[90m 393 |[39m       expect(service[33m.[39mgetQueuedMessages())[33m.[39mtoHaveLength([35m2[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 394 |[39m
     [90m 395 |[39m       [90m// Connect and verify messages are sent[39m
     [90m 396 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:393:22)

  ● WebSocketService › message queuing and offline support › should handle message priority in queue

    TypeError: service.getQueuedMessages is not a function

    [0m [90m 410 |[39m       [36mawait[39m service[33m.[39msendMessage(highPriorityMsg)[33m;[39m
     [90m 411 |[39m
    [31m[1m>[22m[39m[90m 412 |[39m       [36mconst[39m queue [33m=[39m service[33m.[39mgetQueuedMessages()[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 413 |[39m       expect(queue[[35m0[39m][33m.[39mpriority)[33m.[39mtoBe([32m'high'[39m)[33m;[39m
     [90m 414 |[39m       expect(queue[[35m1[39m][33m.[39mpriority)[33m.[39mtoBe([32m'low'[39m)[33m;[39m
     [90m 415 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:412:29)

  ● WebSocketService › security and validation › should validate message format

    TypeError: service.validateMessage is not a function

    [0m [90m 424 |[39m       }[33m;[39m
     [90m 425 |[39m
    [31m[1m>[22m[39m[90m 426 |[39m       [36mconst[39m isValid [33m=[39m service[33m.[39mvalidateMessage(validMessage)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 427 |[39m       expect(isValid)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 428 |[39m     })[33m;[39m
     [90m 429 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:426:31)

  ● WebSocketService › security and validation › should reject invalid messages

    TypeError: service.validateMessage is not a function

    [0m [90m 434 |[39m       }[33m;[39m
     [90m 435 |[39m
    [31m[1m>[22m[39m[90m 436 |[39m       [36mconst[39m isValid [33m=[39m service[33m.[39mvalidateMessage(invalidMessage)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 437 |[39m       expect(isValid)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 438 |[39m     })[33m;[39m
     [90m 439 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:436:31)

  ● WebSocketService › security and validation › should sanitize message content

    TypeError: service.sanitizeMessage is not a function

    [0m [90m 446 |[39m       }[33m;[39m
     [90m 447 |[39m
    [31m[1m>[22m[39m[90m 448 |[39m       [36mconst[39m sanitized [33m=[39m service[33m.[39msanitizeMessage(unsafeMessage)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 449 |[39m       expect(sanitized[33m.[39mpayload[33m.[39mtext)[33m.[39mnot[33m.[39mtoContain([32m'<script>'[39m)[33m;[39m
     [90m 450 |[39m       expect(sanitized[33m.[39mpayload[33m.[39mtext)[33m.[39mtoContain([32m'Safe text'[39m)[33m;[39m
     [90m 451 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:448:33)

  ● WebSocketService › error handling and recovery › should handle WebSocket errors gracefully

    TypeError: Cannot read properties of undefined (reading 'instances')

    [0m [90m 455 |[39m     it([32m'should handle WebSocket errors gracefully'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 456 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 457 |[39m       mockWebSocket [33m=[39m (global[33m.[39m[33mWebSocket[39m [36mas[39m any)[33m.[39mmock[33m.[39minstances[[35m0[39m][33m;[39m
     [90m     |[39m                                                      [31m[1m^[22m[39m
     [90m 458 |[39m
     [90m 459 |[39m       [36mconst[39m errorHandler [33m=[39m jest[33m.[39mfn()[33m;[39m
     [90m 460 |[39m       service[33m.[39monError(errorHandler)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:457:54)

  ● WebSocketService › error handling and recovery › should implement exponential backoff for reconnection

    Property `reconnectWithBackoff` does not exist in the provided object

    [0m [90m 469 |[39m
     [90m 470 |[39m     it([32m'should implement exponential backoff for reconnection'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 471 |[39m       [36mconst[39m reconnectSpy [33m=[39m jest[33m.[39mspyOn(service[33m,[39m [32m'reconnectWithBackoff'[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 472 |[39m       
     [90m 473 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
     [90m 474 |[39m       [0m

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:731:13)
      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:471:33)

  ● WebSocketService › error handling and recovery › should cleanup resources on disconnect

    Property `cleanup` does not exist in the provided object

    [0m [90m 485 |[39m       [36mawait[39m service[33m.[39mconnect([32m'ws://localhost:8080/test'[39m)[33m;[39m
     [90m 486 |[39m       
    [31m[1m>[22m[39m[90m 487 |[39m       [36mconst[39m cleanupSpy [33m=[39m jest[33m.[39mspyOn(service[33m,[39m [32m'cleanup'[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 488 |[39m       
     [90m 489 |[39m       [36mawait[39m service[33m.[39mdisconnect()[33m;[39m
     [90m 490 |[39m[0m

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:731:13)
      at Object.<anonymous> (src/services/__tests__/websocketService.test.ts:487:31)

FAIL tests/integration/crisisEscalationWorkflowIntegration.test.ts
  ● Crisis Escalation Workflow Integration › should check user crisis state across multiple messages

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 123 |[39m     )[33m;[39m
     [90m 124 |[39m
    [31m[1m>[22m[39m[90m 125 |[39m     expect(crisisState[33m.[39misInCrisis)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 126 |[39m     expect([[32m'high'[39m[33m,[39m [32m'critical'[39m])[33m.[39mtoContain(crisisState[33m.[39mhighestSeverity)[33m;[39m
     [90m 127 |[39m     expect(crisisState[33m.[39mescalationTriggered)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 128 |[39m     expect(crisisState[33m.[39mrecommendedActions[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisisEscalationWorkflowIntegration.test.ts:125:36)

  ● Crisis Escalation Workflow Integration › should handle escalation service failures gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 145 |[39m     [90m// Should still detect crisis even if escalation fails[39m
     [90m 146 |[39m     expect(result[33m.[39misCrisis)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 147 |[39m     expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 148 |[39m     expect(result[33m.[39mescalationResponse)[33m.[39mtoBeUndefined()[33m;[39m [90m// Escalation failed[39m
     [90m 149 |[39m     expect(result[33m.[39menhanced)[33m.[39mtoBe([36mtrue[39m)[33m;[39m [90m// Enhanced detection still worked[39m
     [90m 150 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisisEscalationWorkflowIntegration.test.ts:147:39)

  ● Crisis Escalation Workflow Integration › should provide appropriate user context to escalation service

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: Any<Object>, "context-test-user", ObjectContaining {"accessibilityNeeds": ["screen-reader"], "culturalContext": "hispanic", "languageCode": "es", "location": ObjectContaining {"country": "US", "hasGeolocation": true, "region": "CA"}, "preferredContactMethod": "phone", "timeZone": "America/Los_Angeles"}, ObjectContaining {"conversationId": "context-test-session", "messagesSent": 5, "previousEscalations": 1, "riskTrend": "increasing", "sessionDuration": 300000}

    Number of calls: 0

    [0m [90m 180 |[39m
     [90m 181 |[39m     [90m// Verify escalation service was called with correct parameters[39m
    [31m[1m>[22m[39m[90m 182 |[39m     expect(crisisEscalationWorkflowService[33m.[39minitiateCrisisEscalation)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                                                      [31m[1m^[22m[39m
     [90m 183 |[39m       expect[33m.[39many([33mObject[39m)[33m,[39m [90m// crisis analysis[39m
     [90m 184 |[39m       [32m'context-test-user'[39m[33m,[39m [90m// user ID[39m
     [90m 185 |[39m       expect[33m.[39mobjectContaining({[0m

      at Object.<anonymous> (tests/integration/crisisEscalationWorkflowIntegration.test.ts:182:70)

FAIL tests/integration/crisisDetectionEscalationIntegration.test.ts
  ● Crisis Detection and Escalation Integration › Automatic Escalation Triggering › should trigger crisis counselor escalation for high-risk ideation

    expect(received).toEqual(expected) // deep equality

    Expected: StringMatching /high|critical/
    Received: "medium"

    [0m [90m 59 |[39m       [90m// Should detect crisis indicators[39m
     [90m 60 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 61 |[39m       expect(result[33m.[39moverallSeverity)[33m.[39mtoEqual(expect[33m.[39mstringMatching([35m/high|critical/[39m))[33m;[39m
     [90m    |[39m                                      [31m[1m^[22m[39m
     [90m 62 |[39m       expect(result[33m.[39mimmediateRisk)[33m.[39mtoBeGreaterThan([35m60[39m)[33m;[39m
     [90m 63 |[39m       expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 64 |[39m[0m

      at Object.<anonymous> (tests/integration/crisisDetectionEscalationIntegration.test.ts:61:38)

  ● Crisis Detection and Escalation Integration › Automatic Escalation Triggering › should provide escalation recommendations without user ID

    expect(received).toBe(expected) // Object.is equality

    Expected: "violence-threat"
    Received: "suicide-attempt"

    [0m [90m 110 |[39m       expect(result[33m.[39mescalationWorkflow)[33m.[39mtoBeDefined()[33m;[39m
     [90m 111 |[39m       expect(result[33m.[39mescalationWorkflow[33m?[39m[33m.[39mrecommendedTier)[33m.[39mtoBe([32m'emergency-services'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m       expect(result[33m.[39mescalationWorkflow[33m?[39m[33m.[39mtriggerReason)[33m.[39mtoBe([32m'violence-threat'[39m)[33m;[39m
     [90m     |[39m                                                        [31m[1m^[22m[39m
     [90m 113 |[39m       expect(result[33m.[39mescalationWorkflow[33m?[39m[33m.[39mescalationInitiated)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 114 |[39m       expect(result[33m.[39mescalationWorkflow[33m?[39m[33m.[39mescalationId)[33m.[39mtoBeUndefined()[33m;[39m
     [90m 115 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisisDetectionEscalationIntegration.test.ts:112:56)

  ● Crisis Detection and Escalation Integration › Escalation Tier Selection › should recommend crisis counselor for severe distress

    expect(received).toBeGreaterThan(expected)

    Expected: > 60
    Received:   12.118400000000001

    [0m [90m 143 |[39m
     [90m 144 |[39m       [90m// Should detect high risk requiring professional help[39m
    [31m[1m>[22m[39m[90m 145 |[39m       expect(result[33m.[39mimmediateRisk)[33m.[39mtoBeGreaterThan([35m60[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 146 |[39m       expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 147 |[39m
     [90m 148 |[39m       [90m// Should have appropriate escalation tier[39m[0m

      at Object.<anonymous> (tests/integration/crisisDetectionEscalationIntegration.test.ts:145:36)

  ● Crisis Detection and Escalation Integration › Cultural Context Integration › should handle cultural considerations in escalation

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 167 |[39m
     [90m 168 |[39m       [90m// Should detect crisis with cultural context[39m
    [31m[1m>[22m[39m[90m 169 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 170 |[39m       expect(result[33m.[39mculturalAnalysis)[33m.[39mtoBeDefined()[33m;[39m
     [90m 171 |[39m       expect(result[33m.[39mescalationRequired)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 172 |[39m[0m

      at Object.<anonymous> (tests/integration/crisisDetectionEscalationIntegration.test.ts:169:42)

  ● Crisis Detection and Escalation Integration › Multi-Method Integration › should combine keyword, AI, and cultural analysis for escalation decisions

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 226 |[39m
     [90m 227 |[39m       [90m// Should make escalation decision based on combined analysis[39m
    [31m[1m>[22m[39m[90m 228 |[39m       expect(result[33m.[39mhasCrisisIndicators)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 229 |[39m       expect(result[33m.[39manalysisMetadata[33m.[39mmethodsUsed)[33m.[39mtoContain([32m'keyword'[39m)[33m;[39m
     [90m 230 |[39m       expect(result[33m.[39manalysisMetadata[33m.[39mmethodsUsed)[33m.[39mtoContain([32m'ai'[39m)[33m;[39m
     [90m 231 |[39m       expect(result[33m.[39manalysisMetadata[33m.[39mmethodsUsed)[33m.[39mtoContain([32m'cultural'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisisDetectionEscalationIntegration.test.ts:228:42)

  ● Crisis Detection and Escalation Integration › Response Time and Performance › should process and escalate severe cases quickly

    expect(received).toBe(expected) // Object.is equality

    Expected: "emergency"
    Received: "medium"

    [0m [90m 257 |[39m
     [90m 258 |[39m       [90m// Should properly escalate emergency case[39m
    [31m[1m>[22m[39m[90m 259 |[39m       expect(result[33m.[39moverallSeverity)[33m.[39mtoBe([32m'emergency'[39m)[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 260 |[39m       expect(result[33m.[39mescalationWorkflow[33m?[39m[33m.[39mrecommendedTier)[33m.[39mtoBe([32m'emergency-services'[39m)[33m;[39m
     [90m 261 |[39m       expect(result[33m.[39mescalationWorkflow[33m?[39m[33m.[39mescalationInitiated)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 262 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/crisisDetectionEscalationIntegration.test.ts:259:38)

FAIL src/services/__tests__/serviceWorkerManager.test.ts
  ● ServiceWorkerManager › caching › should get cache status

    expect(received).toHaveProperty(path)

    Expected path: "cached"
    Received path: []

    Received value: {"aiModels": false, "cacheVersion": "1.0.0", "crisisResources": false, "culturalContent": false, "staticResources": false, "swRegistered": true, "translations": false, "updateAvailable": false}

    [0m [90m 74 |[39m     it([32m'should get cache status'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 75 |[39m       [36mconst[39m status [33m=[39m [36mawait[39m serviceWorkerManager[33m.[39mgetCacheStatus()[33m;[39m
    [31m[1m>[22m[39m[90m 76 |[39m       expect(status)[33m.[39mtoHaveProperty([32m'cached'[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 77 |[39m       expect(status)[33m.[39mtoHaveProperty([32m'size'[39m)[33m;[39m
     [90m 78 |[39m     })[33m;[39m
     [90m 79 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerManager.test.ts:76:22)

FAIL src/services/__tests__/serviceWorkerConfig.test.ts
  ● Service Worker Configuration › service worker registration › should register service worker successfully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/sw.js", {"scope": "/", "updateViaCache": "none"}

    Number of calls: 0

    [0m [90m 32 |[39m       [36mconst[39m registration [33m=[39m [36mawait[39m registerServiceWorker()[33m;[39m
     [90m 33 |[39m
    [31m[1m>[22m[39m[90m 34 |[39m       expect(navigator[33m.[39mserviceWorker[33m.[39mregister)[33m.[39mtoHaveBeenCalledWith([32m'/sw.js'[39m[33m,[39m {
     [90m    |[39m                                                [31m[1m^[22m[39m
     [90m 35 |[39m         scope[33m:[39m [32m'/'[39m[33m,[39m
     [90m 36 |[39m         updateViaCache[33m:[39m [32m'none'[39m
     [90m 37 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:34:48)

  ● Service Worker Configuration › service worker updates › should check for updates

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 60 |[39m       [36mawait[39m updateServiceWorker()[33m;[39m
     [90m 61 |[39m
    [31m[1m>[22m[39m[90m 62 |[39m       expect(mockServiceWorkerRegistration[33m.[39mupdate)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m    |[39m                                                    [31m[1m^[22m[39m
     [90m 63 |[39m     })[33m;[39m
     [90m 64 |[39m
     [90m 65 |[39m     it([32m'should handle update check failures'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:62:52)

  ● Service Worker Configuration › service worker updates › should notify when new version is available

    expect(received).toBeInstanceOf(expected)

    Expected constructor: Function
    Received constructor: Function

    [0m [90m 79 |[39m       })[33m;[39m
     [90m 80 |[39m
    [31m[1m>[22m[39m[90m 81 |[39m       expect(updateHandler)[33m.[39mtoBeInstanceOf([33mFunction[39m)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 82 |[39m     })[33m;[39m
     [90m 83 |[39m   })[33m;[39m
     [90m 84 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:81:29)

  ● Service Worker Configuration › service worker unregistration › should unregister service worker

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 87 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m unregisterServiceWorker()[33m;[39m
     [90m 88 |[39m
    [31m[1m>[22m[39m[90m 89 |[39m       expect(mockServiceWorkerRegistration[33m.[39munregister)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m    |[39m                                                        [31m[1m^[22m[39m
     [90m 90 |[39m       expect(result)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 91 |[39m     })[33m;[39m
     [90m 92 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:89:56)

  ● Service Worker Configuration › service worker unregistration › should handle unregistration when no service worker exists

    TypeError: Cannot read properties of undefined (reading 'getRegistration')

    [0m [90m 92 |[39m
     [90m 93 |[39m     it([32m'should handle unregistration when no service worker exists'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 94 |[39m       (navigator[33m.[39mserviceWorker[33m.[39mgetRegistration [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockResolvedValue([36mnull[39m)[33m;[39m
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 95 |[39m
     [90m 96 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m unregisterServiceWorker()[33m;[39m
     [90m 97 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:94:32)

  ● Service Worker Configuration › service worker lifecycle › should handle install event

    expect(received).toBeInstanceOf(expected)

    Expected constructor: Function
    Received constructor: Function

    [0m [90m 108 |[39m       })[33m;[39m
     [90m 109 |[39m
    [31m[1m>[22m[39m[90m 110 |[39m       expect(installHandler)[33m.[39mtoBeInstanceOf([33mFunction[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 111 |[39m     })[33m;[39m
     [90m 112 |[39m
     [90m 113 |[39m     it([32m'should handle activate event'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:110:30)

  ● Service Worker Configuration › service worker lifecycle › should handle activate event

    expect(received).toBeInstanceOf(expected)

    Expected constructor: Function
    Received constructor: Function

    [0m [90m 118 |[39m       })[33m;[39m
     [90m 119 |[39m
    [31m[1m>[22m[39m[90m 120 |[39m       expect(activateHandler)[33m.[39mtoBeInstanceOf([33mFunction[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 121 |[39m     })[33m;[39m
     [90m 122 |[39m
     [90m 123 |[39m     it([32m'should handle fetch event for offline support'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:120:31)

  ● Service Worker Configuration › service worker lifecycle › should handle fetch event for offline support

    expect(received).toBeInstanceOf(expected)

    Expected constructor: Function
    Received constructor: Function

    [0m [90m 128 |[39m       })[33m;[39m
     [90m 129 |[39m
    [31m[1m>[22m[39m[90m 130 |[39m       expect(fetchHandler)[33m.[39mtoBeInstanceOf([33mFunction[39m)[33m;[39m
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 131 |[39m     })[33m;[39m
     [90m 132 |[39m   })[33m;[39m
     [90m 133 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:130:28)

  ● Service Worker Configuration › caching strategies › should implement cache-first strategy for static assets

    TypeError: Cannot read properties of undefined (reading 'register')

    [0m [90m 141 |[39m       registerServiceWorker(config)[33m;[39m
     [90m 142 |[39m
    [31m[1m>[22m[39m[90m 143 |[39m       expect(navigator[33m.[39mserviceWorker[33m.[39mregister)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 144 |[39m     })[33m;[39m
     [90m 145 |[39m
     [90m 146 |[39m     it([32m'should implement network-first strategy for API calls'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:143:38)

  ● Service Worker Configuration › caching strategies › should implement network-first strategy for API calls

    TypeError: Cannot read properties of undefined (reading 'register')

    [0m [90m 152 |[39m       registerServiceWorker(config)[33m;[39m
     [90m 153 |[39m
    [31m[1m>[22m[39m[90m 154 |[39m       expect(navigator[33m.[39mserviceWorker[33m.[39mregister)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 155 |[39m     })[33m;[39m
     [90m 156 |[39m
     [90m 157 |[39m     it([32m'should implement stale-while-revalidate for dynamic content'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:154:38)

  ● Service Worker Configuration › caching strategies › should implement stale-while-revalidate for dynamic content

    TypeError: Cannot read properties of undefined (reading 'register')

    [0m [90m 163 |[39m       registerServiceWorker(config)[33m;[39m
     [90m 164 |[39m
    [31m[1m>[22m[39m[90m 165 |[39m       expect(navigator[33m.[39mserviceWorker[33m.[39mregister)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 166 |[39m     })[33m;[39m
     [90m 167 |[39m   })[33m;[39m
     [90m 168 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:165:38)

  ● Service Worker Configuration › offline functionality › should configure offline page

    TypeError: Cannot read properties of undefined (reading 'register')

    [0m [90m 176 |[39m       registerServiceWorker(config)[33m;[39m
     [90m 177 |[39m
    [31m[1m>[22m[39m[90m 178 |[39m       expect(navigator[33m.[39mserviceWorker[33m.[39mregister)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 179 |[39m     })[33m;[39m
     [90m 180 |[39m
     [90m 181 |[39m     it([32m'should handle crisis resources offline'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:178:38)

  ● Service Worker Configuration › offline functionality › should handle crisis resources offline

    TypeError: Cannot read properties of undefined (reading 'register')

    [0m [90m 190 |[39m       registerServiceWorker(config)[33m;[39m
     [90m 191 |[39m
    [31m[1m>[22m[39m[90m 192 |[39m       expect(navigator[33m.[39mserviceWorker[33m.[39mregister)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 193 |[39m     })[33m;[39m
     [90m 194 |[39m   })[33m;[39m
     [90m 195 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:192:38)

  ● Service Worker Configuration › push notification support › should configure push notification handling

    TypeError: Cannot read properties of undefined (reading 'register')

    [0m [90m 205 |[39m       registerServiceWorker(config)[33m;[39m
     [90m 206 |[39m
    [31m[1m>[22m[39m[90m 207 |[39m       expect(navigator[33m.[39mserviceWorker[33m.[39mregister)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 208 |[39m     })[33m;[39m
     [90m 209 |[39m
     [90m 210 |[39m     it([32m'should handle background sync for offline actions'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:207:38)

  ● Service Worker Configuration › push notification support › should handle background sync for offline actions

    TypeError: Cannot read properties of undefined (reading 'register')

    [0m [90m 218 |[39m       registerServiceWorker(config)[33m;[39m
     [90m 219 |[39m
    [31m[1m>[22m[39m[90m 220 |[39m       expect(navigator[33m.[39mserviceWorker[33m.[39mregister)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 221 |[39m     })[33m;[39m
     [90m 222 |[39m   })[33m;[39m
     [90m 223 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:220:38)

  ● Service Worker Configuration › performance optimization › should preload critical resources

    TypeError: Cannot read properties of undefined (reading 'register')

    [0m [90m 234 |[39m       registerServiceWorker(config)[33m;[39m
     [90m 235 |[39m
    [31m[1m>[22m[39m[90m 236 |[39m       expect(navigator[33m.[39mserviceWorker[33m.[39mregister)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 237 |[39m     })[33m;[39m
     [90m 238 |[39m
     [90m 239 |[39m     it([32m'should implement resource hinting'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:236:38)

  ● Service Worker Configuration › performance optimization › should implement resource hinting

    TypeError: Cannot read properties of undefined (reading 'register')

    [0m [90m 247 |[39m       registerServiceWorker(config)[33m;[39m
     [90m 248 |[39m
    [31m[1m>[22m[39m[90m 249 |[39m       expect(navigator[33m.[39mserviceWorker[33m.[39mregister)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 250 |[39m     })[33m;[39m
     [90m 251 |[39m   })[33m;[39m
     [90m 252 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:249:38)

  ● Service Worker Configuration › error handling and monitoring › should track service worker performance

    expect(received).toBeInstanceOf(expected)

    Expected constructor: Function
    Received constructor: Function

    [0m [90m 273 |[39m       })[33m;[39m
     [90m 274 |[39m
    [31m[1m>[22m[39m[90m 275 |[39m       expect(performanceHandler)[33m.[39mtoBeInstanceOf([33mFunction[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 276 |[39m     })[33m;[39m
     [90m 277 |[39m   })[33m;[39m
     [90m 278 |[39m })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/serviceWorkerConfig.test.ts:275:34)

FAIL src/services/__tests__/intelligentCachingService.test.ts
  ● IntelligentCachingService › cache management › should invalidate cache entries

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/cached-resource"

    Number of calls: 0

    [0m [90m 204 |[39m       [36mawait[39m service[33m.[39minvalidateCache(url[33m,[39m [32m'manual'[39m)[33m;[39m
     [90m 205 |[39m       
    [31m[1m>[22m[39m[90m 206 |[39m       expect(mockCache[33m.[39m[36mdelete[39m)[33m.[39mtoHaveBeenCalledWith(url)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 207 |[39m       expect(mockDatabase[33m.[39m[36mdelete[39m)[33m.[39mtoHaveBeenCalledWith(url)[33m;[39m
     [90m 208 |[39m     })[33m;[39m
     [90m 209 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/intelligentCachingService.test.ts:206:32)

  ● IntelligentCachingService › cache management › should clean up expired entries

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/old-resource"

    Number of calls: 0

    [0m [90m 246 |[39m       
     [90m 247 |[39m       expect(cleanedCount)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 248 |[39m       expect(mockCache[33m.[39m[36mdelete[39m)[33m.[39mtoHaveBeenCalledWith([32m'/old-resource'[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 249 |[39m     })[33m;[39m
     [90m 250 |[39m
     [90m 251 |[39m     it([32m'should get cache analytics'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/intelligentCachingService.test.ts:248:32)

  ● IntelligentCachingService › cache eviction and cleanup › should perform intelligent eviction when storage is high

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 307 |[39m       [36mawait[39m service[33m.[39mperformIntelligentEviction()[33m;[39m
     [90m 308 |[39m
    [31m[1m>[22m[39m[90m 309 |[39m       expect(mockCache[33m.[39m[36mdelete[39m)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 310 |[39m     })[33m;[39m
     [90m 311 |[39m
     [90m 312 |[39m     it([32m'should never evict critical resources'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/intelligentCachingService.test.ts:309:32)

  ● IntelligentCachingService › cache eviction and cleanup › should clean up expired entries based on retention policy

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/old-low-priority"

    Number of calls: 0

    [0m [90m 359 |[39m
     [90m 360 |[39m       expect(cleanedCount)[33m.[39mtoBe([35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 361 |[39m       expect(mockCache[33m.[39m[36mdelete[39m)[33m.[39mtoHaveBeenCalledWith([32m'/old-low-priority'[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 362 |[39m       expect(mockCache[33m.[39m[36mdelete[39m)[33m.[39mnot[33m.[39mtoHaveBeenCalledWith([32m'/recent-high-priority'[39m)[33m;[39m
     [90m 363 |[39m     })[33m;[39m
     [90m 364 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/intelligentCachingService.test.ts:361:32)

  ● IntelligentCachingService › cache invalidation › should invalidate cache entries

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/resource-to-invalidate"
    Received: "cache_entries", "/resource-to-invalidate"

    Number of calls: 1

    [0m [90m 512 |[39m       
     [90m 513 |[39m       expect(mockCache[33m.[39m[36mdelete[39m)[33m.[39mtoHaveBeenCalledWith(url)[33m;[39m
    [31m[1m>[22m[39m[90m 514 |[39m       expect(mockDatabase[33m.[39m[36mdelete[39m)[33m.[39mtoHaveBeenCalledWith(url)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 515 |[39m     })[33m;[39m
     [90m 516 |[39m
     [90m 517 |[39m     it([32m'should handle invalidation errors gracefully'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/intelligentCachingService.test.ts:514:35)

FAIL src/services/__tests__/encryptionService.test.ts
  ● EncryptionService › Encryption and Decryption › should encrypt and decrypt data successfully

    Encryption not supported in this browser

    [0m [90m 290 |[39m   [36mpublic[39m [36masync[39m encrypt(data[33m:[39m string[33m,[39m key[33m:[39m string)[33m:[39m [33mPromise[39m[33m<[39m[33mEncryptedData[39m[33m>[39m {
     [90m 291 |[39m     [36mif[39m ([33m![39m[36mthis[39m[33m.[39misSupported) {
    [31m[1m>[22m[39m[90m 292 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Encryption not supported in this browser'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 293 |[39m     }
     [90m 294 |[39m
     [90m 295 |[39m     [36mtry[39m {[0m

      at EncryptionService.encrypt (src/services/encryptionService.ts:292:13)
      at Object.<anonymous> (src/services/__tests__/encryptionService.test.ts:19:54)

  ● EncryptionService › Encryption and Decryption › should handle string data

    Encryption not supported in this browser

    [0m [90m 290 |[39m   [36mpublic[39m [36masync[39m encrypt(data[33m:[39m string[33m,[39m key[33m:[39m string)[33m:[39m [33mPromise[39m[33m<[39m[33mEncryptedData[39m[33m>[39m {
     [90m 291 |[39m     [36mif[39m ([33m![39m[36mthis[39m[33m.[39misSupported) {
    [31m[1m>[22m[39m[90m 292 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Encryption not supported in this browser'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 293 |[39m     }
     [90m 294 |[39m
     [90m 295 |[39m     [36mtry[39m {[0m

      at EncryptionService.encrypt (src/services/encryptionService.ts:292:13)
      at Object.<anonymous> (src/services/__tests__/encryptionService.test.ts:31:54)

  ● EncryptionService › Encryption and Decryption › should handle complex objects

    Encryption not supported in this browser

    [0m [90m 290 |[39m   [36mpublic[39m [36masync[39m encrypt(data[33m:[39m string[33m,[39m key[33m:[39m string)[33m:[39m [33mPromise[39m[33m<[39m[33mEncryptedData[39m[33m>[39m {
     [90m 291 |[39m     [36mif[39m ([33m![39m[36mthis[39m[33m.[39misSupported) {
    [31m[1m>[22m[39m[90m 292 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Encryption not supported in this browser'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 293 |[39m     }
     [90m 294 |[39m
     [90m 295 |[39m     [36mtry[39m {[0m

      at EncryptionService.encrypt (src/services/encryptionService.ts:292:13)
      at Object.<anonymous> (src/services/__tests__/encryptionService.test.ts:54:54)

  ● EncryptionService › Encryption and Decryption › should generate different encrypted values for same data

    Encryption not supported in this browser

    [0m [90m 290 |[39m   [36mpublic[39m [36masync[39m encrypt(data[33m:[39m string[33m,[39m key[33m:[39m string)[33m:[39m [33mPromise[39m[33m<[39m[33mEncryptedData[39m[33m>[39m {
     [90m 291 |[39m     [36mif[39m ([33m![39m[36mthis[39m[33m.[39misSupported) {
    [31m[1m>[22m[39m[90m 292 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Encryption not supported in this browser'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 293 |[39m     }
     [90m 294 |[39m
     [90m 295 |[39m     [36mtry[39m {[0m

      at EncryptionService.encrypt (src/services/encryptionService.ts:292:13)
      at Object.<anonymous> (src/services/__tests__/encryptionService.test.ts:63:55)

  ● EncryptionService › Encryption Stats › should get encryption statistics

    expect(received).toHaveProperty(path)

    Expected path: "totalEncrypted"
    Received path: []

    Received value: {"classifications": {}, "encryptedKeys": 0, "hipaaCompliantKeys": 0, "isSupported": false, "totalKeys": 0}

    [0m [90m 92 |[39m       
     [90m 93 |[39m       expect(stats)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 94 |[39m       expect(stats)[33m.[39mtoHaveProperty([32m'totalEncrypted'[39m)[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 95 |[39m       expect(stats)[33m.[39mtoHaveProperty([32m'totalDecrypted'[39m)[33m;[39m
     [90m 96 |[39m       expect(stats)[33m.[39mtoHaveProperty([32m'encryptionErrors'[39m)[33m;[39m
     [90m 97 |[39m       expect(stats)[33m.[39mtoHaveProperty([32m'decryptionErrors'[39m)[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/encryptionService.test.ts:94:21)

  ● EncryptionService › Secure Storage › should store encrypted data in localStorage

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "John Doe"
    Received string:        "{\"id\":1,\"name\":\"John Doe\"}"

    [0m [90m 108 |[39m       [36mconst[39m stored [33m=[39m localStorage[33m.[39mgetItem(key)[33m;[39m
     [90m 109 |[39m       expect(stored)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 110 |[39m       expect(stored)[33m.[39mnot[33m.[39mtoContain([32m'John Doe'[39m)[33m;[39m [90m// Should be encrypted[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 111 |[39m       
     [90m 112 |[39m       [36mconst[39m retrieved [33m=[39m [36mawait[39m getEncryptionService()[33m.[39msecureGetItem(key)[33m;[39m
     [90m 113 |[39m       [36mconst[39m parsedRetrieved [33m=[39m retrieved [33m?[39m [33mJSON[39m[33m.[39mparse(retrieved) [33m:[39m [36mnull[39m[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/encryptionService.test.ts:110:26)

  ● EncryptionService › HIPAA Compliance › should perform HIPAA compliance check

    expect(received).toHaveProperty(path)

    Expected path: "checks"
    Received path: []

    Received value: {"compliant": true, "recommendations": [], "violations": []}

    [0m [90m 137 |[39m       expect(complianceCheck)[33m.[39mtoBeDefined()[33m;[39m
     [90m 138 |[39m       expect(complianceCheck)[33m.[39mtoHaveProperty([32m'compliant'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 139 |[39m       expect(complianceCheck)[33m.[39mtoHaveProperty([32m'checks'[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 140 |[39m     })[33m;[39m
     [90m 141 |[39m   })[33m;[39m
     [90m 142 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/encryptionService.test.ts:139:31)

  ● EncryptionService › Error Handling › should handle corrupted stored data

    expect(received).toBeNull()

    Received: "not-encrypted-data"

    [0m [90m 166 |[39m       localStorage[33m.[39msetItem([32m'corrupted'[39m[33m,[39m [32m'not-encrypted-data'[39m)[33m;[39m
     [90m 167 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getEncryptionService()[33m.[39msecureGetItem([32m'corrupted'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 168 |[39m       expect(result)[33m.[39mtoBeNull()[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 169 |[39m     })[33m;[39m
     [90m 170 |[39m   })[33m;[39m
     [90m 171 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/encryptionService.test.ts:168:22)

FAIL src/services/__tests__/peerSupportNetworkService.test.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/contexts/__tests__/AuthContext.test.tsx
  ● AuthContext › AuthProvider › should provide default values

    TypeError: mockUseNotification.mockReturnValue is not a function

    [0m [90m 15 |[39m   beforeEach(() [33m=>[39m {
     [90m 16 |[39m     jest[33m.[39mclearAllMocks()[33m;[39m
    [31m[1m>[22m[39m[90m 17 |[39m     mockUseNotification[33m.[39mmockReturnValue({
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 18 |[39m       toasts[33m:[39m [][33m,[39m
     [90m 19 |[39m       addToast[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 20 |[39m       removeToast[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.<anonymous> (src/contexts/__tests__/AuthContext.test.tsx:17:25)

  ● AuthContext › AuthProvider › should handle login function

    TypeError: mockUseNotification.mockReturnValue is not a function

    [0m [90m 15 |[39m   beforeEach(() [33m=>[39m {
     [90m 16 |[39m     jest[33m.[39mclearAllMocks()[33m;[39m
    [31m[1m>[22m[39m[90m 17 |[39m     mockUseNotification[33m.[39mmockReturnValue({
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 18 |[39m       toasts[33m:[39m [][33m,[39m
     [90m 19 |[39m       addToast[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 20 |[39m       removeToast[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.<anonymous> (src/contexts/__tests__/AuthContext.test.tsx:17:25)

  ● AuthContext › AuthProvider › should handle logout function

    TypeError: mockUseNotification.mockReturnValue is not a function

    [0m [90m 15 |[39m   beforeEach(() [33m=>[39m {
     [90m 16 |[39m     jest[33m.[39mclearAllMocks()[33m;[39m
    [31m[1m>[22m[39m[90m 17 |[39m     mockUseNotification[33m.[39mmockReturnValue({
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 18 |[39m       toasts[33m:[39m [][33m,[39m
     [90m 19 |[39m       addToast[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 20 |[39m       removeToast[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.<anonymous> (src/contexts/__tests__/AuthContext.test.tsx:17:25)

  ● AuthContext › AuthProvider › should handle updateHelperProfile

    TypeError: mockUseNotification.mockReturnValue is not a function

    [0m [90m 15 |[39m   beforeEach(() [33m=>[39m {
     [90m 16 |[39m     jest[33m.[39mclearAllMocks()[33m;[39m
    [31m[1m>[22m[39m[90m 17 |[39m     mockUseNotification[33m.[39mmockReturnValue({
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 18 |[39m       toasts[33m:[39m [][33m,[39m
     [90m 19 |[39m       addToast[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 20 |[39m       removeToast[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.<anonymous> (src/contexts/__tests__/AuthContext.test.tsx:17:25)

  ● AuthContext › useAuth hook › should throw error when used outside provider

    TypeError: mockUseNotification.mockReturnValue is not a function

    [0m [90m 15 |[39m   beforeEach(() [33m=>[39m {
     [90m 16 |[39m     jest[33m.[39mclearAllMocks()[33m;[39m
    [31m[1m>[22m[39m[90m 17 |[39m     mockUseNotification[33m.[39mmockReturnValue({
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 18 |[39m       toasts[33m:[39m [][33m,[39m
     [90m 19 |[39m       addToast[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 20 |[39m       removeToast[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.<anonymous> (src/contexts/__tests__/AuthContext.test.tsx:17:25)

  ● AuthContext › useAuth hook › should return auth context when used within provider

    TypeError: mockUseNotification.mockReturnValue is not a function

    [0m [90m 15 |[39m   beforeEach(() [33m=>[39m {
     [90m 16 |[39m     jest[33m.[39mclearAllMocks()[33m;[39m
    [31m[1m>[22m[39m[90m 17 |[39m     mockUseNotification[33m.[39mmockReturnValue({
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 18 |[39m       toasts[33m:[39m [][33m,[39m
     [90m 19 |[39m       addToast[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 20 |[39m       removeToast[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.<anonymous> (src/contexts/__tests__/AuthContext.test.tsx:17:25)

  ● AuthContext › Global authState › should be accessible and updatable

    TypeError: mockUseNotification.mockReturnValue is not a function

    [0m [90m 15 |[39m   beforeEach(() [33m=>[39m {
     [90m 16 |[39m     jest[33m.[39mclearAllMocks()[33m;[39m
    [31m[1m>[22m[39m[90m 17 |[39m     mockUseNotification[33m.[39mmockReturnValue({
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 18 |[39m       toasts[33m:[39m [][33m,[39m
     [90m 19 |[39m       addToast[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 20 |[39m       removeToast[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.<anonymous> (src/contexts/__tests__/AuthContext.test.tsx:17:25)

FAIL tests/integration/enhancedCrisisDetectionIntegration.test.ts
  ● Enhanced Crisis Detection Integration › should fallback to basic detection when enhanced fails

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 34 |[39m     [90m// Should still detect crisis even in fallback mode[39m
     [90m 35 |[39m     expect(result)[33m.[39mtoHaveProperty([32m'isCrisis'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 36 |[39m     expect(result[33m.[39misCrisis)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 37 |[39m
     [90m 38 |[39m     console[33m.[39merror [33m=[39m originalConsoleError[33m;[39m
     [90m 39 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/enhancedCrisisDetectionIntegration.test.ts:36:29)

  ● Enhanced Crisis Detection Integration › should detect various crisis indicators

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 51 |[39m     [36mfor[39m ([36mconst[39m text [36mof[39m testCases) {
     [90m 52 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m crisisService[33m.[39manalyze(text)[33m;[39m
    [31m[1m>[22m[39m[90m 53 |[39m       expect(result[33m.[39misCrisis)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 54 |[39m       expect(result[33m.[39mseverity)[33m.[39mnot[33m.[39mtoBe([32m'none'[39m)[33m;[39m
     [90m 55 |[39m     }
     [90m 56 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/enhancedCrisisDetectionIntegration.test.ts:53:31)

FAIL src/stores/assessmentStore.test.ts
  ● assessmentStore › submitPhq9Result should call the API and then refresh history

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/api/assessments/submit", {"body": "{\"type\":\"phq-9\",\"score\":15,\"answers\":[1,2,3,1,2,3,1,2,0],\"timestamp\":{\"inverse\":false}}", "headers": {"Authorization": "Bearer user123", "Content-Type": "application/json"}, "method": "POST"}
    Received
           1
              "/api/assessments/submit",
            @@ -1,7 +1,7 @@
              Object {
            -   "body": "{\"type\":\"phq-9\",\"score\":15,\"answers\":[1,2,3,1,2,3,1,2,0],\"timestamp\":{\"inverse\":false}}",
            +   "body": "{\"type\":\"phq-9\",\"score\":15,\"answers\":[1,2,3,1,2,3,1,2,0],\"timestamp\":\"2025-08-17T19:58:45.070Z\"}",
                "headers": Object {
                  "Authorization": "Bearer user123",
                  "Content-Type": "application/json",
                },
                "method": "POST",,
           2
              "/api/assessments/history",
              Object {
            -   "body": "{\"type\":\"phq-9\",\"score\":15,\"answers\":[1,2,3,1,2,3,1,2,0],\"timestamp\":{\"inverse\":false}}",
                "headers": Object {
                  "Authorization": "Bearer user123",
                  "Content-Type": "application/json",
                },
            -   "method": "POST",
              },

    Number of calls: 2

    [0m [90m 65 |[39m     })[33m;[39m
     [90m 66 |[39m
    [31m[1m>[22m[39m[90m 67 |[39m     expect(mockedFetch)[33m.[39mtoHaveBeenCalledWith([32m'/api/assessments/submit'[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 68 |[39m       method[33m:[39m [32m'POST'[39m[33m,[39m
     [90m 69 |[39m       headers[33m:[39m {
     [90m 70 |[39m         [32m'Authorization'[39m[33m:[39m [32m'Bearer user123'[39m[33m,[39m[0m

      at Object.<anonymous> (src/stores/assessmentStore.test.ts:67:25)

  ● assessmentStore › submitGad7Result should call the API and then refresh history

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/api/assessments/submit", {"body": "{\"type\":\"gad-7\",\"score\":12,\"answers\":[1,2,3,1,2,3,0],\"timestamp\":{\"inverse\":false}}", "headers": {"Authorization": "Bearer user123", "Content-Type": "application/json"}, "method": "POST"}
    Received
           1
              "/api/assessments/submit",
            @@ -1,7 +1,7 @@
              Object {
            -   "body": "{\"type\":\"gad-7\",\"score\":12,\"answers\":[1,2,3,1,2,3,0],\"timestamp\":{\"inverse\":false}}",
            +   "body": "{\"type\":\"gad-7\",\"score\":12,\"answers\":[1,2,3,1,2,3,0],\"timestamp\":\"2025-08-17T19:58:45.077Z\"}",
                "headers": Object {
                  "Authorization": "Bearer user123",
                  "Content-Type": "application/json",
                },
                "method": "POST",,
           2
              "/api/assessments/history",
              Object {
            -   "body": "{\"type\":\"gad-7\",\"score\":12,\"answers\":[1,2,3,1,2,3,0],\"timestamp\":{\"inverse\":false}}",
                "headers": Object {
                  "Authorization": "Bearer user123",
                  "Content-Type": "application/json",
                },
            -   "method": "POST",
              },

    Number of calls: 2

    [0m [90m 101 |[39m     })[33m;[39m
     [90m 102 |[39m
    [31m[1m>[22m[39m[90m 103 |[39m     expect(mockedFetch)[33m.[39mtoHaveBeenCalledWith([32m'/api/assessments/submit'[39m[33m,[39m {
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 104 |[39m       method[33m:[39m [32m'POST'[39m[33m,[39m
     [90m 105 |[39m       headers[33m:[39m {
     [90m 106 |[39m         [32m'Authorization'[39m[33m:[39m [32m'Bearer user123'[39m[33m,[39m[0m

      at Object.<anonymous> (src/stores/assessmentStore.test.ts:103:25)

FAIL src/contexts/__tests__/ThemeContext.test.tsx
  ● ThemeContext › ThemeProvider › should handle theme toggle

    expect(element).toHaveTextContent()

    Expected element to have text content:
      dark
    Received:
      light

    [0m [90m 58 |[39m       })[33m;[39m
     [90m 59 |[39m
    [31m[1m>[22m[39m[90m 60 |[39m       expect(screen[33m.[39mgetByTestId([32m'theme'[39m))[33m.[39mtoHaveTextContent([32m'dark'[39m)[33m;[39m
     [90m    |[39m                                           [31m[1m^[22m[39m
     [90m 61 |[39m
     [90m 62 |[39m       [90m// Toggle back to light theme[39m
     [90m 63 |[39m       act(() [33m=>[39m {[0m

      at Object.<anonymous> (src/contexts/__tests__/ThemeContext.test.tsx:60:43)

  ● ThemeContext › ThemeProvider › should persist theme to localStorage

    expect(received).toBeNull()

    Received: "light"

    [0m [90m 81 |[39m
     [90m 82 |[39m       [90m// Initially no theme in localStorage[39m
    [31m[1m>[22m[39m[90m 83 |[39m       expect(localStorage[33m.[39mgetItem([32m'theme'[39m))[33m.[39mtoBeNull()[33m;[39m
     [90m    |[39m                                             [31m[1m^[22m[39m
     [90m 84 |[39m
     [90m 85 |[39m       [90m// Toggle to dark theme[39m
     [90m 86 |[39m       act(() [33m=>[39m {[0m

      at Object.<anonymous> (src/contexts/__tests__/ThemeContext.test.tsx:83:45)

  ● ThemeContext › ThemeProvider › should provide correct dark theme config

    expect(element).toHaveTextContent()

    Expected element to have text content:
      #1a1a1a
    Received:
      #161b22

    [0m [90m 136 |[39m       )[33m;[39m
     [90m 137 |[39m
    [31m[1m>[22m[39m[90m 138 |[39m       expect(screen[33m.[39mgetByTestId([32m'bg-primary'[39m))[33m.[39mtoHaveTextContent([32m'#1a1a1a'[39m)[33m;[39m
     [90m     |[39m                                                [31m[1m^[22m[39m
     [90m 139 |[39m       expect(screen[33m.[39mgetByTestId([32m'text-primary'[39m))[33m.[39mtoHaveTextContent([32m'#e0e0e0'[39m)[33m;[39m
     [90m 140 |[39m     })[33m;[39m
     [90m 141 |[39m[0m

      at Object.<anonymous> (src/contexts/__tests__/ThemeContext.test.tsx:138:48)

  ● ThemeContext › ThemeProvider › should apply theme class to document root

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 153 |[39m
     [90m 154 |[39m       [90m// Initially light theme[39m
    [31m[1m>[22m[39m[90m 155 |[39m       expect(document[33m.[39mdocumentElement[33m.[39mclassList[33m.[39mcontains([32m'theme-light'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                                          [31m[1m^[22m[39m
     [90m 156 |[39m       expect(document[33m.[39mdocumentElement[33m.[39mclassList[33m.[39mcontains([32m'theme-dark'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 157 |[39m
     [90m 158 |[39m       [90m// Toggle to dark theme[39m[0m

      at Object.<anonymous> (src/contexts/__tests__/ThemeContext.test.tsx:155:74)

FAIL src/services/__tests__/culturalCrisisDetectionService.test.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/services/__tests__/accessibilityService.test.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/services/__tests__/mobileNetworkService.test.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/services/__tests__/errorTracking.test.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/services/__tests__/intelligentPreloading.test.ts
  ● IntelligentPreloadingEngine › Route Prediction Model › should predict next routes based on navigation patterns

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 45 |[39m
     [90m 46 |[39m       expect(routePredictions[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 47 |[39m       expect(routePredictions[33m.[39msome(p [33m=>[39m p[33m.[39mconfidence [33m>[39m [35m0.5[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m    |[39m                                                              [31m[1m^[22m[39m
     [90m 48 |[39m     })[33m;[39m
     [90m 49 |[39m
     [90m 50 |[39m     it([32m'should prioritize frequently visited routes'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/intelligentPreloading.test.ts:47:62)

  ● IntelligentPreloadingEngine › Resource Usage Prediction › should predict resource needs based on patterns

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 102 |[39m       )[33m;[39m
     [90m 103 |[39m
    [31m[1m>[22m[39m[90m 104 |[39m       expect(resourcePredictions[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 105 |[39m     })[33m;[39m
     [90m 106 |[39m   })[33m;[39m
     [90m 107 |[39m[0m

      at Object.<anonymous> (src/services/__tests__/intelligentPreloading.test.ts:104:42)

FAIL src/services/__tests__/cacheStrategyCoordinator.test.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/services/__tests__/pushNotificationService.test.ts
  ● PushNotificationService › initialization › should request notification permissions

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 45 |[39m       [36mconst[39m permission [33m=[39m [36mawait[39m service[33m.[39mrequestPermission()[33m;[39m
     [90m 46 |[39m       
    [31m[1m>[22m[39m[90m 47 |[39m       expect([33mNotification[39m[33m.[39mrequestPermission)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m    |[39m                                              [31m[1m^[22m[39m
     [90m 48 |[39m       expect(permission)[33m.[39mtoBe([32m'granted'[39m)[33m;[39m
     [90m 49 |[39m     })[33m;[39m
     [90m 50 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/pushNotificationService.test.ts:47:46)

  ● PushNotificationService › subscription management › should subscribe user to push notifications

    expect(received).toEqual(expected) // deep equality

    Expected: {"endpoint": "https://fcm.googleapis.com/fcm/send/test", "keys": {"auth": "test-auth", "p256dh": "test-key"}}
    Received: null

    [0m [90m 64 |[39m       [36mconst[39m subscription [33m=[39m [36mawait[39m service[33m.[39msubscribe()[33m;[39m
     [90m 65 |[39m
    [31m[1m>[22m[39m[90m 66 |[39m       expect(subscription)[33m.[39mtoEqual(mockSubscription)[33m;[39m
     [90m    |[39m                            [31m[1m^[22m[39m
     [90m 67 |[39m     })[33m;[39m
     [90m 68 |[39m
     [90m 69 |[39m     it([32m'should handle crisis notification subscriptions'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/pushNotificationService.test.ts:66:28)

  ● PushNotificationService › subscription management › should handle crisis notification subscriptions

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 70 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m service[33m.[39msubscribeToCrisisAlerts([32m'user-123'[39m)[33m;[39m
     [90m 71 |[39m
    [31m[1m>[22m[39m[90m 72 |[39m       expect(result[33m.[39msubscribed)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 73 |[39m       expect(result[33m.[39malertTypes)[33m.[39mtoContain([32m'crisis_immediate'[39m)[33m;[39m
     [90m 74 |[39m     })[33m;[39m
     [90m 75 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/pushNotificationService.test.ts:72:33)

  ● PushNotificationService › crisis notifications › should send immediate crisis notification

    TypeError: navigator.serviceWorker.getRegistration is not a function

    [0m [90m 116 |[39m     }
     [90m 117 |[39m   )[33m:[39m [33mPromise[39m[33m<[39m[36mvoid[39m[33m>[39m {
    [31m[1m>[22m[39m[90m 118 |[39m     [36mconst[39m registration [33m=[39m [36mawait[39m navigator[33m.[39mserviceWorker[33m.[39mgetRegistration()[33m;[39m
     [90m     |[39m                                                        [31m[1m^[22m[39m
     [90m 119 |[39m     [36mif[39m ([33m![39mregistration) {
     [90m 120 |[39m       console[33m.[39mwarn([32m'[Push] No service worker registration for crisis notification'[39m)[33m;[39m
     [90m 121 |[39m       [36mreturn[39m[33m;[39m[0m

      at PushNotificationService.sendCrisisNotification (src/services/pushNotificationService.ts:118:56)
      at Object.<anonymous> (src/services/__tests__/pushNotificationService.test.ts:79:21)

  ● PushNotificationService › crisis notifications › should send safety check notifications

    TypeError: navigator.serviceWorker.getRegistration is not a function

    [0m [90m 147 |[39m     }
     [90m 148 |[39m   )[33m:[39m [33mPromise[39m[33m<[39m[36mvoid[39m[33m>[39m {
    [31m[1m>[22m[39m[90m 149 |[39m     [36mconst[39m registration [33m=[39m [36mawait[39m navigator[33m.[39mserviceWorker[33m.[39mgetRegistration()[33m;[39m
     [90m     |[39m                                                        [31m[1m^[22m[39m
     [90m 150 |[39m     [36mif[39m ([33m![39mregistration) {
     [90m 151 |[39m       console[33m.[39mwarn([32m'[Push] No service worker registration for safety check'[39m)[33m;[39m
     [90m 152 |[39m       [36mreturn[39m[33m;[39m[0m

      at PushNotificationService.sendSafetyCheckNotification (src/services/pushNotificationService.ts:149:56)
      at Object.<anonymous> (src/services/__tests__/pushNotificationService.test.ts:96:21)

  ● PushNotificationService › error handling › should handle permission denied gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: "denied"
    Received: false

    [0m [90m 144 |[39m
     [90m 145 |[39m       [36mconst[39m permission [33m=[39m [36mawait[39m service[33m.[39mrequestPermission()[33m;[39m
    [31m[1m>[22m[39m[90m 146 |[39m       expect(permission)[33m.[39mtoBe([32m'denied'[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 147 |[39m
     [90m 148 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m service[33m.[39msubscribe()[33m;[39m
     [90m 149 |[39m       expect(result)[33m.[39mtoBeNull()[33m;[39m[0m

      at Object.<anonymous> (src/services/__tests__/pushNotificationService.test.ts:146:26)

FAIL src/services/__tests__/analyticsService.test.ts
  ● AnalyticsService › Error Handling › should handle malformed stored data

    Storage quota exceeded

    [0m [90m 362 |[39m     it([32m'should handle localStorage errors gracefully'[39m[33m,[39m () [33m=>[39m {
     [90m 363 |[39m       localStorage[33m.[39msetItem[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 364 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage quota exceeded'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 365 |[39m       })[33m;[39m
     [90m 366 |[39m       
     [90m 367 |[39m       expect(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/analyticsService.test.ts:364:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● AnalyticsService › Configuration › should update configuration

    Storage quota exceeded

    [0m [90m 362 |[39m     it([32m'should handle localStorage errors gracefully'[39m[33m,[39m () [33m=>[39m {
     [90m 363 |[39m       localStorage[33m.[39msetItem[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 364 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage quota exceeded'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 365 |[39m       })[33m;[39m
     [90m 366 |[39m       
     [90m 367 |[39m       expect(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/analyticsService.test.ts:364:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● AnalyticsService › Configuration › should check if service is enabled

    Storage quota exceeded

    [0m [90m 362 |[39m     it([32m'should handle localStorage errors gracefully'[39m[33m,[39m () [33m=>[39m {
     [90m 363 |[39m       localStorage[33m.[39msetItem[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 364 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage quota exceeded'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 365 |[39m       })[33m;[39m
     [90m 366 |[39m       
     [90m 367 |[39m       expect(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/analyticsService.test.ts:364:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● AnalyticsService › Data Management › should get stored events

    Storage quota exceeded

    [0m [90m 362 |[39m     it([32m'should handle localStorage errors gracefully'[39m[33m,[39m () [33m=>[39m {
     [90m 363 |[39m       localStorage[33m.[39msetItem[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 364 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage quota exceeded'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 365 |[39m       })[33m;[39m
     [90m 366 |[39m       
     [90m 367 |[39m       expect(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/analyticsService.test.ts:364:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● AnalyticsService › Data Management › should clear stored data

    Storage quota exceeded

    [0m [90m 362 |[39m     it([32m'should handle localStorage errors gracefully'[39m[33m,[39m () [33m=>[39m {
     [90m 363 |[39m       localStorage[33m.[39msetItem[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 364 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage quota exceeded'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 365 |[39m       })[33m;[39m
     [90m 366 |[39m       
     [90m 367 |[39m       expect(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/analyticsService.test.ts:364:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● AnalyticsService › Singleton Service › should return singleton instance

    Storage quota exceeded

    [0m [90m 362 |[39m     it([32m'should handle localStorage errors gracefully'[39m[33m,[39m () [33m=>[39m {
     [90m 363 |[39m       localStorage[33m.[39msetItem[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 364 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage quota exceeded'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 365 |[39m       })[33m;[39m
     [90m 366 |[39m       
     [90m 367 |[39m       expect(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/analyticsService.test.ts:364:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

  ● AnalyticsService › Privacy Reporting › should generate privacy compliance report

    Storage quota exceeded

    [0m [90m 362 |[39m     it([32m'should handle localStorage errors gracefully'[39m[33m,[39m () [33m=>[39m {
     [90m 363 |[39m       localStorage[33m.[39msetItem[33m.[39mmockImplementation(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 364 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Storage quota exceeded'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 365 |[39m       })[33m;[39m
     [90m 366 |[39m       
     [90m 367 |[39m       expect(() [33m=>[39m {[0m

      at Object.<anonymous> (src/services/__tests__/analyticsService.test.ts:364:15)
      at setupDefaultMocks (src/__mocks__/services.ts:250:18)
      at Object.<anonymous> (src/setupTests.ts:1228:20)

FAIL src/views/ShareView.test.tsx
  ● ShareView user flow › user can chat with AI, draft a post, and submit it

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 46 |[39m
     [90m 47 |[39m     [90m// Assert AI was called and response is shown[39m
    [31m[1m>[22m[39m[90m 48 |[39m     expect(mockedApiClient[33m.[39mai[33m.[39mchat)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m    |[39m                                     [31m[1m^[22m[39m
     [90m 49 |[39m     expect([36mawait[39m screen[33m.[39mfindByText([35m/That sounds really tough/[39m))[33m.[39mtoBeTruthy()[33m;[39m
     [90m 50 |[39m
     [90m 51 |[39m     [90m// --- 2. User drafts a post from the chat ---[39m[0m

      at Object.<anonymous> (src/views/ShareView.test.tsx:48:37)

FAIL src/views/HelperDashboardView.test.tsx
  ● HelperDashboardView user flow › helper can view and accept an available dilemma

    TestingLibraryElementError: Found multiple elements with the text: /Available/

    Here are the matching elements:

    Ignored nodes: comments, script, style
    [36m<span[39m
      [33mclass[39m=[32m"btn-text"[39m
    [36m>[39m
      [0mAvailable ([0m
      [0m1[0m
      [0m)[0m
    [36m</span>[39m

    Ignored nodes: comments, script, style
    [36m<p[39m
      [33mclass[39m=[32m"empty-state-message"[39m
    [36m>[39m
      [0mNo specific dilemmas match your expertise right now. Check the 'Available' tab for all posts.[0m
    [36m</p>[39m

    (If this is intentional, then use the `*AllBy*` variant of the query (like `queryAllByText`, `getAllByText`, or `findAllByText`)).

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div[39m
        [33mdata-testid[39m=[32m"test-container"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"view-header"[39m
          [33mstyle[39m=[32m"display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;"[39m
        [36m>[39m
          [36m<div>[39m
            [36m<h1>[39m
              [0mHelper Dashboard[0m
            [36m</h1>[39m
            [36m<p[39m
              [33mclass[39m=[32m"view-subheader"[39m
            [36m>[39m
              [0mWelcome, [0m
              [0mTest Helper[0m
              [0m. Your current level is [0m
              [0m1[0m
              [0m.[0m
            [36m</p>[39m
          [36m</div>[39m
          [36m<button[39m
            [33mclass[39m=[32m"glass-button btn-primary-therapeutic ripple-button touch-optimized touch-feedback smooth-transition"[39m
            [33mstyle[39m=[32m"min-height: 44px; min-width: auto; display: inline-flex; align-items: center; justify-content: center;"[39m
            [33mtype[39m=[32m"button"[39m
          [36m>[39m
            [36m<span[39m
              [33mclass[39m=[32m"btn-text"[39m
            [36m>[39m
              [0mEdit Profile[0m
            [36m</span>[39m
          [36m</button>[39m
        [36m</div>[39m
        [36m<div>[39m
          [0mXPBar Mock[0m
        [36m</div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"card setting-item"[39m
          [33mstyle[39m=[32m"margin-bottom: 1.5rem;"[39m
        [36m>[39m
          [36m<label[39m
            [33mfor[39m=[32m"availability-toggle"[39m
            [33mstyle[39m=[32m"font-weight: 700; font-size: 1.1rem;"[39m
          [36m>[39m
            [0mYou are Online[0m
          [36m</label>[39m
          [36m<div[39m
            [33mclass[39m=[32m"theme-toggle"[39m
          [36m>[39m
            [36m<input[39m
              [33mchecked[39m=[32m""[39m
              [33mid[39m=[32m"availability-toggle"[39m
              [33mtype[39m=[32m"checkbox"[39m
            [36m/>[39m
            [36m<label[39m
              [33mclass[39m=[32m"slider"[39m
              [33mfor[39m=[32m"availability-toggle"[39m
            [36m/>[39m
          [36m</div>[39m
        [36m</div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"dashboard-tabs"[39m
        [36m>[39m
          [36m<button[39m
            [33mclass[39m=[32m"glass-button btn-primary-therapeutic ripple-button touch-optimized touch-feedback smooth-transition active"[39m
            [33mstyle[39m=[32m"min-height: 44px; min-width: auto; display: inline-flex; align-items: center; justify-content: center;"[39m
            [33mtype[39m=[32m"button"[39m
          [36m>[39m
            [36m<span[39m
              [33mclass[39m=[32m"btn-text"[39m
            [36m>[39m
              [0mFor You[0m
            [36m</span>[39m
          [36m</button>[39m
          [36m<button[39m
            [33mclass[39m=[32m"glass-button btn-primary-therapeutic ripple-button touch-optimized touch-feedback smooth-transition"[39m
            [33mstyle[39m=[32m"min-height: 44px; min-width: auto; display: inline-flex; align-items: center; justify-content: center;"[39m
            [33mtype[39m=[32m"button"[39m
          [36m>[39m
            [36m<span[39m
              [33mclass[39m=[32m"btn-text"[39m
            [36m>[39m
              [0mRequests ([0m
              [0m1[0m
              [0m)[0m
            [36m</span>[39m
          [36m</button>[39m
          [36m<button[39m
            [33mclass[39m=[32m"glass-button btn-primary-therapeutic ripple-button touch-optimized touch-feedback smooth-transition"[39m
            [33mstyle[39m=[32m"min-height: 44px; min-width: auto; display: inline-flex; align-items: center; justify-content: center;"[39m
            [33mtype[39m=[32m"button"[39m
          [36m>[39m
            [36m<span[39m
              [33mclass[39m=[32m"btn-text"[39m
            [36m>[39m
              [0mAvailable ([0m
              [0m1[0m
              [0m)[0m
            [36m</span>[39m
          [36m</button>[39m
          [36m<button[39m
            [33mclass[39m=[32m"glass-button btn-primary-therapeutic ripple-button touch-optimized touch-feedback smooth-transition"[39m
            [33mstyle[39m=[32m"min-height: 44px; min-width: auto; display: inline-flex; align-items: center; justify-content: center;"[39m
            [33mtype[39m=[32m"button"[39m
          [36m>[39m
            [36m<span[39m
              [33mclass[39m=[32m"btn-text"[39m
            [36m>[39m
              [0mMy Active ([0m
              [0m0[0m
              [0m)[0m
            [36m</span>[39m
          [36m</button>[39m
          [36m<button[39m
            [33mclass[39m=[32m"glass-button btn-primary-therapeutic ripple-button touch-optimized touch-feedback smooth-transition"[39m
            [33mstyle[39m=[32m"min-height: 44px; min-width: auto; display: inline-flex; align-items: center; justify-content: center;"[39m
            [33mtype[39m=[32m"button"[39m
          [36m>[39m
            [36m<span[39m
              [33mclass[39m=[32m"btn-text"[39m
            [36m>[39m
              [0mSession History[0m
            [36m</span>[39m
          [36m</button>[39m
          [36m<button[39m
            [33mclass[39m=[32m"glass-button btn-primary-therapeutic ripple-button touch-optimized touch-feedback smooth-transition"[39m
            [33mstyle[39m=[32m"min-height: 44px; min-width: auto; display: inline-flex; align-items: center; justify-content: center;"[39m
            [33mtype[39m=[32m"button"[39m
          [36m>[39m
            [36m<span[39m
              [33mclass[39m=[32m"btn-text"[39m
            [36m>[39m
              [0mMy Stats[0m
            [36m</span>[39m
          [36m</button>[39m
          [36m<button[39m
            [33mclass[39m=[32m"glass-button btn-primary-therapeutic ripple-button touch-optimized touch-feedback smooth-transition"[39m
            [33mstyle[39m=[32m"min-height: 44px; min-width: auto; display: inline-flex; align-items: center; justify-content: center;"[39m
            [33mtype[39m=[32m"button"[39m
          [36m>[39m
            [36m<span[39m
              [33mclass[39m=[32m"btn-text"[39m
            [36m>[39m
              [0mAchievements[0m
            [36m</span>[39m
          [36m</button>[39m
        [36m</div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"dashboard-content"[39m
        [36m>[39m
          [36m<ul[39m
            [33mclass[39m=[32m"posts-list"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"card"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"empty-state "[39m
              [36m>[39m
                [36m<h3[39m
                  [33mclass[39m=[32m"empty-state-title"[39m
                [36m>[39m
                  [0mNo Matches Found[0m
                [36m</h3>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"empty-state-message"[39m
                [36m>[39m
                  [0mNo specific dilemmas match your expertise right now. Check the 'Available' tab for all posts.[0m
                [36m</p>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</ul>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 53 |[39m
     [90m 54 |[39m     [90m// 1. User sees the dashboard and clicks on the "Available" tab[39m
    [31m[1m>[22m[39m[90m 55 |[39m     [36mconst[39m availableTab [33m=[39m screen[33m.[39mgetByText([35m/Available/[39m)[33m;[39m
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 56 |[39m     [36mawait[39m userEvent[33m.[39mclick(availableTab)[33m;[39m
     [90m 57 |[39m     
     [90m 58 |[39m     [90m// 2. The available dilemma is displayed[39m[0m

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at getElementError (node_modules/@testing-library/dom/dist/query-helpers.js:20:35)
      at getMultipleElementsFoundError (node_modules/@testing-library/dom/dist/query-helpers.js:23:10)
      at node_modules/@testing-library/dom/dist/query-helpers.js:55:13
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.<anonymous> (src/views/HelperDashboardView.test.tsx:55:33)

FAIL src/hooks/useIntelligentPreloading.test.ts (12.076 s)
  ● useIntelligentPreloading Hook › should initialize with default state

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 78 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useIntelligentPreloading())[33m;[39m
     [90m 79 |[39m
    [31m[1m>[22m[39m[90m 80 |[39m     expect(result[33m.[39mcurrent[33m.[39mpreloadingState[33m.[39misActive)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                     [31m[1m^[22m[39m
     [90m 81 |[39m     expect(result[33m.[39mcurrent[33m.[39mpreloadingState[33m.[39mcurrentPredictions)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m 82 |[39m     expect(result[33m.[39mcurrent[33m.[39mpreloadingState[33m.[39mtotalResourcesPreloaded)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m 83 |[39m     expect(result[33m.[39mcurrent[33m.[39mpreloadingState[33m.[39mlastPredictionTime)[33m.[39mtoBeNull()[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useIntelligentPreloading.test.ts:80:53)

FAIL tests/views/GroupSessionView.test.tsx
  ● GroupSessionView - Anonymity Features › handles session joining with anonymous identity

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "Joining session anonymously:", ObjectContaining {"anonymousAlias": Any<String>, "sessionId": Any<String>}

    Number of calls: 0

    [0m [90m 100 |[39m     [90m// Should show success message (mocked alert)[39m
     [90m 101 |[39m     [90m// The actual implementation would show a success state[39m
    [31m[1m>[22m[39m[90m 102 |[39m     expect(console[33m.[39mlog)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 103 |[39m       [32m'Joining session anonymously:'[39m[33m,[39m
     [90m 104 |[39m       expect[33m.[39mobjectContaining({
     [90m 105 |[39m         sessionId[33m:[39m expect[33m.[39many([33mString[39m)[33m,[39m[0m

      at Object.<anonymous> (tests/views/GroupSessionView.test.tsx:102:25)

  ● GroupSessionView - Security Features › uses secure anonymous session joining

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "Joining session anonymously:", ObjectContaining {"anonymousAlias": Any<String>, "participantNotes": StringContaining "Joined as"}

    Number of calls: 0

    [0m [90m 176 |[39m     
     [90m 177 |[39m     [90m// Verify joining mechanism uses anonymous identifier[39m
    [31m[1m>[22m[39m[90m 178 |[39m     expect(console[33m.[39mlog)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 179 |[39m       [32m'Joining session anonymously:'[39m[33m,[39m
     [90m 180 |[39m       expect[33m.[39mobjectContaining({
     [90m 181 |[39m         anonymousAlias[33m:[39m expect[33m.[39many([33mString[39m)[33m,[39m[0m

      at Object.<anonymous> (tests/views/GroupSessionView.test.tsx:178:25)

FAIL src/hooks/useErrorTracking.test.ts
  ● Test suite failed to run

    [96msrc/hooks/useErrorTracking.test.ts[0m:[93m398[0m:[93m9[0m - [91merror[0m[90m TS1005: [0m',' expected.

    [7m398[0m       } as TestProps
    [7m   [0m [91m        ~~[0m
    [96msrc/hooks/useErrorTracking.test.ts[0m:[93m398[0m:[93m12[0m - [91merror[0m[90m TS1005: [0m',' expected.

    [7m398[0m       } as TestProps
    [7m   [0m [91m           ~~~~~~~~~[0m
    [96msrc/hooks/useErrorTracking.test.ts[0m:[93m399[0m:[93m7[0m - [91merror[0m[90m TS1005: [0m',' expected.

    [7m399[0m       }
    [7m   [0m [91m      ~[0m
    [96msrc/hooks/useErrorTracking.test.ts[0m:[93m449[0m:[93m1[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m449[0m });
    [7m   [0m [91m~[0m
    [96msrc/hooks/useErrorTracking.test.ts[0m:[93m449[0m:[93m2[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m449[0m });
    [7m   [0m [91m ~[0m

FAIL src/hooks/useAccessibilityMonitoring.test.tsx
  ● Test suite failed to run

    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m48[0m:[93m4[0m - [91merror[0m[90m TS1005: [0m';' expected.

    [7m48[0m   });
    [7m  [0m [91m   ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m49[0m:[93m1[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m49[0m });
    [7m  [0m [91m~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m49[0m:[93m2[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m49[0m });
    [7m  [0m [91m ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m276[0m:[93m7[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m276[0m       ,
    [7m   [0m [91m      ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m279[0m:[93m5[0m - [91merror[0m[90m TS1005: [0m',' expected.

    [7m279[0m     )
    [7m   [0m [91m    ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m280[0m:[93m5[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m280[0m     );
    [7m   [0m [91m    ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m316[0m:[93m1[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m316[0m });
    [7m   [0m [91m~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m316[0m:[93m2[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m316[0m });
    [7m   [0m [91m ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m356[0m:[93m5[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m356[0m     );
    [7m   [0m [91m    ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m381[0m:[93m5[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m381[0m     );
    [7m   [0m [91m    ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m394[0m:[93m3[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m394[0m   });
    [7m   [0m [91m  ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m394[0m:[93m4[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m394[0m   });
    [7m   [0m [91m   ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m395[0m:[93m1[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m395[0m });
    [7m   [0m [91m~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m395[0m:[93m2[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m395[0m });
    [7m   [0m [91m ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m434[0m:[93m5[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m434[0m     );
    [7m   [0m [91m    ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m456[0m:[93m5[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m456[0m     );
    [7m   [0m [91m    ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m471[0m:[93m3[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m471[0m   });
    [7m   [0m [91m  ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m471[0m:[93m4[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m471[0m   });
    [7m   [0m [91m   ~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m472[0m:[93m1[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m472[0m });
    [7m   [0m [91m~[0m
    [96msrc/hooks/useAccessibilityMonitoring.test.tsx[0m:[93m472[0m:[93m2[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m472[0m });
    [7m   [0m [91m ~[0m

FAIL src/hooks/usePeerSupport.test.ts
  ● Test suite failed to run

    [96msrc/hooks/usePeerSupport.test.ts[0m:[93m547[0m:[93m7[0m - [91merror[0m[90m TS1005: [0m',' expected.

    [7m547[0m       }
    [7m   [0m [91m      ~[0m
    [96msrc/hooks/usePeerSupport.test.ts[0m:[93m597[0m:[93m1[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m597[0m });
    [7m   [0m [91m~[0m
    [96msrc/hooks/usePeerSupport.test.ts[0m:[93m597[0m:[93m2[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m597[0m });
    [7m   [0m [91m ~[0m

FAIL tests/accessibility/wcag-compliance.test.ts
  ● Test suite failed to run

    Cannot find module 'axe-playwright' from 'tests/accessibility/wcag-compliance.test.ts'

    [0m [90m 1 |[39m [36mimport[39m { test[33m,[39m expect[33m,[39m [33mPage[39m } [36mfrom[39m [32m'@playwright/test'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 2 |[39m [36mimport[39m { injectAxe[33m,[39m checkA11y[33m,[39m getViolations } [36mfrom[39m [32m'axe-playwright'[39m[33m;[39m
     [90m   |[39m [31m[1m^[22m[39m
     [90m 3 |[39m
     [90m 4 |[39m [90m/**[39m
     [90m 5 |[39m [90m * WCAG 2.1 AA Compliance Testing Suite[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (tests/accessibility/wcag-compliance.test.ts:2:1)

FAIL src/hooks/useConnectionStatus.test.ts (13.419 s)
  ● useConnectionStatus Hook › should detect offline status

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 78 |[39m     
     [90m 79 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 80 |[39m       expect(result[33m.[39mcurrent[33m.[39mconnectionStatus[33m.[39misOnline)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                        [31m[1m^[22m[39m
     [90m 81 |[39m       expect(result[33m.[39mcurrent[33m.[39mconnectionStatus[33m.[39mconnectionQuality)[33m.[39mtoBe([32m'offline'[39m)[33m;[39m
     [90m 82 |[39m     })[33m;[39m
     [90m 83 |[39m   })[33m;[39m[0m

      at src/hooks/useConnectionStatus.test.ts:80:56
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useConnectionStatus Hook › should handle service worker messages

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "message", Any<Function>

    Number of calls: 0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 403 |[39m     
     [90m 404 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 405 |[39m       expect(mockNavigator[33m.[39mserviceWorker[33m.[39maddEventListener)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                                            [31m[1m^[22m[39m
     [90m 406 |[39m         [32m'message'[39m[33m,[39m
     [90m 407 |[39m         expect[33m.[39many([33mFunction[39m)
     [90m 408 |[39m       )[33m;[39m[0m

      at src/hooks/useConnectionStatus.test.ts:405:60
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useConnectionStatus Hook › should handle when service worker is not supported

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 453 |[39m     [36mconst[39m { result } [33m=[39m renderHook(() [33m=>[39m useConnectionStatus())[33m;[39m
     [90m 454 |[39m     
    [31m[1m>[22m[39m[90m 455 |[39m     expect(result[33m.[39mcurrent[33m.[39mconnectionStatus[33m.[39misServiceWorkerSupported)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                                                                      [31m[1m^[22m[39m
     [90m 456 |[39m     
     [90m 457 |[39m     [90m// Restore service worker[39m
     [90m 458 |[39m     mockNavigator[33m.[39mserviceWorker [33m=[39m originalServiceWorker[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useConnectionStatus.test.ts:455:70)

  ● useConnectionStatus Hook › should warn when trying to send message without active service worker

    TypeError: Cannot read properties of undefined (reading 'getRegistration')

    [0m [90m 53 |[39m     jest[33m.[39mclearAllMocks()[33m;[39m
     [90m 54 |[39m     mockNavigator[33m.[39monLine [33m=[39m [36mtrue[39m[33m;[39m
    [31m[1m>[22m[39m[90m 55 |[39m     mockNavigator[33m.[39mserviceWorker[33m.[39mgetRegistration[33m.[39mmockResolvedValue([36mnull[39m)[33m;[39m
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 56 |[39m   })[33m;[39m
     [90m 57 |[39m
     [90m 58 |[39m   it([32m'should initialize with default connection status'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/hooks/useConnectionStatus.test.ts:55:33)

FAIL src/hooks/useEnhancedOffline.test.ts (16.352 s)
  ● useEnhancedOffline Hook › should update offline resources

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 425 |[39m
     [90m 426 |[39m     [90m// Should be updating during the call[39m
    [31m[1m>[22m[39m[90m 427 |[39m     expect(result[33m.[39mcurrent[33m.[39misUpdatingResources)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                                [31m[1m^[22m[39m
     [90m 428 |[39m
     [90m 429 |[39m     [36mawait[39m updatePromise[33m;[39m
     [90m 430 |[39m[0m

      at Object.<anonymous> (src/hooks/useEnhancedOffline.test.ts:427:48)

  ● useEnhancedOffline Hook › should handle update resources errors

    TypeError: Cannot read properties of null (reading 'isInitializing')

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 446 |[39m
     [90m 447 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 448 |[39m       expect(result[33m.[39mcurrent[33m.[39misInitializing)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 449 |[39m     })[33m;[39m
     [90m 450 |[39m
     [90m 451 |[39m     [36mawait[39m act([36masync[39m () [33m=>[39m {[0m

      at src/hooks/useEnhancedOffline.test.ts:448:29
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useEnhancedOffline Hook › should determine offline support correctly

    TypeError: Cannot read properties of null (reading 'hasOfflineSupport')

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 465 |[39m
     [90m 466 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 467 |[39m       expect(result1[33m.[39mcurrent[33m.[39mhasOfflineSupport)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 468 |[39m     })[33m;[39m
     [90m 469 |[39m
     [90m 470 |[39m     [90m// Test with limited support[39m[0m

      at src/hooks/useEnhancedOffline.test.ts:467:30
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useEnhancedOffline Hook › should handle storage estimation errors gracefully

    TypeError: Cannot read properties of null (reading 'isInitializing')

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 492 |[39m
     [90m 493 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 494 |[39m       expect(result[33m.[39mcurrent[33m.[39misInitializing)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 495 |[39m     })[33m;[39m
     [90m 496 |[39m
     [90m 497 |[39m     expect(result[33m.[39mcurrent[33m.[39mstorageUsage[33m.[39mused)[33m.[39mtoBe([35m0[39m)[33m;[39m[0m

      at src/hooks/useEnhancedOffline.test.ts:494:29
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useEnhancedOffline Hook › should handle browsers without storage API

    TypeError: Cannot read properties of null (reading 'isInitializing')

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 514 |[39m
     [90m 515 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 516 |[39m       expect(result[33m.[39mcurrent[33m.[39misInitializing)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 517 |[39m     })[33m;[39m
     [90m 518 |[39m
     [90m 519 |[39m     expect(result[33m.[39mcurrent[33m.[39mstorageUsage[33m.[39mused)[33m.[39mtoBe([35m0[39m)[33m;[39m[0m

      at src/hooks/useEnhancedOffline.test.ts:516:29
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useEnhancedOffline Hook › should update storage usage periodically

    TypeError: Cannot read properties of null (reading 'isInitializing')

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 530 |[39m
     [90m 531 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 532 |[39m       expect(result[33m.[39mcurrent[33m.[39misInitializing)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 533 |[39m     })[33m;[39m
     [90m 534 |[39m
     [90m 535 |[39m     [90m// Clear the initial call[39m[0m

      at src/hooks/useEnhancedOffline.test.ts:532:29
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at node_modules/@testing-library/dom/dist/wait-for.js:82:9

  ● useEnhancedOffline Hook › should handle status change callbacks

    TypeError: Cannot read properties of null (reading 'isInitializing')

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 556 |[39m
     [90m 557 |[39m     [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 558 |[39m       expect(result[33m.[39mcurrent[33m.[39misInitializing)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 559 |[39m     })[33m;[39m
     [90m 560 |[39m
     [90m 561 |[39m     [36mconst[39m updatedStatus [33m=[39m {[0m

      at src/hooks/useEnhancedOffline.test.ts:558:29
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at node_modules/@testing-library/dom/dist/wait-for.js:82:9

  ● useEnhancedOffline Hook › should cleanup event listeners on unmount

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "online", Any<Function>

    Number of calls: 0

    [0m [90m 578 |[39m     [36mconst[39m { unmount } [33m=[39m renderHook(() [33m=>[39m useEnhancedOffline())[33m;[39m
     [90m 579 |[39m
    [31m[1m>[22m[39m[90m 580 |[39m     expect(addEventListenerSpy)[33m.[39mtoHaveBeenCalledWith([32m'online'[39m[33m,[39m expect[33m.[39many([33mFunction[39m))[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 581 |[39m     expect(addEventListenerSpy)[33m.[39mtoHaveBeenCalledWith([32m'offline'[39m[33m,[39m expect[33m.[39many([33mFunction[39m))[33m;[39m
     [90m 582 |[39m
     [90m 583 |[39m     unmount()[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useEnhancedOffline.test.ts:580:33)

  ● useEnhancedOffline Hook › should clear storage usage update interval on unmount

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 599 |[39m     unmount()[33m;[39m
     [90m 600 |[39m
    [31m[1m>[22m[39m[90m 601 |[39m     expect(clearIntervalSpy)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 602 |[39m
     [90m 603 |[39m     jest[33m.[39museRealTimers()[33m;[39m
     [90m 604 |[39m     clearIntervalSpy[33m.[39mmockRestore()[33m;[39m[0m

      at Object.<anonymous> (src/hooks/useEnhancedOffline.test.ts:601:30)

FAIL src/tests/culturalCrisisDetection.test.tsx (10.344 s)
  ● Cultural Crisis Detection Integration › Cross-Cultural Crisis Scenarios › western cultural context › should detect indirectDistress crisis appropriately

    TypeError: Cannot read properties of undefined (reading 'culturallyAdjustedRisk')

    [0m [90m 148 |[39m           [33m...[39mprev[33m,[39m
     [90m 149 |[39m           lastAnalysis[33m:[39m analysis[33m,[39m
    [31m[1m>[22m[39m[90m 150 |[39m           culturallyAdjustedRisk[33m:[39m analysis[33m.[39mculturallyAdjustedRisk[33m?[39m[33m.[39madjustedRisk [33m||[39m [35m0[39m[33m,[39m
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 151 |[39m           biasAdjustments[33m:[39m analysis[33m.[39mculturalBiasAdjustments[33m?[39m[33m.[39mmap(adj [33m=>[39m adj[33m.[39mfactor) [33m||[39m [][33m,[39m
     [90m 152 |[39m           culturalInterventions[33m:[39m analysis[33m.[39mculturalInterventions [33m||[39m [36mnull[39m[33m,[39m
     [90m 153 |[39m           analysisHistory[33m:[39m newHistory[33m,[39m[0m

      at src/hooks/useCulturalCrisisDetection.ts:150:44
      at basicStateReducer (node_modules/react-dom/cjs/react-dom.development.js:15721:41)
      at updateReducer (node_modules/react-dom/cjs/react-dom.development.js:15845:22)
      at updateState (node_modules/react-dom/cjs/react-dom.development.js:16185:10)
      at Object.useState (node_modules/react-dom/cjs/react-dom.development.js:17096:16)
      at useState (node_modules/react/cjs/react.development.js:1622:21)
      at useCulturalCrisisDetection (src/hooks/useCulturalCrisisDetection.ts:79:37)
      at CulturalCrisisAlert (src/components/CulturalCrisisAlert.tsx:84:33)
      at renderWithHooks (node_modules/react-dom/cjs/react-dom.development.js:15486:18)
      at updateFunctionComponent (node_modules/react-dom/cjs/react-dom.development.js:19617:20)
      at beginWork (node_modules/react-dom/cjs/react-dom.development.js:21640:16)
      at beginWork$1 (node_modules/react-dom/cjs/react-dom.development.js:27465:14)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26599:12)
      at workLoopSync (node_modules/react-dom/cjs/react-dom.development.js:26505:5)
      at renderRootSync (node_modules/react-dom/cjs/react-dom.development.js:26473:7)
      at recoverFromConcurrentError (node_modules/react-dom/cjs/react-dom.development.js:25889:20)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25789:22)
      at workLoop (node_modules/scheduler/cjs/scheduler.development.js:266:34)
      at flushWork (node_modules/scheduler/cjs/scheduler.development.js:239:14)
      at performWorkUntilDeadline (node_modules/scheduler/cjs/scheduler.development.js:533:21)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● Cultural Crisis Detection Integration › Bias Mitigation › should adjust risk scores based on cultural context

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ArrayContaining [StringContaining "communication_style"]

    Number of calls: 0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div[39m
          [33mdata-testid[39m=[32m"test-container"[39m
        [36m>[39m
          [36m<div[39m
            [33maria-labelledby[39m=[32m"crisis-alert-title"[39m
            [33maria-live[39m=[32m"assertive"[39m
            [33mclass[39m=[32m"crisis-alert crisis-alert--medium crisis-alert--show"[39m
            [33mid[39m=[32m"crisis-alert"[39m
            [33mrole[39m=[32m"alert"[39m
            [33mtabindex[39m=[32m"-1"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert__backdrop"[39m
            [36m/>[39m
            [36m<div[39m
              [33mclass[39m=[32m"crisis-alert__container"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-alert__header"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"crisis-alert__icon-container"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33maria-hidden[39m=[32m"true"[39m
                    [33mclass[39m=[32m"crisis-alert__icon"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mheight[39m=[32m"24"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mstyle[39m=[32m"color: rgb(217, 119, 6);"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mwidth[39m=[32m"24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1Z"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"crisis-alert__title-container"[39m
                [36m>[39m
                  [36m<h2[39m
                    [33mclass[39m=[32m"crisis-alert__title"[39m
                    [33mid[39m=[32m"crisis-alert-title"[39m
                  [36m>[39m
                    [0mSupport Recommended[0m
                  [36m</h2>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"crisis-alert__timestamp"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33maria-hidden[39m=[32m"true"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"14"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"14"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.2L17,14.7L16.2,16.2Z"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                    [36m<span>[39m
                      [0m2:58:47 PM[0m
                    [36m</span>[39m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Close alert"[39m
                  [33mclass[39m=[32m"crisis-alert__close"[39m
                  [33mtype[39m=[32m"button"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33maria-hidden[39m=[32m"true"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mheight[39m=[32m"20"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mwidth[39m=[32m"20"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-alert__content"[39m
              [36m>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"crisis-alert__message"[39m
                [36m>[39m
                  [0mHelp is available. You are not alone.[0m
                [36m</p>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-alert__actions-section"[39m
              [36m>[39m
                [36m<h3[39m
                  [33mclass[39m=[32m"crisis-alert__section-title"[39m
                [36m>[39m
                  [0mRecommended Actions[0m
                [36m</h3>[39m
                [36m<ul[39m
                  [33mclass[39m=[32m"crisis-alert__actions-list"[39m
                [36m>[39m
                  [36m<li[39m
                    [33mclass[39m=[32m"crisis-alert__action-item"[39m
                  [36m>[39m
                    [0mcommunication_style[0m
                  [36m</li>[39m
                  [36m<li[39m
                    [33mclass[39m=[32m"crisis-alert__action-item"[39m
                  [36m>[39m
                    [0mFamily-centered crisis intervention approach recommended[0m
                  [36m</li>[39m
                  [36m<li[39m
                    [33mclass[39m=[32m"crisis-alert__action-item"[39m
                  [36m>[39m
                    [0mCommunity-based support systems available[0m
                  [36m</li>[39m
                  [36m<li[39m
                    [33mclass[39m=[32m"crisis-alert__action-item"[39m
                  [36m>[39m
                    [0meastern_counseling[0m
                  [36m</li>[39m
                  [36m<li[39m
                    [33mclass[39m=[32m"crisis-alert__action-item"[39m
                  [36m>[39m
                    [0mzh_crisis_line[0m
                  [36m</li>[39m
                [36m</ul>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-alert__chat-section"[39m
              [36m>[39m
                [36m<button[39m
                  [33mclass[39m=[32m"crisis-alert__chat-button"[39m
                  [33mtype[39m=[32m"button"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33maria-hidden[39m=[32m"true"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mheight[39m=[32m"20"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mwidth[39m=[32m"20"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                  [36m<span>[39m
                    [0mStart Crisis Chat[0m
                  [36m</span>[39m
                [36m</button>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-alert__resources-section"[39m
              [36m>[39m
                [36m<h3[39m
                  [33mclass[39m=[32m"crisis-alert__section-title"[39m
                [36m>[39m
                  [0mAdditional Resources[0m
                [36m</h3>[39m
                [36m<ul[39m
                  [33mclass[39m=[32m"crisis-alert__resources-list"[39m
                [36m>[39m
                  [36m<li[39m
                    [33mclass[39m=[32m"crisis-alert__resource-item"[39m
                  [36m>[39m
                    [0m988 Suicide & Crisis Lifeline[0m
                  [36m</li>[39m
                  [36m<li[39m
                    [33mclass[39m=[32m"crisis-alert__resource-item"[39m
                  [36m>[39m
                    [0mCrisis Text Line: Text HOME to 741741[0m
                  [36m</li>[39m
                [36m</ul>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"crisis-alert__footer"[39m
              [36m>[39m
                [36m<button[39m
                  [33mclass[39m=[32m"crisis-alert__dismiss-button"[39m
                  [33mtype[39m=[32m"button"[39m
                [36m>[39m
                  [0mI understand[0m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 465 |[39m       [90m// Give more time for the hook's useEffect to process and trigger callbacks[39m
     [90m 466 |[39m       [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 467 |[39m         expect(onBiasDetected)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 468 |[39m           expect[33m.[39marrayContaining([
     [90m 469 |[39m             expect[33m.[39mstringContaining([32m'communication_style'[39m)
     [90m 470 |[39m           ])[0m

      at timeout (src/tests/culturalCrisisDetection.test.tsx:467:32)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

FAIL src/services/__tests__/comprehensivePerformanceMonitor.test.ts
  ● Test suite failed to run

    Jest worker encountered 4 child process exceptions, exceeding retry limit

      at ChildProcessWorker.initialize (node_modules/jest-worker/build/workers/ChildProcessWorker.js:181:21)


Test Suites: 83 failed, 49 passed, 132 total
Tests:       607 failed, 2437 passed, 3044 total
Snapshots:   0 total
Time:        27.549 s
Ran all test suites matching /test/i.
